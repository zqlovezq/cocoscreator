
                (function() {
                    var nodeEnv = typeof require !== 'undefined' && typeof process !== 'undefined';
                    var __module = nodeEnv ? module : {exports:{}};
                    var __filename = 'preview-scripts/assets/Script/Tools.js';
                    var __require = nodeEnv ? function (request) {
                        return cc.require(request);
                    } : function (request) {
                        return __quick_compile_project__.require(request, __filename);
                    };
                    function __define (exports, require, module) {
                        if (!nodeEnv) {__quick_compile_project__.registerModule(__filename, module);}"use strict";
cc._RF.push(module, '5f815fcXZ9BIY+pPRsOeaGx', 'Tools');
// Script/Tools.js

"use strict";

cc.Tools = {
  /**
   * @param {*} event 数数打点的事件名称
   * @param {*} pro 数数打点的关联属性
  */
  dot: function dot(event, pro) {
    if (cc.sys.isNative) {
      console.log("cocos----注册打点" + event); // jsb.reflection.callStaticMethod("org/cocos2dx/javascript/AppActivity", "dot", "(Ljava/lang/String;)V", event, JSON.stringify(pro));

      jsb.reflection.callStaticMethod("org/cocos2dx/javascript/AppActivity", "dot", "(Ljava/lang/String;Ljava/lang/String;)V", event, JSON.stringify(pro));
    }
  },

  /**
   * 看视频回调
   */
  adCallBack: function adCallBack(ecpm) {
    console.log("cocos----观看视频回调"); // 获取广告ad之前先用epcr
    // 看视频得体力

    this.getUserEcpm(ecpm).then(function () {
      console.log("cocos----获取ecpm之后才调用");

      if (cc.zm.userInfo.power <= 0) {
        console.log("cocos----体力接口");
        var sendData = {
          ad: cc.zm.ad
        };
        cc.Tools.sendRequest("pit.v1.PitSvc/GrowPower", "POST", sendData).then(function (res) {
          console.log("cocos----获取体力奖励");
          cc.zm.userInfo.power = res.data.value;

          if (cc.zm.videoAd.enterGame) {
            cc.director.loadScene('Game');
          }
        });
      } // 看视频得红包


      if (cc.zm.videoAd.redPack) {
        console.log("cocos----获取红包接口");
        cc.Tools.sendRequest("pit.v1.PitSvc/PassAd", "POST", cc.zm.videoAd.redPack).then(function (res) {
          console.log("cocos----获取红包奖励", res);
          var sendData = {};
          cc.Tools.sendRequest("pit.v1.PitSvc/UserInfo", "GET", sendData).then(function (res) {
            cc.zm.userInfo = res.data; // 如果体力大于0 进入下一关

            if (cc.zm.userInfo.power > 0) {
              cc.Tools.sendRequest("pit.v1.PitSvc/Stage", "GET", {}).then(function (res) {
                cc.zm.LevelInfo = res.data;
                cc.zm.videoAd.redPack = null;

                if (cc.zm.LevelInfo.stage < 30) {
                  cc.director.loadScene('Game');
                } else {
                  // 直接返回主界面
                  cc.director.loadScene('Index');
                }
              });
            } else {
              // 小于0 弹出看视频获得体力的接口
              cc.director.loadScene('Index');
            }
          });
        });
      }

      if (cc.zm.videoAd.clickSign) {
        console.log("cocos----签到接口");
        cc.zm.videoAd.clickSign = false;
      }

      if (cc.zm.videoAd.clickTable) {
        console.log("cocos----转盘接口");
        cc.zm.videoAd.clickTable = false;
      }
    });
  },
  // 显示激励视频
  showJiliAd: function showJiliAd() {
    console.log("cocos----点击显示激励视频");

    if (cc.sys.isNative) {
      jsb.reflection.callStaticMethod("org/cocos2dx/javascript/AppActivity", "showAd", "()V");
    }
  },
  // 显示banner
  showBanner: function showBanner() {
    if (cc.sys.isNative) {
      jsb.reflection.callStaticMethod("org/cocos2dx/javascript/AppActivity", "showBanner", "()V");
    }
  },
  // 隐藏banner
  hideBanner: function hideBanner() {
    if (cc.sys.isNative) {
      jsb.reflection.callStaticMethod("org/cocos2dx/javascript/AppActivity", "hideBanner", "()V");
    }
  },
  // 显示插屏广告
  showTableScreen: function showTableScreen() {
    console.log("cococ----触发插屏");

    if (cc.sys.isNative) {
      jsb.reflection.callStaticMethod("org/cocos2dx/javascript/AppActivity", "showTableScreen", "()V");
    }
  },
  // 隐藏插屏广告
  hideTableScreen: function hideTableScreen() {
    if (cc.sys.isNative) {
      jsb.reflection.callStaticMethod("org/cocos2dx/javascript/AppActivity", "hideTableScreen", "()V");
    }
  },
  // 微信登陆
  wxLogin: function wxLogin() {
    console.log("cocos----wxLogin");

    if (cc.sys.isNative) {
      jsb.reflection.callStaticMethod("org/cocos2dx/javascript/AppActivity", "weixin_login", "(Ljava/lang/String;)V", "weixin_login");
    }
  },

  /**
  * 接收native微信授权的code
  * @param errCode 
  */
  wxLoginResult: function wxLoginResult(errCode) {
    console.log("cocos----wxLoginResultcode=" + errCode);
    cc.wxLoginResultcode = errCode;
  },

  /**
   * 看广告之后刷新一下ecpm
   */
  getUserEcpm: function getUserEcpm(ecpm) {
    if (!cc.zm) {
      return;
    }

    console.log("cocos----调用ecpm=", ecpm);
    return new Promise(function (resolve, reject) {
      var sendData = {
        "ecpm": parseInt(ecpm),
        "ts": new Date().getTime() //时间戳

      };
      var data = cc.Tools.createSignData(sendData);
      cc.Tools.sendRequest("pit.v1.PitSvc/Rc", "POST", data).then(function (res) {
        console.log("cocos----Ecpm成功", res.data);
        cc.zm.ad = res.data.ad;
        resolve();
      })["catch"](function (res) {
        console.log("cocos----Ecpm失败", res);
        reject(res);
      });
    });
  },

  /**
   * 
   * @param {*} data 需要签名数据
   * @returns 
   */
  createSignData: function createSignData(data) {
    var sortList = [];

    for (var key in data) {
      if (data.hasOwnProperty(key) && key != "sign") {
        var value = data[key];
        var item = {};
        item.key = key;
        item.value = value;
        sortList.push(key);
      }
    }

    sortList.sort();
    var strToJiaMi = "";
    sortList.forEach(function (key) {
      strToJiaMi += "&" + key + "=" + data[key];
    }, this);
    strToJiaMi = "token=" + cc.zm.userInfo.sc1 + strToJiaMi;

    var hex_md5 = require("MD5");

    strToJiaMi = hex_md5(strToJiaMi);
    data.sign = strToJiaMi;
    return data;
  },
  // 适配屏幕
  screenAdapter: function screenAdapter() {
    var canvas = cc.find("Canvas").getComponent(cc.Canvas);
    var winSize = cc.view.getVisibleSize();

    if (winSize.height / winSize.width <= 720 / 1280) {
      canvas.fitHeight = true;
      canvas.fitWidth = false;
    } else {
      canvas.fitHeight = false;
      canvas.fitWidth = true;
    }
  },

  /**
   * 
   * @param {*} n node节点
   * @param {*} str  显示的tips内容
   */
  showTips: function showTips(n, str) {
    var tips = n.getChildByName("Tips");
    tips.getComponent(cc.Label).string = str;
    tips.stopAllActions();
    tips.y = 145;
    cc.tween(tips).to(0.1, {
      opacity: 255
    }).to(1, {
      y: 300
    }).delay(0.5).to(0.1, {
      opacity: 0
    }).start();
  },

  /**
   * 
   * @param {*} url 请求接口的url----pit.v1.PitSvc/UserInfo
   * @param {*} type 请求接口的类型 只能是GET--POST
   * @param {*} data 请求接口所需要的数据
   * @returns 
   */
  sendRequest: function sendRequest(url, type, data) {
    return new Promise(function (resolve, reject) {
      var xhr = new XMLHttpRequest();
      var requestURL = "https://pit.api.jiankangzhuan.com/" + url;
      xhr.open(type, requestURL, true);

      if (cc.sys.isNative) {
        xhr.setRequestHeader("Accept-Encodeing", "gzip,deflate");
      }

      if (cc.wxToken) {
        xhr.setRequestHeader("Authorization", cc.wxToken);
      }

      xhr.setRequestHeader("Content-Type", "application/json");
      console.log("cocos----requestURL=", requestURL);
      console.log("cocos----data=", JSON.stringify(data));

      xhr.onreadystatechange = function () {
        if (xhr.readyState === 4 && xhr.status == 200) {
          console.log("cocos----http res:" + xhr.response); // 统一处理

          var _response = JSON.parse(xhr.response);

          if (_response.code === 0) {
            resolve(_response);
          } else {
            console.log("cocos----" + _response.message);
            reject(_response.message);
          }
        }
      };

      xhr.onerror = function () {
        reject(new Error(xhr.statusText));
      };

      xhr.send(JSON.stringify(data));
    });
  }
};

cc._RF.pop();
                    }
                    if (nodeEnv) {
                        __define(__module.exports, __require, __module);
                    }
                    else {
                        __quick_compile_project__.registerModuleFunc(__filename, function () {
                            __define(__module.exports, __require, __module);
                        });
                    }
                })();
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImFzc2V0cy9TY3JpcHQvVG9vbHMuanMiXSwibmFtZXMiOlsiY2MiLCJUb29scyIsImRvdCIsImV2ZW50IiwicHJvIiwic3lzIiwiaXNOYXRpdmUiLCJjb25zb2xlIiwibG9nIiwianNiIiwicmVmbGVjdGlvbiIsImNhbGxTdGF0aWNNZXRob2QiLCJKU09OIiwic3RyaW5naWZ5IiwiYWRDYWxsQmFjayIsImVjcG0iLCJnZXRVc2VyRWNwbSIsInRoZW4iLCJ6bSIsInVzZXJJbmZvIiwicG93ZXIiLCJzZW5kRGF0YSIsImFkIiwic2VuZFJlcXVlc3QiLCJyZXMiLCJkYXRhIiwidmFsdWUiLCJ2aWRlb0FkIiwiZW50ZXJHYW1lIiwiZGlyZWN0b3IiLCJsb2FkU2NlbmUiLCJyZWRQYWNrIiwiTGV2ZWxJbmZvIiwic3RhZ2UiLCJjbGlja1NpZ24iLCJjbGlja1RhYmxlIiwic2hvd0ppbGlBZCIsInNob3dCYW5uZXIiLCJoaWRlQmFubmVyIiwic2hvd1RhYmxlU2NyZWVuIiwiaGlkZVRhYmxlU2NyZWVuIiwid3hMb2dpbiIsInd4TG9naW5SZXN1bHQiLCJlcnJDb2RlIiwid3hMb2dpblJlc3VsdGNvZGUiLCJQcm9taXNlIiwicmVzb2x2ZSIsInJlamVjdCIsInBhcnNlSW50IiwiRGF0ZSIsImdldFRpbWUiLCJjcmVhdGVTaWduRGF0YSIsInNvcnRMaXN0Iiwia2V5IiwiaGFzT3duUHJvcGVydHkiLCJpdGVtIiwicHVzaCIsInNvcnQiLCJzdHJUb0ppYU1pIiwiZm9yRWFjaCIsInNjMSIsImhleF9tZDUiLCJyZXF1aXJlIiwic2lnbiIsInNjcmVlbkFkYXB0ZXIiLCJjYW52YXMiLCJmaW5kIiwiZ2V0Q29tcG9uZW50IiwiQ2FudmFzIiwid2luU2l6ZSIsInZpZXciLCJnZXRWaXNpYmxlU2l6ZSIsImhlaWdodCIsIndpZHRoIiwiZml0SGVpZ2h0IiwiZml0V2lkdGgiLCJzaG93VGlwcyIsIm4iLCJzdHIiLCJ0aXBzIiwiZ2V0Q2hpbGRCeU5hbWUiLCJMYWJlbCIsInN0cmluZyIsInN0b3BBbGxBY3Rpb25zIiwieSIsInR3ZWVuIiwidG8iLCJvcGFjaXR5IiwiZGVsYXkiLCJzdGFydCIsInVybCIsInR5cGUiLCJ4aHIiLCJYTUxIdHRwUmVxdWVzdCIsInJlcXVlc3RVUkwiLCJvcGVuIiwic2V0UmVxdWVzdEhlYWRlciIsInd4VG9rZW4iLCJvbnJlYWR5c3RhdGVjaGFuZ2UiLCJyZWFkeVN0YXRlIiwic3RhdHVzIiwicmVzcG9uc2UiLCJfcmVzcG9uc2UiLCJwYXJzZSIsImNvZGUiLCJtZXNzYWdlIiwib25lcnJvciIsIkVycm9yIiwic3RhdHVzVGV4dCIsInNlbmQiXSwibWFwcGluZ3MiOiI7Ozs7Ozs7Ozs7Ozs7Ozs7O0FBQUFBLEVBQUUsQ0FBQ0MsS0FBSCxHQUFXO0FBQ1A7QUFDSjtBQUNBO0FBQ0E7QUFDSUMsRUFBQUEsR0FMTyxlQUtIQyxLQUxHLEVBS0lDLEdBTEosRUFLUztBQUNaLFFBQUlKLEVBQUUsQ0FBQ0ssR0FBSCxDQUFPQyxRQUFYLEVBQXFCO0FBQ2pCQyxNQUFBQSxPQUFPLENBQUNDLEdBQVIsQ0FBWSxrQkFBa0JMLEtBQTlCLEVBRGlCLENBRWpCOztBQUNBTSxNQUFBQSxHQUFHLENBQUNDLFVBQUosQ0FBZUMsZ0JBQWYsQ0FBZ0MscUNBQWhDLEVBQXVFLEtBQXZFLEVBQThFLHlDQUE5RSxFQUF5SFIsS0FBekgsRUFBK0hTLElBQUksQ0FBQ0MsU0FBTCxDQUFlVCxHQUFmLENBQS9IO0FBQ0g7QUFDSixHQVhNOztBQWFQO0FBQ0o7QUFDQTtBQUNJVSxFQUFBQSxVQWhCTyxzQkFnQklDLElBaEJKLEVBZ0JVO0FBQ2JSLElBQUFBLE9BQU8sQ0FBQ0MsR0FBUixDQUFZLGlCQUFaLEVBRGEsQ0FFYjtBQUNBOztBQUNBLFNBQUtRLFdBQUwsQ0FBaUJELElBQWpCLEVBQXVCRSxJQUF2QixDQUE0QixZQUFJO0FBQzVCVixNQUFBQSxPQUFPLENBQUNDLEdBQVIsQ0FBWSxzQkFBWjs7QUFDQSxVQUFJUixFQUFFLENBQUNrQixFQUFILENBQU1DLFFBQU4sQ0FBZUMs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LENBQUN1RCxTQUFTLENBQUNHLE9BQVgsQ0FBTjtBQUNIO0FBQ0o7QUFDSixPQVpEOztBQWFBYixNQUFBQSxHQUFHLENBQUNjLE9BQUosR0FBYyxZQUFZO0FBQ3RCM0QsUUFBQUEsTUFBTSxDQUFDLElBQUk0RCxLQUFKLENBQVVmLEdBQUcsQ0FBQ2dCLFVBQWQsQ0FBRCxDQUFOO0FBQ0gsT0FGRDs7QUFHQWhCLE1BQUFBLEdBQUcsQ0FBQ2lCLElBQUosQ0FBU2pHLElBQUksQ0FBQ0MsU0FBTCxDQUFlWSxJQUFmLENBQVQ7QUFDSCxLQTlCTSxDQUFQO0FBK0JIO0FBNU9NLENBQVgiLCJzb3VyY2VSb290IjoiLyIsInNvdXJjZXNDb250ZW50IjpbImNjLlRvb2xzID0ge1xuICAgIC8qKlxuICAgICAqIEBwYXJhbSB7Kn0gZXZlbnQg5pWw5pWw5omT54K555qE5LqL5Lu25ZCN56ewXG4gICAgICogQHBhcmFtIHsqfSBwcm8g5pWw5pWw5omT54K555qE5YWz6IGU5bGe5oCnXG4gICAgKi9cbiAgICBkb3QoZXZlbnQsIHBybykge1xuICAgICAgICBpZiAoY2Muc3lzLmlzTmF0aXZlKSB7XG4gICAgICAgICAgICBjb25zb2xlLmxvZyhcImNvY29zLS0tLeazqOWGjOaJk+eCuVwiICsgZXZlbnQpO1xuICAgICAgICAgICAgLy8ganNiLnJlZmxlY3Rpb24uY2FsbFN0YXRpY01ldGhvZChcIm9yZy9jb2NvczJkeC9qYXZhc2NyaXB0L0FwcEFjdGl2aXR5XCIsIFwiZG90XCIsIFwiKExqYXZhL2xhbmcvU3RyaW5nOylWXCIsIGV2ZW50LCBKU09OLnN0cmluZ2lmeShwcm8pKTtcbiAgICAgICAgICAgIGpzYi5yZWZsZWN0aW9uLmNhbGxTdGF0aWNNZXRob2QoXCJvcmcvY29jb3MyZHgvamF2YXNjcmlwdC9BcHBBY3Rpdml0eVwiLCBcImRvdFwiLCBcIihMamF2YS9sYW5nL1N0cmluZztMamF2YS9sYW5nL1N0cmluZzspVlwiLCBldmVudCxKU09OLnN0cmluZ2lmeShwcm8pKTtcbiAgICAgICAgfVxuICAgIH0sXG5cbiAgICAvKipcbiAgICAgKiDnnIvop4bpopHlm57osINcbiAgICAgKi9cbiAgICBhZENhbGxCYWNrKGVjcG0pIHtcbiAgICAgICAgY29uc29sZS5sb2coXCJjb2Nvcy0tLS3op4LnnIvop4bpopHlm57osINcIik7XG4gICAgICAgIC8vIOiOt+WPluW5v+WRimFk5LmL5YmN5YWI55SoZXBjclxuICAgICAgICAvLyDnnIvop4bpopHlvpfkvZPliptcbiAgICAgICAgdGhpcy5nZXRVc2VyRWNwbShlY3BtKS50aGVuKCgpPT57XG4gICAgICAgICAgICBjb25zb2xlLmxvZyhcImNvY29zLS0tLeiOt+WPlmVjcG3kuYvlkI7miY3osIPnlKhcIik7XG4gICAgICAgICAgICBpZiAoY2Muem0udXNlckluZm8ucG93ZXI8PTApIHtcbiAgICAgICAgICAgICAgICBjb25zb2xlLmxvZyhcImNvY29zLS0tLeS9k+WKm+aOpeWPo1wiKTtcbiAgICAgICAgICAgICAgICBsZXQgc2VuZERhdGEgPSB7XG4gICAgICAgICAgICAgICAgICAgIGFkOiBjYy56bS5hZFxuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBjYy5Ub29scy5zZW5kUmVxdWVzdChcInBpdC52MS5QaXRTdmMvR3Jvd1Bvd2VyXCIsIFwiUE9TVFwiLCBzZW5kRGF0YSkudGhlbigocmVzKSA9PiB7XG4gICAgICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKFwiY29jb3MtLS0t6I635Y+W5L2T5Yqb5aWW5YqxXCIpXG4gICAgICAgICAgICAgICAgICAgIGNjLnptLnVzZXJJbmZvLnBvd2VyID0gcmVzLmRhdGEudmFsdWU7XG4gICAgICAgICAgICAgICAgICAgIGlmKGNjLnptLnZpZGVvQWQuZW50ZXJHYW1lKXtcbiAgICAgICAgICAgICAgICAgICAgICAgIGNjLmRpcmVjdG9yLmxvYWRTY2VuZSgnR2FtZScpO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICAvLyDnnIvop4bpopHlvpfnuqLljIVcbiAgICAgICAgICAgIGlmIChjYy56bS52aWRlb0FkLnJlZFBhY2spIHtcbiAgICAgICAgICAgICAgICBjb25zb2xlLmxvZyhcImNvY29zLS0tLeiOt+WPlue6ouWMheaOpeWPo1wiKTtcbiAgICAgICAgICAgICAgICBjYy5Ub29scy5zZW5kUmVxdWVzdChcInBpdC52MS5QaXRTdmMvUGFzc0FkXCIsIFwiUE9TVFwiLCBjYy56bS52aWRlb0FkLnJlZFBhY2spLnRoZW4oKHJlcykgPT4ge1xuICAgICAgICAgICAgICAgICAgICBjb25zb2xlLmxvZyhcImNvY29zLS0tLeiOt+WPlue6ouWMheWlluWKsVwiLCByZXMpO1xuICAgICAgICAgICAgICAgICAgICBsZXQgc2VuZERhdGEgPSB7fTtcbiAgICAgICAgICAgICAgICAgICAgY2MuVG9vbHMuc2VuZFJlcXVlc3QoXCJwaXQudjEuUGl0U3ZjL1VzZXJJbmZvXCIsIFwiR0VUXCIsIHNlbmREYXRhKS50aGVuKChyZXMpID0+IHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGNjLnptLnVzZXJJbmZvID0gcmVzLmRhdGE7XG4gICAgICAgICAgICAgICAgICAgICAgICAvLyDlpoLmnpzkvZPlipvlpKfkuo4wIOi/m+WFpeS4i+S4gOWFs1xuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGNjLnptLnVzZXJJbmZvLnBvd2VyID4gMCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNjLlRvb2xzLnNlbmRSZXF1ZXN0KFwicGl0LnYxLlBpdFN2Yy9TdGFnZVwiLCBcIkdFVFwiLCB7fSkudGhlbigocmVzKSA9PiB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNjLnptLkxldmVsSW5mbyA9IHJlcy5kYXRhO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjYy56bS52aWRlb0FkLnJlZFBhY2sgPSBudWxsO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoY2Muem0uTGV2ZWxJbmZvLnN0YWdlIDwgMzApIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNjLmRpcmVjdG9yLmxvYWRTY2VuZSgnR2FtZScpO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgLy8g55u05o6l6L+U5Zue5Li755WM6Z2iXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjYy5kaXJlY3Rvci5sb2FkU2NlbmUoJ0luZGV4Jyk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgLy8g5bCP5LqOMCDlvLnlh7rnnIvop4bpopHojrflvpfkvZPlipvnmoTmjqXlj6NcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjYy5kaXJlY3Rvci5sb2FkU2NlbmUoJ0luZGV4Jyk7XG4gICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIH0pXG4gICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBpZihjYy56bS52aWRlb0FkLmNsaWNrU2lnbil7XG4gICAgICAgICAgICAgICAgY29uc29sZS5sb2coXCJjb2Nvcy0tLS3nrb7liLDmjqXlj6NcIik7XG4gICAgICAgICAgICAgICAgY2Muem0udmlkZW9BZC5jbGlja1NpZ24gPSBmYWxzZTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGlmKGNjLnptLnZpZGVvQWQuY2xpY2tUYWJsZSl7XG4gICAgICAgICAgICAgICAgY29uc29sZS5sb2coXCJjb2Nvcy0tLS3ovaznm5jmjqXlj6NcIik7XG4gICAgICAgICAgICAgICAgY2Muem0udmlkZW9BZC5jbGlja1RhYmxlID0gZmFsc2U7XG4gICAgICAgICAgICB9XG4gICAgICAgIH0pXG4gICAgfSxcbiAgICAvLyDmmL7npLrmv4DlirHop4bpopFcbiAgICBzaG93SmlsaUFkKCkge1xuICAgICAgICBjb25zb2xlLmxvZyhcImNvY29zLS0tLeeCueWHu+aYvuekuua/gOWKseinhumikVwiKVxuICAgICAgICBpZiAoY2Muc3lzLmlzTmF0aXZlKSB7XG4gICAgICAgICAgICBqc2IucmVmbGVjdGlvbi5jYWxsU3RhdGljTWV0aG9kKFwib3JnL2NvY29zMmR4L2phdmFzY3JpcHQvQXBwQWN0aXZpdHlcIiwgXCJzaG93QWRcIiwgXCIoKVZcIik7XG4gICAgICAgIH1cbiAgICB9LFxuICAgIC8vIOaYvuekumJhbm5lclxuICAgIHNob3dCYW5uZXIoKSB7XG4gICAgICAgIGlmIChjYy5zeXMuaXNOYXRpdmUpIHtcbiAgICAgICAgICAgIGpzYi5yZWZsZWN0aW9uLmNhbGxTdGF0aWNNZXRob2QoXCJvcmcvY29jb3MyZHgvamF2YXNjcmlwdC9BcHBBY3Rpdml0eVwiLCBcInNob3dCYW5uZXJcIiwgXCIoKVZcIik7XG4gICAgICAgIH1cbiAgICB9LFxuICAgIC8vIOmakOiXj2Jhbm5lclxuICAgIGhpZGVCYW5uZXIoKSB7XG4gICAgICAgIGlmIChjYy5zeXMuaXNOYXRpdmUpIHtcbiAgICAgICAgICAgIGpzYi5yZWZsZWN0aW9uLmNhbGxTdGF0aWNNZXRob2QoXCJvcmcvY29jb3MyZHgvamF2YXNjcmlwdC9BcHBBY3Rpdml0eVwiLCBcImhpZGVCYW5uZXJcIiwgXCIoKVZcIik7XG4gICAgICAgIH1cbiAgICB9LFxuICAgIC8vIOaYvuekuuaPkuWxj+W5v+WRilxuICAgIHNob3dUYWJsZVNjcmVlbigpIHtcbiAgICAgICAgY29uc29sZS5sb2coXCJjb2NvYy0tLS3op6blj5Hmj5LlsY9cIik7XG4gICAgICAgIGlmIChjYy5zeXMuaXNOYXRpdmUpIHtcbiAgICAgICAgICAgIGpzYi5yZWZsZWN0aW9uLmNhbGxTdGF0aWNNZXRob2QoXCJvcmcvY29jb3MyZHgvamF2YXNjcmlwdC9BcHBBY3Rpdml0eVwiLCBcInNob3dUYWJsZVNjcmVlblwiLCBcIigpVlwiKTtcbiAgICAgICAgfVxuICAgIH0sXG4gICAgLy8g6ZqQ6JeP5o+S5bGP5bm/5ZGKXG4gICAgaGlkZVRhYmxlU2NyZWVuKCkge1xuICAgICAgICBpZiAoY2Muc3lzLmlzTmF0aXZlKSB7XG4gICAgICAgICAgICBqc2IucmVmbGVjdGlvbi5jYWxsU3RhdGljTWV0aG9kKFwib3JnL2NvY29zMmR4L2phdmFzY3JpcHQvQXBwQWN0aXZpdHlcIiwgXCJoaWRlVGFibGVTY3JlZW5cIiwgXCIoKVZcIik7XG4gICAgICAgIH1cbiAgICB9LFxuICAgIC8vIOW+ruS/oeeZu+mZhlxuICAgIHd4TG9naW4oKSB7XG4gICAgICAgIGNvbnNvbGUubG9nKFwiY29jb3MtLS0td3hMb2dpblwiKTtcbiAgICAgICAgaWYgKGNjLnN5cy5pc05hdGl2ZSkge1xuICAgICAgICAgICAganNiLnJlZmxlY3Rpb24uY2FsbFN0YXRpY01ldGhvZChcIm9yZy9jb2NvczJkeC9qYXZhc2NyaXB0L0FwcEFjdGl2aXR5XCIsIFwid2VpeGluX2xvZ2luXCIsIFwiKExqYXZhL2xhbmcvU3RyaW5nOylWXCIsIFwid2VpeGluX2xvZ2luXCIpO1xuICAgICAgICB9XG4gICAgfSxcbiAgICAvKipcbiAgICAqIOaOpeaUtm5hdGl2ZeW+ruS/oeaOiOadg+eahGNvZGVcbiAgICAqIEBwYXJhbSBlcnJDb2RlIFxuICAgICovXG4gICAgd3hMb2dpblJlc3VsdChlcnJDb2RlKSB7XG4gICAgICAgIGNvbnNvbGUubG9nKFwiY29jb3MtLS0td3hMb2dpblJlc3VsdGNvZGU9XCIgKyBlcnJDb2RlKVxuICAgICAgICBjYy53eExvZ2luUmVzdWx0Y29kZSA9IGVyckNvZGU7XG4gICAgfSxcbiAgICAvKipcbiAgICAgKiDnnIvlub/lkYrkuYvlkI7liLfmlrDkuIDkuItlY3BtXG4gICAgICovXG4gICAgIGdldFVzZXJFY3BtKGVjcG0pIHtcbiAgICAgICAgIGlmKCFjYy56bSl7XG4gICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICAgfVxuICAgICAgICAgY29uc29sZS5sb2coXCJjb2Nvcy0tLS3osIPnlKhlY3BtPVwiLGVjcG0pO1xuICAgICAgICAgcmV0dXJuIG5ldyBQcm9taXNlKGZ1bmN0aW9uIChyZXNvbHZlLCByZWplY3Qpe1xuICAgICAgICAgICAgbGV0IHNlbmREYXRhID0ge1xuICAgICAgICAgICAgICAgIFwiZWNwbVwiOiBwYXJzZUludChlY3BtKSxcbiAgICAgICAgICAgICAgICBcInRzXCI6IG5ldyBEYXRlKCkuZ2V0VGltZSgpLy/ml7bpl7TmiLNcbiAgICAgICAgICAgIH07XG4gICAgICAgICAgICBsZXQgZGF0YSA9IGNjLlRvb2xzLmNyZWF0ZVNpZ25EYXRhKHNlbmREYXRhKTtcbiAgICAgICAgICAgIGNjLlRvb2xzLnNlbmRSZXF1ZXN0KFwicGl0LnYxLlBpdFN2Yy9SY1wiLCBcIlBPU1RcIiwgZGF0YSkudGhlbigocmVzKSA9PiB7XG4gICAgICAgICAgICAgICAgY29uc29sZS5sb2coXCJjb2Nvcy0tLS1FY3Bt5oiQ5YqfXCIsIHJlcy5kYXRhKTtcbiAgICAgICAgICAgICAgICBjYy56bS5hZCA9IHJlcy5kYXRhLmFkO1xuICAgICAgICAgICAgICAgIHJlc29sdmUoKTtcbiAgICAgICAgICAgIH0pLmNhdGNoKChyZXMpPT57XG4gICAgICAgICAgICAgICAgY29uc29sZS5sb2coXCJjb2Nvcy0tLS1FY3Bt5aSx6LSlXCIsIHJlcyk7XG4gICAgICAgICAgICAgICAgcmVqZWN0KHJlcyk7XG4gICAgICAgICAgICB9KVxuICAgICAgICAgfSlcbiAgICB9LFxuICAgIC8qKlxuICAgICAqIFxuICAgICAqIEBwYXJhbSB7Kn0gZGF0YSDpnIDopoHnrb7lkI3mlbDmja5cbiAgICAgKiBAcmV0dXJucyBcbiAgICAgKi9cbiAgICBjcmVhdGVTaWduRGF0YTogZnVuY3Rpb24gKGRhdGEpIHtcbiAgICAgICAgdmFyIHNvcnRMaXN0ID0gW107XG4gICAgICAgIGZvciAodmFyIGtleSBpbiBkYXRhKSB7XG4gICAgICAgICAgICBpZiAoZGF0YS5oYXNPd25Qcm9wZXJ0eShrZXkpICYmIGtleSAhPSBcInNpZ25cIikge1xuICAgICAgICAgICAgICAgIHZhciB2YWx1ZSA9IGRhdGFba2V5XTtcbiAgICAgICAgICAgICAgICB2YXIgaXRlbSA9IHt9O1xuICAgICAgICAgICAgICAgIGl0ZW0ua2V5ID0ga2V5O1xuICAgICAgICAgICAgICAgIGl0ZW0udmFsdWUgPSB2YWx1ZTtcbiAgICAgICAgICAgICAgICBzb3J0TGlzdC5wdXNoKGtleSk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgICAgc29ydExpc3Quc29ydCgpO1xuICAgICAgICB2YXIgc3RyVG9KaWFNaSA9IFwiXCI7XG4gICAgICAgIHNvcnRMaXN0LmZvckVhY2goZnVuY3Rpb24gKGtleSkge1xuICAgICAgICAgICAgc3RyVG9KaWFNaSArPSBcIiZcIiArIGtleSArIFwiPVwiICsgZGF0YVtrZXldO1xuICAgICAgICB9LCB0aGlzKTtcbiAgICAgICAgc3RyVG9KaWFNaSA9IFwidG9rZW49XCIgKyBjYy56bS51c2VySW5mby5zYzEgKyBzdHJUb0ppYU1pO1xuICAgICAgICB2YXIgaGV4X21kNSA9IHJlcXVpcmUoXCJNRDVcIilcbiAgICAgICAgc3RyVG9KaWFNaSA9IGhleF9tZDUoc3RyVG9KaWFNaSk7XG4gICAgICAgIGRhdGEuc2lnbiA9IHN0clRvSmlhTWk7XG4gICAgICAgIHJldHVybiBkYXRhO1xuXG4gICAgfSxcbiAgICAvLyDpgILphY3lsY/luZVcbiAgICBzY3JlZW5BZGFwdGVyKCkge1xuICAgICAgICBsZXQgY2FudmFzID0gY2MuZmluZChcIkNhbnZhc1wiKS5nZXRDb21wb25lbnQoY2MuQ2FudmFzKTtcbiAgICAgICAgbGV0IHdpblNpemUgPSBjYy52aWV3LmdldFZpc2libGVTaXplKCk7XG5cbiAgICAgICAgaWYgKHdpblNpemUuaGVpZ2h0IC8gd2luU2l6ZS53aWR0aCA8PSA3MjAgLyAxMjgwKSB7XG4gICAgICAgICAgICBjYW52YXMuZml0SGVpZ2h0ID0gdHJ1ZTtcbiAgICAgICAgICAgIGNhbnZhcy5maXRXaWR0aCA9IGZhbHNlO1xuICAgICAgICB9XG4gICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgY2FudmFzLmZpdEhlaWdodCA9IGZhbHNlO1xuICAgICAgICAgICAgY2FudmFzLmZpdFdpZHRoID0gdHJ1ZTtcbiAgICAgICAgfVxuICAgIH0sXG4gICAgLyoqXG4gICAgICogXG4gICAgICogQHBhcmFtIHsqfSBuIG5vZGXoioLngrlcbiAgICAgKiBAcGFyYW0geyp9IHN0ciAg5pi+56S655qEdGlwc+WGheWuuVxuICAgICAqL1xuICAgIHNob3dUaXBzKG4sc3RyKSB7XG4gICAgICAgIGxldCB0aXBzID0gbi5nZXRDaGlsZEJ5TmFtZShcIlRpcHNcIik7XG4gICAgICAgIHRpcHMuZ2V0Q29tcG9uZW50KGNjLkxhYmVsKS5zdHJpbmcgPXN0cjtcbiAgICAgICAgdGlwcy5zdG9wQWxsQWN0aW9ucygpO1xuICAgICAgICB0aXBzLnkgPSAxNDU7XG4gICAgICAgIGNjLnR3ZWVuKHRpcHMpLnRvKDAuMSwgeyBvcGFjaXR5OiAyNTUgfSkudG8oMSwgeyB5OiAzMDAgfSkuZGVsYXkoMC41KS50bygwLjEsIHsgb3BhY2l0eTogMCB9KS5zdGFydCgpXG4gICAgfSxcbiAgICAvKipcbiAgICAgKiBcbiAgICAgKiBAcGFyYW0geyp9IHVybCDor7fmsYLmjqXlj6PnmoR1cmwtLS0tcGl0LnYxLlBpdFN2Yy9Vc2VySW5mb1xuICAgICAqIEBwYXJhbSB7Kn0gdHlwZSDor7fmsYLmjqXlj6PnmoTnsbvlnosg5Y+q6IO95pivR0VULS1QT1NUXG4gICAgICogQHBhcmFtIHsqfSBkYXRhIOivt+axguaOpeWPo+aJgOmcgOimgeeahOaVsOaNrlxuICAgICAqIEByZXR1cm5zIFxuICAgICAqL1xuICAgIHNlbmRSZXF1ZXN0OiBmdW5jdGlvbiAodXJsLCB0eXBlLGRhdGEpIHtcbiAgICAgICAgcmV0dXJuIG5ldyBQcm9taXNlKGZ1bmN0aW9uIChyZXNvbHZlLCByZWplY3QpIHtcbiAgICAgICAgICAgIGxldCB4aHIgPSBuZXcgWE1MSHR0cFJlcXVlc3QoKTtcbiAgICAgICAgICAgIGxldCByZXF1ZXN0VVJMID0gXCJodHRwczovL3BpdC5hcGkuamlhbmthbmd6aHVhbi5jb20vXCIgKyB1cmw7XG4gICAgICAgICAgICB4aHIub3Blbih0eXBlLCByZXF1ZXN0VVJMLCB0cnVlKTtcbiAgICAgICAgICAgIGlmIChjYy5zeXMuaXNOYXRpdmUpIHtcbiAgICAgICAgICAgICAgICB4aHIuc2V0UmVxdWVzdEhlYWRlcihcIkFjY2VwdC1FbmNvZGVpbmdcIiwgXCJnemlwLGRlZmxhdGVcIik7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBpZihjYy53eFRva2VuKXtcbiAgICAgICAgICAgICAgICB4aHIuc2V0UmVxdWVzdEhlYWRlcihcIkF1dGhvcml6YXRpb25cIiwgY2Mud3hUb2tlbik7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICB4aHIuc2V0UmVxdWVzdEhlYWRlcihcIkNvbnRlbnQtVHlwZVwiLCBcImFwcGxpY2F0aW9uL2pzb25cIik7XG4gICAgICAgICAgICBjb25zb2xlLmxvZyhcImNvY29zLS0tLXJlcXVlc3RVUkw9XCIsIHJlcXVlc3RVUkwpO1xuICAgICAgICAgICAgY29uc29sZS5sb2coXCJjb2Nvcy0tLS1kYXRhPVwiLCBKU09OLnN0cmluZ2lmeShkYXRhKSk7XG4gICAgICAgICAgICB4aHIub25yZWFkeXN0YXRlY2hhbmdlID0gZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgICAgIGlmICh4aHIucmVhZHlTdGF0ZSA9PT0gNCAmJiB4aHIuc3RhdHVzID09IDIwMCkge1xuICAgICAgICAgICAgICAgICAgICBjb25zb2xlLmxvZyhcImNvY29zLS0tLWh0dHAgcmVzOlwiICsgeGhyLnJlc3BvbnNlKTtcbiAgICAgICAgICAgICAgICAgICAgLy8g57uf5LiA5aSE55CGXG4gICAgICAgICAgICAgICAgICAgIGxldCBfcmVzcG9uc2UgPSBKU09OLnBhcnNlKHhoci5yZXNwb25zZSk7XG4gICAgICAgICAgICAgICAgICAgIGlmKF9yZXNwb25zZS5jb2RlPT09MCl7XG4gICAgICAgICAgICAgICAgICAgICAgICByZXNvbHZlKF9yZXNwb25zZSlcbiAgICAgICAgICAgICAgICAgICAgfWVsc2V7XG4gICAgICAgICAgICAgICAgICAgICAgICBjb25zb2xlLmxvZyhcImNvY29zLS0tLVwiK19yZXNwb25zZS5tZXNzYWdlKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIHJlamVjdChfcmVzcG9uc2UubWVzc2FnZSk7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICB4aHIub25lcnJvciA9IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgICAgICByZWplY3QobmV3IEVycm9yKHhoci5zdGF0dXNUZXh0KSlcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIHhoci5zZW5kKEpTT04uc3RyaW5naWZ5KGRhdGEpKTtcbiAgICAgICAgfSlcbiAgICB9XG59Il19