{"version":3,"sources":["assets/Script/login.js"],"names":["cc","Class","Component","properties","start","protocol","time","Tools","Event","EventTarget","on","getCode","sys","isNative","localStorage","setItem","getItem","wxToken","console","log","beginCountTime","Date","getTime","director","loadScene","prototype","Format","fmt","o","getMonth","getDate","getHours","getMinutes","getSeconds","Math","floor","getMilliseconds","test","replace","RegExp","$1","getFullYear","substr","length","k","onLoginWX","wxLogin","showTips","node","clickProtocol","e","target","right","getChildByName","active","data","DeviceInfo","channel","imei","mac","uid","oaid","android_id","wxLoginResultcode","sendRequest","then","res","token","_dotTime","dot","register_time","showUserProtocol","hideUserProtocol","showUserPrivacy","privacy","hideUserPrivacy","showRealLayer","realNameLayer","clickRealLayer","_realName","getComponent","EditBox","string","_realNumber","regYourName","regYourNumber","name","regName","num","regIdNo"],"mappings":"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","sourceRoot":"/","sourcesContent":["cc.Class({\n    extends: cc.Component,\n\n    properties: {\n\n    },\n\n    // LIFE-CYCLE CALLBACKS:\n\n    // onLoad () {},\n\n    start() {\n        this.protocol = false;\n        // this.needLogin = true;\n        this.time = 0;\n        // 注册一个事件 监听微信返回的code\n        cc.Tools.Event = new cc.EventTarget();\n        cc.Tools.Event.on('getCode', this.getCode, this);\n        if (!cc.sys.isNative) {\n            cc.sys.localStorage.setItem(\"token\", \"eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJ1c2VyX2lkIjoxMDAxMjQxLCJvcGVuX2lkIjoib1FXNFI1OVVSRlF1YTNSWjlvX3lfdGJ6UEdLNCIsIm5pY2tfbmFtZSI6Iua1t-ebl-iIuemVvzIuMCIsImdlbmRlciI6MSwiYXZhdGFyIjoiaHR0cHM6Ly90aGlyZHd4LnFsb2dvLmNuL21tb3Blbi92aV8zMi9mR0xkR1pneG5wVmtJQldjaWEzeWljaWJ6aWJFQ0J0VzFhQkhEbUdhWmV6cTAycWdQUUN3STN5OGljVE5nWEtCcDBOcExBNUJFdDZ6UEdsSG1VTWY5bHd4Qk1nLzEzMiIsImNyZWF0ZV90aW1lIjoxNjM0MTk4ODUyLCJjaGFubmVsIjoid2FsayIsImRpc3RpbmN0X2lkIjoiYmFlNGY0N2MtZmZiMy00MGIxLWJhMzYtZTc0NjlkMTU0ODk4In0.u5sj49OYNGfbxzA4rM3CJfKqBjEYSZAN-mXVJOQ-U4M\")\n        }\n        if (cc.sys.localStorage.getItem(\"token\")) {\n            // this.needLogin = false;\n            this.protocol = true;\n            cc.wxToken = cc.sys.localStorage.getItem(\"token\");\n            console.log(\"cocos--token---\",cc.wxToken);\n            if (cc.sys.isNative) {\n                cc.beginCountTime = new Date().getTime();\n                cc.director.loadScene('Index');\n                // if (cc.sys.localStorage.getItem(\"realName\")) {\n                //     cc.beginCountTime = new Date().getTime();\n                //     cc.director.loadScene('Index');\n                // } else {\n                //     this.showRealLayer();\n                // }\n            } else {\n                cc.beginCountTime = new Date().getTime();\n                cc.director.loadScene('Index');\n            }\n        }\n        Date.prototype.Format = function (fmt) {\n            var o = {\n                \"M+\": this.getMonth() + 1, //月份 \n                \"d+\": this.getDate(), //日 \n                \"H+\": this.getHours(), //小时 \n                \"m+\": this.getMinutes(), //分 \n                \"s+\": this.getSeconds(), //秒 \n                \"q+\": Math.floor((this.getMonth() + 3) / 3), //季度 \n                \"S\": this.getMilliseconds() //毫秒 \n            };\n            if (/(y+)/.test(fmt)) fmt = fmt.replace(RegExp.$1, (this.getFullYear() + \"\").substr(4 - RegExp.$1.length));\n            for (var k in o)\n                if (new RegExp(\"(\" + k + \")\").test(fmt)) fmt = fmt.replace(RegExp.$1, (RegExp.$1.length == 1) ? (o[k]) : ((\"00\" + o[k]).substr((\"\" + o[k]).length)));\n            return fmt;\n        }\n    },\n    onLoginWX() {\n        if (cc.sys.isNative) {\n            if (this.protocol) {\n                cc.Tools.wxLogin();\n            } else {\n                cc.Tools.showTips(this.node, \"请先同意用户协议和隐私政策\")\n            }\n        }\n    },\n    // 选择用户协议\n    clickProtocol(e) {\n        let target = e.target;\n        let right = target.getChildByName(\"right\");\n        if (this.protocol) {\n            right.active = false;\n            this.protocol = false;\n        } else {\n            right.active = true;\n            this.protocol = true;\n        }\n    },\n    getCode() {\n        this.protocol = false;\n        // {\"channel\":\"walk\",\"imei\":\"\",\"android_id\":\"8bacfc24ece79979\",\"mac\":\"02:00:00:00:00:00\",\"uid\":\"3b0fe5ec-050d-46bf-aac6-0dc5aa5889c4\",\"oaid\":\"fbf75dfb-fffd-7f02-6ef6-f7ffbfad8da6\"}\n        let data = {\n            \"channel\": cc.Tools.DeviceInfo.channel ? cc.Tools.DeviceInfo.channel : \"\",\n            \"imei\": cc.Tools.DeviceInfo.imei ? cc.Tools.DeviceInfo.imei : \"\",\n            \"mac\": cc.Tools.DeviceInfo.mac ? cc.Tools.DeviceInfo.mac : \"\",\n            \"distinct_id\": cc.Tools.DeviceInfo.uid ? cc.Tools.DeviceInfo.uid : \"\",\n            \"oaid\": cc.Tools.DeviceInfo.oaid ? cc.Tools.DeviceInfo.oaid : \"\",\n            \"android_id\": cc.Tools.DeviceInfo.android_id ? cc.Tools.DeviceInfo.android_id : \"\",\n            \"code\": cc.wxLoginResultcode\n        }\n        cc.Tools.sendRequest(\"pit.v1/register\", \"POST\", data).then((res) => {\n            cc.wxToken = res.data.token;\n            cc.sys.localStorage.setItem(\"token\", res.data.token);\n            let _dotTime = new Date().Format(\"yyyy-MM-dd HH:mm:ss\")\n            cc.Tools.dot(\"register\", { register_time: _dotTime, channel: cc.Tools.DeviceInfo.channel ? cc.Tools.DeviceInfo.channel : \"\" })\n            // if (cc.sys.localStorage.getItem(\"realName\")) {\n            cc.beginCountTime = new Date().getTime();\n            cc.director.loadScene('Index');\n            // } else {\n            //     this.showRealLayer();\n            // }\n        })\n    },\n    // 显示用户协议\n    showUserProtocol() {\n        let protocol = this.node.getChildByName(\"user_protocol\");\n        protocol.active = true;\n    },\n    hideUserProtocol() {\n        let protocol = this.node.getChildByName(\"user_protocol\");\n        protocol.active = false;\n    },\n    // 显示隐私政策\n    showUserPrivacy() {\n        let privacy = this.node.getChildByName(\"user_privacy\");\n        privacy.active = true;\n    },\n    hideUserPrivacy() {\n        let privacy = this.node.getChildByName(\"user_privacy\");\n        privacy.active = false;\n    },\n    // 实名认证\n    showRealLayer() {\n        this.realNameLayer = this.node.getChildByName(\"RealName\");\n        this.realNameLayer.active = true;\n    },\n    // 实名认证点击\n    clickRealLayer(e) {\n        let target = e.target;\n        let _realName = this.realNameLayer.getChildByName(\"edit1\").getComponent(cc.EditBox).string;\n        let _realNumber = this.realNameLayer.getChildByName(\"edit2\").getComponent(cc.EditBox).string;\n        // 用local记录 是否实名\n        if (this.regYourName(_realName) && this.regYourNumber(_realNumber)) {\n            cc.sys.localStorage.setItem(\"realName\", true)\n            cc.beginCountTime = new Date().getTime();\n            cc.director.loadScene('Index');\n        }\n    },\n    // 判断真实姓名\n    regYourName(name) {\n        var regName = /^[\\u4e00-\\u9fa5]{2,4}$/;\n        if (!regName.test(name)) {\n            cc.Tools.showTips(this.node, \"真实姓名填写有误\")\n            return false;\n        }\n        return true\n    },\n    // 判断身份证号\n    regYourNumber(num) {\n        var regIdNo = /(^\\d{15}$)|(^\\d{18}$)|(^\\d{17}(\\d|X|x)$)/;\n        if (!regIdNo.test(num)) {\n            cc.Tools.showTips(this.node, '身份证号填写有误');\n            return false;\n        }\n        return true\n    }\n});\n\n\n"]}