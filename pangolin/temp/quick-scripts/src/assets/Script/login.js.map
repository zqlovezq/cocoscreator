{"version":3,"sources":["assets/Script/login.js"],"names":["cc","Class","Component","properties","start","protocol","needLogin","time","sys","isNative","localStorage","setItem","getItem","wxToken","beginCountTime","Date","getTime","director","loadScene","showRealLayer","onLoginWX","Tools","wxLogin","showTips","node","clickProtocol","e","target","right","getChildByName","active","update","dt","wxLoginResultcode","data","sendRequest","then","res","token","dot","register_time","channel","showUserProtocol","hideUserProtocol","showUserPrivacy","privacy","hideUserPrivacy","realNameLayer","clickRealLayer","_realName","getComponent","EditBox","string","_realNumber","console","log","regYourName","regYourNumber","name","regName","test","num","regIdNo"],"mappings":"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","sourceRoot":"/","sourcesContent":["cc.Class({\n    extends: cc.Component,\n\n    properties: {\n\n    },\n\n    // LIFE-CYCLE CALLBACKS:\n\n    // onLoad () {},\n\n    start() {\n        this.protocol = false;\n        this.needLogin = true;\n        this.time = 0;\n        if (!cc.sys.isNative) {\n            cc.sys.localStorage.setItem(\"token\", \"eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJ1c2VyX2lkIjoxMDAxMTcxLCJvcGVuX2lkIjoib1FXNFI1OVVSRlF1YTNSWjlvX3lfdGJ6UEdLNCIsIm5pY2tfbmFtZSI6Iua1t-ebl-iIuemVvzIuMCIsImdlbmRlciI6MSwiYXZhdGFyIjoiaHR0cHM6Ly90aGlyZHd4LnFsb2dvLmNuL21tb3Blbi92aV8zMi9mR0xkR1pneG5wVmtJQldjaWEzeWljaWJ6aWJFQ0J0VzFhQkhEbUdhWmV6cTAycWdQUUN3STN5OGljVE5nWEtCcDBOcExBNUJFdDZ6UEdsSG1VTWY5bHd4Qk1nLzEzMiIsImNyZWF0ZV90aW1lIjowLCJjaGFubmVsIjoiMSIsImRpc3RpbmN0X2lkIjoiMSJ9.K5C9XSkEEjBBfPFn1m5BoXGu11ubPc9lSvDRAHkv_V4\")\n        }\n        if (cc.sys.localStorage.getItem(\"token\")) {\n            this.needLogin = false;\n            this.protocol = true;\n            cc.wxToken = cc.sys.localStorage.getItem(\"token\");\n            if(cc.sys.isNative){\n                if (cc.sys.localStorage.getItem(\"realName\")) {\n                    cc.beginCountTime = new Date().getTime();\n                    cc.director.loadScene('Index');\n                } else {\n                    this.showRealLayer();\n                }\n            }else{\n                cc.beginCountTime = new Date().getTime();\n                cc.director.loadScene('Index');\n            }\n        }\n    },\n    onLoginWX() {\n        if (cc.sys.isNative) {\n            if (this.protocol) {\n                cc.Tools.wxLogin();\n            } else {\n                cc.Tools.showTips(this.node,\"请先同意用户协议和隐私政策\")\n            }\n        }\n    },\n    // 选择用户协议\n    clickProtocol(e) {\n        let target = e.target;\n        let right = target.getChildByName(\"right\");\n        if (this.protocol) {\n            right.active = false;\n            this.protocol = false;\n        } else {\n            right.active = true;\n            this.protocol = true;\n        }\n    },\n    update(dt) {\n        this.time += dt;\n        if (!this.needLogin) {\n            return;\n        }\n        if (this.time >= 1) {\n            this.time = 0;\n            if (cc.wxLoginResultcode && this.protocol) {\n                this.protocol = false;\n                let data = {\n                    \"channel\": \"1\",\n                    \"imei\": \"1\",\n                    \"mac\": \"1\",\n                    \"distinct_id\": \"1\",\n                    \"oaid\": \"1\",\n                    \"android_id\": \"1\",\n                    \"code\": cc.wxLoginResultcode\n                }\n                cc.Tools.sendRequest(\"pit.v1/register\", \"POST\", data).then((res) => {\n                    cc.wxToken = res.data.token;\n                    cc.sys.localStorage.setItem(\"token\", res.data.token);\n                    cc.Tools.dot(\"register\", { register_time: new Date(), channel: \"微信\" })\n                    if (cc.sys.localStorage.getItem(\"realName\")) {\n                        cc.beginCountTime = new Date().getTime();\n                        cc.director.loadScene('Index');\n                    } else {\n                        this.showRealLayer();\n                    }\n                })\n            }\n        }\n    },\n    // 显示用户协议\n    showUserProtocol() {\n        let protocol = this.node.getChildByName(\"user_protocol\");\n        protocol.active = true;\n    },\n    hideUserProtocol() {\n        let protocol = this.node.getChildByName(\"user_protocol\");\n        protocol.active = false;\n    },\n    // 显示隐私政策\n    showUserPrivacy() {\n        let privacy = this.node.getChildByName(\"user_privacy\");\n        privacy.active = true;\n    },\n    hideUserPrivacy() {\n        let privacy = this.node.getChildByName(\"user_privacy\");\n        privacy.active = false;\n    },\n    // 实名认证\n    showRealLayer() {\n        this.realNameLayer = this.node.getChildByName(\"RealName\");\n        this.realNameLayer.active = true;\n    },\n    // 实名认证点击\n    clickRealLayer(e) {\n        let target = e.target;\n        let _realName = this.realNameLayer.getChildByName(\"edit1\").getComponent(cc.EditBox).string;\n        let _realNumber = this.realNameLayer.getChildByName(\"edit2\").getComponent(cc.EditBox).string;\n        console.log(`cocos----真实姓名${_realName}------身份证号${_realNumber}`);\n        // 用local记录 是否实名\n        if(this.regYourName(_realName)&&this.regYourNumber(_realNumber)){\n            console.log(\"cocos----认证成功\");\n            cc.sys.localStorage.setItem(\"realName\", true)\n            cc.director.loadScene('Index');\n        }\n    },\n    // 判断真实姓名\n    regYourName(name) {\n        var regName = /^[\\u4e00-\\u9fa5]{2,4}$/;\n        if (!regName.test(name)) {\n            cc.Tools.showTips(this.node,\"真实姓名填写有误\")\n            return false;\n        }\n        return true\n    },\n    // 判断身份证号\n    regYourNumber(num) {\n        var regIdNo = /(^\\d{15}$)|(^\\d{18}$)|(^\\d{17}(\\d|X|x)$)/;\n        if (!regIdNo.test(num)) {\n            cc.Tools.showTips(this.node,'身份证号填写有误');\n            return false;\n        }\n        return true\n    }\n});\n\n\n"]}