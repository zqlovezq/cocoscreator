
                (function() {
                    var nodeEnv = typeof require !== 'undefined' && typeof process !== 'undefined';
                    var __module = nodeEnv ? module : {exports:{}};
                    var __filename = 'preview-scripts/assets/Script/login.js';
                    var __require = nodeEnv ? function (request) {
                        return cc.require(request);
                    } : function (request) {
                        return __quick_compile_project__.require(request, __filename);
                    };
                    function __define (exports, require, module) {
                        if (!nodeEnv) {__quick_compile_project__.registerModule(__filename, module);}"use strict";
cc._RF.push(module, '6b7cdHix81Ol6r4h+cnHYQh', 'login');
// Script/login.js

"use strict";

cc.Class({
  "extends": cc.Component,
  properties: {},
  // LIFE-CYCLE CALLBACKS:
  // onLoad () {},
  start: function start() {
    this.protocol = false;
    this.needLogin = true;
    this.time = 0;

    if (!cc.sys.isNative) {
      cc.sys.localStorage.setItem("token", "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJ1c2VyX2lkIjoxMDAxMTcxLCJvcGVuX2lkIjoib1FXNFI1OVVSRlF1YTNSWjlvX3lfdGJ6UEdLNCIsIm5pY2tfbmFtZSI6Iua1t-ebl-iIuemVvzIuMCIsImdlbmRlciI6MSwiYXZhdGFyIjoiaHR0cHM6Ly90aGlyZHd4LnFsb2dvLmNuL21tb3Blbi92aV8zMi9mR0xkR1pneG5wVmtJQldjaWEzeWljaWJ6aWJFQ0J0VzFhQkhEbUdhWmV6cTAycWdQUUN3STN5OGljVE5nWEtCcDBOcExBNUJFdDZ6UEdsSG1VTWY5bHd4Qk1nLzEzMiIsImNyZWF0ZV90aW1lIjowLCJjaGFubmVsIjoiMSIsImRpc3RpbmN0X2lkIjoiMSJ9.K5C9XSkEEjBBfPFn1m5BoXGu11ubPc9lSvDRAHkv_V4");
    }

    if (cc.sys.localStorage.getItem("token")) {
      this.needLogin = false;
      this.protocol = true;
      cc.wxToken = cc.sys.localStorage.getItem("token");

      if (cc.sys.isNative) {
        if (cc.sys.localStorage.getItem("realName")) {
          cc.beginCountTime = new Date().getTime();
          cc.director.loadScene('Index');
        } else {
          this.showRealLayer();
        }
      } else {
        cc.beginCountTime = new Date().getTime();
        cc.director.loadScene('Index');
      }
    }
  },
  onLoginWX: function onLoginWX() {
    if (cc.sys.isNative) {
      if (this.protocol) {
        cc.Tools.wxLogin();
      } else {
        cc.Tools.showTips(this.node, "请先同意用户协议和隐私政策");
      }
    }
  },
  // 选择用户协议
  clickProtocol: function clickProtocol(e) {
    var target = e.target;
    var right = target.getChildByName("right");

    if (this.protocol) {
      right.active = false;
      this.protocol = false;
    } else {
      right.active = true;
      this.protocol = true;
    }
  },
  update: function update(dt) {
    var _this = this;

    this.time += dt;

    if (!this.needLogin) {
      return;
    }

    if (this.time >= 1) {
      this.time = 0;

      if (cc.wxLoginResultcode && this.protocol) {
        this.protocol = false;
        var data = {
          "channel": "1",
          "imei": "1",
          "mac": "1",
          "distinct_id": "1",
          "oaid": "1",
          "android_id": "1",
          "code": cc.wxLoginResultcode
        };
        cc.Tools.sendRequest("pit.v1/register", "POST", data).then(function (res) {
          cc.wxToken = res.data.token;
          cc.sys.localStorage.setItem("token", res.data.token);
          cc.Tools.dot("register", {
            register_time: new Date(),
            channel: "微信"
          });

          if (cc.sys.localStorage.getItem("realName")) {
            cc.beginCountTime = new Date().getTime();
            cc.director.loadScene('Index');
          } else {
            _this.showRealLayer();
          }
        });
      }
    }
  },
  // 显示用户协议
  showUserProtocol: function showUserProtocol() {
    var protocol = this.node.getChildByName("user_protocol");
    protocol.active = true;
  },
  hideUserProtocol: function hideUserProtocol() {
    var protocol = this.node.getChildByName("user_protocol");
    protocol.active = false;
  },
  // 显示隐私政策
  showUserPrivacy: function showUserPrivacy() {
    var privacy = this.node.getChildByName("user_privacy");
    privacy.active = true;
  },
  hideUserPrivacy: function hideUserPrivacy() {
    var privacy = this.node.getChildByName("user_privacy");
    privacy.active = false;
  },
  // 实名认证
  showRealLayer: function showRealLayer() {
    this.realNameLayer = this.node.getChildByName("RealName");
    this.realNameLayer.active = true;
  },
  // 实名认证点击
  clickRealLayer: function clickRealLayer(e) {
    var target = e.target;
    var _realName = this.realNameLayer.getChildByName("edit1").getComponent(cc.EditBox).string;
    var _realNumber = this.realNameLayer.getChildByName("edit2").getComponent(cc.EditBox).string;
    console.log("cocos----\u771F\u5B9E\u59D3\u540D" + _realName + "------\u8EAB\u4EFD\u8BC1\u53F7" + _realNumber); // 用local记录 是否实名

    if (this.regYourName(_realName) && this.regYourNumber(_realNumber)) {
      console.log("cocos----认证成功");
      cc.sys.localStorage.setItem("realName", true);
      cc.director.loadScene('Index');
    }
  },
  // 判断真实姓名
  regYourName: function regYourName(name) {
    var regName = /^[\u4e00-\u9fa5]{2,4}$/;

    if (!regName.test(name)) {
      cc.Tools.showTips(this.node, "真实姓名填写有误");
      return false;
    }

    return true;
  },
  // 判断身份证号
  regYourNumber: function regYourNumber(num) {
    var regIdNo = /(^\d{15}$)|(^\d{18}$)|(^\d{17}(\d|X|x)$)/;

    if (!regIdNo.test(num)) {
      cc.Tools.showTips(this.node, '身份证号填写有误');
      return false;
    }

    return true;
  }
});

cc._RF.pop();
                    }
                    if (nodeEnv) {
                        __define(__module.exports, __require, __module);
                    }
                    else {
                        __quick_compile_project__.registerModuleFunc(__filename, function () {
                            __define(__module.exports, __require, __module);
                        });
                    }
                })();
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImFzc2V0cy9TY3JpcHQvbG9naW4uanMiXSwibmFtZXMiOlsiY2MiLCJDbGFzcyIsIkNvbXBvbmVudCIsInByb3BlcnRpZXMiLCJzdGFydCIsInByb3RvY29sIiwibmVlZExvZ2luIiwidGltZSIsInN5cyIsImlzTmF0aXZlIiwibG9jYWxTdG9yYWdlIiwic2V0SXRlbSIsImdldEl0ZW0iLCJ3eFRva2VuIiwiYmVnaW5Db3VudFRpbWUiLCJEYXRlIiwiZ2V0VGltZSIsImRpcmVjdG9yIiwibG9hZFNjZW5lIiwic2hvd1JlYWxMYXllciIsIm9uTG9naW5XWCIsIlRvb2xzIiwid3hMb2dpbiIsInNob3dUaXBzIiwibm9kZSIsImNsaWNrUHJvdG9jb2wiLCJlIiwidGFyZ2V0IiwicmlnaHQiLCJnZXRDaGlsZEJ5TmFtZSIsImFjdGl2ZSIsInVwZGF0ZSIsImR0Iiwid3hMb2dpblJlc3VsdGNvZGUiLCJkYXRhIiwic2VuZFJlcXVlc3QiLCJ0aGVuIiwicmVzIiwidG9rZW4iLCJkb3QiLCJyZWdpc3Rlcl90aW1lIiwiY2hhbm5lbCIsInNob3dVc2VyUHJvdG9jb2wiLCJoaWRlVXNlclByb3RvY29sIiwic2hvd1VzZXJQcml2YWN5IiwicHJpdmFjeSIsImhpZGVVc2VyUHJpdmFjeSIsInJlYWxOYW1lTGF5ZXIiLCJjbGlja1JlYWxMYXllciIsIl9yZWFsTmFtZSIsImdldENvbXBvbmVudCIsIkVkaXRCb3giLCJzdHJpbmciLCJfcmVhbE51bWJlciIsImNvbnNvbGUiLCJsb2ciLCJyZWdZb3VyTmFtZSIsInJlZ1lvdXJOdW1iZXIiLCJuYW1lIiwicmVnTmFtZSIsInRlc3QiLCJudW0iLCJyZWdJZE5vIl0sIm1hcHBpbmdzIjoiOzs7Ozs7Ozs7Ozs7Ozs7OztBQUFBQSxFQUFFLENBQUNDLEtBQUgsQ0FBUztBQUNMLGFBQVNELEVBQUUsQ0FBQ0UsU0FEUDtBQUdMQyxFQUFBQSxVQUFVLEVBQUUsRUFIUDtBQU9MO0FBRUE7QUFFQUMsRUFBQUEsS0FYSyxtQkFXRztBQUNKLFNBQUtDLFFBQUwsR0FBZ0IsS0FBaEI7QUFDQSxTQUFLQyxTQUFMLEdBQWlCLElBQWpCO0FBQ0EsU0FBS0MsSUFBTCxHQUFZLENBQVo7O0FBQ0EsUUFBSSxDQUFDUCxFQUFFLENBQUNRLEdBQUgsQ0FBT0MsUUFBWixFQUFzQjtBQUNsQlQsTUFBQUEsRUFBRSxDQUFDUSxHQUFILENBQU9FLFlBQVAsQ0FBb0JDLE9BQXBCLENBQTRCLE9BQTVCLEVBQXFDLDJkQUFyQztBQUNIOztBQUNELFFBQUlYLEVBQUUsQ0FBQ1EsR0FBSCxDQUFPRSxZQUFQLENBQW9CRSxPQUFwQixDQUE0QixPQUE1QixDQUFKLEVBQTBDO0FBQ3RDLFdBQUtOLFNBQUwsR0FBaUIsS0FBakI7QUFDQSxXQUFLRCxRQUFMLEdBQWdCLElBQWhCO0FBQ0FMLE1BQUFBLEVBQUUsQ0FBQ2EsT0FBSCxHQUFhYixFQUFFLENBQUNRLEdBQUgsQ0FBT0UsWUFBUCxDQUFvQkUsT0FBcEIsQ0FBNEIsT0FBNUIsQ0FBYjs7QUFDQSxVQUFHWixFQUFFLENBQUNRLEdBQUgsQ0FBT0MsUUFBVixFQUFtQjtBQUNmLFlBQUlULEVBQUUsQ0FBQ1EsR0FBSCxDQUFPRSxZQUFQLENBQW9CRSxPQUFwQixDQUE0QixVQUE1QixDQUFKLEVBQTZDO0FBQ3pDWixVQUFBQSxFQUFFLENBQUNjLGNBQUgsR0FBb0IsSUFBSUMsSUFBSixHQUFXQyxPQUFYLEVBQXBCO0FBQ0FoQixVQUFBQSxFQUFFLENBQUNpQixRQUFILENBQVlDLFNBQVosQ0FBc0IsT0FBdEI7QUFDSCxTQUhELE1BR087QUFDSCxlQUFLQyxhQUFMO0FBQ0g7QUFDSixPQVBELE1BT0s7QUFDRG5CLFFBQUFBLEVBQUUsQ0FBQ2MsY0FBSCxHQUFvQixJQUFJQyxJQUFKLEdBQVdDLE9BQVgsRUFBcEI7QUFDQWhCLFFBQUFBLEVBQUUsQ0FBQ2lCLFFBQUgsQ0FBWUMsU0FBWixDQUFzQixPQUF0QjtBQUNIO0FBQ0o7QUFDSixHQWxDSTtBQW1DTEUsRUFBQUEsU0FuQ0ssdUJBbUNPO0FBQ1IsUUFBSXBCLEVBQUUsQ0FBQ1EsR0FBSCxDQUFPQyxRQUFYLEVBQXFCO0FBQ2pCLFVBQUksS0FBS0osUUFBVCxFQUFtQjtBQUNmTCxRQUFBQSxFQUFFLENBQUNxQixLQUFILENBQVNDLE9BQVQ7QUFDSCxPQUZELE1BRU87QUFDSHRCLFFBQUFBLEVBQUUsQ0FBQ3FCLEtBQUgsQ0FBU0UsUUFBVCxDQUFrQixLQUFLQyxJQUF2QixFQUE0QixlQUE1QjtBQUNIO0FBQ0o7QUFDSixHQTNDSTtBQTRDTDtBQUNBQyxFQUFBQSxhQTdDSyx5QkE2Q1NDLENBN0NULEVBNkNZO0FBQ2IsUUFBSUMsTUFBTSxHQUFHRCxDQUFDLENBQUNDLE1BQWY7QUFDQSxRQUFJQyxLQUFLLEdBQUdELE1BQU0sQ0FBQ0UsY0FBUCxDQUFzQixPQUF0QixDQUFaOztBQUNBLFFBQUksS0FBS3hCLFFBQVQsRUFBbUI7QUFDZnVCLE1BQUFBLEtBQUssQ0FBQ0UsTUFBTixHQUFlLEtBQWY7QUFDQSxXQUFLekIsUUFBTCxHQUFnQixLQUFoQjtBQUNILEtBSEQsTUFHTztBQUNIdUIsTUFBQUEsS0FBSyxDQUFDRSxNQUFOLEdBQWUsSUFBZjtBQUNBLFdBQUt6QixRQUFMLEdBQWdCLElBQWhCO0FBQ0g7QUFDSixHQXZESTtBQXdETDBCLEVBQUFBLE1BeERLLGtCQXdERUMsRUF4REYsRUF3RE07QUFBQTs7QUFDUCxTQUFLekIsSUFBTCxJQUFheUIsRUFBYjs7QUFDQSxRQUFJLENBQUMsS0FBSzFCLFNBQVYsRUFBcUI7QUFDakI7QUFDSDs7QUFDRCxRQUFJLEtBQUtDLElBQUwsSUFBYSxDQUFqQixFQUFvQjtBQUNoQixXQUFLQSxJQUFMLEdBQVksQ0FBWjs7QUFDQSxVQUFJUCxFQUFFLENBQUNpQyxpQkFBSCxJQUF3QixLQUFLNUIsUUFBakMsRUFBMkM7QUFDdkMsYUFBS0EsUUFBTCxHQUFnQixLQUFoQjtBQUNBLFlBQUk2QixJQUFJLEdBQUc7QUFDUCxxQkFBVyxHQURKO0FBRVAsa0JBQVEsR0FGRDtBQUdQLGlCQUFPLEdBSEE7QUFJUCx5QkFBZSxHQUpSO0FBS1Asa0JBQVEsR0FMRDtBQU1QLHdCQUFjLEdBTlA7QUFPUCxrQkFBUWxDLEVBQUUsQ0FBQ2lDO0FBUEosU0FBWDtBQVNBakMsUUFBQUEsRUFBRSxDQUFDcUIsS0FBSCxDQUFTYyxXQUFULENBQXFCLGlCQUFyQixFQUF3QyxNQUF4QyxFQUFnREQsSUFBaEQsRUFBc0RFLElBQXRELENBQTJELFVBQUNDLEdBQUQsRUFBUztBQUNoRXJDLFVBQUFBLEVBQUUsQ0FBQ2EsT0FBSCxHQUFhd0IsR0FBRyxDQUFDSCxJQUFKLENBQVNJLEtBQXRCO0FBQ0F0QyxVQUFBQSxFQUFFLENBQUNRLEdBQUgsQ0FBT0UsWUFBUCxDQUFvQkMsT0FBcEIsQ0FBNEIsT0FBNUIsRUFBcUMwQixHQUFHLENBQUNILElBQUosQ0FBU0ksS0FBOUM7QUFDQXRDLFVBQUFBLEVBQUUsQ0FBQ3FCLEtBQUgsQ0FBU2tCLEdBQVQsQ0FBYSxVQUFiLEVBQXlCO0FBQUVDLFlBQUFBLGFBQWEsRUFBRSxJQUFJekIsSUFBSixFQUFqQjtBQUE2QjBCLFlBQUFBLE9BQU8sRUFBRTtBQUF0QyxXQUF6Qjs7QUFDQSxjQUFJekMsRUFBRSxDQUFDUSxHQUFILENBQU9FLFlBQVAsQ0FBb0JFLE9BQXBCLENBQTRCLFVBQTVCLENBQUosRUFBNkM7QUFDekNaLFlBQUFBLEVBQUUsQ0FBQ2MsY0FBSCxHQUFvQixJQUFJQyxJQUFKLEdBQVdDLE9BQVgsRUFBcEI7QUFDQWhCLFlBQUFBLEVBQUUsQ0FBQ2lCLFFBQUgsQ0FBWUMsU0FBWixDQUFzQixPQUF0QjtBQUNILFdBSEQsTUFHTztBQUNILFlBQUEsS0FBSSxDQUFDQyxhQUFMO0FBQ0g7QUFDSixTQVZEO0FBV0g7QUFDSjtBQUNKLEdBdkZJO0FBd0ZMO0FBQ0F1QixFQUFBQSxnQkF6RkssOEJBeUZjO0FBQ2YsUUFBSXJDLFFBQVEsR0FBRyxLQUFLbUIsSUFBTCxDQUFVSyxjQUFWLENBQXlCLGVBQXpCLENBQWY7QUFDQXhCLElBQUFBLFFBQVEsQ0FBQ3lCLE1BQVQsR0FBa0IsSUFBbEI7QUFDSCxHQTVGSTtBQTZGTGEsRUFBQUEsZ0JBN0ZLLDhCQTZGYztBQUNmLFFBQUl0QyxRQUFRLEdBQUcsS0FBS21CLElBQUwsQ0FBVUssY0FBVixDQUF5QixlQUF6QixDQUFmO0FBQ0F4QixJQUFBQSxRQUFRLENBQUN5QixNQUFULEdBQWtCLEtBQWxCO0FBQ0gsR0FoR0k7QUFpR0w7QUFDQWMsRUFBQUEsZUFsR0ssNkJBa0dhO0FBQ2QsUUFBSUMsT0FBTyxHQUFHLEtBQUtyQixJQUFMLENBQVVLLGNBQVYsQ0FBeUIsY0FBekIsQ0FBZDtBQUNBZ0IsSUFBQUEsT0FBTyxDQUFDZixNQUFSLEdBQWlCLElBQWpCO0FBQ0gsR0FyR0k7QUFzR0xnQixFQUFBQSxlQXRHSyw2QkFzR2E7QUFDZCxRQUFJRCxPQUFPLEdBQUcsS0FBS3JCLElBQUwsQ0FBVUssY0FBVixDQUF5QixjQUF6QixDQUFkO0FBQ0FnQixJQUFBQSxPQUFPLENBQUNmLE1BQVIsR0FBaUIsS0FBakI7QUFDSCxHQXpHSTtBQTBHTDtBQUNBWCxFQUFBQSxhQTNHSywyQkEyR1c7QUFDWixTQUFLNEIsYUFBTCxHQUFxQixLQUFLdkIsSUFBTCxDQUFVSyxjQUFWLENBQXlCLFVBQXpCLENBQXJCO0FBQ0EsU0FBS2tCLGFBQUwsQ0FBbUJqQixNQUFuQixHQUE0QixJQUE1QjtBQUNILEdBOUdJO0FBK0dMO0FBQ0FrQixFQUFBQSxjQWhISywwQkFnSFV0QixDQWhIVixFQWdIYTtBQUNkLFFBQUlDLE1BQU0sR0FBR0QsQ0FBQyxDQUFDQyxNQUFmO0FBQ0EsUUFBSXNCLFNBQVMsR0FBRyxLQUFLRixhQUFMLENBQW1CbEIsY0FBbkIsQ0FBa0MsT0FBbEMsRUFBMkNxQixZQUEzQyxDQUF3RGxELEVBQUUsQ0FBQ21ELE9BQTNELEVBQW9FQyxNQUFwRjtBQUNBLFFBQUlDLFdBQVcsR0FBRyxLQUFLTixhQUFMLENBQW1CbEIsY0FBbkIsQ0FBa0MsT0FBbEMsRUFBMkNxQixZQUEzQyxDQUF3RGxELEVBQUUsQ0FBQ21ELE9BQTNELEVBQW9FQyxNQUF0RjtBQUNBRSxJQUFBQSxPQUFPLENBQUNDLEdBQVIsdUNBQTRCTixTQUE1QixzQ0FBa0RJLFdBQWxELEVBSmMsQ0FLZDs7QUFDQSxRQUFHLEtBQUtHLFdBQUwsQ0FBaUJQLFNBQWpCLEtBQTZCLEtBQUtRLGFBQUwsQ0FBbUJKLFdBQW5CLENBQWhDLEVBQWdFO0FBQzVEQyxNQUFBQSxPQUFPLENBQUNDLEdBQVIsQ0FBWSxlQUFaO0FBQ0F2RCxNQUFBQSxFQUFFLENBQUNRLEdBQUgsQ0FBT0UsWUFBUCxDQUFvQkMsT0FBcEIsQ0FBNEIsVUFBNUIsRUFBd0MsSUFBeEM7QUFDQVgsTUFBQUEsRUFBRSxDQUFDaUIsUUFBSCxDQUFZQyxTQUFaLENBQXNCLE9BQXRCO0FBQ0g7QUFDSixHQTNISTtBQTRITDtBQUNBc0MsRUFBQUEsV0E3SEssdUJBNkhPRSxJQTdIUCxFQTZIYTtBQUNkLFFBQUlDLE9BQU8sR0FBRyx3QkFBZDs7QUFDQSxRQUFJLENBQUNBLE9BQU8sQ0FBQ0MsSUFBUixDQUFhRixJQUFiLENBQUwsRUFBeUI7QUFDckIxRCxNQUFBQSxFQUFFLENBQUNxQixLQUFILENBQVNFLFFBQVQsQ0FBa0IsS0FBS0MsSUFBdkIsRUFBNEIsVUFBNUI7QUFDQSxhQUFPLEtBQVA7QUFDSDs7QUFDRCxXQUFPLElBQVA7QUFDSCxHQXBJSTtBQXFJTDtBQUNBaUMsRUFBQUEsYUF0SUsseUJBc0lTSSxHQXRJVCxFQXNJYztBQUNmLFFBQUlDLE9BQU8sR0FBRywwQ0FBZDs7QUFDQSxRQUFJLENBQUNBLE9BQU8sQ0FBQ0YsSUFBUixDQUFhQyxHQUFiLENBQUwsRUFBd0I7QUFDcEI3RCxNQUFBQSxFQUFFLENBQUNxQixLQUFILENBQVNFLFFBQVQsQ0FBa0IsS0FBS0MsSUFBdkIsRUFBNEIsVUFBNUI7QUFDQSxhQUFPLEtBQVA7QUFDSDs7QUFDRCxXQUFPLElBQVA7QUFDSDtBQTdJSSxDQUFUIiwic291cmNlUm9vdCI6Ii8iLCJzb3VyY2VzQ29udGVudCI6WyJjYy5DbGFzcyh7XG4gICAgZXh0ZW5kczogY2MuQ29tcG9uZW50LFxuXG4gICAgcHJvcGVydGllczoge1xuXG4gICAgfSxcblxuICAgIC8vIExJRkUtQ1lDTEUgQ0FMTEJBQ0tTOlxuXG4gICAgLy8gb25Mb2FkICgpIHt9LFxuXG4gICAgc3RhcnQoKSB7XG4gICAgICAgIHRoaXMucHJvdG9jb2wgPSBmYWxzZTtcbiAgICAgICAgdGhpcy5uZWVkTG9naW4gPSB0cnVlO1xuICAgICAgICB0aGlzLnRpbWUgPSAwO1xuICAgICAgICBpZiAoIWNjLnN5cy5pc05hdGl2ZSkge1xuICAgICAgICAgICAgY2Muc3lzLmxvY2FsU3RvcmFnZS5zZXRJdGVtKFwidG9rZW5cIiwgXCJleUpoYkdjaU9pSklVekkxTmlJc0luUjVjQ0k2SWtwWFZDSjkuZXlKMWMyVnlYMmxrSWpveE1EQXhNVGN4TENKdmNHVnVYMmxrSWpvaWIxRlhORkkxT1ZWU1JsRjFZVE5TV2psdlgzbGZkR0o2VUVkTE5DSXNJbTVwWTJ0ZmJtRnRaU0k2SXVhMXQtZWJsLWlJdWVtVnZ6SXVNQ0lzSW1kbGJtUmxjaUk2TVN3aVlYWmhkR0Z5SWpvaWFIUjBjSE02THk5MGFHbHlaSGQ0TG5Gc2IyZHZMbU51TDIxdGIzQmxiaTkyYVY4ek1pOW1SMHhrUjFwbmVHNXdWbXRKUWxkamFXRXplV2xqYVdKNmFXSkZRMEowVnpGaFFraEViVWRoV21WNmNUQXljV2RRVVVOM1NUTjVPR2xqVkU1bldFdENjREJPY0V4Qk5VSkZkRFo2VUVkc1NHMVZUV1k1YkhkNFFrMW5MekV6TWlJc0ltTnlaV0YwWlY5MGFXMWxJam93TENKamFHRnVibVZzSWpvaU1TSXNJbVJwYzNScGJtTjBYMmxrSWpvaU1TSjkuSzVDOVhTa0VFakJCZlBGbjFtNUJvWEd1MTF1YlBjOWxTdkRSQUhrdl9WNFwiKVxuICAgICAgICB9XG4gICAgICAgIGlmIChjYy5zeXMubG9jYWxTdG9yYWdlLmdldEl0ZW0oXCJ0b2tlblwiKSkge1xuICAgICAgICAgICAgdGhpcy5uZWVkTG9naW4gPSBmYWxzZTtcbiAgICAgICAgICAgIHRoaXMucHJvdG9jb2wgPSB0cnVlO1xuICAgICAgICAgICAgY2Mud3hUb2tlbiA9IGNjLnN5cy5sb2NhbFN0b3JhZ2UuZ2V0SXRlbShcInRva2VuXCIpO1xuICAgICAgICAgICAgaWYoY2Muc3lzLmlzTmF0aXZlKXtcbiAgICAgICAgICAgICAgICBpZiAoY2Muc3lzLmxvY2FsU3RvcmFnZS5nZXRJdGVtKFwicmVhbE5hbWVcIikpIHtcbiAgICAgICAgICAgICAgICAgICAgY2MuYmVnaW5Db3VudFRpbWUgPSBuZXcgRGF0ZSgpLmdldFRpbWUoKTtcbiAgICAgICAgICAgICAgICAgICAgY2MuZGlyZWN0b3IubG9hZFNjZW5lKCdJbmRleCcpO1xuICAgICAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMuc2hvd1JlYWxMYXllcigpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1lbHNle1xuICAgICAgICAgICAgICAgIGNjLmJlZ2luQ291bnRUaW1lID0gbmV3IERhdGUoKS5nZXRUaW1lKCk7XG4gICAgICAgICAgICAgICAgY2MuZGlyZWN0b3IubG9hZFNjZW5lKCdJbmRleCcpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgfSxcbiAgICBvbkxvZ2luV1goKSB7XG4gICAgICAgIGlmIChjYy5zeXMuaXNOYXRpdmUpIHtcbiAgICAgICAgICAgIGlmICh0aGlzLnByb3RvY29sKSB7XG4gICAgICAgICAgICAgICAgY2MuVG9vbHMud3hMb2dpbigpO1xuICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICBjYy5Ub29scy5zaG93VGlwcyh0aGlzLm5vZGUsXCLor7flhYjlkIzmhI/nlKjmiLfljY/orq7lkozpmpDnp4HmlL/nrZZcIilcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgIH0sXG4gICAgLy8g6YCJ5oup55So5oi35Y2P6K6uXG4gICAgY2xpY2tQcm90b2NvbChlKSB7XG4gICAgICAgIGxldCB0YXJnZXQgPSBlLnRhcmdldDtcbiAgICAgICAgbGV0IHJpZ2h0ID0gdGFyZ2V0LmdldENoaWxkQnlOYW1lKFwicmlnaHRcIik7XG4gICAgICAgIGlmICh0aGlzLnByb3RvY29sKSB7XG4gICAgICAgICAgICByaWdodC5hY3RpdmUgPSBmYWxzZTtcbiAgICAgICAgICAgIHRoaXMucHJvdG9jb2wgPSBmYWxzZTtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgIHJpZ2h0LmFjdGl2ZSA9IHRydWU7XG4gICAgICAgICAgICB0aGlzLnByb3RvY29sID0gdHJ1ZTtcbiAgICAgICAgfVxuICAgIH0sXG4gICAgdXBkYXRlKGR0KSB7XG4gICAgICAgIHRoaXMudGltZSArPSBkdDtcbiAgICAgICAgaWYgKCF0aGlzLm5lZWRMb2dpbikge1xuICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICB9XG4gICAgICAgIGlmICh0aGlzLnRpbWUgPj0gMSkge1xuICAgICAgICAgICAgdGhpcy50aW1lID0gMDtcbiAgICAgICAgICAgIGlmIChjYy53eExvZ2luUmVzdWx0Y29kZSAmJiB0aGlzLnByb3RvY29sKSB7XG4gICAgICAgICAgICAgICAgdGhpcy5wcm90b2NvbCA9IGZhbHNlO1xuICAgICAgICAgICAgICAgIGxldCBkYXRhID0ge1xuICAgICAgICAgICAgICAgICAgICBcImNoYW5uZWxcIjogXCIxXCIsXG4gICAgICAgICAgICAgICAgICAgIFwiaW1laVwiOiBcIjFcIixcbiAgICAgICAgICAgICAgICAgICAgXCJtYWNcIjogXCIxXCIsXG4gICAgICAgICAgICAgICAgICAgIFwiZGlzdGluY3RfaWRcIjogXCIxXCIsXG4gICAgICAgICAgICAgICAgICAgIFwib2FpZFwiOiBcIjFcIixcbiAgICAgICAgICAgICAgICAgICAgXCJhbmRyb2lkX2lkXCI6IFwiMVwiLFxuICAgICAgICAgICAgICAgICAgICBcImNvZGVcIjogY2Mud3hMb2dpblJlc3VsdGNvZGVcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgY2MuVG9vbHMuc2VuZFJlcXVlc3QoXCJwaXQudjEvcmVnaXN0ZXJcIiwgXCJQT1NUXCIsIGRhdGEpLnRoZW4oKHJlcykgPT4ge1xuICAgICAgICAgICAgICAgICAgICBjYy53eFRva2VuID0gcmVzLmRhdGEudG9rZW47XG4gICAgICAgICAgICAgICAgICAgIGNjLnN5cy5sb2NhbFN0b3JhZ2Uuc2V0SXRlbShcInRva2VuXCIsIHJlcy5kYXRhLnRva2VuKTtcbiAgICAgICAgICAgICAgICAgICAgY2MuVG9vbHMuZG90KFwicmVnaXN0ZXJcIiwgeyByZWdpc3Rlcl90aW1lOiBuZXcgRGF0ZSgpLCBjaGFubmVsOiBcIuW+ruS/oVwiIH0pXG4gICAgICAgICAgICAgICAgICAgIGlmIChjYy5zeXMubG9jYWxTdG9yYWdlLmdldEl0ZW0oXCJyZWFsTmFtZVwiKSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgY2MuYmVnaW5Db3VudFRpbWUgPSBuZXcgRGF0ZSgpLmdldFRpbWUoKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIGNjLmRpcmVjdG9yLmxvYWRTY2VuZSgnSW5kZXgnKTtcbiAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuc2hvd1JlYWxMYXllcigpO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgfSlcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgIH0sXG4gICAgLy8g5pi+56S655So5oi35Y2P6K6uXG4gICAgc2hvd1VzZXJQcm90b2NvbCgpIHtcbiAgICAgICAgbGV0IHByb3RvY29sID0gdGhpcy5ub2RlLmdldENoaWxkQnlOYW1lKFwidXNlcl9wcm90b2NvbFwiKTtcbiAgICAgICAgcHJvdG9jb2wuYWN0aXZlID0gdHJ1ZTtcbiAgICB9LFxuICAgIGhpZGVVc2VyUHJvdG9jb2woKSB7XG4gICAgICAgIGxldCBwcm90b2NvbCA9IHRoaXMubm9kZS5nZXRDaGlsZEJ5TmFtZShcInVzZXJfcHJvdG9jb2xcIik7XG4gICAgICAgIHByb3RvY29sLmFjdGl2ZSA9IGZhbHNlO1xuICAgIH0sXG4gICAgLy8g5pi+56S66ZqQ56eB5pS/562WXG4gICAgc2hvd1VzZXJQcml2YWN5KCkge1xuICAgICAgICBsZXQgcHJpdmFjeSA9IHRoaXMubm9kZS5nZXRDaGlsZEJ5TmFtZShcInVzZXJfcHJpdmFjeVwiKTtcbiAgICAgICAgcHJpdmFjeS5hY3RpdmUgPSB0cnVlO1xuICAgIH0sXG4gICAgaGlkZVVzZXJQcml2YWN5KCkge1xuICAgICAgICBsZXQgcHJpdmFjeSA9IHRoaXMubm9kZS5nZXRDaGlsZEJ5TmFtZShcInVzZXJfcHJpdmFjeVwiKTtcbiAgICAgICAgcHJpdmFjeS5hY3RpdmUgPSBmYWxzZTtcbiAgICB9LFxuICAgIC8vIOWunuWQjeiupOivgVxuICAgIHNob3dSZWFsTGF5ZXIoKSB7XG4gICAgICAgIHRoaXMucmVhbE5hbWVMYXllciA9IHRoaXMubm9kZS5nZXRDaGlsZEJ5TmFtZShcIlJlYWxOYW1lXCIpO1xuICAgICAgICB0aGlzLnJlYWxOYW1lTGF5ZXIuYWN0aXZlID0gdHJ1ZTtcbiAgICB9LFxuICAgIC8vIOWunuWQjeiupOivgeeCueWHu1xuICAgIGNsaWNrUmVhbExheWVyKGUpIHtcbiAgICAgICAgbGV0IHRhcmdldCA9IGUudGFyZ2V0O1xuICAgICAgICBsZXQgX3JlYWxOYW1lID0gdGhpcy5yZWFsTmFtZUxheWVyLmdldENoaWxkQnlOYW1lKFwiZWRpdDFcIikuZ2V0Q29tcG9uZW50KGNjLkVkaXRCb3gpLnN0cmluZztcbiAgICAgICAgbGV0IF9yZWFsTnVtYmVyID0gdGhpcy5yZWFsTmFtZUxheWVyLmdldENoaWxkQnlOYW1lKFwiZWRpdDJcIikuZ2V0Q29tcG9uZW50KGNjLkVkaXRCb3gpLnN0cmluZztcbiAgICAgICAgY29uc29sZS5sb2coYGNvY29zLS0tLeecn+WunuWnk+WQjSR7X3JlYWxOYW1lfS0tLS0tLei6q+S7veivgeWPtyR7X3JlYWxOdW1iZXJ9YCk7XG4gICAgICAgIC8vIOeUqGxvY2Fs6K6w5b2VIOaYr+WQpuWunuWQjVxuICAgICAgICBpZih0aGlzLnJlZ1lvdXJOYW1lKF9yZWFsTmFtZSkmJnRoaXMucmVnWW91ck51bWJlcihfcmVhbE51bWJlcikpe1xuICAgICAgICAgICAgY29uc29sZS5sb2coXCJjb2Nvcy0tLS3orqTor4HmiJDlip9cIik7XG4gICAgICAgICAgICBjYy5zeXMubG9jYWxTdG9yYWdlLnNldEl0ZW0oXCJyZWFsTmFtZVwiLCB0cnVlKVxuICAgICAgICAgICAgY2MuZGlyZWN0b3IubG9hZFNjZW5lKCdJbmRleCcpO1xuICAgICAgICB9XG4gICAgfSxcbiAgICAvLyDliKTmlq3nnJ/lrp7lp5PlkI1cbiAgICByZWdZb3VyTmFtZShuYW1lKSB7XG4gICAgICAgIHZhciByZWdOYW1lID0gL15bXFx1NGUwMC1cXHU5ZmE1XXsyLDR9JC87XG4gICAgICAgIGlmICghcmVnTmFtZS50ZXN0KG5hbWUpKSB7XG4gICAgICAgICAgICBjYy5Ub29scy5zaG93VGlwcyh0aGlzLm5vZGUsXCLnnJ/lrp7lp5PlkI3loavlhpnmnInor69cIilcbiAgICAgICAgICAgIHJldHVybiBmYWxzZTtcbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gdHJ1ZVxuICAgIH0sXG4gICAgLy8g5Yik5pat6Lqr5Lu96K+B5Y+3XG4gICAgcmVnWW91ck51bWJlcihudW0pIHtcbiAgICAgICAgdmFyIHJlZ0lkTm8gPSAvKF5cXGR7MTV9JCl8KF5cXGR7MTh9JCl8KF5cXGR7MTd9KFxcZHxYfHgpJCkvO1xuICAgICAgICBpZiAoIXJlZ0lkTm8udGVzdChudW0pKSB7XG4gICAgICAgICAgICBjYy5Ub29scy5zaG93VGlwcyh0aGlzLm5vZGUsJ+i6q+S7veivgeWPt+Whq+WGmeacieivrycpO1xuICAgICAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgICAgICB9XG4gICAgICAgIHJldHVybiB0cnVlXG4gICAgfVxufSk7XG5cblxuIl19