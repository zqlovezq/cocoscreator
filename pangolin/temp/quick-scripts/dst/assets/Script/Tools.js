
                (function() {
                    var nodeEnv = typeof require !== 'undefined' && typeof process !== 'undefined';
                    var __module = nodeEnv ? module : {exports:{}};
                    var __filename = 'preview-scripts/assets/Script/Tools.js';
                    var __require = nodeEnv ? function (request) {
                        return cc.require(request);
                    } : function (request) {
                        return __quick_compile_project__.require(request, __filename);
                    };
                    function __define (exports, require, module) {
                        if (!nodeEnv) {__quick_compile_project__.registerModule(__filename, module);}"use strict";
cc._RF.push(module, '5f815fcXZ9BIY+pPRsOeaGx', 'Tools');
// Script/Tools.js

"use strict";

cc.Tools = {
  /**
   * @param {*} event 数数打点的事件名称
   * @param {*} pro 数数打点的关联属性
  */
  dot: function dot(event, pro) {
    if (cc.sys.isNative) {
      if (pro) {
        jsb.reflection.callStaticMethod("org/cocos2dx/javascript/AppActivity", "dot", "(Ljava/lang/String;Ljava/lang/String;)V", event, JSON.stringify(pro));
      } else {
        jsb.reflection.callStaticMethod("org/cocos2dx/javascript/AppActivity", "dot", "(Ljava/lang/String;)V", event);
      }
    }
  },
  getDevice: function getDevice(pram, data) {
    cc.Tools.DeviceInfo = JSON.parse(data);
  },

  /**
   * 看视频回调
   *  //type 1体力补充 2--过关奖励 3--签到 4--转盘 5--开局增益 6--插屏 7--开屏
   */
  adCallBack: function adCallBack(pram) {
    var _this = this;

    var _pram = pram.split(",");

    var ecpm = _pram[0];
    var type = _pram[1];
    console.log("cocos ecpm=", ecpm);
    this.getUserEcpm(ecpm, type).then(function () {
      switch (type) {
        case "1":
          // 看视频得体力
          _this.emitEvent("getPower");

          break;

        case "2":
          // 看视频得红包
          _this.emitEvent("getRedPackage");

          break;

        case "3":
          // 看视频签到
          _this.emitEvent("getSign");

          break;

        case "4":
          // 看视频转盘
          _this.emitEvent("getTable");

          break;

        case "5":
          // 看视频得道具
          _this.emitEvent("getWeapon");

          break;

        case "6":
          break;

        case "7":
          break;

        default:
          break;
      }
    });
  },
  emitEvent: function emitEvent(event) {
    cc.Tools.Event.emit(event);
  },
  // 显示激励视频
  showJiliAd: function showJiliAd(type) {
    var data = ["体力补充", "过关奖励", "签到", "转盘", "开局增益"];
    cc.Tools.dot("ad_show", {
      ad_scene: data[Number(type) - 1]
    });

    if (cc.sys.isNative) {
      jsb.reflection.callStaticMethod("org/cocos2dx/javascript/AppActivity", "showAd", "(Ljava/lang/String;)V", "" + type);
    }
  },
  // 显示banner
  showBanner: function showBanner() {
    if (cc.sys.isNative) {
      jsb.reflection.callStaticMethod("org/cocos2dx/javascript/AppActivity", "showBanner", "()V");
    }
  },
  // 隐藏banner
  hideBanner: function hideBanner() {
    if (cc.sys.isNative) {
      jsb.reflection.callStaticMethod("org/cocos2dx/javascript/AppActivity", "hideBanner", "()V");
    }
  },
  // 显示插屏广告
  showTableScreen: function showTableScreen() {
    if (cc.sys.isNative) {
      jsb.reflection.callStaticMethod("org/cocos2dx/javascript/AppActivity", "showTableScreen", "()V");
    }
  },
  // 隐藏插屏广告
  hideTableScreen: function hideTableScreen() {
    if (cc.sys.isNative) {
      jsb.reflection.callStaticMethod("org/cocos2dx/javascript/AppActivity", "hideTableScreen", "()V");
    }
  },
  // 微信登陆
  wxLogin: function wxLogin() {
    if (cc.sys.isNative) {
      jsb.reflection.callStaticMethod("org/cocos2dx/javascript/AppActivity", "weixin_login", "(Ljava/lang/String;)V", "weixin_login");
    }
  },

  /**
  * 接收native微信授权的code
  * @param errCode 
  */
  wxLoginResult: function wxLoginResult(errCode) {
    cc.wxLoginResultcode = errCode;
    cc.Tools.emitEvent("getCode");
  },

  /**
   * 看广告之后刷新一下ecpm
   */
  getUserEcpm: function getUserEcpm(ecpm, type) {
    // 获取ecpm之后像服务器发的是ecpm/100
    var serverEcpm = parseInt(ecpm / 100); // 单价

    var priceEcpm = Number(ecpm / (10 * 10000));
    return new Promise(function (resolve, reject) {
      if (type === "6") {
        cc.Tools.dot("ad_flow", {
          ecpm: serverEcpm,
          ad_price_1: priceEcpm
        });
        resolve();
      } else if (type === "7") {
        cc.Tools.dot("ad_open_screen", {
          ecpm: serverEcpm,
          ad_price_1: priceEcpm
        });
        resolve();
      } else {
        var sendData = {
          "ecpm": Number(ecpm) / 100,
          "ts": new Date().getTime() //时间戳

        };
        var data = cc.Tools.createSignData(sendData);
        cc.Tools.sendRequest("pit.v1.PitSvc/Rc", "POST", data).then(function (res) {
          var data = ["体力补充", "过关奖励", "签到", "转盘", "开局增益"];
          cc.Tools.dot("ad", {
            ad_type: "激励视频",
            ecpm: serverEcpm,
            ad_price_1: priceEcpm
          });
          cc.Tools.dot("ad_start", {
            ad_scene: data[Number(type) - 1],
            ecpm: serverEcpm
          });
          cc.zm.ad = res.data.ad;

          if (cc.zm.videoAd.redPack) {
            cc.zm.videoAd.redPack.ad = cc.zm.ad;
          }

          resolve();
        });
      }
    });
  },

  /**
   * 
   * @param {*} data 需要签名数据
   * @returns 
   */
  createSignData: function createSignData(data) {
    var sortList = [];

    for (var key in data) {
      if (data.hasOwnProperty(key) && key != "sign") {
        var value = data[key];
        var item = {};
        item.key = key;
        item.value = value;
        sortList.push(key);
      }
    }

    sortList.sort();
    var strToJiaMi = "";
    sortList.forEach(function (key) {
      strToJiaMi += "&" + key + "=" + data[key];
    }, this);
    strToJiaMi = "token=" + cc.zm.userInfo.sc1 + strToJiaMi;

    var hex_md5 = require("MD5");

    strToJiaMi = hex_md5(strToJiaMi);
    data.sign = strToJiaMi;
    return data;
  },
  // 适配屏幕
  screenAdapter: function screenAdapter() {
    var canvas = cc.find("Canvas").getComponent(cc.Canvas);
    var winSize = cc.view.getVisibleSize();

    if (winSize.height / winSize.width <= 720 / 1280) {
      canvas.fitHeight = true;
      canvas.fitWidth = false;
    } else {
      canvas.fitHeight = false;
      canvas.fitWidth = true;
    }
  },

  /**
   * 
   * @param {*} n node节点
   * @param {*} str  显示的tips内容
   */
  showTips: function showTips(n, str) {
    var tips = n.getChildByName("Tips");
    tips.getComponent(cc.Label).string = str;
    tips.stopAllActions();
    tips.y = 145;
    cc.tween(tips).to(0.1, {
      opacity: 255
    }).to(1, {
      y: 300
    }).delay(0.5).to(0.1, {
      opacity: 0
    }).start();
  },

  /**
   * 
   * @param {*} url 请求接口的url----pit.v1.PitSvc/UserInfo
   * @param {*} type 请求接口的类型 只能是GET--POST
   * @param {*} data 请求接口所需要的数据
   * @returns 
   */
  sendRequest: function sendRequest(url, type, data) {
    return new Promise(function (resolve, reject) {
      var xhr = new XMLHttpRequest();
      var requestURL = "https://pit.api.jiankangzhuan.com/" + url;
      xhr.open(type, requestURL, true);

      if (cc.sys.isNative) {
        xhr.setRequestHeader("Accept-Encodeing", "gzip,deflate");
      }

      if (cc.wxToken) {
        xhr.setRequestHeader("Authorization", cc.wxToken);
      }

      xhr.setRequestHeader("Content-Type", "application/json");
      console.log("cocos----xhr=", requestURL);
      console.log("cocos----data=", JSON.stringify(data));

      xhr.onreadystatechange = function () {
        if (xhr.readyState === 4 && xhr.status == 200) {
          console.log("cocos----http res:" + xhr.response); // 统一处理

          var _response = JSON.parse(xhr.response);

          if (_response.code === 0) {
            console.log("cocos----http success");
            resolve(_response);
          } else {
            console.log("cocos----http fail" + _response.message);
            reject(_response.message);
          }
        }
      };

      xhr.onerror = function () {
        reject(new Error(xhr.statusText));
      };

      xhr.send(JSON.stringify(data));
    });
  }
};

cc._RF.pop();
                    }
                    if (nodeEnv) {
                        __define(__module.exports, __require, __module);
                    }
                    else {
                        __quick_compile_project__.registerModuleFunc(__filename, function () {
                            __define(__module.exports, __require, __module);
                        });
                    }
                })();
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImFzc2V0cy9TY3JpcHQvVG9vbHMuanMiXSwibmFtZXMiOlsiY2MiLCJUb29scyIsImRvdCIsImV2ZW50IiwicHJvIiwic3lzIiwiaXNOYXRpdmUiLCJqc2IiLCJyZWZsZWN0aW9uIiwiY2FsbFN0YXRpY01ldGhvZCIsIkpTT04iLCJzdHJpbmdpZnkiLCJnZXREZXZpY2UiLCJwcmFtIiwiZGF0YSIsIkRldmljZUluZm8iLCJwYXJzZSIsImFkQ2FsbEJhY2siLCJfcHJhbSIsInNwbGl0IiwiZWNwbSIsInR5cGUiLCJjb25zb2xlIiwibG9nIiwiZ2V0VXNlckVjcG0iLCJ0aGVuIiwiZW1pdEV2ZW50IiwiRXZlbnQiLCJlbWl0Iiwic2hvd0ppbGlBZCIsImFkX3NjZW5lIiwiTnVtYmVyIiwic2hvd0Jhbm5lciIsImhpZGVCYW5uZXIiLCJzaG93VGFibGVTY3JlZW4iLCJoaWRlVGFibGVTY3JlZW4iLCJ3eExvZ2luIiwid3hMb2dpblJlc3VsdCIsImVyckNvZGUiLCJ3eExvZ2luUmVzdWx0Y29kZSIsInNlcnZlckVjcG0iLCJwYXJzZUludCIsInByaWNlRWNwbSIsIlByb21pc2UiLCJyZXNvbHZlIiwicmVqZWN0IiwiYWRfcHJpY2VfMSIsInNlbmREYXRhIiwiRGF0ZSIsImdldFRpbWUiLCJjcmVhdGVTaWduRGF0YSIsInNlbmRSZXF1ZXN0IiwicmVzIiwiYWRfdHlwZSIsInptIiwiYWQiLCJ2aWRlb0FkIiwicmVkUGFjayIsInNvcnRMaXN0Iiwia2V5IiwiaGFzT3duUHJvcGVydHkiLCJ2YWx1ZSIsIml0ZW0iLCJwdXNoIiwic29ydCIsInN0clRvSmlhTWkiLCJmb3JFYWNoIiwidXNlckluZm8iLCJzYzEiLCJoZXhfbWQ1IiwicmVxdWlyZSIsInNpZ24iLCJzY3JlZW5BZGFwdGVyIiwiY2FudmFzIiwiZmluZCIsImdldENvbXBvbmVudCIsIkNhbnZhcyIsIndpblNpemUiLCJ2aWV3IiwiZ2V0VmlzaWJsZVNpemUiLCJoZWlnaHQiLCJ3aWR0aCIsImZpdEhlaWdodCIsImZpdFdpZHRoIiwic2hvd1RpcHMiLCJuIiwic3RyIiwidGlwcyIsImdldENoaWxkQnlOYW1lIiwiTGFiZWwiLCJzdHJpbmciLCJzdG9wQWxsQWN0aW9ucyIsInkiLCJ0d2VlbiIsInRvIiwib3BhY2l0eSIsImRlbGF5Iiwic3RhcnQiLCJ1cmwiLCJ4aHIiLCJYTUxIdHRwUmVxdWVzdCIsInJlcXVlc3RVUkwiLCJvcGVuIiwic2V0UmVxdWVzdEhlYWRlciIsInd4VG9rZW4iLCJvbnJlYWR5c3RhdGVjaGFuZ2UiLCJyZWFkeVN0YXRlIiwic3RhdHVzIiwicmVzcG9uc2UiLCJfcmVzcG9uc2UiLCJjb2RlIiwibWVzc2FnZSIsIm9uZXJyb3IiLCJFcnJvciIsInN0YXR1c1RleHQiLCJzZW5kIl0sIm1hcHBpbmdzIjoiOzs7Ozs7Ozs7Ozs7Ozs7OztBQUFBQSxFQUFFLENBQUNDLEtBQUgsR0FBVztBQUNQO0FBQ0o7QUFDQTtBQUNBO0FBQ0lDLEVBQUFBLEdBTE8sZUFLSEMsS0FMRyxFQUtJQyxHQUxKLEVBS1M7QUFDWixRQUFJSixFQUFFLENBQUNLLEdBQUgsQ0FBT0MsUUFBWCxFQUFxQjtBQUVqQixVQUFJRixHQUFKLEVBQVM7QUFDTEcsUUFBQUEsR0FBRyxDQUFDQyxVQUFKLENBQWVDLGdCQUFmLENBQWdDLHFDQUFoQyxFQUF1RSxLQUF2RSxFQUE4RSx5Q0FBOUUsRUFBeUhOLEtBQXpILEVBQWdJTyxJQUFJLENBQUNDLFNBQUwsQ0FBZVAsR0FBZixDQUFoSTtBQUNILE9BRkQsTUFFTztBQUNIRyxRQUFBQSxHQUFHLENBQUNDLFVBQUosQ0FBZUMsZ0JBQWYsQ0FBZ0MscUNBQWhDLEVBQXVFLEtBQXZFLEVBQThFLHVCQUE5RSxFQUF1R04sS0FBdkc7QUFDSDtBQUNKO0FBQ0osR0FkTTtBQWVQUyxFQUFBQSxTQWZPLHFCQWVHQyxJQWZILEVBZVFDLElBZlIsRUFlYTtBQUNoQmQsSUFBQUEsRUFBRSxDQUFDQyxLQUFILENBQVNjLFVBQVQsR0FBc0JMLElBQUksQ0FBQ00sS0FBTCxDQUFXRixJQUFYLENB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R0FBRyxDQUFDZ0IsSUFBSixDQUFTekcsSUFBSSxDQUFDQyxTQUFMLENBQWVHLElBQWYsQ0FBVDtBQUNILEtBL0JNLENBQVA7QUFnQ0g7QUEzT00sQ0FBWCIsInNvdXJjZVJvb3QiOiIvIiwic291cmNlc0NvbnRlbnQiOlsiY2MuVG9vbHMgPSB7XG4gICAgLyoqXG4gICAgICogQHBhcmFtIHsqfSBldmVudCDmlbDmlbDmiZPngrnnmoTkuovku7blkI3np7BcbiAgICAgKiBAcGFyYW0geyp9IHBybyDmlbDmlbDmiZPngrnnmoTlhbPogZTlsZ7mgKdcbiAgICAqL1xuICAgIGRvdChldmVudCwgcHJvKSB7XG4gICAgICAgIGlmIChjYy5zeXMuaXNOYXRpdmUpIHtcbiAgICAgICAgXG4gICAgICAgICAgICBpZiAocHJvKSB7XG4gICAgICAgICAgICAgICAganNiLnJlZmxlY3Rpb24uY2FsbFN0YXRpY01ldGhvZChcIm9yZy9jb2NvczJkeC9qYXZhc2NyaXB0L0FwcEFjdGl2aXR5XCIsIFwiZG90XCIsIFwiKExqYXZhL2xhbmcvU3RyaW5nO0xqYXZhL2xhbmcvU3RyaW5nOylWXCIsIGV2ZW50LCBKU09OLnN0cmluZ2lmeShwcm8pKTtcbiAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAganNiLnJlZmxlY3Rpb24uY2FsbFN0YXRpY01ldGhvZChcIm9yZy9jb2NvczJkeC9qYXZhc2NyaXB0L0FwcEFjdGl2aXR5XCIsIFwiZG90XCIsIFwiKExqYXZhL2xhbmcvU3RyaW5nOylWXCIsIGV2ZW50KTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgIH0sXG4gICAgZ2V0RGV2aWNlKHByYW0sZGF0YSl7XG4gICAgICAgIGNjLlRvb2xzLkRldmljZUluZm8gPSBKU09OLnBhcnNlKGRhdGEpO1xuICAgIH0sXG4gICAgLyoqXG4gICAgICog55yL6KeG6aKR5Zue6LCDXG4gICAgICogIC8vdHlwZSAx5L2T5Yqb6KGl5YWFIDItLei/h+WFs+WlluWKsSAzLS3nrb7liLAgNC0t6L2s55uYIDUtLeW8gOWxgOWinuebiiA2LS3mj5LlsY8gNy0t5byA5bGPXG4gICAgICovXG4gICAgYWRDYWxsQmFjayhwcmFtKSB7XG4gICAgICAgIGxldCBfcHJhbSA9IHByYW0uc3BsaXQoXCIsXCIpO1xuICAgICAgICBsZXQgZWNwbSA9IF9wcmFtWzBdO1xuICAgICAgICBsZXQgdHlwZSA9IF9wcmFtWzFdO1xuICAgICAgICBjb25zb2xlLmxvZyhcImNvY29zIGVjcG09XCIsIGVjcG0pO1xuICAgICAgICB0aGlzLmdldFVzZXJFY3BtKGVjcG0sIHR5cGUpLnRoZW4oKCkgPT4ge1xuICAgICAgICAgICAgc3dpdGNoICh0eXBlKSB7XG4gICAgICAgICAgICAgICAgY2FzZSBcIjFcIjpcbiAgICAgICAgICAgICAgICAgICAgIC8vIOeci+inhumikeW+l+S9k+WKm1xuICAgICAgICAgICAgICAgICAgICB0aGlzLmVtaXRFdmVudChcImdldFBvd2VyXCIpO1xuICAgICAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgICAgICBjYXNlIFwiMlwiOlxuICAgICAgICAgICAgICAgICAgICAvLyDnnIvop4bpopHlvpfnuqLljIVcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5lbWl0RXZlbnQoXCJnZXRSZWRQYWNrYWdlXCIpO1xuICAgICAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgICAgICBjYXNlIFwiM1wiOlxuICAgICAgICAgICAgICAgICAgICAgLy8g55yL6KeG6aKR562+5YiwXG4gICAgICAgICAgICAgICAgICAgIHRoaXMuZW1pdEV2ZW50KFwiZ2V0U2lnblwiKTtcbiAgICAgICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICAgICAgY2FzZSBcIjRcIjpcbiAgICAgICAgICAgICAgICAgICAgIC8vIOeci+inhumikei9rOebmFxuICAgICAgICAgICAgICAgICAgICB0aGlzLmVtaXRFdmVudChcImdldFRhYmxlXCIpO1xuICAgICAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgICAgICBjYXNlIFwiNVwiOlxuICAgICAgICAgICAgICAgICAgICAvLyDnnIvop4bpopHlvpfpgZPlhbdcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5lbWl0RXZlbnQoXCJnZXRXZWFwb25cIik7XG4gICAgICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgICAgIGNhc2UgXCI2XCI6XG4gICAgICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgICAgIGNhc2UgXCI3XCI6XG4gICAgICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgICAgIGRlZmF1bHQ6XG4gICAgICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgfVxuICAgICAgICB9KVxuICAgIH0sXG4gICAgZW1pdEV2ZW50KGV2ZW50KXtcbiAgICAgICAgY2MuVG9vbHMuRXZlbnQuZW1pdChldmVudCk7XG4gICAgfSxcbiAgICAvLyDmmL7npLrmv4DlirHop4bpopFcbiAgICBzaG93SmlsaUFkKHR5cGUpIHtcbiAgICAgICAgbGV0IGRhdGEgPSBbXCLkvZPlipvooaXlhYVcIiwgXCLov4flhbPlpZblirFcIiwgXCLnrb7liLBcIiwgXCLovaznm5hcIiwgXCLlvIDlsYDlop7nm4pcIl07XG4gICAgICAgIGNjLlRvb2xzLmRvdChcImFkX3Nob3dcIiwgeyBhZF9zY2VuZTogZGF0YVtOdW1iZXIodHlwZSkgLSAxXSB9KTtcbiAgICAgICAgaWYgKGNjLnN5cy5pc05hdGl2ZSkge1xuICAgICAgICAgICAganNiLnJlZmxlY3Rpb24uY2FsbFN0YXRpY01ldGhvZChcIm9yZy9jb2NvczJkeC9qYXZhc2NyaXB0L0FwcEFjdGl2aXR5XCIsIFwic2hvd0FkXCIsIFwiKExqYXZhL2xhbmcvU3RyaW5nOylWXCIsIFwiXCIgKyB0eXBlKTtcbiAgICAgICAgfVxuICAgIH0sXG4gICAgLy8g5pi+56S6YmFubmVyXG4gICAgc2hvd0Jhbm5lcigpIHtcbiAgICAgICAgaWYgKGNjLnN5cy5pc05hdGl2ZSkge1xuICAgICAgICAgICAganNiLnJlZmxlY3Rpb24uY2FsbFN0YXRpY01ldGhvZChcIm9yZy9jb2NvczJkeC9qYXZhc2NyaXB0L0FwcEFjdGl2aXR5XCIsIFwic2hvd0Jhbm5lclwiLCBcIigpVlwiKTtcbiAgICAgICAgfVxuICAgIH0sXG4gICAgLy8g6ZqQ6JePYmFubmVyXG4gICAgaGlkZUJhbm5lcigpIHtcbiAgICAgICAgaWYgKGNjLnN5cy5pc05hdGl2ZSkge1xuICAgICAgICAgICAganNiLnJlZmxlY3Rpb24uY2FsbFN0YXRpY01ldGhvZChcIm9yZy9jb2NvczJkeC9qYXZhc2NyaXB0L0FwcEFjdGl2aXR5XCIsIFwiaGlkZUJhbm5lclwiLCBcIigpVlwiKTtcbiAgICAgICAgfVxuICAgIH0sXG4gICAgLy8g5pi+56S65o+S5bGP5bm/5ZGKXG4gICAgc2hvd1RhYmxlU2NyZWVuKCkge1xuICAgICAgICBpZiAoY2Muc3lzLmlzTmF0aXZlKSB7XG4gICAgICAgICAgICBqc2IucmVmbGVjdGlvbi5jYWxsU3RhdGljTWV0aG9kKFwib3JnL2NvY29zMmR4L2phdmFzY3JpcHQvQXBwQWN0aXZpdHlcIiwgXCJzaG93VGFibGVTY3JlZW5cIiwgXCIoKVZcIik7XG4gICAgICAgIH1cbiAgICB9LFxuICAgIC8vIOmakOiXj+aPkuWxj+W5v+WRilxuICAgIGhpZGVUYWJsZVNjcmVlbigpIHtcbiAgICAgICAgaWYgKGNjLnN5cy5pc05hdGl2ZSkge1xuICAgICAgICAgICAganNiLnJlZmxlY3Rpb24uY2FsbFN0YXRpY01ldGhvZChcIm9yZy9jb2NvczJkeC9qYXZhc2NyaXB0L0FwcEFjdGl2aXR5XCIsIFwiaGlkZVRhYmxlU2NyZWVuXCIsIFwiKClWXCIpO1xuICAgICAgICB9XG4gICAgfSxcbiAgICAvLyDlvq7kv6HnmbvpmYZcbiAgICB3eExvZ2luKCkge1xuICAgICAgICBpZiAoY2Muc3lzLmlzTmF0aXZlKSB7XG4gICAgICAgICAgICBqc2IucmVmbGVjdGlvbi5jYWxsU3RhdGljTWV0aG9kKFwib3JnL2NvY29zMmR4L2phdmFzY3JpcHQvQXBwQWN0aXZpdHlcIiwgXCJ3ZWl4aW5fbG9naW5cIiwgXCIoTGphdmEvbGFuZy9TdHJpbmc7KVZcIiwgXCJ3ZWl4aW5fbG9naW5cIik7XG4gICAgICAgIH1cbiAgICB9LFxuICAgIC8qKlxuICAgICog5o6l5pS2bmF0aXZl5b6u5L+h5o6I5p2D55qEY29kZVxuICAgICogQHBhcmFtIGVyckNvZGUgXG4gICAgKi9cbiAgICB3eExvZ2luUmVzdWx0KGVyckNvZGUpIHtcbiAgICAgICAgY2Mud3hMb2dpblJlc3VsdGNvZGUgPSBlcnJDb2RlO1xuICAgICAgICBjYy5Ub29scy5lbWl0RXZlbnQoXCJnZXRDb2RlXCIpO1xuICAgIH0sXG4gICAgLyoqXG4gICAgICog55yL5bm/5ZGK5LmL5ZCO5Yi35paw5LiA5LiLZWNwbVxuICAgICAqL1xuICAgIGdldFVzZXJFY3BtKGVjcG0sIHR5cGUpIHtcbiAgICAgICAgLy8g6I635Y+WZWNwbeS5i+WQjuWDj+acjeWKoeWZqOWPkeeahOaYr2VjcG0vMTAwXG4gICAgICAgIGxldCBzZXJ2ZXJFY3BtID0gcGFyc2VJbnQoZWNwbS8xMDApO1xuICAgICAgICAvLyDljZXku7dcbiAgICAgICAgbGV0IHByaWNlRWNwbSA9IE51bWJlcihlY3BtLygxMCoxMDAwMCkpO1xuICAgICAgICByZXR1cm4gbmV3IFByb21pc2UoZnVuY3Rpb24gKHJlc29sdmUsIHJlamVjdCkge1xuICAgICAgICAgICAgaWYgKHR5cGUgPT09IFwiNlwiKSB7XG4gICAgICAgICAgICAgICAgY2MuVG9vbHMuZG90KFwiYWRfZmxvd1wiLCB7IGVjcG06IHNlcnZlckVjcG0sYWRfcHJpY2VfMTogcHJpY2VFY3BtfSk7XG4gICAgICAgICAgICAgICAgcmVzb2x2ZSgpO1xuICAgICAgICAgICAgfSBlbHNlIGlmICh0eXBlID09PSBcIjdcIikge1xuICAgICAgICAgICAgICAgIGNjLlRvb2xzLmRvdChcImFkX29wZW5fc2NyZWVuXCIsIHsgZWNwbTogc2VydmVyRWNwbSxhZF9wcmljZV8xOiBwcmljZUVjcG19KTtcbiAgICAgICAgICAgICAgICByZXNvbHZlKCk7XG4gICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgIGxldCBzZW5kRGF0YSA9IHtcbiAgICAgICAgICAgICAgICAgICAgXCJlY3BtXCI6IE51bWJlcihlY3BtKS8xMDAsXG4gICAgICAgICAgICAgICAgICAgIFwidHNcIjogbmV3IERhdGUoKS5nZXRUaW1lKCkvL+aXtumXtOaIs1xuICAgICAgICAgICAgICAgIH07XG4gICAgICAgICAgICAgICAgbGV0IGRhdGEgPSBjYy5Ub29scy5jcmVhdGVTaWduRGF0YShzZW5kRGF0YSk7XG4gICAgICAgICAgICAgICAgY2MuVG9vbHMuc2VuZFJlcXVlc3QoXCJwaXQudjEuUGl0U3ZjL1JjXCIsIFwiUE9TVFwiLCBkYXRhKS50aGVuKChyZXMpID0+IHtcbiAgICAgICAgICAgICAgICAgICAgbGV0IGRhdGEgPSBbXCLkvZPlipvooaXlhYVcIiwgXCLov4flhbPlpZblirFcIiwgXCLnrb7liLBcIiwgXCLovaznm5hcIiwgXCLlvIDlsYDlop7nm4pcIl07XG4gICAgICAgICAgICAgICAgICAgIGNjLlRvb2xzLmRvdChcImFkXCIsIHsgYWRfdHlwZTogXCLmv4DlirHop4bpopFcIiwgZWNwbTogc2VydmVyRWNwbSwgYWRfcHJpY2VfMTogcHJpY2VFY3BtfSk7XG4gICAgICAgICAgICAgICAgICAgIGNjLlRvb2xzLmRvdChcImFkX3N0YXJ0XCIsIHsgYWRfc2NlbmU6IGRhdGFbTnVtYmVyKHR5cGUpIC0gMV0sIGVjcG06IHNlcnZlckVjcG0gfSk7XG4gICAgICAgICAgICAgICAgICAgIGNjLnptLmFkID0gcmVzLmRhdGEuYWQ7XG4gICAgICAgICAgICAgICAgICAgIGlmIChjYy56bS52aWRlb0FkLnJlZFBhY2spIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGNjLnptLnZpZGVvQWQucmVkUGFjay5hZCA9IGNjLnptLmFkO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIHJlc29sdmUoKTtcbiAgICAgICAgICAgICAgICB9KVxuICAgICAgICAgICAgfVxuICAgICAgICB9KVxuICAgIH0sXG4gICAgLyoqXG4gICAgICogXG4gICAgICogQHBhcmFtIHsqfSBkYXRhIOmcgOimgeetvuWQjeaVsOaNrlxuICAgICAqIEByZXR1cm5zIFxuICAgICAqL1xuICAgIGNyZWF0ZVNpZ25EYXRhOiBmdW5jdGlvbiAoZGF0YSkge1xuICAgICAgICB2YXIgc29ydExpc3QgPSBbXTtcbiAgICAgICAgZm9yICh2YXIga2V5IGluIGRhdGEpIHtcbiAgICAgICAgICAgIGlmIChkYXRhLmhhc093blByb3BlcnR5KGtleSkgJiYga2V5ICE9IFwic2lnblwiKSB7XG4gICAgICAgICAgICAgICAgdmFyIHZhbHVlID0gZGF0YVtrZXldO1xuICAgICAgICAgICAgICAgIHZhciBpdGVtID0ge307XG4gICAgICAgICAgICAgICAgaXRlbS5rZXkgPSBrZXk7XG4gICAgICAgICAgICAgICAgaXRlbS52YWx1ZSA9IHZhbHVlO1xuICAgICAgICAgICAgICAgIHNvcnRMaXN0LnB1c2goa2V5KTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgICBzb3J0TGlzdC5zb3J0KCk7XG4gICAgICAgIHZhciBzdHJUb0ppYU1pID0gXCJcIjtcbiAgICAgICAgc29ydExpc3QuZm9yRWFjaChmdW5jdGlvbiAoa2V5KSB7XG4gICAgICAgICAgICBzdHJUb0ppYU1pICs9IFwiJlwiICsga2V5ICsgXCI9XCIgKyBkYXRhW2tleV07XG4gICAgICAgIH0sIHRoaXMpO1xuICAgICAgICBzdHJUb0ppYU1pID0gXCJ0b2tlbj1cIiArIGNjLnptLnVzZXJJbmZvLnNjMSArIHN0clRvSmlhTWk7XG4gICAgICAgIHZhciBoZXhfbWQ1ID0gcmVxdWlyZShcIk1ENVwiKVxuICAgICAgICBzdHJUb0ppYU1pID0gaGV4X21kNShzdHJUb0ppYU1pKTtcbiAgICAgICAgZGF0YS5zaWduID0gc3RyVG9KaWFNaTtcbiAgICAgICAgcmV0dXJuIGRhdGE7XG5cbiAgICB9LFxuICAgIC8vIOmAgumFjeWxj+W5lVxuICAgIHNjcmVlbkFkYXB0ZXIoKSB7XG4gICAgICAgIGxldCBjYW52YXMgPSBjYy5maW5kKFwiQ2FudmFzXCIpLmdldENvbXBvbmVudChjYy5DYW52YXMpO1xuICAgICAgICBsZXQgd2luU2l6ZSA9IGNjLnZpZXcuZ2V0VmlzaWJsZVNpemUoKTtcblxuICAgICAgICBpZiAod2luU2l6ZS5oZWlnaHQgLyB3aW5TaXplLndpZHRoIDw9IDcyMCAvIDEyODApIHtcbiAgICAgICAgICAgIGNhbnZhcy5maXRIZWlnaHQgPSB0cnVlO1xuICAgICAgICAgICAgY2FudmFzLmZpdFdpZHRoID0gZmFsc2U7XG4gICAgICAgIH1cbiAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICBjYW52YXMuZml0SGVpZ2h0ID0gZmFsc2U7XG4gICAgICAgICAgICBjYW52YXMuZml0V2lkdGggPSB0cnVlO1xuICAgICAgICB9XG4gICAgfSxcbiAgICAvKipcbiAgICAgKiBcbiAgICAgKiBAcGFyYW0geyp9IG4gbm9kZeiKgueCuVxuICAgICAqIEBwYXJhbSB7Kn0gc3RyICDmmL7npLrnmoR0aXBz5YaF5a65XG4gICAgICovXG4gICAgc2hvd1RpcHMobiwgc3RyKSB7XG4gICAgICAgIGxldCB0aXBzID0gbi5nZXRDaGlsZEJ5TmFtZShcIlRpcHNcIik7XG4gICAgICAgIHRpcHMuZ2V0Q29tcG9uZW50KGNjLkxhYmVsKS5zdHJpbmcgPSBzdHI7XG4gICAgICAgIHRpcHMuc3RvcEFsbEFjdGlvbnMoKTtcbiAgICAgICAgdGlwcy55ID0gMTQ1O1xuICAgICAgICBjYy50d2Vlbih0aXBzKS50bygwLjEsIHsgb3BhY2l0eTogMjU1IH0pLnRvKDEsIHsgeTogMzAwIH0pLmRlbGF5KDAuNSkudG8oMC4xLCB7IG9wYWNpdHk6IDAgfSkuc3RhcnQoKVxuICAgIH0sXG4gICAgLyoqXG4gICAgICogXG4gICAgICogQHBhcmFtIHsqfSB1cmwg6K+35rGC5o6l5Y+j55qEdXJsLS0tLXBpdC52MS5QaXRTdmMvVXNlckluZm9cbiAgICAgKiBAcGFyYW0geyp9IHR5cGUg6K+35rGC5o6l5Y+j55qE57G75Z6LIOWPquiDveaYr0dFVC0tUE9TVFxuICAgICAqIEBwYXJhbSB7Kn0gZGF0YSDor7fmsYLmjqXlj6PmiYDpnIDopoHnmoTmlbDmja5cbiAgICAgKiBAcmV0dXJucyBcbiAgICAgKi9cbiAgICBzZW5kUmVxdWVzdDogZnVuY3Rpb24gKHVybCwgdHlwZSwgZGF0YSkge1xuICAgICAgICByZXR1cm4gbmV3IFByb21pc2UoZnVuY3Rpb24gKHJlc29sdmUsIHJlamVjdCkge1xuICAgICAgICAgICAgbGV0IHhociA9IG5ldyBYTUxIdHRwUmVxdWVzdCgpO1xuICAgICAgICAgICAgbGV0IHJlcXVlc3RVUkwgPSBcImh0dHBzOi8vcGl0LmFwaS5qaWFua2FuZ3podWFuLmNvbS9cIiArIHVybDtcbiAgICAgICAgICAgIHhoci5vcGVuKHR5cGUsIHJlcXVlc3RVUkwsIHRydWUpO1xuICAgICAgICAgICAgaWYgKGNjLnN5cy5pc05hdGl2ZSkge1xuICAgICAgICAgICAgICAgIHhoci5zZXRSZXF1ZXN0SGVhZGVyKFwiQWNjZXB0LUVuY29kZWluZ1wiLCBcImd6aXAsZGVmbGF0ZVwiKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGlmIChjYy53eFRva2VuKSB7XG4gICAgICAgICAgICAgICAgeGhyLnNldFJlcXVlc3RIZWFkZXIoXCJBdXRob3JpemF0aW9uXCIsIGNjLnd4VG9rZW4pO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgeGhyLnNldFJlcXVlc3RIZWFkZXIoXCJDb250ZW50LVR5cGVcIiwgXCJhcHBsaWNhdGlvbi9qc29uXCIpO1xuICAgICAgICAgICAgY29uc29sZS5sb2coXCJjb2Nvcy0tLS14aHI9XCIsIHJlcXVlc3RVUkwpO1xuICAgICAgICAgICAgY29uc29sZS5sb2coXCJjb2Nvcy0tLS1kYXRhPVwiLCBKU09OLnN0cmluZ2lmeShkYXRhKSk7XG4gICAgICAgICAgICB4aHIub25yZWFkeXN0YXRlY2hhbmdlID0gZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgICAgIGlmICh4aHIucmVhZHlTdGF0ZSA9PT0gNCAmJiB4aHIuc3RhdHVzID09IDIwMCkge1xuICAgICAgICAgICAgICAgICAgICBjb25zb2xlLmxvZyhcImNvY29zLS0tLWh0dHAgcmVzOlwiICsgeGhyLnJlc3BvbnNlKTtcbiAgICAgICAgICAgICAgICAgICAgLy8g57uf5LiA5aSE55CGXG4gICAgICAgICAgICAgICAgICAgIGxldCBfcmVzcG9uc2UgPSBKU09OLnBhcnNlKHhoci5yZXNwb25zZSk7XG4gICAgICAgICAgICAgICAgICAgIGlmIChfcmVzcG9uc2UuY29kZSA9PT0gMCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgY29uc29sZS5sb2coXCJjb2Nvcy0tLS1odHRwIHN1Y2Nlc3NcIik7XG4gICAgICAgICAgICAgICAgICAgICAgICByZXNvbHZlKF9yZXNwb25zZSlcbiAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKFwiY29jb3MtLS0taHR0cCBmYWlsXCIrX3Jlc3BvbnNlLm1lc3NhZ2UpO1xuICAgICAgICAgICAgICAgICAgICAgICAgcmVqZWN0KF9yZXNwb25zZS5tZXNzYWdlKTtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIHhoci5vbmVycm9yID0gZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgICAgIHJlamVjdChuZXcgRXJyb3IoeGhyLnN0YXR1c1RleHQpKVxuICAgICAgICAgICAgfVxuICAgICAgICAgICAgeGhyLnNlbmQoSlNPTi5zdHJpbmdpZnkoZGF0YSkpO1xuICAgICAgICB9KVxuICAgIH1cbn0iXX0=