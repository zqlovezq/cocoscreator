
                (function() {
                    var nodeEnv = typeof require !== 'undefined' && typeof process !== 'undefined';
                    var __module = nodeEnv ? module : {exports:{}};
                    var __filename = 'preview-scripts/assets/Script/login.js';
                    var __require = nodeEnv ? function (request) {
                        return cc.require(request);
                    } : function (request) {
                        return __quick_compile_project__.require(request, __filename);
                    };
                    function __define (exports, require, module) {
                        if (!nodeEnv) {__quick_compile_project__.registerModule(__filename, module);}"use strict";
cc._RF.push(module, '6b7cdHix81Ol6r4h+cnHYQh', 'login');
// Script/login.js

"use strict";

cc.Class({
  "extends": cc.Component,
  properties: {},
  // LIFE-CYCLE CALLBACKS:
  // onLoad () {},
  start: function start() {
    this.protocol = false;
    this.needLogin = true;
    this.time = 0;

    if (!cc.sys.isNative) {
      cc.sys.localStorage.setItem("token", "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJ1c2VyX2lkIjoxMDAxMTcxLCJvcGVuX2lkIjoib1FXNFI1OVVSRlF1YTNSWjlvX3lfdGJ6UEdLNCIsIm5pY2tfbmFtZSI6Iua1t-ebl-iIuemVvzIuMCIsImdlbmRlciI6MSwiYXZhdGFyIjoiaHR0cHM6Ly90aGlyZHd4LnFsb2dvLmNuL21tb3Blbi92aV8zMi9mR0xkR1pneG5wVmtJQldjaWEzeWljaWJ6aWJFQ0J0VzFhQkhEbUdhWmV6cTAycWdQUUN3STN5OGljVE5nWEtCcDBOcExBNUJFdDZ6UEdsSG1VTWY5bHd4Qk1nLzEzMiIsImNyZWF0ZV90aW1lIjowLCJjaGFubmVsIjoiMSIsImRpc3RpbmN0X2lkIjoiMSJ9.K5C9XSkEEjBBfPFn1m5BoXGu11ubPc9lSvDRAHkv_V4");
    }

    if (cc.sys.localStorage.getItem("token")) {
      this.needLogin = false;
      this.protocol = true;
      cc.wxToken = cc.sys.localStorage.getItem("token");

      if (cc.sys.isNative) {
        if (cc.sys.localStorage.getItem("realName")) {
          cc.director.loadScene('Index');
        } else {
          this.showRealLayer();
        }
      } else {
        cc.director.loadScene('Index');
      }
    }
  },
  onLoginWX: function onLoginWX() {
    if (cc.sys.isNative) {
      if (this.protocol) {
        cc.Tools.wxLogin();
      } else {
        cc.Tools.showTips(this.node, "请先同意用户协议和隐私政策");
      }
    }
  },
  // 选择用户协议
  clickProtocol: function clickProtocol(e) {
    var target = e.target;
    var right = target.getChildByName("right");

    if (this.protocol) {
      right.active = false;
      this.protocol = false;
    } else {
      right.active = true;
      this.protocol = true;
    }
  },
  update: function update(dt) {
    var _this = this;

    this.time += dt;

    if (!this.needLogin) {
      return;
    }

    if (this.time >= 1) {
      this.time = 0;

      if (cc.wxLoginResultcode && this.protocol) {
        this.protocol = false;
        var data = {
          "channel": "1",
          "imei": "1",
          "mac": "1",
          "distinct_id": "1",
          "oaid": "1",
          "android_id": "1",
          "code": cc.wxLoginResultcode
        };
        cc.Tools.sendRequest("pit.v1/register", "POST", data).then(function (res) {
          cc.wxToken = res.data.token;
          cc.sys.localStorage.setItem("token", res.data.token);
          cc.Tools.dot("register", {
            register_time: new Date(),
            channel: "微信"
          });

          if (cc.sys.localStorage.getItem("realName")) {
            cc.director.loadScene('Index');
          } else {
            _this.showRealLayer();
          }
        });
      }
    }
  },
  // 显示用户协议
  showUserProtocol: function showUserProtocol() {
    var protocol = this.node.getChildByName("user_protocol");
    protocol.active = true;
  },
  hideUserProtocol: function hideUserProtocol() {
    var protocol = this.node.getChildByName("user_protocol");
    protocol.active = false;
  },
  // 显示隐私政策
  showUserPrivacy: function showUserPrivacy() {
    var privacy = this.node.getChildByName("user_privacy");
    privacy.active = true;
  },
  hideUserPrivacy: function hideUserPrivacy() {
    var privacy = this.node.getChildByName("user_privacy");
    privacy.active = false;
  },
  // 实名认证
  showRealLayer: function showRealLayer() {
    this.realNameLayer = this.node.getChildByName("RealName");
    this.realNameLayer.active = true;
  },
  // 实名认证点击
  clickRealLayer: function clickRealLayer(e) {
    var target = e.target;
    var _realName = this.realNameLayer.getChildByName("edit1").getComponent(cc.EditBox).string;
    var _realNumber = this.realNameLayer.getChildByName("edit2").getComponent(cc.EditBox).string;
    cc.log("\u771F\u5B9E\u59D3\u540D" + _realName + "------\u8EAB\u4EFD\u8BC1\u53F7" + _realNumber); // 用local记录 是否实名

    if (this.regYourName(_realName) && this.regYourNumber(_realNumber)) {
      cc.log("认证成功");
      cc.sys.localStorage.setItem("realName", true);
      cc.director.loadScene('Index');
    }
  },
  // 判断真实姓名
  regYourName: function regYourName(name) {
    var regName = /^[\u4e00-\u9fa5]{2,4}$/;

    if (!regName.test(name)) {
      cc.Tools.showTips(this.node, "真实姓名填写有误");
      return false;
    }

    return true;
  },
  // 判断身份证号
  regYourNumber: function regYourNumber(num) {
    var regIdNo = /(^\d{15}$)|(^\d{18}$)|(^\d{17}(\d|X|x)$)/;

    if (!regIdNo.test(num)) {
      cc.Tools.showTips(this.node, '身份证号填写有误');
      return false;
    }

    return true;
  }
});

cc._RF.pop();
                    }
                    if (nodeEnv) {
                        __define(__module.exports, __require, __module);
                    }
                    else {
                        __quick_compile_project__.registerModuleFunc(__filename, function () {
                            __define(__module.exports, __require, __module);
                        });
                    }
                })();
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImFzc2V0cy9TY3JpcHQvbG9naW4uanMiXSwibmFtZXMiOlsiY2MiLCJDbGFzcyIsIkNvbXBvbmVudCIsInByb3BlcnRpZXMiLCJzdGFydCIsInByb3RvY29sIiwibmVlZExvZ2luIiwidGltZSIsInN5cyIsImlzTmF0aXZlIiwibG9jYWxTdG9yYWdlIiwic2V0SXRlbSIsImdldEl0ZW0iLCJ3eFRva2VuIiwiZGlyZWN0b3IiLCJsb2FkU2NlbmUiLCJzaG93UmVhbExheWVyIiwib25Mb2dpbldYIiwiVG9vbHMiLCJ3eExvZ2luIiwic2hvd1RpcHMiLCJub2RlIiwiY2xpY2tQcm90b2NvbCIsImUiLCJ0YXJnZXQiLCJyaWdodCIsImdldENoaWxkQnlOYW1lIiwiYWN0aXZlIiwidXBkYXRlIiwiZHQiLCJ3eExvZ2luUmVzdWx0Y29kZSIsImRhdGEiLCJzZW5kUmVxdWVzdCIsInRoZW4iLCJyZXMiLCJ0b2tlbiIsImRvdCIsInJlZ2lzdGVyX3RpbWUiLCJEYXRlIiwiY2hhbm5lbCIsInNob3dVc2VyUHJvdG9jb2wiLCJoaWRlVXNlclByb3RvY29sIiwic2hvd1VzZXJQcml2YWN5IiwicHJpdmFjeSIsImhpZGVVc2VyUHJpdmFjeSIsInJlYWxOYW1lTGF5ZXIiLCJjbGlja1JlYWxMYXllciIsIl9yZWFsTmFtZSIsImdldENvbXBvbmVudCIsIkVkaXRCb3giLCJzdHJpbmciLCJfcmVhbE51bWJlciIsImxvZyIsInJlZ1lvdXJOYW1lIiwicmVnWW91ck51bWJlciIsIm5hbWUiLCJyZWdOYW1lIiwidGVzdCIsIm51bSIsInJlZ0lkTm8iXSwibWFwcGluZ3MiOiI7Ozs7Ozs7Ozs7Ozs7Ozs7O0FBQUFBLEVBQUUsQ0FBQ0MsS0FBSCxDQUFTO0FBQ0wsYUFBU0QsRUFBRSxDQUFDRSxTQURQO0FBR0xDLEVBQUFBLFVBQVUsRUFBRSxFQUhQO0FBT0w7QUFFQTtBQUVBQyxFQUFBQSxLQVhLLG1CQVdHO0FBQ0osU0FBS0MsUUFBTCxHQUFnQixLQUFoQjtBQUNBLFNBQUtDLFNB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QXhDO0FBQ0FYLE1BQUFBLEVBQUUsQ0FBQ2MsUUFBSCxDQUFZQyxTQUFaLENBQXNCLE9BQXRCO0FBQ0g7QUFDSixHQXhISTtBQXlITDtBQUNBc0MsRUFBQUEsV0ExSEssdUJBMEhPRSxJQTFIUCxFQTBIYTtBQUNkLFFBQUlDLE9BQU8sR0FBRyx3QkFBZDs7QUFDQSxRQUFJLENBQUNBLE9BQU8sQ0FBQ0MsSUFBUixDQUFhRixJQUFiLENBQUwsRUFBeUI7QUFDckJ2RCxNQUFBQSxFQUFFLENBQUNrQixLQUFILENBQVNFLFFBQVQsQ0FBa0IsS0FBS0MsSUFBdkIsRUFBNEIsVUFBNUI7QUFDQSxhQUFPLEtBQVA7QUFDSDs7QUFDRCxXQUFPLElBQVA7QUFDSCxHQWpJSTtBQWtJTDtBQUNBaUMsRUFBQUEsYUFuSUsseUJBbUlTSSxHQW5JVCxFQW1JYztBQUNmLFFBQUlDLE9BQU8sR0FBRywwQ0FBZDs7QUFDQSxRQUFJLENBQUNBLE9BQU8sQ0FBQ0YsSUFBUixDQUFhQyxHQUFiLENBQUwsRUFBd0I7QUFDcEIxRCxNQUFBQSxFQUFFLENBQUNrQixLQUFILENBQVNFLFFBQVQsQ0FBa0IsS0FBS0MsSUFBdkIsRUFBNEIsVUFBNUI7QUFDQSxhQUFPLEtBQVA7QUFDSDs7QUFDRCxXQUFPLElBQVA7QUFDSDtBQTFJSSxDQUFUIiwic291cmNlUm9vdCI6Ii8iLCJzb3VyY2VzQ29udGVudCI6WyJjYy5DbGFzcyh7XG4gICAgZXh0ZW5kczogY2MuQ29tcG9uZW50LFxuXG4gICAgcHJvcGVydGllczoge1xuXG4gICAgfSxcblxuICAgIC8vIExJRkUtQ1lDTEUgQ0FMTEJBQ0tTOlxuXG4gICAgLy8gb25Mb2FkICgpIHt9LFxuXG4gICAgc3RhcnQoKSB7XG4gICAgICAgIHRoaXMucHJvdG9jb2wgPSBmYWxzZTtcbiAgICAgICAgdGhpcy5uZWVkTG9naW4gPSB0cnVlO1xuICAgICAgICB0aGlzLnRpbWUgPSAwO1xuICAgICAgICBpZiAoIWNjLnN5cy5pc05hdGl2ZSkge1xuICAgICAgICAgICAgY2Muc3lzLmxvY2FsU3RvcmFnZS5zZXRJdGVtKFwidG9rZW5cIiwgXCJleUpoYkdjaU9pSklVekkxTmlJc0luUjVjQ0k2SWtwWFZDSjkuZXlKMWMyVnlYMmxrSWpveE1EQXhNVGN4TENKdmNHVnVYMmxrSWpvaWIxRlhORkkxT1ZWU1JsRjFZVE5TV2psdlgzbGZkR0o2VUVkTE5DSXNJbTVwWTJ0ZmJtRnRaU0k2SXVhMXQtZWJsLWlJdWVtVnZ6SXVNQ0lzSW1kbGJtUmxjaUk2TVN3aVlYWmhkR0Z5SWpvaWFIUjBjSE02THk5MGFHbHlaSGQ0TG5Gc2IyZHZMbU51TDIxdGIzQmxiaTkyYVY4ek1pOW1SMHhrUjFwbmVHNXdWbXRKUWxkamFXRXplV2xqYVdKNmFXSkZRMEowVnpGaFFraEViVWRoV21WNmNUQXljV2RRVVVOM1NUTjVPR2xqVkU1bldFdENjREJPY0V4Qk5VSkZkRFo2VUVkc1NHMVZUV1k1YkhkNFFrMW5MekV6TWlJc0ltTnlaV0YwWlY5MGFXMWxJam93TENKamFHRnVibVZzSWpvaU1TSXNJbVJwYzNScGJtTjBYMmxrSWpvaU1TSjkuSzVDOVhTa0VFakJCZlBGbjFtNUJvWEd1MTF1YlBjOWxTdkRSQUhrdl9WNFwiKVxuICAgICAgICB9XG4gICAgICAgIGlmIChjYy5zeXMubG9jYWxTdG9yYWdlLmdldEl0ZW0oXCJ0b2tlblwiKSkge1xuICAgICAgICAgICAgdGhpcy5uZWVkTG9naW4gPSBmYWxzZTtcbiAgICAgICAgICAgIHRoaXMucHJvdG9jb2wgPSB0cnVlO1xuICAgICAgICAgICAgY2Mud3hUb2tlbiA9IGNjLnN5cy5sb2NhbFN0b3JhZ2UuZ2V0SXRlbShcInRva2VuXCIpO1xuICAgICAgICAgICAgaWYoY2Muc3lzLmlzTmF0aXZlKXtcbiAgICAgICAgICAgICAgICBpZiAoY2Muc3lzLmxvY2FsU3RvcmFnZS5nZXRJdGVtKFwicmVhbE5hbWVcIikpIHtcbiAgICAgICAgICAgICAgICAgICAgY2MuZGlyZWN0b3IubG9hZFNjZW5lKCdJbmRleCcpO1xuICAgICAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMuc2hvd1JlYWxMYXllcigpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1lbHNle1xuICAgICAgICAgICAgICAgIGNjLmRpcmVjdG9yLmxvYWRTY2VuZSgnSW5kZXgnKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgIH0sXG4gICAgb25Mb2dpbldYKCkge1xuICAgICAgICBpZiAoY2Muc3lzLmlzTmF0aXZlKSB7XG4gICAgICAgICAgICBpZiAodGhpcy5wcm90b2NvbCkge1xuICAgICAgICAgICAgICAgIGNjLlRvb2xzLnd4TG9naW4oKTtcbiAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgY2MuVG9vbHMuc2hvd1RpcHModGhpcy5ub2RlLFwi6K+35YWI5ZCM5oSP55So5oi35Y2P6K6u5ZKM6ZqQ56eB5pS/562WXCIpXG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICB9LFxuICAgIC8vIOmAieaLqeeUqOaIt+WNj+iurlxuICAgIGNsaWNrUHJvdG9jb2woZSkge1xuICAgICAgICBsZXQgdGFyZ2V0ID0gZS50YXJnZXQ7XG4gICAgICAgIGxldCByaWdodCA9IHRhcmdldC5nZXRDaGlsZEJ5TmFtZShcInJpZ2h0XCIpO1xuICAgICAgICBpZiAodGhpcy5wcm90b2NvbCkge1xuICAgICAgICAgICAgcmlnaHQuYWN0aXZlID0gZmFsc2U7XG4gICAgICAgICAgICB0aGlzLnByb3RvY29sID0gZmFsc2U7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICByaWdodC5hY3RpdmUgPSB0cnVlO1xuICAgICAgICAgICAgdGhpcy5wcm90b2NvbCA9IHRydWU7XG4gICAgICAgIH1cbiAgICB9LFxuICAgIHVwZGF0ZShkdCkge1xuICAgICAgICB0aGlzLnRpbWUgKz0gZHQ7XG4gICAgICAgIGlmICghdGhpcy5uZWVkTG9naW4pIHtcbiAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgfVxuICAgICAgICBpZiAodGhpcy50aW1lID49IDEpIHtcbiAgICAgICAgICAgIHRoaXMudGltZSA9IDA7XG4gICAgICAgICAgICBpZiAoY2Mud3hMb2dpblJlc3VsdGNvZGUgJiYgdGhpcy5wcm90b2NvbCkge1xuICAgICAgICAgICAgICAgIHRoaXMucHJvdG9jb2wgPSBmYWxzZTtcbiAgICAgICAgICAgICAgICBsZXQgZGF0YSA9IHtcbiAgICAgICAgICAgICAgICAgICAgXCJjaGFubmVsXCI6IFwiMVwiLFxuICAgICAgICAgICAgICAgICAgICBcImltZWlcIjogXCIxXCIsXG4gICAgICAgICAgICAgICAgICAgIFwibWFjXCI6IFwiMVwiLFxuICAgICAgICAgICAgICAgICAgICBcImRpc3RpbmN0X2lkXCI6IFwiMVwiLFxuICAgICAgICAgICAgICAgICAgICBcIm9haWRcIjogXCIxXCIsXG4gICAgICAgICAgICAgICAgICAgIFwiYW5kcm9pZF9pZFwiOiBcIjFcIixcbiAgICAgICAgICAgICAgICAgICAgXCJjb2RlXCI6IGNjLnd4TG9naW5SZXN1bHRjb2RlXG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIGNjLlRvb2xzLnNlbmRSZXF1ZXN0KFwicGl0LnYxL3JlZ2lzdGVyXCIsIFwiUE9TVFwiLCBkYXRhKS50aGVuKChyZXMpID0+IHtcbiAgICAgICAgICAgICAgICAgICAgY2Mud3hUb2tlbiA9IHJlcy5kYXRhLnRva2VuO1xuICAgICAgICAgICAgICAgICAgICBjYy5zeXMubG9jYWxTdG9yYWdlLnNldEl0ZW0oXCJ0b2tlblwiLCByZXMuZGF0YS50b2tlbik7XG4gICAgICAgICAgICAgICAgICAgIGNjLlRvb2xzLmRvdChcInJlZ2lzdGVyXCIsIHsgcmVnaXN0ZXJfdGltZTogbmV3IERhdGUoKSwgY2hhbm5lbDogXCLlvq7kv6FcIiB9KVxuICAgICAgICAgICAgICAgICAgICBpZiAoY2Muc3lzLmxvY2FsU3RvcmFnZS5nZXRJdGVtKFwicmVhbE5hbWVcIikpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGNjLmRpcmVjdG9yLmxvYWRTY2VuZSgnSW5kZXgnKTtcbiAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuc2hvd1JlYWxMYXllcigpO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgfSlcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgIH0sXG4gICAgLy8g5pi+56S655So5oi35Y2P6K6uXG4gICAgc2hvd1VzZXJQcm90b2NvbCgpIHtcbiAgICAgICAgbGV0IHByb3RvY29sID0gdGhpcy5ub2RlLmdldENoaWxkQnlOYW1lKFwidXNlcl9wcm90b2NvbFwiKTtcbiAgICAgICAgcHJvdG9jb2wuYWN0aXZlID0gdHJ1ZTtcbiAgICB9LFxuICAgIGhpZGVVc2VyUHJvdG9jb2woKSB7XG4gICAgICAgIGxldCBwcm90b2NvbCA9IHRoaXMubm9kZS5nZXRDaGlsZEJ5TmFtZShcInVzZXJfcHJvdG9jb2xcIik7XG4gICAgICAgIHByb3RvY29sLmFjdGl2ZSA9IGZhbHNlO1xuICAgIH0sXG4gICAgLy8g5pi+56S66ZqQ56eB5pS/562WXG4gICAgc2hvd1VzZXJQcml2YWN5KCkge1xuICAgICAgICBsZXQgcHJpdmFjeSA9IHRoaXMubm9kZS5nZXRDaGlsZEJ5TmFtZShcInVzZXJfcHJpdmFjeVwiKTtcbiAgICAgICAgcHJpdmFjeS5hY3RpdmUgPSB0cnVlO1xuICAgIH0sXG4gICAgaGlkZVVzZXJQcml2YWN5KCkge1xuICAgICAgICBsZXQgcHJpdmFjeSA9IHRoaXMubm9kZS5nZXRDaGlsZEJ5TmFtZShcInVzZXJfcHJpdmFjeVwiKTtcbiAgICAgICAgcHJpdmFjeS5hY3RpdmUgPSBmYWxzZTtcbiAgICB9LFxuICAgIC8vIOWunuWQjeiupOivgVxuICAgIHNob3dSZWFsTGF5ZXIoKSB7XG4gICAgICAgIHRoaXMucmVhbE5hbWVMYXllciA9IHRoaXMubm9kZS5nZXRDaGlsZEJ5TmFtZShcIlJlYWxOYW1lXCIpO1xuICAgICAgICB0aGlzLnJlYWxOYW1lTGF5ZXIuYWN0aXZlID0gdHJ1ZTtcbiAgICB9LFxuICAgIC8vIOWunuWQjeiupOivgeeCueWHu1xuICAgIGNsaWNrUmVhbExheWVyKGUpIHtcbiAgICAgICAgbGV0IHRhcmdldCA9IGUudGFyZ2V0O1xuICAgICAgICBsZXQgX3JlYWxOYW1lID0gdGhpcy5yZWFsTmFtZUxheWVyLmdldENoaWxkQnlOYW1lKFwiZWRpdDFcIikuZ2V0Q29tcG9uZW50KGNjLkVkaXRCb3gpLnN0cmluZztcbiAgICAgICAgbGV0IF9yZWFsTnVtYmVyID0gdGhpcy5yZWFsTmFtZUxheWVyLmdldENoaWxkQnlOYW1lKFwiZWRpdDJcIikuZ2V0Q29tcG9uZW50KGNjLkVkaXRCb3gpLnN0cmluZztcbiAgICAgICAgY2MubG9nKGDnnJ/lrp7lp5PlkI0ke19yZWFsTmFtZX0tLS0tLS3ouqvku73or4Hlj7cke19yZWFsTnVtYmVyfWApO1xuICAgICAgICAvLyDnlKhsb2NhbOiusOW9lSDmmK/lkKblrp7lkI1cbiAgICAgICAgaWYodGhpcy5yZWdZb3VyTmFtZShfcmVhbE5hbWUpJiZ0aGlzLnJlZ1lvdXJOdW1iZXIoX3JlYWxOdW1iZXIpKXtcbiAgICAgICAgICAgIGNjLmxvZyhcIuiupOivgeaIkOWKn1wiKTtcbiAgICAgICAgICAgIGNjLnN5cy5sb2NhbFN0b3JhZ2Uuc2V0SXRlbShcInJlYWxOYW1lXCIsIHRydWUpXG4gICAgICAgICAgICBjYy5kaXJlY3Rvci5sb2FkU2NlbmUoJ0luZGV4Jyk7XG4gICAgICAgIH1cbiAgICB9LFxuICAgIC8vIOWIpOaWreecn+WunuWnk+WQjVxuICAgIHJlZ1lvdXJOYW1lKG5hbWUpIHtcbiAgICAgICAgdmFyIHJlZ05hbWUgPSAvXltcXHU0ZTAwLVxcdTlmYTVdezIsNH0kLztcbiAgICAgICAgaWYgKCFyZWdOYW1lLnRlc3QobmFtZSkpIHtcbiAgICAgICAgICAgIGNjLlRvb2xzLnNob3dUaXBzKHRoaXMubm9kZSxcIuecn+WunuWnk+WQjeWhq+WGmeacieivr1wiKVxuICAgICAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgICAgICB9XG4gICAgICAgIHJldHVybiB0cnVlXG4gICAgfSxcbiAgICAvLyDliKTmlq3ouqvku73or4Hlj7dcbiAgICByZWdZb3VyTnVtYmVyKG51bSkge1xuICAgICAgICB2YXIgcmVnSWRObyA9IC8oXlxcZHsxNX0kKXwoXlxcZHsxOH0kKXwoXlxcZHsxN30oXFxkfFh8eCkkKS87XG4gICAgICAgIGlmICghcmVnSWROby50ZXN0KG51bSkpIHtcbiAgICAgICAgICAgIGNjLlRvb2xzLnNob3dUaXBzKHRoaXMubm9kZSwn6Lqr5Lu96K+B5Y+35aGr5YaZ5pyJ6K+vJyk7XG4gICAgICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIHRydWVcbiAgICB9XG59KTtcblxuXG4iXX0=