
                (function() {
                    var nodeEnv = typeof require !== 'undefined' && typeof process !== 'undefined';
                    var __module = nodeEnv ? module : {exports:{}};
                    var __filename = 'preview-scripts/assets/Script/Tools.js';
                    var __require = nodeEnv ? function (request) {
                        return cc.require(request);
                    } : function (request) {
                        return __quick_compile_project__.require(request, __filename);
                    };
                    function __define (exports, require, module) {
                        if (!nodeEnv) {__quick_compile_project__.registerModule(__filename, module);}"use strict";
cc._RF.push(module, '5f815fcXZ9BIY+pPRsOeaGx', 'Tools');
// Script/Tools.js

"use strict";

cc.Tools = {
  /**
   * @param {*} event 数数打点的事件名称
   * @param {*} pro 数数打点的关联属性
  */
  dot: function dot(event, pro) {
    if (cc.sys.isNative) {
      cc.log("注册打点" + event);
      jsb.reflection.callStaticMethod("org/cocos2dx/javascript/AppActivity", "dot", "(Ljava/lang/String;)V", event, pro);
    }
  },

  /**
   * 看视频回调
   */
  adCallBack: function adCallBack(ecpm) {
    cc.log("观看视频回调"); // 获取广告ad之前先用epcr
    // 看视频得体力

    this.getUserEcpm(ecpm).then(function () {
      cc.log("获取ecpm之后才调用");

      if (cc.zm.userInfo.power <= 0) {
        var sendData = {
          ad: cc.zm.ad
        };
        cc.Tools.sendRequest("pit.v1.PitSvc/GrowPower", "POST", sendData).then(function (res) {
          cc.log("获取体力奖励");
          cc.zm.userInfo.power = res.data.value;

          if (cc.zm.videoAd.enterGame) {
            cc.director.loadScene('Game');
          }
        });
      } // 看视频得红包


      if (cc.zm.videoAd.redPack) {
        cc.Tools.sendRequest("pit.v1.PitSvc/PassAd", "POST", cc.zm.ad.redPack).then(function (res) {
          cc.log("获取红包奖励", res);
          var sendData = {};
          cc.Tools.sendRequest("pit.v1.PitSvc/UserInfo", "GET", sendData).then(function (res) {
            cc.zm.userInfo = res.data; // 如果体力大于0 进入下一关

            if (cc.zm.userInfo.power > 0) {
              cc.Tools.sendRequest("pit.v1.PitSvc/Stage", "GET", {}).then(function (res) {
                cc.zm.LevelInfo = res.data;
                cc.zm.videoAd.redPack = null; // console.log("关卡信息=", cc.zm.LevelInfo);

                if (cc.zm.LevelInfo.stage < 30) {
                  cc.director.loadScene('Game');
                } else {
                  // 直接返回主界面
                  cc.director.loadScene('Index');
                }
              });
            } else {
              // 小于0 弹出看视频获得体力的接口
              cc.director.loadScene('Index');
            }
          });
        });
      }

      if (cc.zm.videoAd.clickSign) {
        cc.zm.videoAd.clickSign = false;
      }

      if (cc.zm.videoAd.clickTable) {
        cc.zm.videoAd.clickTable = false;
      }
    });
  },
  // 显示激励视频
  showJiliAd: function showJiliAd() {
    cc.log("点击显示激励视频");

    if (cc.sys.isNative) {
      jsb.reflection.callStaticMethod("org/cocos2dx/javascript/AppActivity", "showAd", "()V");
    }
  },
  // 显示banner
  showBanner: function showBanner() {
    if (cc.sys.isNative) {
      jsb.reflection.callStaticMethod("org/cocos2dx/javascript/AppActivity", "showBanner", "()V");
    }
  },
  // 隐藏banner
  hideBanner: function hideBanner() {
    if (cc.sys.isNative) {
      jsb.reflection.callStaticMethod("org/cocos2dx/javascript/AppActivity", "hideBanner", "()V");
    }
  },
  // 显示插屏广告
  showTableScreen: function showTableScreen() {
    if (cc.sys.isNative) {
      jsb.reflection.callStaticMethod("org/cocos2dx/javascript/AppActivity", "showTableScreen", "()V");
    }
  },
  // 隐藏插屏广告
  hideTableScreen: function hideTableScreen() {
    if (cc.sys.isNative) {
      jsb.reflection.callStaticMethod("org/cocos2dx/javascript/AppActivity", "hideTableScreen", "()V");
    }
  },
  // 微信登陆
  wxLogin: function wxLogin() {
    cc.log("wxLogin");

    if (cc.sys.isNative) {
      jsb.reflection.callStaticMethod("org/cocos2dx/javascript/AppActivity", "weixin_login", "(Ljava/lang/String;)V", "weixin_login");
    }
  },

  /**
  * 接收native微信授权的code
  * @param errCode 
  */
  wxLoginResult: function wxLoginResult(errCode) {
    cc.log("wxLoginResultcode=" + errCode);
    cc.wxLoginResultcode = errCode;
  },

  /**
   * 看广告之后刷新一下ecpm
   */
  getUserEcpm: function getUserEcpm(ecpm) {
    if (!cc.zm) {
      return;
    }

    cc.log("调用ecpm=", ecpm);
    return new Promise(function (resolve, reject) {
      var sendData = {
        "ecpm": ecpm,
        "ts": new Date().getTime() //时间戳

      };
      var data = cc.Tools.createSignData(sendData);
      cc.Tools.sendRequest("pit.v1.PitSvc/Rc", "POST", data).then(function (res) {
        cc.log("Ecpm成功", res.data);
        cc.zm.ad = res.data.ad;
        resolve();
      })["catch"](function (res) {
        cc.log("Ecpm失败", res);
        reject(res);
      });
    });
  },

  /**
   * 
   * @param {*} data 需要签名数据
   * @returns 
   */
  createSignData: function createSignData(data) {
    var sortList = [];

    for (var key in data) {
      if (data.hasOwnProperty(key) && key != "sign") {
        var value = data[key];
        var item = {};
        item.key = key;
        item.value = value;
        sortList.push(key);
      }
    }

    sortList.sort();
    var strToJiaMi = "";
    sortList.forEach(function (key) {
      strToJiaMi += "&" + key + "=" + data[key];
    }, this);
    strToJiaMi = "token=" + cc.zm.userInfo.sc1 + strToJiaMi; // var noJiaMi = strToJiaMi;
    // console.log("未加密前=", strToJiaMi)

    var hex_md5 = require("MD5");

    strToJiaMi = hex_md5(strToJiaMi);
    data.sign = strToJiaMi; // console.log("加密后=", strToJiaMi)

    return data;
  },
  // 适配屏幕
  screenAdapter: function screenAdapter() {
    var canvas = cc.find("Canvas").getComponent(cc.Canvas);
    var winSize = cc.view.getVisibleSize();

    if (winSize.height / winSize.width <= 720 / 1280) {
      canvas.fitHeight = true;
      canvas.fitWidth = false;
    } else {
      canvas.fitHeight = false;
      canvas.fitWidth = true;
    }
  },

  /**
   * 
   * @param {*} n node节点
   * @param {*} str  显示的tips内容
   */
  showTips: function showTips(n, str) {
    var tips = n.getChildByName("Tips");
    tips.getComponent(cc.Label).string = str;
    tips.stopAllActions();
    tips.y = 145;
    cc.tween(tips).to(0.1, {
      opacity: 255
    }).to(1, {
      y: 300
    }).delay(0.5).to(0.1, {
      opacity: 0
    }).start();
  },

  /**
   * 
   * @param {*} url 请求接口的url----pit.v1.PitSvc/UserInfo
   * @param {*} type 请求接口的类型 只能是GET--POST
   * @param {*} data 请求接口所需要的数据
   * @returns 
   */
  sendRequest: function sendRequest(url, type, data) {
    return new Promise(function (resolve, reject) {
      var xhr = new XMLHttpRequest();
      var requestURL = "https://pit.api.jiankangzhuan.com/" + url;
      xhr.open(type, requestURL, true);

      if (cc.sys.isNative) {
        cc.log("isNative");
        xhr.setRequestHeader("Accept-Encodeing", "gzip,deflate");
      }

      if (cc.wxToken) {
        xhr.setRequestHeader("Authorization", cc.wxToken);
      }

      xhr.setRequestHeader("Content-Type", "application/json");
      cc.log("requestURL=", requestURL);
      cc.log("data=", JSON.stringify(data));

      xhr.onreadystatechange = function () {
        if (xhr.readyState === 4 && xhr.status == 200) {
          cc.log("http res:" + xhr.response); // 统一处理

          var _response = JSON.parse(xhr.response);

          if (_response.code === 0) {
            resolve(_response);
          } else {
            console.log(_response.message);
            reject(_response.message);
          }
        }
      };

      xhr.onerror = function () {
        reject(new Error(xhr.statusText));
      };

      xhr.send(JSON.stringify(data));
    });
  }
};

cc._RF.pop();
                    }
                    if (nodeEnv) {
                        __define(__module.exports, __require, __module);
                    }
                    else {
                        __quick_compile_project__.registerModuleFunc(__filename, function () {
                            __define(__module.exports, __require, __module);
                        });
                    }
                })();
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImFzc2V0cy9TY3JpcHQvVG9vbHMuanMiXSwibmFtZXMiOlsiY2MiLCJUb29scyIsImRvdCIsImV2ZW50IiwicHJvIiwic3lzIiwiaXNOYXRpdmUiLCJsb2ciLCJqc2IiLCJyZWZsZWN0aW9uIiwiY2FsbFN0YXRpY01ldGhvZCIsImFkQ2FsbEJhY2siLCJlY3BtIiwiZ2V0VXNlckVjcG0iLCJ0aGVuIiwiem0iLCJ1c2VySW5mbyIsInBvd2VyIiwic2VuZERhdGEiLCJhZCIsInNlbmRSZXF1ZXN0IiwicmVzIiwiZGF0YSIsInZhbHVlIiwidmlkZW9BZCIsImVudGVyR2FtZSIsImRpcmVjdG9yIiwibG9hZFNjZW5lIiwicmVkUGFjayIsIkxldmVsSW5mbyIsInN0YWdlIiwiY2xpY2tTaWduIiwiY2xpY2tUYWJsZSIsInNob3dKaWxpQWQiLCJzaG93QmFubmVyIiwiaGlkZUJhbm5lciIsInNob3dUYWJsZVNjcmVlbiIsImhpZGVUYWJsZVNjcmVlbiIsInd4TG9naW4iLCJ3eExvZ2luUmVzdWx0IiwiZXJyQ29kZSIsInd4TG9naW5SZXN1bHRjb2RlIiwiUHJvbWlzZSIsInJlc29sdmUiLCJyZWplY3QiLCJEYXRlIiwiZ2V0VGltZSIsImNyZWF0ZVNpZ25EYXRhIiwic29ydExpc3QiLCJrZXkiLCJoYXNPd25Qcm9wZXJ0eSIsIml0ZW0iLCJwdXNoIiwic29ydCIsInN0clRvSmlhTWkiLCJmb3JFYWNoIiwic2MxIiwiaGV4X21kNSIsInJlcXVpcmUiLCJzaWduIiwic2NyZWVuQWRhcHRlciIsImNhbnZhcyIsImZpbmQiLCJnZXRDb21wb25lbnQiLCJDYW52YXMiLCJ3aW5TaXplIiwidmlldyIsImdldFZpc2libGVTaXplIiwiaGVpZ2h0Iiwid2lkdGgiLCJmaXRIZWlnaHQiLCJmaXRXaWR0aCIsInNob3dUaXBzIiwibiIsInN0ciIsInRpcHMiLCJnZXRDaGlsZEJ5TmFtZSIsIkxhYmVsIiwic3RyaW5nIiwic3RvcEFsbEFjdGlvbnMiLCJ5IiwidHdlZW4iLCJ0byIsIm9wYWNpdHkiLCJkZWxheSIsInN0YXJ0IiwidXJsIiwidHlwZSIsInhociIsIlhNTEh0dHBSZXF1ZXN0IiwicmVxdWVzdFVSTCIsIm9wZW4iLCJzZXRSZXF1ZXN0SGVhZGVyIiwid3hUb2tlbiIsIkpTT04iLCJzdHJpbmdpZnkiLCJvbnJlYWR5c3RhdGVjaGFuZ2UiLCJyZWFkeVN0YXRlIiwic3RhdHVzIiwicmVzcG9uc2UiLCJfcmVzcG9uc2UiLCJwYXJzZSIsImNvZGUiLCJjb25zb2xlIiwibWVzc2FnZSIsIm9uZXJyb3IiLCJFcnJvciIsInN0YXR1c1RleHQiLCJzZW5kIl0sIm1hcHBpbmdzIjoiOzs7Ozs7Ozs7Ozs7Ozs7OztBQUFBQSxFQUFFLENBQUNDLEtBQUgsR0FBVztBQUNQO0FBQ0o7QUFDQTtBQUNBO0FBQ0lDLEVBQUFBLEdBTE8sZUFLSEMsS0FMRyxFQUtJQyxHQUxKLEVBS1M7QUFDWixRQUFJSixFQUFFLENBQUNLLEdBQUgsQ0FBT0MsUUFBWCxFQUFxQjtBQUNqQk4sTUFBQUEsRUFBRSxDQUFDTyxHQUFILENBQU8sU0FBU0osS0FBaEI7QUFDQUssTUFBQUEsR0FBRyxDQUFDQyxVQUFKLENBQWVDLGdCQUFmLENBQWdDLHFDQUFoQyxFQUF1RSxLQUF2RSxFQUE4RSx1QkFBOUUsRUFBdUdQLEtBQXZHLEVBQThHQyxHQUE5RztBQUNIO0FBQ0osR0FWTTs7QUFZUDtBQUNKO0FBQ0E7QUFDSU8sRUFBQUEsVUFmTyxzQkFlSUMsSUFmSixFQWVVO0FBQ2JaLElBQUFBLEVBQUUsQ0FBQ08sR0FBSCxDQUFPLFFBQVAsRUFEYSxDQUViO0FBQ0E7O0FBQ0EsU0FBS00sV0FBTCxDQUFpQkQsSUFBakIsRUFBdUJFLElBQXZCLENBQTRCLFlBQUk7QUFDNUJkLE1BQUFBLEVBQUUsQ0FBQ08sR0FBSCxDQUFPLGFBQVA7O0FBQ0EsVUFBSVAsRUFBRSxDQUFDZSxFQUFILENBQU1DLFFBQU4sQ0FBZUMsS0FBZixJQUFzQixDQUExQixFQUE2QjtBQUN6QixZQUFJQyxRQUFRLEdBQUc7QUFDWEMsVUFBQUEsRUFB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LENBQWV6RSxJQUFmLENBQVQ7QUFDSCxLQS9CTSxDQUFQO0FBZ0NIO0FBM09NLENBQVgiLCJzb3VyY2VSb290IjoiLyIsInNvdXJjZXNDb250ZW50IjpbImNjLlRvb2xzID0ge1xuICAgIC8qKlxuICAgICAqIEBwYXJhbSB7Kn0gZXZlbnQg5pWw5pWw5omT54K555qE5LqL5Lu25ZCN56ewXG4gICAgICogQHBhcmFtIHsqfSBwcm8g5pWw5pWw5omT54K555qE5YWz6IGU5bGe5oCnXG4gICAgKi9cbiAgICBkb3QoZXZlbnQsIHBybykge1xuICAgICAgICBpZiAoY2Muc3lzLmlzTmF0aXZlKSB7XG4gICAgICAgICAgICBjYy5sb2coXCLms6jlhozmiZPngrlcIiArIGV2ZW50KTtcbiAgICAgICAgICAgIGpzYi5yZWZsZWN0aW9uLmNhbGxTdGF0aWNNZXRob2QoXCJvcmcvY29jb3MyZHgvamF2YXNjcmlwdC9BcHBBY3Rpdml0eVwiLCBcImRvdFwiLCBcIihMamF2YS9sYW5nL1N0cmluZzspVlwiLCBldmVudCwgcHJvKTtcbiAgICAgICAgfVxuICAgIH0sXG5cbiAgICAvKipcbiAgICAgKiDnnIvop4bpopHlm57osINcbiAgICAgKi9cbiAgICBhZENhbGxCYWNrKGVjcG0pIHtcbiAgICAgICAgY2MubG9nKFwi6KeC55yL6KeG6aKR5Zue6LCDXCIpO1xuICAgICAgICAvLyDojrflj5blub/lkYphZOS5i+WJjeWFiOeUqGVwY3JcbiAgICAgICAgLy8g55yL6KeG6aKR5b6X5L2T5YqbXG4gICAgICAgIHRoaXMuZ2V0VXNlckVjcG0oZWNwbSkudGhlbigoKT0+e1xuICAgICAgICAgICAgY2MubG9nKFwi6I635Y+WZWNwbeS5i+WQjuaJjeiwg+eUqFwiKTtcbiAgICAgICAgICAgIGlmIChjYy56bS51c2VySW5mby5wb3dlcjw9MCkge1xuICAgICAgICAgICAgICAgIGxldCBzZW5kRGF0YSA9IHtcbiAgICAgICAgICAgICAgICAgICAgYWQ6IGNjLnptLmFkXG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIGNjLlRvb2xzLnNlbmRSZXF1ZXN0KFwicGl0LnYxLlBpdFN2Yy9Hcm93UG93ZXJcIiwgXCJQT1NUXCIsIHNlbmREYXRhKS50aGVuKChyZXMpID0+IHtcbiAgICAgICAgICAgICAgICAgICAgY2MubG9nKFwi6I635Y+W5L2T5Yqb5aWW5YqxXCIpXG4gICAgICAgICAgICAgICAgICAgIGNjLnptLnVzZXJJbmZvLnBvd2VyID0gcmVzLmRhdGEudmFsdWU7XG4gICAgICAgICAgICAgICAgICAgIGlmKGNjLnptLnZpZGVvQWQuZW50ZXJHYW1lKXtcbiAgICAgICAgICAgICAgICAgICAgICAgIGNjLmRpcmVjdG9yLmxvYWRTY2VuZSgnR2FtZScpO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICAvLyDnnIvop4bpopHlvpfnuqLljIVcbiAgICAgICAgICAgIGlmIChjYy56bS52aWRlb0FkLnJlZFBhY2spIHtcbiAgICAgICAgICAgICAgICBjYy5Ub29scy5zZW5kUmVxdWVzdChcInBpdC52MS5QaXRTdmMvUGFzc0FkXCIsIFwiUE9TVFwiLCBjYy56bS5hZC5yZWRQYWNrKS50aGVuKChyZXMpID0+IHtcbiAgICAgICAgICAgICAgICAgICAgY2MubG9nKFwi6I635Y+W57qi5YyF5aWW5YqxXCIsIHJlcyk7XG4gICAgICAgICAgICAgICAgICAgIGxldCBzZW5kRGF0YSA9IHt9O1xuICAgICAgICAgICAgICAgICAgICBjYy5Ub29scy5zZW5kUmVxdWVzdChcInBpdC52MS5QaXRTdmMvVXNlckluZm9cIiwgXCJHRVRcIiwgc2VuZERhdGEpLnRoZW4oKHJlcykgPT4ge1xuICAgICAgICAgICAgICAgICAgICAgICAgY2Muem0udXNlckluZm8gPSByZXMuZGF0YTtcbiAgICAgICAgICAgICAgICAgICAgICAgIC8vIOWmguaenOS9k+WKm+Wkp+S6jjAg6L+b5YWl5LiL5LiA5YWzXG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAoY2Muem0udXNlckluZm8ucG93ZXIgPiAwKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgY2MuVG9vbHMuc2VuZFJlcXVlc3QoXCJwaXQudjEuUGl0U3ZjL1N0YWdlXCIsIFwiR0VUXCIsIHt9KS50aGVuKChyZXMpID0+IHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY2Muem0uTGV2ZWxJbmZvID0gcmVzLmRhdGE7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNjLnptLnZpZGVvQWQucmVkUGFjayA9IG51bGw7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vIGNvbnNvbGUubG9nKFwi5YWz5Y2h5L+h5oGvPVwiLCBjYy56bS5MZXZlbEluZm8pO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoY2Muem0uTGV2ZWxJbmZvLnN0YWdlIDwgMzApIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNjLmRpcmVjdG9yLmxvYWRTY2VuZSgnR2FtZScpO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgLy8g55u05o6l6L+U5Zue5Li755WM6Z2iXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjYy5kaXJlY3Rvci5sb2FkU2NlbmUoJ0luZGV4Jyk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgLy8g5bCP5LqOMCDlvLnlh7rnnIvop4bpopHojrflvpfkvZPlipvnmoTmjqXlj6NcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjYy5kaXJlY3Rvci5sb2FkU2NlbmUoJ0luZGV4Jyk7XG4gICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIH0pXG4gICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBpZihjYy56bS52aWRlb0FkLmNsaWNrU2lnbil7XG4gICAgICAgICAgICAgICAgY2Muem0udmlkZW9BZC5jbGlja1NpZ24gPSBmYWxzZTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGlmKGNjLnptLnZpZGVvQWQuY2xpY2tUYWJsZSl7XG4gICAgICAgICAgICAgICAgY2Muem0udmlkZW9BZC5jbGlja1RhYmxlID0gZmFsc2U7XG4gICAgICAgICAgICB9XG4gICAgICAgIH0pXG4gICAgfSxcbiAgICAvLyDmmL7npLrmv4DlirHop4bpopFcbiAgICBzaG93SmlsaUFkKCkge1xuICAgICAgICBjYy5sb2coXCLngrnlh7vmmL7npLrmv4DlirHop4bpopFcIilcbiAgICAgICAgaWYgKGNjLnN5cy5pc05hdGl2ZSkge1xuICAgICAgICAgICAganNiLnJlZmxlY3Rpb24uY2FsbFN0YXRpY01ldGhvZChcIm9yZy9jb2NvczJkeC9qYXZhc2NyaXB0L0FwcEFjdGl2aXR5XCIsIFwic2hvd0FkXCIsIFwiKClWXCIpO1xuICAgICAgICB9XG4gICAgfSxcbiAgICAvLyDmmL7npLpiYW5uZXJcbiAgICBzaG93QmFubmVyKCkge1xuICAgICAgICBpZiAoY2Muc3lzLmlzTmF0aXZlKSB7XG4gICAgICAgICAgICBqc2IucmVmbGVjdGlvbi5jYWxsU3RhdGljTWV0aG9kKFwib3JnL2NvY29zMmR4L2phdmFzY3JpcHQvQXBwQWN0aXZpdHlcIiwgXCJzaG93QmFubmVyXCIsIFwiKClWXCIpO1xuICAgICAgICB9XG4gICAgfSxcbiAgICAvLyDpmpDol49iYW5uZXJcbiAgICBoaWRlQmFubmVyKCkge1xuICAgICAgICBpZiAoY2Muc3lzLmlzTmF0aXZlKSB7XG4gICAgICAgICAgICBqc2IucmVmbGVjdGlvbi5jYWxsU3RhdGljTWV0aG9kKFwib3JnL2NvY29zMmR4L2phdmFzY3JpcHQvQXBwQWN0aXZpdHlcIiwgXCJoaWRlQmFubmVyXCIsIFwiKClWXCIpO1xuICAgICAgICB9XG4gICAgfSxcbiAgICAvLyDmmL7npLrmj5LlsY/lub/lkYpcbiAgICBzaG93VGFibGVTY3JlZW4oKSB7XG4gICAgICAgIGlmIChjYy5zeXMuaXNOYXRpdmUpIHtcbiAgICAgICAgICAgIGpzYi5yZWZsZWN0aW9uLmNhbGxTdGF0aWNNZXRob2QoXCJvcmcvY29jb3MyZHgvamF2YXNjcmlwdC9BcHBBY3Rpdml0eVwiLCBcInNob3dUYWJsZVNjcmVlblwiLCBcIigpVlwiKTtcbiAgICAgICAgfVxuICAgIH0sXG4gICAgLy8g6ZqQ6JeP5o+S5bGP5bm/5ZGKXG4gICAgaGlkZVRhYmxlU2NyZWVuKCkge1xuICAgICAgICBpZiAoY2Muc3lzLmlzTmF0aXZlKSB7XG4gICAgICAgICAgICBqc2IucmVmbGVjdGlvbi5jYWxsU3RhdGljTWV0aG9kKFwib3JnL2NvY29zMmR4L2phdmFzY3JpcHQvQXBwQWN0aXZpdHlcIiwgXCJoaWRlVGFibGVTY3JlZW5cIiwgXCIoKVZcIik7XG4gICAgICAgIH1cbiAgICB9LFxuICAgIC8vIOW+ruS/oeeZu+mZhlxuICAgIHd4TG9naW4oKSB7XG4gICAgICAgIGNjLmxvZyhcInd4TG9naW5cIik7XG4gICAgICAgIGlmIChjYy5zeXMuaXNOYXRpdmUpIHtcbiAgICAgICAgICAgIGpzYi5yZWZsZWN0aW9uLmNhbGxTdGF0aWNNZXRob2QoXCJvcmcvY29jb3MyZHgvamF2YXNjcmlwdC9BcHBBY3Rpdml0eVwiLCBcIndlaXhpbl9sb2dpblwiLCBcIihMamF2YS9sYW5nL1N0cmluZzspVlwiLCBcIndlaXhpbl9sb2dpblwiKTtcbiAgICAgICAgfVxuICAgIH0sXG4gICAgLyoqXG4gICAgKiDmjqXmlLZuYXRpdmXlvq7kv6HmjojmnYPnmoRjb2RlXG4gICAgKiBAcGFyYW0gZXJyQ29kZSBcbiAgICAqL1xuICAgIHd4TG9naW5SZXN1bHQoZXJyQ29kZSkge1xuICAgICAgICBjYy5sb2coXCJ3eExvZ2luUmVzdWx0Y29kZT1cIiArIGVyckNvZGUpXG4gICAgICAgIGNjLnd4TG9naW5SZXN1bHRjb2RlID0gZXJyQ29kZTtcbiAgICB9LFxuICAgIC8qKlxuICAgICAqIOeci+W5v+WRiuS5i+WQjuWIt+aWsOS4gOS4i2VjcG1cbiAgICAgKi9cbiAgICAgZ2V0VXNlckVjcG0oZWNwbSkge1xuICAgICAgICAgaWYoIWNjLnptKXtcbiAgICAgICAgICAgICByZXR1cm47XG4gICAgICAgICB9XG4gICAgICAgICBjYy5sb2coXCLosIPnlKhlY3BtPVwiLGVjcG0pO1xuICAgICAgICAgcmV0dXJuIG5ldyBQcm9taXNlKGZ1bmN0aW9uIChyZXNvbHZlLCByZWplY3Qpe1xuICAgICAgICAgICAgbGV0IHNlbmREYXRhID0ge1xuICAgICAgICAgICAgICAgIFwiZWNwbVwiOiBlY3BtLFxuICAgICAgICAgICAgICAgIFwidHNcIjogbmV3IERhdGUoKS5nZXRUaW1lKCkvL+aXtumXtOaIs1xuICAgICAgICAgICAgfTtcbiAgICAgICAgICAgIGxldCBkYXRhID0gY2MuVG9vbHMuY3JlYXRlU2lnbkRhdGEoc2VuZERhdGEpO1xuICAgICAgICAgICAgY2MuVG9vbHMuc2VuZFJlcXVlc3QoXCJwaXQudjEuUGl0U3ZjL1JjXCIsIFwiUE9TVFwiLCBkYXRhKS50aGVuKChyZXMpID0+IHtcbiAgICAgICAgICAgICAgICBjYy5sb2coXCJFY3Bt5oiQ5YqfXCIsIHJlcy5kYXRhKTtcbiAgICAgICAgICAgICAgICBjYy56bS5hZCA9IHJlcy5kYXRhLmFkO1xuICAgICAgICAgICAgICAgIHJlc29sdmUoKTtcbiAgICAgICAgICAgIH0pLmNhdGNoKChyZXMpPT57XG4gICAgICAgICAgICAgICAgY2MubG9nKFwiRWNwbeWksei0pVwiLCByZXMpO1xuICAgICAgICAgICAgICAgIHJlamVjdChyZXMpO1xuICAgICAgICAgICAgfSlcbiAgICAgICAgIH0pXG4gICAgfSxcbiAgICAvKipcbiAgICAgKiBcbiAgICAgKiBAcGFyYW0geyp9IGRhdGEg6ZyA6KaB562+5ZCN5pWw5o2uXG4gICAgICogQHJldHVybnMgXG4gICAgICovXG4gICAgY3JlYXRlU2lnbkRhdGE6IGZ1bmN0aW9uIChkYXRhKSB7XG4gICAgICAgIHZhciBzb3J0TGlzdCA9IFtdO1xuICAgICAgICBmb3IgKHZhciBrZXkgaW4gZGF0YSkge1xuICAgICAgICAgICAgaWYgKGRhdGEuaGFzT3duUHJvcGVydHkoa2V5KSAmJiBrZXkgIT0gXCJzaWduXCIpIHtcbiAgICAgICAgICAgICAgICB2YXIgdmFsdWUgPSBkYXRhW2tleV07XG4gICAgICAgICAgICAgICAgdmFyIGl0ZW0gPSB7fTtcbiAgICAgICAgICAgICAgICBpdGVtLmtleSA9IGtleTtcbiAgICAgICAgICAgICAgICBpdGVtLnZhbHVlID0gdmFsdWU7XG4gICAgICAgICAgICAgICAgc29ydExpc3QucHVzaChrZXkpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICAgIHNvcnRMaXN0LnNvcnQoKTtcbiAgICAgICAgdmFyIHN0clRvSmlhTWkgPSBcIlwiO1xuICAgICAgICBzb3J0TGlzdC5mb3JFYWNoKGZ1bmN0aW9uIChrZXkpIHtcbiAgICAgICAgICAgIHN0clRvSmlhTWkgKz0gXCImXCIgKyBrZXkgKyBcIj1cIiArIGRhdGFba2V5XTtcbiAgICAgICAgfSwgdGhpcyk7XG4gICAgICAgIHN0clRvSmlhTWkgPSBcInRva2VuPVwiICsgY2Muem0udXNlckluZm8uc2MxICsgc3RyVG9KaWFNaTtcbiAgICAgICAgLy8gdmFyIG5vSmlhTWkgPSBzdHJUb0ppYU1pO1xuICAgICAgICAvLyBjb25zb2xlLmxvZyhcIuacquWKoOWvhuWJjT1cIiwgc3RyVG9KaWFNaSlcbiAgICAgICAgdmFyIGhleF9tZDUgPSByZXF1aXJlKFwiTUQ1XCIpXG4gICAgICAgIHN0clRvSmlhTWkgPSBoZXhfbWQ1KHN0clRvSmlhTWkpO1xuICAgICAgICBkYXRhLnNpZ24gPSBzdHJUb0ppYU1pO1xuICAgICAgICAvLyBjb25zb2xlLmxvZyhcIuWKoOWvhuWQjj1cIiwgc3RyVG9KaWFNaSlcbiAgICAgICAgcmV0dXJuIGRhdGE7XG5cbiAgICB9LFxuICAgIC8vIOmAgumFjeWxj+W5lVxuICAgIHNjcmVlbkFkYXB0ZXIoKSB7XG4gICAgICAgIGxldCBjYW52YXMgPSBjYy5maW5kKFwiQ2FudmFzXCIpLmdldENvbXBvbmVudChjYy5DYW52YXMpO1xuICAgICAgICBsZXQgd2luU2l6ZSA9IGNjLnZpZXcuZ2V0VmlzaWJsZVNpemUoKTtcblxuICAgICAgICBpZiAod2luU2l6ZS5oZWlnaHQgLyB3aW5TaXplLndpZHRoIDw9IDcyMCAvIDEyODApIHtcbiAgICAgICAgICAgIGNhbnZhcy5maXRIZWlnaHQgPSB0cnVlO1xuICAgICAgICAgICAgY2FudmFzLmZpdFdpZHRoID0gZmFsc2U7XG4gICAgICAgIH1cbiAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICBjYW52YXMuZml0SGVpZ2h0ID0gZmFsc2U7XG4gICAgICAgICAgICBjYW52YXMuZml0V2lkdGggPSB0cnVlO1xuICAgICAgICB9XG4gICAgfSxcbiAgICAvKipcbiAgICAgKiBcbiAgICAgKiBAcGFyYW0geyp9IG4gbm9kZeiKgueCuVxuICAgICAqIEBwYXJhbSB7Kn0gc3RyICDmmL7npLrnmoR0aXBz5YaF5a65XG4gICAgICovXG4gICAgc2hvd1RpcHMobixzdHIpIHtcbiAgICAgICAgbGV0IHRpcHMgPSBuLmdldENoaWxkQnlOYW1lKFwiVGlwc1wiKTtcbiAgICAgICAgdGlwcy5nZXRDb21wb25lbnQoY2MuTGFiZWwpLnN0cmluZyA9c3RyO1xuICAgICAgICB0aXBzLnN0b3BBbGxBY3Rpb25zKCk7XG4gICAgICAgIHRpcHMueSA9IDE0NTtcbiAgICAgICAgY2MudHdlZW4odGlwcykudG8oMC4xLCB7IG9wYWNpdHk6IDI1NSB9KS50bygxLCB7IHk6IDMwMCB9KS5kZWxheSgwLjUpLnRvKDAuMSwgeyBvcGFjaXR5OiAwIH0pLnN0YXJ0KClcbiAgICB9LFxuICAgIC8qKlxuICAgICAqIFxuICAgICAqIEBwYXJhbSB7Kn0gdXJsIOivt+axguaOpeWPo+eahHVybC0tLS1waXQudjEuUGl0U3ZjL1VzZXJJbmZvXG4gICAgICogQHBhcmFtIHsqfSB0eXBlIOivt+axguaOpeWPo+eahOexu+WeiyDlj6rog73mmK9HRVQtLVBPU1RcbiAgICAgKiBAcGFyYW0geyp9IGRhdGEg6K+35rGC5o6l5Y+j5omA6ZyA6KaB55qE5pWw5o2uXG4gICAgICogQHJldHVybnMgXG4gICAgICovXG4gICAgc2VuZFJlcXVlc3Q6IGZ1bmN0aW9uICh1cmwsIHR5cGUsZGF0YSkge1xuICAgICAgICByZXR1cm4gbmV3IFByb21pc2UoZnVuY3Rpb24gKHJlc29sdmUsIHJlamVjdCkge1xuICAgICAgICAgICAgbGV0IHhociA9IG5ldyBYTUxIdHRwUmVxdWVzdCgpO1xuICAgICAgICAgICAgbGV0IHJlcXVlc3RVUkwgPSBcImh0dHBzOi8vcGl0LmFwaS5qaWFua2FuZ3podWFuLmNvbS9cIiArIHVybDtcbiAgICAgICAgICAgIHhoci5vcGVuKHR5cGUsIHJlcXVlc3RVUkwsIHRydWUpO1xuICAgICAgICAgICAgaWYgKGNjLnN5cy5pc05hdGl2ZSkge1xuICAgICAgICAgICAgICAgIGNjLmxvZyhcImlzTmF0aXZlXCIpO1xuICAgICAgICAgICAgICAgIHhoci5zZXRSZXF1ZXN0SGVhZGVyKFwiQWNjZXB0LUVuY29kZWluZ1wiLCBcImd6aXAsZGVmbGF0ZVwiKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGlmKGNjLnd4VG9rZW4pe1xuICAgICAgICAgICAgICAgIHhoci5zZXRSZXF1ZXN0SGVhZGVyKFwiQXV0aG9yaXphdGlvblwiLCBjYy53eFRva2VuKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIHhoci5zZXRSZXF1ZXN0SGVhZGVyKFwiQ29udGVudC1UeXBlXCIsIFwiYXBwbGljYXRpb24vanNvblwiKTtcbiAgICAgICAgICAgIGNjLmxvZyhcInJlcXVlc3RVUkw9XCIsIHJlcXVlc3RVUkwpO1xuICAgICAgICAgICAgY2MubG9nKFwiZGF0YT1cIiwgSlNPTi5zdHJpbmdpZnkoZGF0YSkpO1xuICAgICAgICAgICAgeGhyLm9ucmVhZHlzdGF0ZWNoYW5nZSA9IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgICAgICBpZiAoeGhyLnJlYWR5U3RhdGUgPT09IDQgJiYgeGhyLnN0YXR1cyA9PSAyMDApIHtcbiAgICAgICAgICAgICAgICAgICAgY2MubG9nKFwiaHR0cCByZXM6XCIgKyB4aHIucmVzcG9uc2UpO1xuICAgICAgICAgICAgICAgICAgICAvLyDnu5/kuIDlpITnkIZcbiAgICAgICAgICAgICAgICAgICAgbGV0IF9yZXNwb25zZSA9IEpTT04ucGFyc2UoeGhyLnJlc3BvbnNlKTtcbiAgICAgICAgICAgICAgICAgICAgaWYoX3Jlc3BvbnNlLmNvZGU9PT0wKXtcbiAgICAgICAgICAgICAgICAgICAgICAgIHJlc29sdmUoX3Jlc3BvbnNlKVxuICAgICAgICAgICAgICAgICAgICB9ZWxzZXtcbiAgICAgICAgICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKF9yZXNwb25zZS5tZXNzYWdlKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIHJlamVjdChfcmVzcG9uc2UubWVzc2FnZSk7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICB4aHIub25lcnJvciA9IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgICAgICByZWplY3QobmV3IEVycm9yKHhoci5zdGF0dXNUZXh0KSlcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIHhoci5zZW5kKEpTT04uc3RyaW5naWZ5KGRhdGEpKTtcbiAgICAgICAgfSlcbiAgICB9XG59Il19