{"version":3,"sources":["assets/Script/Http.js"],"names":["cc","Class","Component","properties","statics","base_url","sendRequest","url","type","data","Promise","resolve","reject","xhr","XMLHttpRequest","requestURL","open","sys","isNative","log","setRequestHeader","wxToken","onreadystatechange","readyState","status","response","_response","JSON","parse","code","console","message","onerror","Error","statusText","send","stringify","onLoad"],"mappings":";;;;;;AAAAA,EAAE,CAACC,KAAH,CAAS;AACL,aAASD,EAAE,CAACE,SADP;AAGLC,EAAAA,UAAU,EAAE,EAHP;AAOLC,EAAAA,OAAO,EAAE;AACLC,IAAAA,QAAQ,EAAE,oCADL;AAC0C;AAC/C;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACAC,IAAAA,WAAW,EAAE,qBAAUC,GAAV,EAAeC,IAAf,EAAoBC,IAApB,EAA0B;AACnC,aAAO,IAAIC,OAAJ,CAAY,UAAUC,OAAV,EAAmBC,MAAnB,EAA2B;AAC1C,YAAIC,GAAG,GAAG,IAAIC,cAAJ,EAAV;AACA,YAAIC,UAAU,GAAG,uCAAuCR,GAAxD,CAF0C,CAG1C;;AACAM,QAAAA,GAAG,CAACG,IAAJ,CAASR,IAAT,EAAeO,UAAf,EAA2B,IAA3B;;AACA,YAAIf,EAAE,CAACiB,GAAH,CAAOC,QAAX,EAAqB;AACjBlB,UAAAA,EAAE,CAACmB,GAAH,CAAO,UAAP;AACAN,UAAAA,GAAG,CAACO,gBAAJ,CAAqB,kBAArB,EAAyC,cAAzC;AACH;;AACD,YAAGpB,EAAE,CAACqB,OAAN,EAAc;AACVR,UAAAA,GAAG,CAACO,gBAAJ,CAAqB,eAArB,EAAsCpB,EAAE,CAACqB,OAAzC;AACH;;AACDR,QAAAA,GAAG,CAACO,gBAAJ,CAAqB,cAArB,EAAqC,kBAArC;AACApB,QAAAA,EAAE,CAACmB,GAAH,CAAO,aAAP,EAAsBJ,UAAtB;AACAf,QAAAA,EAAE,CAACmB,GAAH,CAAO,OAAP,EAAgBV,IAAhB;;AACAI,QAAAA,GAAG,CAACS,kBAAJ,GAAyB,YAAY;AACjC;AACA,cAAIT,GAAG,CAACU,UAAJ,KAAmB,CAAnB,IAAwBV,GAAG,CAACW,MAAJ,IAAc,GAA1C,EAA+C;AAC3CxB,YAAAA,EAAE,CAACmB,GAAH,CAAO,cAAcN,GAAG,CAACY,QAAzB,EAD2C,CAE3C;;AACA,gBAAIC,SAAS,GAAGC,IAAI,CAACC,KAAL,CAAWf,GAAG,CAACY,QAAf,CAAhB;;AACA,gBAAGC,SAAS,CAACG,IAAV,KAAiB,CAApB,EAAsB;AAClBlB,cAAAA,OAAO,CAACe,SAAD,CAAP;AACH,aAFD,MAEK;AACDI,cAAAA,OAAO,CAACX,GAAR,CAAYO,SAAS,CAACK,OAAtB;AACAnB,cAAAA,MAAM,CAACc,SAAS,CAACK,OAAX,CAAN;AACH;AACJ;AACJ,SAbD;;AAcAlB,QAAAA,GAAG,CAACmB,OAAJ,GAAc,YAAY;AACtBpB,UAAAA,MAAM,CAAC,IAAIqB,KAAJ,CAAUpB,GAAG,CAACqB,UAAd,CAAD,CAAN;AACH,SAFD,CA7B0C,CAgC1C;AACA;;;AACArB,QAAAA,GAAG,CAACsB,IAAJ,CAASR,IAAI,CAACS,SAAL,CAAe3B,IAAf,CAAT;AACH,OAnCM,CAAP;AAoCH;AAnEI,GAPJ;AA6EL;AACA4B,EAAAA,MAAM,EAAE,kBAAY,CAEnB;AAhFI,CAAT","sourceRoot":"/","sourcesContent":["cc.Class({\n    extends: cc.Component,\n\n    properties: {\n\n    },\n\n    statics: {\n        base_url: \"https://pit.api.jiankangzhuan.com/\",//测试服\n        // sendRequest: function (url, data, success, fail) {\n        //     var xhr = new XMLHttpRequest();\n        //     xhr.timeout = 2000;\n        //     var requestURL = this.base_url + url;\n        //     xhr.open(data.type, requestURL, true);\n        //     // xhr.responseType = \"arraybuffer\" \n        //     if(cc.sys.isNative){\n        //         cc.log(\"isNative\");\n        //         xhr.setRequestHeader(\"Accept-Encodeing\",\"gzip,deflate\");\n        //     }\n        //     if(url===\"pit.v1.PitSvc/UserInfo\"){\n        //         // 如果当前是获取用户信息 测试用的token\n        //         let token = \"eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJ1c2VyX2lkIjoxMDAxMDcwLCJvcGVuX2lkIjoiIiwibmlja19uYW1lIjoi6K6_5a6iOTUyNyIsImdlbmRlciI6MCwiYXZhdGFyIjoiIiwiY3JlYXRlX3RpbWUiOjE2MzA5OTM0MzksImNoYW5uZWwiOiIiLCJkaXN0aW5jdF9pZCI6IiJ9.ptOVOXd2IDFE9C9fi6o7KAgY2I53xQmnsjv3AmEEcFc\"\n        //         xhr.setRequestHeader(\"Authorization\",token);\n        //     }\n        //     cc.log(\"requestURL=\",requestURL)\n        //     xhr.onreadystatechange = function () {\n        //         if (xhr.readyState === 4 && xhr.status == 200) {\n        //             cc.log(\"http res:\" + xhr.response);\n        //             if (success !== null) {\n        //                 success(xhr.response);\n        //             }\n        //         }\n        //     };\n        //     xhr.send(JSON.stringify(data));\n        //     return xhr;\n        // }\n        // 用新的promise来写这个接口\n        sendRequest: function (url, type,data) {\n            return new Promise(function (resolve, reject) {\n                let xhr = new XMLHttpRequest();\n                let requestURL = \"https://pit.api.jiankangzhuan.com/\" + url;\n                // let requestURL = \"https://qa.api.jiankangzhuan.com/v2.QASvc/UserQaRankingList\";\n                xhr.open(type, requestURL, true);\n                if (cc.sys.isNative) {\n                    cc.log(\"isNative\");\n                    xhr.setRequestHeader(\"Accept-Encodeing\", \"gzip,deflate\");\n                }\n                if(cc.wxToken){\n                    xhr.setRequestHeader(\"Authorization\", cc.wxToken);\n                }\n                xhr.setRequestHeader(\"Content-Type\", \"application/json\");\n                cc.log(\"requestURL=\", requestURL);\n                cc.log(\"data=\", data);\n                xhr.onreadystatechange = function () {\n                    // cc.log(xhr.readyState,\"+\",xhr.status)\n                    if (xhr.readyState === 4 && xhr.status == 200) {\n                        cc.log(\"http res:\" + xhr.response);\n                        // 统一处理\n                        let _response = JSON.parse(xhr.response);\n                        if(_response.code===0){\n                            resolve(_response)\n                        }else{\n                            console.log(_response.message);\n                            reject(_response.message);\n                        }\n                    }\n                }\n                xhr.onerror = function () {\n                    reject(new Error(xhr.statusText))\n                }\n                // console.log(\"data\",JSON.stringify(data));\n                // xhr.send();\n                xhr.send(JSON.stringify(data));\n            })\n        }\n    },\n\n    // use this for initialization\n    onLoad: function () {\n\n    },\n});\n"]}