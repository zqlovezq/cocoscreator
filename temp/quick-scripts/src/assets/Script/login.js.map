{"version":3,"sources":["assets/Script/login.js"],"names":["http","require","cc","Class","Component","properties","start","protocol","needLogin","time","sys","isNative","localStorage","setItem","getItem","wxToken","director","loadScene","onLoginWX","wxLogin","showTips","clickProtocol","e","target","right","getChildByName","active","tips","node","y","tween","to","delay","call","update","dt","wxLoginResultcode","data","sendRequest","then","res","token","showUserProtocol","hideUserProtocol","showUserPrivacy","privacy","hideUserPrivacy"],"mappings":"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","sourceRoot":"/","sourcesContent":["const http = require(\"Http\");\ncc.Class({\n    extends: cc.Component,\n\n    properties: {\n\n    },\n\n    // LIFE-CYCLE CALLBACKS:\n\n    // onLoad () {},\n\n    start() {\n        this.protocol = false;\n        this.needLogin = true;\n        this.time = 0;\n        if (!cc.sys.isNative) {\n            cc.sys.localStorage.setItem(\"token\", \"eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJ1c2VyX2lkIjoxMDAxMTcxLCJvcGVuX2lkIjoib1FXNFI1OVVSRlF1YTNSWjlvX3lfdGJ6UEdLNCIsIm5pY2tfbmFtZSI6Iua1t-ebl-iIuemVvzIuMCIsImdlbmRlciI6MSwiYXZhdGFyIjoiaHR0cHM6Ly90aGlyZHd4LnFsb2dvLmNuL21tb3Blbi92aV8zMi9mR0xkR1pneG5wVmtJQldjaWEzeWljaWJ6aWJFQ0J0VzFhQkhEbUdhWmV6cTAycWdQUUN3STN5OGljVE5nWEtCcDBOcExBNUJFdDZ6UEdsSG1VTWY5bHd4Qk1nLzEzMiIsImNyZWF0ZV90aW1lIjowLCJjaGFubmVsIjoiMSIsImRpc3RpbmN0X2lkIjoiMSJ9.K5C9XSkEEjBBfPFn1m5BoXGu11ubPc9lSvDRAHkv_V4\")\n        }\n        if (cc.sys.localStorage.getItem(\"token\")) {\n            this.needLogin = false;\n            cc.wxToken = cc.sys.localStorage.getItem(\"token\");\n            cc.director.loadScene('Index');\n        }\n    },\n    onLoginWX() {\n        if (cc.sys.isNative) {\n            if (this.protocol) {\n                cc.wxLogin.wxLogin();\n            } else {\n                this.showTips()\n            }\n        }\n        // this.schedule(()=>{\n        //     // cc.wxLoginInfo.wxLoginResultcode = {};\n\n        // },1)\n    },\n    // 选择用户协议\n    clickProtocol(e) {\n        let target = e.target;\n        let right = target.getChildByName(\"right\");\n        if (this.protocol) {\n            right.active = false;\n            this.protocol = false;\n        } else {\n            right.active = true;\n            this.protocol = true;\n        }\n    },\n    showTips() {\n        let tips = this.node.getChildByName(\"tips\");\n        tips.y = 0;\n        tips.active = true;\n        cc.tween(tips).to(1, { y: 100 }).delay(0.5).call(() => {\n            tips.active = false;\n        }).start()\n    },\n    update(dt) {\n        this.time += dt;\n        if (!this.needLogin) {\n            return;\n        }\n        if (this.time >= 1) {\n            this.time = 0;\n            if (cc.wxLoginResultcode && this.protocol) {\n                this.protocol = false;\n                let data = {\n                    \"channel\": \"1\",\n                    \"imei\": \"1\",\n                    \"mac\": \"1\",\n                    \"distinct_id\": \"1\",\n                    \"oaid\": \"1\",\n                    \"android_id\": \"1\",\n                    \"code\": cc.wxLoginResultcode\n                }\n                http.sendRequest(\"pit.v1/register\", \"POST\", data).then((res) => {\n                    // this.token.string = JSON.stringify(res)\n                    cc.wxToken = res.data.token;\n                    cc.sys.localStorage.setItem(\"token\", res.data.token);\n                    cc.director.loadScene('Index');\n                })\n            }\n        }\n    },\n    // 显示用户协议\n    showUserProtocol() {\n        let protocol = this.node.getChildByName(\"user_protocol\");\n        protocol.active = true;\n    },\n    hideUserProtocol() {\n        let protocol = this.node.getChildByName(\"user_protocol\");\n        protocol.active = false;\n    },\n    // 显示隐私政策\n    showUserPrivacy() {\n        let privacy = this.node.getChildByName(\"user_privacy\");\n        privacy.active = true;\n    },\n    hideUserPrivacy() {\n        let privacy = this.node.getChildByName(\"user_privacy\");\n        privacy.active = false;\n    }\n});\n\n\n"]}