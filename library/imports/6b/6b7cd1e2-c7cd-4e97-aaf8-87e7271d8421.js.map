{"version":3,"sources":["assets/Script/login.js"],"names":["http","require","cc","Class","Component","properties","start","protocol","needLogin","time","sys","localStorage","getItem","wxToken","director","loadScene","onLoginWX","isNative","wxLogin","showTips","clickProtocol","e","target","right","getChildByName","active","tips","node","y","tween","to","delay","call","update","dt","wxLoginResultcode","data","sendRequest","then","res","token","setItem"],"mappings":"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","sourceRoot":"/","sourcesContent":["const http = require(\"Http\");\ncc.Class({\n    extends: cc.Component,\n\n    properties: {\n        \n    },\n\n    // LIFE-CYCLE CALLBACKS:\n\n    // onLoad () {},\n\n    start () {\n       this.protocol = false;\n       this.needLogin = true;\n       this.time = 0;\n    //    获取用户信息\n        //  cc.sys.localStorage.setItem(\"token\",\"eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJ1c2VyX2lkIjoxMDAxMTcxLCJvcGVuX2lkIjoib1FXNFI1OVVSRlF1YTNSWjlvX3lfdGJ6UEdLNCIsIm5pY2tfbmFtZSI6Iua1t-ebl-iIuemVvzIuMCIsImdlbmRlciI6MSwiYXZhdGFyIjoiaHR0cHM6Ly90aGlyZHd4LnFsb2dvLmNuL21tb3Blbi92aV8zMi9mR0xkR1pneG5wVmtJQldjaWEzeWljaWJ6aWJFQ0J0VzFhQkhEbUdhWmV6cTAycWdQUUN3STN5OGljVE5nWEtCcDBOcExBNUJFdDZ6UEdsSG1VTWY5bHd4Qk1nLzEzMiIsImNyZWF0ZV90aW1lIjowLCJjaGFubmVsIjoiMSIsImRpc3RpbmN0X2lkIjoiMSJ9.K5C9XSkEEjBBfPFn1m5BoXGu11ubPc9lSvDRAHkv_V4\")\n        if(cc.sys.localStorage.getItem(\"token\")){\n            this.needLogin = false;\n            cc.wxToken = cc.sys.localStorage.getItem(\"token\");\n            cc.director.loadScene('Index');\n        }\n    },\n    onLoginWX(){\n        if(cc.sys.isNative){\n            if(this.protocol){\n                cc.wxLogin.wxLogin();\n            }else{\n                this.showTips()\n            }\n        }\n        // this.schedule(()=>{\n        //     // cc.wxLoginInfo.wxLoginResultcode = {};\n           \n        // },1)\n    },\n    // 选择用户协议\n    clickProtocol(e){\n        let target = e.target;\n        let right = target.getChildByName(\"right\");\n        if(this.protocol){\n            right.active = false;\n            this.protocol = false;\n        }else{\n            right.active = true;\n            this.protocol = true;\n        }\n    },\n    showTips(){\n        let tips = this.node.getChildByName(\"tips\");\n        tips.y = 0;\n        tips.active = true;\n        cc.tween(tips).to(1,{y:100}).delay(0.5).call(()=>{\n            tips.active = false;\n        }).start()\n    },\n    update(dt){\n        this.time+=dt;\n        if(!this.needLogin){\n            return;\n        }\n        if(this.time>=1){\n            this.time = 0;\n            if(cc.wxLoginResultcode&&this.protocol){\n                this.protocol = false;\n                let data = {\n                    \"channel\": \"1\",\n                    \"imei\": \"1\",\n                    \"mac\": \"1\",\n                    \"distinct_id\": \"1\",\n                    \"oaid\": \"1\",\n                    \"android_id\": \"1\",\n                    \"code\": cc.wxLoginResultcode\n                }\n                 http.sendRequest(\"pit.v1/register\", \"POST\", data).then((res) => {\n                    // this.token.string = JSON.stringify(res)\n                    cc.wxToken = res.data.token;\n                    cc.sys.localStorage.setItem(\"token\", res.data.token);\n                    cc.director.loadScene('Index');\n                })\n            }\n        }\n    }\n});\n\n\n"]}