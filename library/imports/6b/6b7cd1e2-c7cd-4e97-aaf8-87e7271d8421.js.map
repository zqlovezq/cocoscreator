{"version":3,"sources":["assets/Script/login.js"],"names":["cc","Class","Component","properties","start","protocol","needLogin","time","sys","isNative","localStorage","setItem","getItem","wxToken","director","loadScene","showRealLayer","onLoginWX","Tools","wxLogin","showTips","node","clickProtocol","e","target","right","getChildByName","active","update","dt","wxLoginResultcode","data","sendRequest","then","res","token","dot","register_time","Date","channel","showUserProtocol","hideUserProtocol","showUserPrivacy","privacy","hideUserPrivacy","realNameLayer","clickRealLayer","_realName","getComponent","EditBox","string","_realNumber","log","regYourName","regYourNumber","name","regName","test","num","regIdNo"],"mappings":"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","sourceRoot":"/","sourcesContent":["cc.Class({\n    extends: cc.Component,\n\n    properties: {\n\n    },\n\n    // LIFE-CYCLE CALLBACKS:\n\n    // onLoad () {},\n\n    start() {\n        this.protocol = false;\n        this.needLogin = true;\n        this.time = 0;\n        if (!cc.sys.isNative) {\n            cc.sys.localStorage.setItem(\"token\", \"eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJ1c2VyX2lkIjoxMDAxMTcxLCJvcGVuX2lkIjoib1FXNFI1OVVSRlF1YTNSWjlvX3lfdGJ6UEdLNCIsIm5pY2tfbmFtZSI6Iua1t-ebl-iIuemVvzIuMCIsImdlbmRlciI6MSwiYXZhdGFyIjoiaHR0cHM6Ly90aGlyZHd4LnFsb2dvLmNuL21tb3Blbi92aV8zMi9mR0xkR1pneG5wVmtJQldjaWEzeWljaWJ6aWJFQ0J0VzFhQkhEbUdhWmV6cTAycWdQUUN3STN5OGljVE5nWEtCcDBOcExBNUJFdDZ6UEdsSG1VTWY5bHd4Qk1nLzEzMiIsImNyZWF0ZV90aW1lIjowLCJjaGFubmVsIjoiMSIsImRpc3RpbmN0X2lkIjoiMSJ9.K5C9XSkEEjBBfPFn1m5BoXGu11ubPc9lSvDRAHkv_V4\")\n        }\n        if (cc.sys.localStorage.getItem(\"token\")) {\n            this.needLogin = false;\n            this.protocol = true;\n            cc.wxToken = cc.sys.localStorage.getItem(\"token\");\n            if(cc.sys.isNative){\n                if (cc.sys.localStorage.getItem(\"realName\")) {\n                    cc.director.loadScene('Index');\n                } else {\n                    this.showRealLayer();\n                }\n            }else{\n                cc.director.loadScene('Index');\n            }\n        }\n    },\n    onLoginWX() {\n        if (cc.sys.isNative) {\n            if (this.protocol) {\n                cc.Tools.wxLogin();\n            } else {\n                cc.Tools.showTips(this.node,\"请先同意用户协议和隐私政策\")\n            }\n        }\n    },\n    // 选择用户协议\n    clickProtocol(e) {\n        let target = e.target;\n        let right = target.getChildByName(\"right\");\n        if (this.protocol) {\n            right.active = false;\n            this.protocol = false;\n        } else {\n            right.active = true;\n            this.protocol = true;\n        }\n    },\n    update(dt) {\n        this.time += dt;\n        if (!this.needLogin) {\n            return;\n        }\n        if (this.time >= 1) {\n            this.time = 0;\n            if (cc.wxLoginResultcode && this.protocol) {\n                this.protocol = false;\n                let data = {\n                    \"channel\": \"1\",\n                    \"imei\": \"1\",\n                    \"mac\": \"1\",\n                    \"distinct_id\": \"1\",\n                    \"oaid\": \"1\",\n                    \"android_id\": \"1\",\n                    \"code\": cc.wxLoginResultcode\n                }\n                cc.Tools.sendRequest(\"pit.v1/register\", \"POST\", data).then((res) => {\n                    cc.wxToken = res.data.token;\n                    cc.sys.localStorage.setItem(\"token\", res.data.token);\n                    cc.Tools.dot(\"register\", { register_time: new Date(), channel: \"微信\" })\n                    if (cc.sys.localStorage.getItem(\"realName\")) {\n                        cc.director.loadScene('Index');\n                    } else {\n                        this.showRealLayer();\n                    }\n                })\n            }\n        }\n    },\n    // 显示用户协议\n    showUserProtocol() {\n        let protocol = this.node.getChildByName(\"user_protocol\");\n        protocol.active = true;\n    },\n    hideUserProtocol() {\n        let protocol = this.node.getChildByName(\"user_protocol\");\n        protocol.active = false;\n    },\n    // 显示隐私政策\n    showUserPrivacy() {\n        let privacy = this.node.getChildByName(\"user_privacy\");\n        privacy.active = true;\n    },\n    hideUserPrivacy() {\n        let privacy = this.node.getChildByName(\"user_privacy\");\n        privacy.active = false;\n    },\n    // 实名认证\n    showRealLayer() {\n        this.realNameLayer = this.node.getChildByName(\"RealName\");\n        this.realNameLayer.active = true;\n    },\n    // 实名认证点击\n    clickRealLayer(e) {\n        let target = e.target;\n        let _realName = this.realNameLayer.getChildByName(\"edit1\").getComponent(cc.EditBox).string;\n        let _realNumber = this.realNameLayer.getChildByName(\"edit2\").getComponent(cc.EditBox).string;\n        cc.log(`真实姓名${_realName}------身份证号${_realNumber}`);\n        // 用local记录 是否实名\n        if(this.regYourName(_realName)&&this.regYourNumber(_realNumber)){\n            cc.log(\"认证成功\");\n            cc.sys.localStorage.setItem(\"realName\", true)\n            cc.director.loadScene('Index');\n        }\n    },\n    // 判断真实姓名\n    regYourName(name) {\n        var regName = /^[\\u4e00-\\u9fa5]{2,4}$/;\n        if (!regName.test(name)) {\n            cc.Tools.showTips(this.node,\"真实姓名填写有误\")\n            return false;\n        }\n        return true\n    },\n    // 判断身份证号\n    regYourNumber(num) {\n        var regIdNo = /(^\\d{15}$)|(^\\d{18}$)|(^\\d{17}(\\d|X|x)$)/;\n        if (!regIdNo.test(num)) {\n            cc.Tools.showTips(this.node,'身份证号填写有误');\n            return false;\n        }\n        return true\n    }\n});\n\n\n"]}