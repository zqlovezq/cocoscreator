{"version":3,"sources":["file:///C:/chickenStarClient/client/assets/scripts/logic/model/activity/ActivityRed.ts"],"names":["_decorator","RedMgr","RedDotType","ActivityData","tab","OpenFunctionMgr","ccclass","property","ActivityRed","ins","instance","init","registerCalculateFb","NewPlayerSignIn","red_NewPlayerSignIn","SignIn","red_SignIn","HeroRoad","red_HeroRoad","MonthlyCard","red_MonthlyCard","Vip","red_Vip","Vip_Buy","red_Vip_Buy","Welfare_Open","red_wlfare_open","checkFunctionIsOpen","OpenFunctionName","OpenFunctionName_Welfare","VipBonusTable","msg","getDailyRewardMsgByType","DailyRewardType","DailyRewardType_NewServer","activatedList","length","DailyRewardType_Daily","heroCollectionMsg","OpenFunctionName_MonthlyPass","monthlyPassInfo","PrivilegeMap","PrivilegedType","PrivilegedType_MonthlyPass","isDailyReceived","PrivilegedType_PremiumMonthlyPass","isReceivedMonthlyPassAddtional","OpenFunctionName_Vip","vipMsg","isDailyGiftReceived","vipBonus","getData","vipLevel","stateToChange","key","VipLv","isBuy","boughtVipGifts","indexOf"],"mappings":"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","sourcesContent":["import { _decorator, Component, Node } from 'cc';\r\nimport { RedMgr } from '../../mgr/RedMgr';\r\nimport { RedDotType } from '../../red/RedDotType';\r\nimport { ActivityData } from './ActivityData';\r\nimport { tab } from '../../../Table/table_gen';\r\nimport { OpenFunctionMgr } from '../../../Common/component/OpenFunctionMgr';\r\nconst { ccclass, property } = _decorator;\r\n\r\n/**\r\n * \r\n * ActivityRed\r\n * zhudingchao\r\n * Fri Jun 28 2024 16:54:49 GMT+0800 (中国标准时间)\r\n * db://assets/scripts/logic/model/activity/ActivityRed.ts\r\n *\r\n */\r\n\r\n@ccclass('ActivityRed')\r\nexport class ActivityRed {\r\n\r\n    private static instance: ActivityRed = null;\r\n\r\n    public static get ins() {\r\n        if (this.instance == null) {\r\n            this.instance = new ActivityRed();\r\n        }\r\n        return this.instance;\r\n    }\r\n    init() {\r\n        RedMgr.ins.registerCalculateFb(RedDotType.NewPlayerSignIn, this.red_NewPlayerSignIn, this);\r\n        RedMgr.ins.registerCalculateFb(RedDotType.SignIn, this.red_SignIn, this);\r\n        RedMgr.ins.registerCalculateFb(RedDotType.HeroRoad, this.red_HeroRoad, this);\r\n        RedMgr.ins.registerCalculateFb(RedDotType.MonthlyCard, this.red_MonthlyCard, this);\r\n        RedMgr.ins.registerCalculateFb(RedDotType.Vip, this.red_Vip, this);\r\n        RedMgr.ins.registerCalculateFb(RedDotType.Vip_Buy, this.red_Vip_Buy, this);\r\n        RedMgr.ins.registerCalculateFb(RedDotType.Welfare_Open, this.red_wlfare_open, this);\r\n    }\r\n    red_wlfare_open(){\r\n        return OpenFunctionMgr.ins.checkFunctionIsOpen(tab.OpenFunctionName.OpenFunctionName_Welfare);\r\n    }\r\n    red_NewPlayerSignIn() {\r\n        tab.VipBonusTable\r\n        let msg = ActivityData.ins.getDailyRewardMsgByType(tab.DailyRewardType.DailyRewardType_NewServer);\r\n        return msg && msg.activatedList.length > 0;\r\n    }\r\n    red_SignIn() {\r\n        let msg = ActivityData.ins.getDailyRewardMsgByType(tab.DailyRewardType.DailyRewardType_Daily);\r\n        return msg && msg.activatedList.length > 0;\r\n    }\r\n    red_HeroRoad() {\r\n        let msg = ActivityData.ins.heroCollectionMsg;\r\n        return msg && msg.activatedList.length > 0;\r\n    }\r\n    red_MonthlyCard() {\r\n        if(!OpenFunctionMgr.ins.checkFunctionIsOpen(tab.OpenFunctionName.OpenFunctionName_MonthlyPass)){\r\n            return false;\r\n        }\r\n        let msg = ActivityData.ins.monthlyPassInfo;\r\n        if (msg.PrivilegeMap && msg.PrivilegeMap[tab.PrivilegedType.PrivilegedType_MonthlyPass]) {\r\n            if (!msg.PrivilegeMap[tab.PrivilegedType.PrivilegedType_MonthlyPass].isDailyReceived) {\r\n                return true;\r\n            }\r\n        }\r\n        if (msg.PrivilegeMap && msg.PrivilegeMap[tab.PrivilegedType.PrivilegedType_PremiumMonthlyPass]) {\r\n            if (!msg.PrivilegeMap[tab.PrivilegedType.PrivilegedType_PremiumMonthlyPass].isDailyReceived) {\r\n                return true;\r\n            }\r\n        }\r\n        if (msg.isReceivedMonthlyPassAddtional) {\r\n            return false;\r\n        }\r\n        if (msg.PrivilegeMap && msg.PrivilegeMap[tab.PrivilegedType.PrivilegedType_MonthlyPass] && msg.PrivilegeMap[tab.PrivilegedType.PrivilegedType_PremiumMonthlyPass]) {\r\n            return true;\r\n        }\r\n        return false;\r\n        // return msg&&msg.activatedList.length>0;\r\n    }\r\n    red_Vip() {\r\n        if(OpenFunctionMgr.ins.checkFunctionIsOpen(tab.OpenFunctionName.OpenFunctionName_Vip)){\r\n            let msg = ActivityData.ins.vipMsg;\r\n            return msg && !msg.isDailyGiftReceived;\r\n        }else{\r\n            return false;\r\n        }\r\n        \r\n    }\r\n    red_Vip_Buy() {\r\n        if(OpenFunctionMgr.ins.checkFunctionIsOpen(tab.OpenFunctionName.OpenFunctionName_Vip)){\r\n            let vipBonus = tab.getData().VipBonusTable;\r\n            let vipLevel =ActivityData.ins.vipMsg.vipLevel;\r\n            let stateToChange = {};\r\n            for(let key in vipBonus){\r\n                if(vipBonus[key].VipLv<=vipLevel){\r\n                    let isBuy = ActivityData.ins.vipMsg.boughtVipGifts.indexOf(vipBonus[key].VipLv) >= 0;\r\n                    stateToChange[vipBonus[key].VipLv+\"\"]=!isBuy;\r\n                }else{\r\n                    stateToChange[vipBonus[key].VipLv+\"\"]=false;\r\n                }\r\n            }\r\n            return stateToChange;\r\n        }else{\r\n            let vipBonus = tab.getData().VipBonusTable;\r\n            let stateToChange = {};\r\n            for(let key in vipBonus){\r\n              stateToChange[vipBonus[key].VipLv+\"\"]=false;\r\n            }\r\n            return stateToChange;\r\n        }\r\n        \r\n    }\r\n}"]}