{"version":3,"sources":["file:///C:/chickenStarClient/client/assets/scripts/logic/model/common/EnergyAccumulatePop.ts"],"names":["_decorator","Label","Node","Sprite","ViewPop","tab","RoleData","ItemData","RoleControl","ShowTips","LangMgr","ccclass","property","EnergyAccumulatePop","currLastNum","currBuyNum","table","register","onShow","initView","Number","numLab","string","getData","BuyStaminaTableByType","getValue","BuyStaminaType","BuyStaminaType_BuyMissStamina","total","MaxCount","currNum","ins","staminaInfo","remainBuyTimesMap","lastTimeLab","costItem","ItemTableById","CostItemId","costSpr","setTexture","Icon","costLab","CostItemNum","buyNumLab","GetItemNum","updateNum","onClickMinusBtn","onClickPlusBtn","onClickMaxBtn","getLab","onClickBuyBtn","id","isItemsEnoughByList","requestBuyStamina","onClose","itemtab","getCombineString","Name"],"mappings":"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","sourcesContent":["import { _decorator, Component, Label, Node, Sprite } from 'cc';\r\nimport { ViewPop } from '../../../framework/base/ViewPop';\r\nimport { tab } from '../../../Table/table_gen';\r\nimport { RoleData } from '../role/RoleData';\r\nimport { ItemData } from '../item/ItemData';\r\nimport { RoleControl } from '../role/RoleControl';\r\nimport { ShowTips } from '../../mgr/UIMgr';\r\nimport { LangMgr } from '../../mgr/LangMgr';\r\nconst { ccclass, property } = _decorator;\r\n\r\n/**\r\n * \r\n * EnergyAccumulatePop\r\n * zhudingchao\r\n * Wed Jun 19 2024 10:47:39 GMT+0800 (中国标准时间)\r\n * db://assets/scripts/logic/model/common/EnergyAccumulatePop.ts\r\n *\r\n */\r\n\r\n@ccclass('EnergyAccumulatePop')\r\nexport class EnergyAccumulatePop extends ViewPop {\r\n    @property(Node)\r\n    contentNode: Node = null;\r\n    @property(Label)\r\n    lastTimeLab: Label = null;\r\n    @property(Label)\r\n    numLab: Label = null;\r\n    @property(Sprite)\r\n    costSpr: Sprite = null;\r\n    @property(Label)\r\n    costLab: Label = null;\r\n    @property(Label)\r\n    buyNumLab: Label = null;\r\n    @property(Sprite)\r\n    iconSpr:Sprite=null;\r\n    private currLastNum: number = 0;\r\n    private currBuyNum: number;\r\n    private table: tab.BuyStaminaTable;\r\n    register(): void {\r\n\r\n    }\r\n    onShow(): void {\r\n        // if (this.openData && this.openData[\"worldPos\"]) {\r\n        //     this.contentNode.setWorldPosition(this.openData[\"worldPos\"]);\r\n        // }\r\n        this.initView()\r\n    }\r\n    initView() {\r\n        this.currBuyNum = Number(this.numLab.string);\r\n        let table = tab.getData().BuyStaminaTableByType.getValue(tab.BuyStaminaType.BuyStaminaType_BuyMissStamina);\r\n        if (table) {\r\n            let total = table.MaxCount;\r\n            let currNum = RoleData.ins.staminaInfo.remainBuyTimesMap[tab.BuyStaminaType.BuyStaminaType_BuyMissStamina];\r\n            if (currNum > total) {\r\n                currNum = total;\r\n            }\r\n            this.currLastNum = currNum;\r\n            this.lastTimeLab.string = currNum + \"/\" + total;\r\n            let costItem = tab.getData().ItemTableById.getValue(table.CostItemId);\r\n            this.costSpr.setTexture(costItem.Icon);\r\n            this.costLab.string = (table.CostItemNum * this.currBuyNum) + \"\";\r\n            this.buyNumLab.string = (table.GetItemNum[0] * this.currBuyNum) + \"\"\r\n            this.table = table;\r\n            // this.iconSpr.setTexture(table.ShowIcon);\r\n        }\r\n\r\n    }\r\n    updateNum() {\r\n        this.numLab.string = this.currBuyNum + \"\";\r\n        this.costLab.string = (this.table.CostItemNum * this.currBuyNum) + \"\";\r\n        this.buyNumLab.string = (this.table.GetItemNum[0] * this.currBuyNum) + \"\"\r\n    }\r\n    onClickMinusBtn() {\r\n        if (this.currBuyNum > 1) {\r\n            this.currBuyNum--;\r\n            this.updateNum();\r\n        }\r\n    }\r\n    onClickPlusBtn() {\r\n        if (this.currBuyNum < this.currLastNum) {\r\n            this.currBuyNum++;\r\n            this.updateNum();\r\n        }\r\n    }\r\n    onClickMaxBtn() {\r\n        if(this.currLastNum<=0){\r\n            ShowTips(LangMgr.getLab(\"Tips_stamina_1\"));\r\n            return;\r\n        }\r\n        if (this.currBuyNum != this.currLastNum) {\r\n            this.currBuyNum = this.currLastNum;\r\n            this.updateNum();\r\n        }\r\n\r\n\r\n\r\n    }\r\n    onClickBuyBtn() {\r\n        if(this.currLastNum<=0){\r\n            //ShowTips(\"没有购买次数\");\r\n            ShowTips(LangMgr.getLab(\"Tips_stamina_1\"));\r\n            return;\r\n        }\r\n        let id = ItemData.ins.isItemsEnoughByList([this.table.CostItemId], [this.table.CostItemNum * this.currBuyNum]);\r\n        if (id <= 0) {\r\n            RoleControl.ins.requestBuyStamina(tab.BuyStaminaType.BuyStaminaType_BuyMissStamina,this.currBuyNum);\r\n            this.onClose();\r\n        } else {\r\n            let itemtab = tab.getData().ItemTableById.getValue(id);\r\n            //ShowTips(LangMgr.getLab(itemtab.Name) + \"不足\");\r\n            ShowTips(LangMgr.getCombineString(\"Tips_itemshortage\", [LangMgr.getLab(itemtab.Name)]));\r\n        }\r\n    }\r\n\r\n\r\n\r\n}"]}