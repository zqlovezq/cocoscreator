{"version":3,"sources":["file:///C:/chickenStarClient/client/assets/scripts/logic/model/role/roleInfo/RoleInfoChangeNamePop.ts"],"names":["_decorator","Button","EditBox","Label","Sprite","ViewPop","RoleData","ItemData","proto","Net","tab","ShowItemNotEnoughTips","ShowTips","isChEngNumber","LangMgr","SensitiveWordsManager","ccclass","property","RoleInfoChangeNamePop","displayName","type","onShow","changeNameConfig","getData","GetKeyValue_ConfigTable","ChangeNameCost","btn_cost","node","active","ins","changeNameTimes","btn_free","on","onClickOk","itemTab","getByItemId","itemTable","sp_diamond","setTexture","Icon","lbl_cost_diamond","string","String","needDiamond","diamond","r_name","getLab","check","msg","Msg_ChangeRoleNameReq","name","Send","Ptl","ChangeRoleNameReq","endedEditBox","cutoutNameLen","bOverLimit","length","substr","deleteSpecialStr","idx","indexOf","substring","disposeRandomName","setSysName","onDestroy","register","unRegister"],"mappings":"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","sourcesContent":["import { _decorator, Button, Component, EditBox, Label, Node, Sprite } from 'cc';\r\nimport { ViewPop } from '../../../../framework/base/ViewPop';\r\nimport { RoleData } from '../RoleData';\r\nimport { ItemData } from '../../item/ItemData';\r\nimport { proto } from 'client_protocol';\r\nimport { Net } from '../../../net/Net';\r\nimport { tab } from '../../../../Table/table_gen';\r\nimport { ShowItemNotEnoughTips, ShowTips } from '../../../mgr/UIMgr';\r\nimport { isChEngNumber } from '../../../utils/GameUtil';\r\nimport { LangMgr } from '../../../mgr/LangMgr';\r\nimport SensitiveWordsManager from '../../../utils/SensitiveWordsManager';\r\nconst { ccclass, property } = _decorator;\r\n\r\n@ccclass('RoleInfoChangeNamePop')\r\nexport class RoleInfoChangeNamePop extends ViewPop {\r\n    @property({ displayName: \"输入名字\", type: EditBox })\r\n    r_name: EditBox = null;\r\n\r\n    @property(Sprite)\r\n    sp_diamond: Sprite = null;\r\n\r\n    @property(Button)\r\n    btn_cost: Button = null;\r\n\r\n    @property(Label)\r\n    lbl_cost_diamond: Label = null;\r\n\r\n    @property(Button)\r\n    btn_free: Button = null;\r\n\r\n    @property(Button)\r\n    btn_close: Button = null;\r\n\r\n    onShow(): void {\r\n        const changeNameConfig = tab.getData().GetKeyValue_ConfigTable().ChangeNameCost;\r\n        this.btn_cost.node.active = RoleData.ins.changeNameTimes>0;\r\n        this.btn_free.node.active = RoleData.ins.changeNameTimes===0;\r\n        this.btn_cost.node.on(\"click\", () => { this.onClickOk() }, this);\r\n        this.btn_free.node.on(\"click\", () => { this.onClickOk() }, this);\r\n        const itemTab = ItemData.ins.getByItemId(1).itemTable;\r\n        this.sp_diamond.setTexture(itemTab.Icon);\r\n        this.lbl_cost_diamond.string = String(changeNameConfig[RoleData.ins.changeNameTimes>=2?2:RoleData.ins.changeNameTimes])\r\n\r\n    }\r\n    public onClickOk() {\r\n        const changeNameConfig = tab.getData().GetKeyValue_ConfigTable().ChangeNameCost;\r\n        const needDiamond = changeNameConfig[RoleData.ins.changeNameTimes>=2?2:RoleData.ins.changeNameTimes];\r\n        if(this.btn_cost.node.active && RoleData.ins.diamond<needDiamond){\r\n            ShowItemNotEnoughTips(1);\r\n        return;\r\n        }\r\n        if(!isChEngNumber(this.r_name.string)) {\r\n            ShowTips(LangMgr.getLab(\"Tips_changename_1\"));\r\n            return\r\n        }\r\n\r\n        if (!SensitiveWordsManager.ins.check(this.r_name.string)) {\r\n            ShowTips(LangMgr.getLab(\"Tips_changename_1\"));\r\n            return\r\n        }\r\n\r\n        let msg = new proto.Msg_ChangeRoleNameReq();\r\n        msg.name = this.r_name.string;\r\n        Net.Send(proto.Ptl.ChangeRoleNameReq, msg)\r\n    }\r\n    public endedEditBox() {\r\n        this.cutoutNameLen();\r\n    }\r\n    private cutoutNameLen() {\r\n        let name = this.r_name.string;\r\n        let bOverLimit = name.length > 7;\r\n        if (bOverLimit) {\r\n            name = name.substr(0, 7);\r\n            this.r_name.string = name;\r\n        }\r\n    }\r\n\r\n    private deleteSpecialStr() {\r\n        let name = this.r_name.string;\r\n        let idx = name.indexOf(\"_\", 0);\r\n        if (idx != -1) {\r\n            name = name.substring(idx + 0);\r\n        }\r\n        this.r_name.string = name;\r\n    }\r\n\r\n    private disposeRandomName() {\r\n        this.setSysName();\r\n    }\r\n\r\n    private setSysName() {\r\n        this.r_name.string = RoleData.ins.name;\r\n        this.cutoutNameLen();\r\n    }\r\n    protected onDestroy(): void {\r\n        super.onDestroy();\r\n    }\r\n    register(): void {\r\n\r\n    }\r\n    unRegister(): void {\r\n        super.unRegister()\r\n    }\r\n}\r\n\r\n\r\n"]}