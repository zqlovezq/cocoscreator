{"version":3,"sources":["file:///C:/chickenStarClient/client/assets/scripts/logic/fight/base/obj/bullet/BulletControl.ts"],"names":["_decorator","Mask","Node","UITransform","Vec3","view","AbsControl","FightRootControl","AbsObjFactory","tab","SearchEnemy","ColliderMgr","MathAngle","AbsObjType","Random","EventMgr","FightEvent","AbsOwner","FightMacro","ccclass","property","BulletTargetType","tempPos","tempStartPos","tempTargetPos","bulletBaseTarget","BulletControl","groupId","ins","_instance","init","x","getData","GetKeyValue_ConfigTable","BulletBaseTarget","y","addSelfGroupId","clickEmitBullet","bulletTab","attack","targetPos","bulletGroupId","console","warn","EffectUnit","EffectUnit_Enemy","emitBullet","get","objId","getShotPos","audoEmitBullet","SearchEnemy_None","enemy","getBySearchEnemy","objType","EnemyUnit","owner","startPos","targetRole","parentSoleId","havaDamageObjIds","set","Fission","length","ZERO","angleToDirection","multiplyScalar","add","targetType","default","role","getHitPos","pos","tmpGroupId","tmpAngle","posToAngle","list","getFissionAngles","index","v","checkForwardArrow","angle","targetObj","objAttr","ForwardArrow","rate","isSuccess","isForwardArrow","getForwardDirection","forwardArrowOffsetY","addBullet","info","bullet","setConfigTab","key","setObjAttr","configTab","error","bulletParent","getBulletNode","isEffectShowBelow","getValidAnimId","isLaunchMask","maskNode","uiComp","addComponent","anchorX","height","width","getVisibleSize","parent","getBullet","setStartPos","setAbsOnwer","setTargetType","addhavaDamageObjIds","isolnyOneSon","sonGroupId","run","addCatapult","defanseAbs","ignores","getEnemyFiltrate","EnemyFiltrate","getTruePosition","EnemyFiltrate_NoSelectSame","EnemyFiltrate_CanSelectlast","inst","removeTrigger","targetDirection","checkDeathTrigger","isDead","OutOfScreen","DeathTrigger","DeathTriggerTabs","bulletCreateBullet","checkHitTrigger","addHitCount","isHitTriggerBullet","check","HitTrigger","hitCount","HitChance","hitTriggerTab","isHitTriggerSpeed","speed","setVelocityAngle","voAngle","intervalTrigger","isInitInterval","intervalEffectBulletTab","isLock","setOwner","NoHarm","bulletSoleId","endDamegeObj","addParentSoleId","BulletBorn","BulletBorn_She","BulletBorn_Inherit","target","Trajectory","Trajectory_Trackless","velocity","push","enemyFiltrate","slice","EnemyFiltrate_Ignorelast","baseAngle","fissions","getAverageEmitAnglesAngle","getAverageEmitAnglesAngle1","getAverageEmitAnglesAngle2","checkHitEffect","HitEffect","emitFight","Hit_Effect_Add"],"mappings":"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","sourcesContent":["import { _decorator, CCInteger, Color, Component, instantiate, Label, Layers, Mask, Node, Prefab, Quat, Rect, sp, Sprite, tween, UITransform, v3, Vec2, Vec3, view } from 'cc';\nimport { AbsControl } from '../../../../../framework/base/IAbs';\nimport { AbsRole } from '../role/AbsRole';\nimport { BulletInfo } from './BulletInfo';\nimport { FightRootControl } from '../../../FightRootControl';\nimport { AbsObjFactory } from '../AbsObjFactory';\nimport { PlayerControl } from '../role/role/PlayerControl';\nimport { Bullet } from './Bullet';\nimport { SkillTab } from '../../../power/powerTab/SkillTab';\nimport { tab } from '../../../../../Table/table_gen';\nimport { SearchEnemy } from '../../ai/SearchEnemy';\nimport { AbsStateType } from '../state/AbsState';\nimport { ColliderMgr } from '../../../../../framework/collision/ColliderMgr';\nimport { MathAngle } from '../../../../../framework/collision/Maths';\nimport { EffectControl } from '../../effect/EffectControl';\nimport { AbsObjInfoAttr } from '../AbsObjInfo';\nimport { AbsObjType } from '../AbsObj';\nimport { Random } from '../../../util/Random';\nimport { EventMgr } from '../../../../mgr/EventMgr';\nimport { FightEvent } from '../../../define/FightEvent';\nimport { BulletTab } from '../../../power/powerTab/BulletTab';\nimport { AbsOwner } from '../AbsOwner';\nimport { FightMacro } from '../../../define/FightDefine';\nimport { Func } from '../../../../utils/Func';\nimport { Buff } from '../../buff/Buff';\n\n\nconst { ccclass, property } = _decorator;\n\nexport enum BulletTargetType {\n    default = 0,\n    /** 角色 */\n    role = 1,\n    /** 位置 */\n    pos = 2,\n    /** 角度 */\n    angle = 3,\n    /** 归属 */\n    owner = 4,\n}\n\n\nconst tempPos = new Vec3(0, 0, 0);\nconst tempStartPos = new Vec3(0, 0, 0);\nconst tempTargetPos = new Vec3(0, 0, 0)\nconst bulletBaseTarget = new Vec3()\n@ccclass('BulletControl')\nexport class BulletControl extends AbsControl {\n    private static _instance: BulletControl;\n    public static get ins() {\n        if (null == this._instance) {\n            this._instance = new BulletControl();\n        }\n        return this._instance;\n    }\n\n    /** 组id,同组衰减用 */\n    groupId: number = 0\n\n    init(): void {\n        this.groupId = 0\n        bulletBaseTarget.x = tab.getData().GetKeyValue_ConfigTable().BulletBaseTarget[0]\n        bulletBaseTarget.y = tab.getData().GetKeyValue_ConfigTable().BulletBaseTarget[1]\n    }\n\n    /** 自增组id */\n    addSelfGroupId() {\n        this.groupId++\n        return this.groupId\n    }\n\n\n    /** 点击发射子弹 肯定是从自身发出*/\n    clickEmitBullet(bulletTab: BulletTab, attack: AbsRole, targetPos: Vec3, bulletGroupId: number = 0) {\n        if (bulletTab == null) {\n            console.warn(\"没有子弹id\")\n            return\n        }\n        if (bulletTab.EffectUnit == tab.EffectUnit.EffectUnit_Enemy) {\n            return this.emitBullet(bulletTab, AbsOwner.get(attack.objId), attack.getShotPos(), null, targetPos, bulletGroupId)\n        }\n        //友军、自己走自动逻辑\n        return this.audoEmitBullet(bulletTab, attack, bulletGroupId)\n    }\n\n    /** 自动发射子弹 */\n    audoEmitBullet(bulletTab: BulletTab, attack: AbsRole, bulletGroupId: number = 0) {\n        if (bulletTab == null) {\n            console.warn(\"没有子弹id\")\n            return\n        }\n        if (bulletTab.SearchEnemy == tab.SearchEnemy.SearchEnemy_None) {\n            return this.emitBullet(bulletTab, AbsOwner.get(attack.objId), attack.getShotPos(), null, null, bulletGroupId)\n\n        }\n        let enemy = SearchEnemy.getBySearchEnemy(attack.objId, attack.objType, attack.getShotPos(), bulletTab.EnemyUnit, bulletTab.SearchEnemy)\n        // if (enemy == null) {\n        //     console.log(\"子弹找不到目标\")\n        //     return\n        // }\n        return BulletControl.ins.emitBullet(bulletTab, AbsOwner.get(attack.objId), attack.getShotPos(), enemy, null)\n    }\n\n    /**\n     * 发射子弹\n     * @param bulletTab 子弹配置\n     * @param owner (归属)发射者\n     * @param startPos 开始位置\n     * @param targetPos 目标位置， 如果为null，则自动寻找目标\n     * @param bulletGroupId 子弹组id\n     * @param parentSoleId 父子弹唯一id\n     * \n     */\n    emitBullet(bulletTab: BulletTab, owner: AbsOwner, startPos: Vec3, targetRole: AbsRole, targetPos: Vec3, bulletGroupId: number = 0, parentSoleId: string = \"\", havaDamageObjIds: number[] = []): Vec3 {\n        if (bulletTab == null) {\n            console.warn(\"没有子弹id\")\n            return\n        }\n\n        tempStartPos.set(startPos)\n        if (bulletTab.Fission.length && bulletTab.Fission[0] == 2) {\n            if (bulletTab.SearchEnemy == tab.SearchEnemy.SearchEnemy_None) {\n                if (targetPos == null) {\n                    targetPos = tempTargetPos\n                    targetPos.set(Vec3.ZERO)\n                }\n                MathAngle.angleToDirection((bulletTab.Fission[1] / 2), targetPos)\n                targetPos.multiplyScalar(100).add(tempStartPos)\n            }\n        }\n\n        if (targetRole == null && targetPos == null) {\n            // console.log(\"没有找到目标，设置发射角度\")\n            targetPos = tempTargetPos\n            targetPos.set(bulletBaseTarget)\n        }\n\n\n        let targetType = BulletTargetType.default\n        if (targetRole) {\n            targetType = BulletTargetType.role\n            tempPos.set(targetRole.getHitPos())\n        } else {\n            targetType = BulletTargetType.pos\n            tempPos.set(targetPos)\n        }\n\n        if (bulletTab.Fission.length) {\n            let tmpGroupId = this.addSelfGroupId()\n            let tmpAngle = MathAngle.posToAngle(tempStartPos, tempPos)\n            let list = this.getFissionAngles(tmpAngle, bulletTab.Fission)\n\n            for (let index = 0; index < list.length; index++) {\n                const v = list[index];\n                this.checkForwardArrow(bulletTab, owner, tempStartPos, BulletTargetType.angle, v, bulletGroupId || tmpGroupId, parentSoleId, havaDamageObjIds)\n            }\n            return tempPos\n        } else {\n            this.checkForwardArrow(bulletTab, owner, tempStartPos, targetType, targetRole || targetPos, bulletGroupId, parentSoleId, havaDamageObjIds)\n            return tempPos\n        }\n    }\n\n    checkForwardArrow(bulletTab: BulletTab, owner: AbsOwner, startPos: Vec3, targetType: BulletTargetType, targetObj: AbsRole | Vec3 | number, bulletGroupId: number = 0, parentSoleId: string = \"\", havaDamageObjIds: number[] = []) {\n        let objAttr: any = { bulletGroupId: bulletGroupId, parentSoleId: parentSoleId }\n        if (bulletTab.ForwardArrow.length) {\n            let rate = bulletTab.ForwardArrow[3]\n\n            if (Random.isSuccess(rate)) {\n                objAttr.isForwardArrow = 1\n                let list = MathAngle.getForwardDirection(0, bulletTab.ForwardArrow[1], bulletTab.ForwardArrow[2])\n                for (let index = 0; index < list.length; index++) {\n                    objAttr.forwardArrowOffsetY = list[index]\n                    this.addBullet(bulletTab, owner, startPos, targetType, targetObj, objAttr, havaDamageObjIds)\n                }\n                return\n            }\n        }\n\n        this.addBullet(bulletTab, owner, startPos, targetType, targetObj, objAttr, havaDamageObjIds)\n    }\n\n    /**\n     * 添加子弹\n     * @param bulletTab 子弹配置\n     * @param attack 攻击者\n     * @param startPos 开始位置\n     * @param targetType 目标类型\n     * @param targetObj 目标\n     * @param bulletGroudId 子弹组id\n     */\n    addBullet(bulletTab: BulletTab, owner: AbsOwner, startPos: Vec3, targetType: BulletTargetType, targetObj: AbsRole | Vec3 | number, objAttr: any, havaDamageObjIds: number[] = []) {\n        let info = AbsObjFactory.getData(AbsObjType.bullet) as BulletInfo\n        info.setConfigTab(bulletTab)\n        info.init()\n        info.parentSoleId = objAttr.parentSoleId || \"\"\n        for (const key in objAttr) {\n            if (typeof objAttr[key] == \"number\") {\n                info.setObjAttr(key as AbsObjInfoAttr, objAttr[key])\n            }\n        }\n        if (info.configTab == null) {\n            console.error(\"创建子弹错误\", info)\n            return\n        }\n\n\n        let bulletParent = FightRootControl.ins.getBulletNode(FightMacro.isEffectShowBelow(bulletTab.getValidAnimId()))\n        if (info.configTab.isLaunchMask()) {\n            let maskNode = new Node(\"BulletLaunchMask\")\n            let uiComp = maskNode.addComponent(UITransform)\n            uiComp.anchorX = 0\n            uiComp.height = 300\n            uiComp.width = view.getVisibleSize().width\n            maskNode.addComponent(Mask)\n\n            maskNode.parent = bulletParent\n            bulletParent = maskNode\n        }\n        let bullet = AbsObjFactory.getBullet(info, bulletParent)\n        bullet.setStartPos(startPos)\n        bullet.setAbsOnwer(owner)\n        bullet.setTargetType(targetType, targetObj)\n        bullet.addhavaDamageObjIds(havaDamageObjIds)\n        if (bullet.info.isolnyOneSon()) {\n            bullet.info.sonGroupId = this.addSelfGroupId()\n        }\n        bullet.run()\n    }\n\n    /** 弹射 */\n    addCatapult(bullet: Bullet, defanseAbs: AbsRole) {\n        let ignores = this.getEnemyFiltrate(bullet, bullet.info.configTab.EnemyFiltrate)\n        let enemy = SearchEnemy.getBySearchEnemy(bullet.owner.objId, bullet.owner.objType, bullet.getTruePosition(), bullet.info.configTab.EnemyUnit, bullet.info.configTab.SearchEnemy, ignores)\n        if (enemy == null && bullet.info.configTab.EnemyFiltrate == tab.EnemyFiltrate.EnemyFiltrate_NoSelectSame) { //找不到目标时， 忽略上一目标后重新查找\n            ignores = this.getEnemyFiltrate(bullet, tab.EnemyFiltrate.EnemyFiltrate_CanSelectlast)\n            enemy = SearchEnemy.getBySearchEnemy(bullet.owner.objId, bullet.owner.objType, bullet.getTruePosition(), bullet.info.configTab.EnemyUnit, bullet.info.configTab.SearchEnemy, ignores)\n        }\n        if (enemy) {\n            ColliderMgr.inst.removeTrigger(bullet, enemy)\n            bullet.setStartPos(bullet.getTruePosition())\n            bullet.setTargetType(BulletTargetType.pos, enemy.getHitPos())\n            bullet.targetDirection()\n        }\n    }\n\n    /** 子弹死亡触发 */\n    checkDeathTrigger(bullet: Bullet) {\n        if (bullet.isDead || bullet.OutOfScreen) {\n            return\n        }\n        if (bullet.info.configTab.DeathTrigger.length > 0) {\n            for (let index = 0; index < bullet.info.configTab.DeathTrigger.length; index++) {\n                let bulletTab = bullet.info.configTab.DeathTriggerTabs[index]\n                this.bulletCreateBullet(bullet, bulletTab)\n            }\n        }\n    }\n\n    /** 子弹命中触发 */\n    checkHitTrigger(bullet: Bullet) {\n        bullet.addHitCount()\n        if (bullet.info.configTab.isHitTriggerBullet()) {\n            let check = false\n            if (bullet.info.configTab.HitTrigger[2] == -1) {\n                check = true\n            } else if (bullet.info.configTab.HitTrigger[2] == bullet.hitCount) {\n                check = true\n            }\n\n            if (!check) {\n                return\n            }\n            if (!Random.isSuccess(bullet.info.configTab.HitChance)) {\n                return\n            }\n            this.bulletCreateBullet(bullet, bullet.info.configTab.hitTriggerTab)\n\n        } else if (bullet.info.configTab.isHitTriggerSpeed() && bullet.hitCount == 1) {\n            bullet.speed += bullet.info.configTab.HitTrigger[1]\n            bullet.setVelocityAngle(bullet.voAngle)\n        }\n    }\n    /** 间隔触发 */\n    intervalTrigger(bullet: Bullet) {\n        bullet.info.isInitInterval = false\n        this.bulletCreateBullet(bullet, bullet.info.configTab.intervalEffectBulletTab)\n    }\n\n    bulletCreateBullet(bullet: Bullet, bulletTab: BulletTab) {\n        let owner = AbsOwner.get(bullet.owner.objId)\n\n        if (bullet.owner.isLock) {\n            owner.setOwner(bullet.owner)\n        }\n\n        let parentSoleId = bullet.info.configTab.NoHarm ? bullet.bulletSoleId : \"\"\n        if (parentSoleId != \"\") {\n            if (bullet.endDamegeObj) {\n                (bullet.endDamegeObj as AbsRole).addParentSoleId(parentSoleId)\n            }\n        }\n        let havaDamageObjIds = []\n        if (bullet.info.configTab.NoHarm) {\n            havaDamageObjIds = bullet.havaDamageObjIds\n        }\n\n        let tmpGroupId = bullet.info.sonGroupId\n\n        let startPos = new Vec3()\n        switch (bulletTab.BulletBorn) {\n            // case tab.BulletBorn.BulletBorn_Me:\n            //     startPos.set(bullet.ownerRole.getHitPos())\n            //     break\n            case tab.BulletBorn.BulletBorn_She:\n                startPos.set(bullet.getTruePosition())\n                break\n            case tab.BulletBorn.BulletBorn_Inherit:\n                startPos.set(bullet.getTruePosition())\n                break\n        }\n\n        let SearchEnemy_None = () => { //无目标， 就按照父子弹角度发射\n            let target = tempTargetPos\n            target.set(Vec3.ZERO)\n            target.add(startPos)\n            if (bulletTab.Trajectory != tab.Trajectory.Trajectory_Trackless) {\n                target.add(bullet.velocity)\n            }\n\n            BulletControl.ins.emitBullet(bulletTab, owner, startPos, null, target, tmpGroupId, parentSoleId, havaDamageObjIds)\n        }\n\n        if (bulletTab.SearchEnemy == tab.SearchEnemy.SearchEnemy_None) { //无寻敌目标\n            SearchEnemy_None()\n            return\n        }\n        let ignores = this.getEnemyFiltrate(bullet, bullet.info.configTab.EnemyFiltrate)\n        let enemy = SearchEnemy.getBySearchEnemy(owner.objId, bullet.owner.objType, startPos, bulletTab.EnemyUnit, bulletTab.SearchEnemy, ignores)\n        if (enemy == null) {\n            SearchEnemy_None()\n            return\n        }\n        BulletControl.ins.emitBullet(bulletTab, owner, startPos, enemy, null, tmpGroupId, parentSoleId, havaDamageObjIds)\n        if (enemy && bullet.info.configTab.EnemyFiltrate == tab.EnemyFiltrate.EnemyFiltrate_NoSelectSame) { //子系不选同目标，把id放在父子弹内\n            bullet.havaDamageObjIds.push(enemy.objId)\n        }\n    }\n\n    getEnemyFiltrate(bullet: Bullet, enemyFiltrate: tab.EnemyFiltrate) {\n        switch (enemyFiltrate) {\n            case tab.EnemyFiltrate.EnemyFiltrate_CanSelectlast:// 可选上一个目标 \n                return bullet.havaDamageObjIds.slice(-1)\n            case tab.EnemyFiltrate.EnemyFiltrate_Ignorelast: // 忽略上一个目标 \n                return bullet.havaDamageObjIds.slice(-2)\n            case tab.EnemyFiltrate.EnemyFiltrate_NoSelectSame:// 忽略已攻击目标 \n                return bullet.havaDamageObjIds\n            case tab.EnemyFiltrate.EnemyFiltrate_NoSelectSame:// 忽略已攻击目标 \n                return bullet.havaDamageObjIds\n        }\n        return []\n    }\n\n\n    /** 子弹分裂角度 */\n    getFissionAngles(baseAngle: number, fissions: number[]) {\n        if (fissions[0] == 1) {\n            return MathAngle.getAverageEmitAnglesAngle(baseAngle, fissions[1], fissions[2])\n        } else if (fissions[0] == 2) {\n            return MathAngle.getAverageEmitAnglesAngle1(baseAngle, fissions[1], fissions[2])\n        } else if (fissions[0] == 3) {\n            return MathAngle.getAverageEmitAnglesAngle2(baseAngle, fissions[1], fissions[2])\n        }\n        return []\n    }\n\n    /** 子弹击中特效 */\n    checkHitEffect(bullet: Bullet, defanseAbs: AbsRole) {\n        if (bullet.info.configTab.HitEffect.length) {\n            EventMgr.emitFight(FightEvent.Hit_Effect_Add, bullet.info.configTab.HitEffect, bullet.startPos, defanseAbs.getHitPos())\n        }\n    }\n\n}\n\n"]}