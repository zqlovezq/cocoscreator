{"version":3,"sources":["file:///C:/chickenStarClient/client/assets/scripts/logic/fight/view/test/FightTestAttr.ts"],"names":["_decorator","instantiate","js","Label","Node","v3","ViewPop","UIMgr","FightRoleTeam","tab","LangMgr","PlayerControl","FightData","ccclass","property","FightTestAttr","create","ins","pause","show","viewName","hide","hideView","register","onShow","fightTeam","refresh","inTest","element","items","index","nn","node","on","EventType","TOUCH_START","showInfo","info","length","globleAttr","GlobleNode","AttrType","AttrType_InitialScroll","AttrType_AddScroll","AttrType_RefreshCount","onCloseClick","nameLab","string","attrNode","destroyAllChildren","role","getRole","itemId","itemTab","getData","ItemTableById","getValue","getLab","Name","attrList","attrData","hp","maxHp","shield","iterator","attr","push","attrLab","active","position","toString","addChild","console","log","formatStr","getComponent","triggerNode","skillGroupNode","skillGroups","normalGroup","weaponeGroup","v","skillGroupItem","getChildByName","Id","nn1","skillLayoutItem","createSkill","skills","takeSkillNode","takeSkills","layout","skillItem","addtTrigger","skill","triggerTabs","attrs","key","value","getRoleAttr","roles","forEach","getAttr"],"mappings":"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","sourcesContent":["import { _decorator, Component, director, EditBox, EventTouch, game, instantiate, js, Label, Layers, Node, Size, Sprite, SpriteFrame, Toggle, Tween, tween, UIOpacity, UITransform, v2, v3, Vec3, view } from 'cc';\nimport { ViewPop } from '../../../../framework/base/ViewPop';\nimport { FightRootControl, FightState } from '../../FightRootControl';\nimport { UIMgr } from '../../../mgr/UIMgr';\nimport { FightRoleTeam } from '../common/FightRoleTeam';\nimport { HeroFightInfo } from '../../data/HeroFightInfo';\nimport { tab } from '../../../../Table/table_gen';\nimport { LangMgr } from '../../../mgr/LangMgr';\nimport { PlayerControl } from '../../base/obj/role/role/PlayerControl';\nimport { FightData } from '../../data/FightData';\nimport { SkillTab } from '../../power/powerTab/SkillTab';\n\nconst { ccclass, property } = _decorator;\n\n@ccclass('FightTestAttr')\nexport class FightTestAttr extends ViewPop {\n    static async create() {\n        FightData.ins.pause = true\n        await UIMgr.ins.show({ viewName: \"FightTestAttr\" })\n    }\n\n    static hide() {\n        FightData.ins.pause = false\n        UIMgr.ins.hideView(\"FightTestAttr\")\n    }\n\n\n    @property(FightRoleTeam)\n    fightTeam: FightRoleTeam = null\n    @property(Label)\n    nameLab: Label = null\n\n    @property(Node)\n    attrNode: Node = null\n\n    @property(Node)\n    skillGroupNode: Node = null\n\n    @property(Node)\n    skillGroupItem: Node = null\n\n    @property(Node)\n    skillLayoutItem: Node = null\n\n    @property(Node)\n    skillItem: Node = null\n\n    @property(Node)\n    takeSkillNode: Node = null\n\n    @property(Node)\n    triggerNode: Node = null\n    @property(Node)\n    GlobleNode: Node = null\n\n\n\n    @property(Node)\n    attrLab: Node = null\n\n    register(): void {\n\n    }\n\n    onShow(): void {\n        this.fightTeam.refresh()\n\n        let inTest = true\n        for (let index = 0; index < this.fightTeam.items.length; index++) {\n            const element = this.fightTeam.items[index];\n            let nn = element.node\n            nn.on(Node.EventType.TOUCH_START, () => {\n                this.showInfo(element.info)\n            })\n            if (element.info && inTest) {\n                inTest = false\n                this.showInfo(element.info)\n            }\n        }\n        this.globleAttr(this.GlobleNode, [tab.AttrType.AttrType_InitialScroll, tab.AttrType.AttrType_AddScroll, tab.AttrType.AttrType_RefreshCount])\n    }\n\n    onCloseClick() {\n        FightTestAttr.hide()\n    }\n\n    showInfo(info: HeroFightInfo) {\n        this.nameLab.string = \"\"\n        this.attrNode.destroyAllChildren()\n        if (info == null) {\n            return\n        }\n\n        let role = PlayerControl.ins.getRole(info.itemId)\n        if (role == null) {\n            return\n        }\n        let itemTab = tab.getData().ItemTableById.getValue(info.itemId)\n        this.nameLab.string = LangMgr.getLab(itemTab.Name)\n\n        let attrList = [\n            [\"当前血量\", role.info.attrData.hp],\n            [\"最大血量\", role.info.attrData.maxHp],\n            [\"当前护盾\", role.info.attrData.shield],\n        ]\n        for (const iterator of role.info.attrData.attr) {\n            attrList.push([tab.AttrType[iterator[0]], iterator[1]])\n        }\n\n        for (let index = 0; index < attrList.length; index++) {\n            const iterator = attrList[index];\n            let nn = instantiate(this.attrLab)\n            nn.active = true\n            nn.position = v3(150-  ((7-iterator[1].toString().length)*15),0,0)\n            this.attrNode.addChild(nn)\n            console.log(iterator[0], js.formatStr(\"%s：%s\", iterator[0], iterator[1]))\n\n\n            nn.getComponent(Label).string = js.formatStr(\"%s %s：%s \", iterator[0], tab.AttrType[iterator[0]] || 0, iterator[1])\n        }\n\n        this.triggerNode.destroyAllChildren()\n\n        this.skillGroupNode.destroyAllChildren()\n        let skillGroups = [role.info.normalGroup, role.info.weaponeGroup]\n        for (let index = 0; index < skillGroups.length; index++) {\n            const v = skillGroups[index];\n            if (v == null) {\n                continue\n            }\n            let nn = instantiate(this.skillGroupItem)\n            nn.active = true\n            nn.position = v3()\n            this.skillGroupNode.addChild(nn)\n            nn.getChildByName(\"Label\").getComponent(Label).string = \"技能组ID:\" + v.Id\n\n            let nn1 = instantiate(this.skillLayoutItem)\n            nn1.active = true\n            nn1.position = v3()\n            nn.getChildByName(\"skillLayoutItem\").addChild(nn1)\n            this.createSkill(nn1, v.skills)\n        }\n\n        //携带的技能\n        this.createSkill(this.takeSkillNode, role.info.takeSkills)\n\n      \n    }\n\n    createSkill(layout: Node, skills: SkillTab[]) {\n        layout.destroyAllChildren()\n        for (let index = 0; index < skills.length; index++) {\n            const v = skills[index];\n            let nn = instantiate(this.skillItem)\n            nn.active = true\n            nn.position = v3()\n            layout.addChild(nn)\n            nn.getChildByName(\"Label\").getComponent(Label).string = \"ID:\" + v.Id\n            this.addtTrigger(v)\n        }\n    }\n\n    addtTrigger(skill:SkillTab){\n        for (let index = 0; index < skill.triggerTabs.length; index++) {\n            const v = skill.triggerTabs[index];\n            let nn = instantiate(this.skillItem)\n            nn.active = true\n            nn.position = v3()\n            this.triggerNode.addChild(nn)\n            nn.getChildByName(\"Label\").getComponent(Label).string = \"ID:\" + v.Id\n        }\n    }\n\n    globleAttr(layout: Node, attrs: tab.AttrType[]) {\n        layout.destroyAllChildren()\n        for (let index = 0; index < attrs.length; index++) {\n\n            let nn = instantiate(this.skillItem)\n            nn.active = true\n            nn.position = v3()\n            layout.addChild(nn)\n\n            let key = attrs[index]\n            let value = this.getRoleAttr(key)\n            nn.getChildByName(\"Label\").getComponent(Label).string = js.formatStr(\"%s：%s\", LangMgr.getLab(tab.AttrType[key]), value)\n\n            // console.log(js.formatStr(\"%s：%s\", iterator[0], iterator[1]))\n        }\n    }\n\n    getRoleAttr(attr: tab.AttrType) {\n        let value = 0\n        PlayerControl.ins.roles.forEach((role) => {\n            value += role.info.attrData.getAttr(attr)\n        })\n        return value\n    }\n}\n"]}