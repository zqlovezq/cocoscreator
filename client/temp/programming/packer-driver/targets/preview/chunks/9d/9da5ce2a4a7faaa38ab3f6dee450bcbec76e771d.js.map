{"version":3,"sources":["file:///C:/chickenStarClient/client/assets/scripts/logic/model/association/AssociationApplyListPop.ts"],"names":["_decorator","instantiate","Label","Node","Prefab","Toggle","ViewPop","AssociationControl","EventMgr","proto","InfiniteList","AssociationApplyListItem","SettingsManager","AssociationData","ccclass","property","AssociationApplyListPop","_list","_clickToggle","onShow","reqGetJoinGuildRequests","toggle_auto_enter","isChecked","ins","getSetting","memberInfo","getGuildMembersCount","lbl_members_count","string","String","memberCount","lbl_total_count","totalCount","register","onMsg","Ptl","GetJoinGuildRequestsRsp","on_s2c_GetJoinGuildRequestsRsp","ProcessGuildApplyRsp","on_s2c_ProcessGuildApplyRsp","RejectAllGuildApplyRsp","on_s2c_RejectAllGuildApplyRsp","unRegister","onDestroy","msg","error","code","CommonErrorCode","Succeed","initList","requests","isRefresh","node_no_body","active","length","list_view","node","Refresh","Init","getCellNumber","getCellCount","bind","getCellSize","getCellHeight","getCellIdentifer","getCellView","getCellData","GetCellData","idx","identifer","cell","pfb_item","getComponent","onClickEnter","onClickAllReject","reqRejectAllGuildApply","onClickAutoEnterToggle","reqSetGuildNeedCheck"],"mappings":"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","sourcesContent":["import { _decorator, Component, instantiate, Label, Node, Prefab, Toggle } from 'cc';\r\nimport { ViewPop } from '../../../framework/base/ViewPop';\r\nimport { AssociationControl } from './AssociationControl';\r\nimport { EventMgr } from '../../mgr/EventMgr';\r\nimport { proto } from 'client_protocol';\r\nimport InfiniteList from '../../../Common/InfiniteList/InfiniteList';\r\nimport { AssociationApplyListItem } from './AssociationApplyListItem';\r\nimport { SettingsManager } from '../role/SettingsManager';\r\nimport { tab } from '../../../Table/table_gen';\r\nimport { AssociationData } from './AssociationData';\r\nconst { ccclass, property } = _decorator;\r\n\r\n@ccclass('AssociationApplyListPop')\r\nexport class AssociationApplyListPop extends ViewPop {\r\n    @property(InfiniteList)\r\n    list_view: InfiniteList = null;\r\n    @property(Prefab)\r\n    pfb_item: Prefab = null;\r\n    @property(Toggle)\r\n    toggle_auto_enter: Toggle = null;//自动审批加入按钮\r\n    @property(Label)\r\n    lbl_members_count: Label = null;\r\n    @property(Label)\r\n    lbl_total_count: Label = null;\r\n    @property(Node)\r\n    node_no_body: Node = null;\r\n    private _list: proto.IJoinGuildRequest[] = []\r\n    private _clickToggle: boolean = false\r\n    onShow(): void {\r\n        this._clickToggle = false\r\n        this.reqGetJoinGuildRequests();\r\n        this.toggle_auto_enter.isChecked = !SettingsManager.ins.getSetting(\"needCheckAssociation\");\r\n        const memberInfo = AssociationData.ins.getGuildMembersCount();\r\n        this.lbl_members_count.string = String(memberInfo.memberCount)\r\n        this.lbl_total_count.string = String(memberInfo.totalCount);\r\n    }\r\n    register(): void {\r\n        EventMgr.onMsg(proto.Ptl.GetJoinGuildRequestsRsp, this.on_s2c_GetJoinGuildRequestsRsp, this);\r\n        EventMgr.onMsg(proto.Ptl.ProcessGuildApplyRsp, this.on_s2c_ProcessGuildApplyRsp, this);\r\n        /* 全部拒绝申请 */\r\n        EventMgr.onMsg(proto.Ptl.RejectAllGuildApplyRsp, this.on_s2c_RejectAllGuildApplyRsp, this);\r\n    }\r\n    unRegister(): void {\r\n        super.unRegister();\r\n    }\r\n    protected onDestroy(): void {\r\n        super.onDestroy()\r\n    }\r\n    reqGetJoinGuildRequests() {\r\n        AssociationControl.ins.reqGetJoinGuildRequests(0);\r\n    }\r\n    on_s2c_RejectAllGuildApplyRsp(msg: proto.Msg_RejectAllGuildApplyRsp) {\r\n        if (msg.error && msg.error.code != proto.CommonErrorCode.Succeed) return;\r\n        this._list = [];\r\n        this.initList();\r\n    }\r\n    on_s2c_GetJoinGuildRequestsRsp(msg: proto.Msg_GetJoinGuildRequestsRsp) {\r\n        this._list = msg.requests\r\n        this.initList();\r\n    }\r\n    initList(isRefresh?: boolean) {\r\n        this.node_no_body.active = this._list.length === 0\r\n        this.list_view.node.active = this._list.length > 0\r\n        if (isRefresh) {\r\n            this.list_view.Refresh();\r\n        } else {\r\n            this.list_view.Init({\r\n                getCellNumber: this.getCellCount.bind(this),\r\n                getCellSize: this.getCellHeight.bind(this),\r\n                getCellIdentifer: this.getCellIdentifer.bind(this),\r\n                getCellView: this.getCellView.bind(this),\r\n                getCellData: this.GetCellData.bind(this),\r\n            });\r\n        }\r\n    }\r\n    getCellCount() {\r\n        return this._list.length\r\n    }\r\n    getCellHeight(idx: number) {\r\n        return 100\r\n    }\r\n    getCellIdentifer(idx: number) {\r\n        return \"AssociationApplyItem\";\r\n    }\r\n    getCellView(idx: number, identifer: string) {\r\n        let cell = instantiate(this.pfb_item).getComponent(AssociationApplyListItem);\r\n        return cell;\r\n    }\r\n    GetCellData(idx: number) {\r\n        return this._list[idx];\r\n    }\r\n    onClickEnter() {\r\n        this._clickToggle = true;\r\n    }\r\n    onClickAllReject() {\r\n        if (this._list.length > 0) {\r\n            AssociationControl.ins.reqRejectAllGuildApply();\r\n        }\r\n    }\r\n    onClickAutoEnterToggle() {\r\n        if (this._clickToggle) {\r\n            this._clickToggle = false;\r\n            AssociationControl.ins.reqSetGuildNeedCheck(!this.toggle_auto_enter.isChecked);\r\n        }\r\n    }\r\n    on_s2c_ProcessGuildApplyRsp(msg: proto.Msg_ProcessGuildApplyRsp) {\r\n        if (msg.error && msg.error.code != proto.CommonErrorCode.Succeed) return;\r\n        this.reqGetJoinGuildRequests();\r\n    }\r\n}\r\n\r\n\r\n"]}