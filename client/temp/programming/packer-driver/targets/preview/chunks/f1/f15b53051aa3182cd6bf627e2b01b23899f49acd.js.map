{"version":3,"sources":["file:///C:/chickenStarClient/client/assets/scripts/logic/model/hero/herobag/HeroDetailEquipItem.ts"],"names":["_decorator","Color","Component","instantiate","Label","Node","Prefab","HeroAttrItem","EquipData","tab","UIMgr","ViewName","EquipControl","HeroEquipSlotItem","LangMgr","RedMgr","RedDotType","RoleData","ccclass","property","HeroDetailEquipItem","equipAttrItems","heroClass","currContainerInfo","onLoad","start","initView","isTeam","inteamNode","active","notinteamNode","ins","getEquipContainerDataByHeroClass","initEquipItem","updateAttrs","updateMaster","node_equip_red","isRed","Wear_Equip","String","datas","getWearEquipInfosByHeroClass","i","equipItems","length","initData","key","node","conts","totalMaps","totalAttrMap","index","forEach","value","table","getData","HeroAttrClientTableByType","getValue","IsBase","attrItemPrefab","parent","equipAttrNode","push","getComponent","Icon","qLv","masteInfo","qualityMasterLevel","eLv","enhanceMasterLevel","rLv","refineMasterLevel","initMasterItem","level","item","masterNodes","nameLab","getChildByName","lvLab","lock_txt","string","getCombineString","color","onClickOneWear","isEquipGuide","Boolean","clientData","equipGuildOver","setClientData","reqOnekeyEquips","onClickStrengthen","show","viewName","EquipmentView","data","onClickMaster","EquipMasterPop","onClickAttrTip","HeroAttrPop"],"mappings":"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","sourcesContent":["import { _decorator, Color, Component, instantiate, Label, Node, Prefab } from 'cc';\r\nimport { HeroItem } from '../../item/HeroItem';\r\nimport { HeroAttrItem } from './HeroAttrItem';\r\nimport { EquipData } from '../../equip/EquipData';\r\nimport { ItemPoolMgr } from '../../item/ItemPoolMgr';\r\nimport { tab } from '../../../../Table/table_gen';\r\nimport { ShowTips, UIMgr } from '../../../mgr/UIMgr';\r\nimport { ViewName } from '../../../define/ViewDefine';\r\nimport { EquipContainerInfo } from '../../equip/EquipContainerInfo';\r\nimport { EquipControl } from '../../equip/EquipControl';\r\nimport { EquipSlotInfo } from '../../equip/EquipSlotInfo';\r\nimport { HeroEquipSlotItem } from './HeroEquipSlotItem';\r\nimport { LangMgr } from '../../../mgr/LangMgr';\r\nimport { RedMgr } from '../../../mgr/RedMgr';\r\nimport { RedDotType } from '../../../red/RedDotType';\r\nimport { RoleData } from '../../role/RoleData';\r\nconst { ccclass, property } = _decorator;\r\n\r\n@ccclass('HeroDetailEquipItem')\r\nexport class HeroDetailEquipItem extends Component {\r\n    @property(Node)\r\n    inteamNode: Node = null;\r\n    @property(Node)\r\n    notinteamNode: Node = null;\r\n    @property(Node)\r\n    equipNode: Node = null;\r\n    @property(Node)\r\n    specialEquipNode = null;\r\n    @property(Node)\r\n    equipAttrNode: Node = null;\r\n   \r\n    @property(Prefab)\r\n    attrItemPrefab:Prefab=null;\r\n    @property(Node)\r\n    node_equip_red:Node = null;\r\n\r\n    @property([HeroEquipSlotItem])\r\n    public equipItems:Array<HeroEquipSlotItem>=[];\r\n\r\n    @property([Node])\r\n    masterNodes:Array<Node>=[];\r\n    // public specialEquipItems:Array<HeroItem>;\r\n    private equipAttrItems:Array<HeroAttrItem>;\r\n    private heroClass:number;\r\n    private currContainerInfo:EquipContainerInfo;\r\n\r\n    onLoad(): void {\r\n    \r\n        this.equipAttrItems=[];\r\n\r\n    }\r\n    start() {\r\n\r\n    }\r\n\r\n    initView(heroClass:number,isTeam:boolean){\r\n        this.heroClass=heroClass;\r\n        if(isTeam){\r\n            this.inteamNode.active=true;\r\n            this.notinteamNode.active=false;\r\n            this.currContainerInfo=EquipData.ins.getEquipContainerDataByHeroClass(this.heroClass);\r\n            this.initEquipItem();\r\n            this.updateAttrs();\r\n            this.updateMaster();\r\n            this.node_equip_red.active = RedMgr.ins.isRed(RedDotType.Wear_Equip, String(this.heroClass));\r\n        }else{\r\n            this.inteamNode.active=false;\r\n            this.notinteamNode.active=true;\r\n        }\r\n\r\n    }\r\n    private initEquipItem(){\r\n        let datas=EquipData.ins.getWearEquipInfosByHeroClass(this.heroClass);\r\n        // EquipType_Gloves = 1, // 手套 \r\n\t\t// EquipType_Clothing = 2, // 衣服 \r\n\t\t// EquipType_Cloak = 3, // 披风 \r\n\t\t// EquipType_Hat = 4, // 帽子 \r\n        // let types=[tab.EquipType.EquipType_Gloves,tab.EquipType.EquipType_Clothing,tab.EquipType.EquipType_Cloak,tab.EquipType.EquipType_Hat]\r\n        // for(let key in types){\r\n        //     let data=datas[types[key]];\r\n        //     if(!this.equipItems[key]){\r\n        //         let node=ItemPoolMgr.ins.createHeroOrEquip(data);\r\n        //         node.parent=this.equipNode;\r\n        //         this.equipItems.push(node.getComponent(HeroItem));\r\n        //     }\r\n        //     this.equipItems[key].UpdateContent(data);\r\n        // }\r\n      \r\n        for(let i:number=0;i<this.equipItems.length;i++ ){\r\n            this.equipItems[i].initData(this.heroClass,i+1,datas[i+1])\r\n        }\r\n        \r\n    }\r\n    updateAttrs(){\r\n        for(let key in this.equipAttrItems){\r\n            this.equipAttrItems[key].node.active=false;\r\n        }\r\n        let conts=this.currContainerInfo;\r\n       \r\n        let totalMaps=conts.totalAttrMap;\r\n        let index=0;\r\n        totalMaps.forEach((value,key)=>{\r\n            let table=tab.getData().HeroAttrClientTableByType.getValue(key);\r\n            if(table&&table.IsBase){\r\n                if(!this.equipAttrItems[index]){\r\n                    let node=instantiate(this.attrItemPrefab);\r\n                    node.parent=this.equipAttrNode;\r\n                    this.equipAttrItems.push(node.getComponent(HeroAttrItem));\r\n                }\r\n                this.equipAttrItems[index].node.active=true;\r\n                this.equipAttrItems[index].initView(key,value,table.Icon);\r\n                index++;\r\n            }\r\n           \r\n        })\r\n        \r\n    }\r\n    updateMaster(){\r\n\r\n        let qLv=this.currContainerInfo.masteInfo.qualityMasterLevel;\r\n        let eLv=this.currContainerInfo.masteInfo.enhanceMasterLevel;\r\n        let rLv=this.currContainerInfo.masteInfo.refineMasterLevel;\r\n        this.initMasterItem(0,qLv);\r\n        this.initMasterItem(1,eLv);\r\n        this.initMasterItem(2,rLv);\r\n        // if(qLv>0){\r\n        //     this.qualityMasterLvLab.string=qLv+\"\";\r\n        // }else{\r\n        //     this.qualityMasterLvLab.string=\"未激活\";\r\n        // }\r\n        // if(eLv>0){\r\n        //     this.strengthenMasterLvLab.string=eLv+\"\";\r\n        // }else{\r\n        //     this.strengthenMasterLvLab.string=\"未激活\";\r\n        // }\r\n        // if(rLv>0){\r\n        //     this.forgeMasterLvLab.string=rLv+\"\";\r\n        // }else{\r\n        //     this.forgeMasterLvLab.string=\"未激活\";\r\n        // }\r\n    }\r\n\r\n    private initMasterItem(index:number,level:number){\r\n        let item=this.masterNodes[index];\r\n        let nameLab=item.getChildByName(\"txt\").getComponent(Label);\r\n        let lvLab=item.getChildByName(\"lv_txt\").getComponent(Label);\r\n        let lock_txt=item.getChildByName(\"lock_txt\");\r\n        if(level>0){\r\n            lvLab.node.active=true;\r\n            lvLab.string=LangMgr.getCombineString(\"ui_heroresonancepop_3\",[level]);\r\n            nameLab.color= new Color(255, 255, 255, 255)\r\n            // lvLab.color= new Color(3, 226, 242, 255)\r\n            lock_txt.active=false;\r\n        }else{\r\n            lvLab.node.active=false;\r\n            lock_txt.active=true;\r\n            nameLab.color= new Color(133, 147, 189, 255)\r\n            // lvLab.color= new Color(255, 255, 255, 255)\r\n        }\r\n    }\r\n    onClickOneWear() {\r\n        const isEquipGuide = Boolean(RoleData.ins.clientData.equipGuildOver);\r\n        if(!isEquipGuide){\r\n            RoleData.ins.setClientData(\"equipGuildOver\",\"true\");\r\n        }\r\n        EquipControl.ins.reqOnekeyEquips(this.heroClass);\r\n        \r\n    }\r\n    onClickStrengthen() {\r\n        UIMgr.ins.show({viewName:ViewName.EquipmentView,data:{\"type\":1,\"heroClass\":this.heroClass}});\r\n    }\r\n    onClickMaster(){\r\n        UIMgr.ins.show({ viewName: ViewName.EquipMasterPop,data:{\"heroClass\":this.heroClass,\"type\":1} });\r\n    }\r\n    onClickAttrTip(){\r\n        UIMgr.ins.show({ viewName: ViewName.HeroAttrPop,data:{\"attrMap\":this.currContainerInfo.totalAttrMap}});\r\n    }\r\n\r\n\r\n}\r\n\r\n\r\n"]}