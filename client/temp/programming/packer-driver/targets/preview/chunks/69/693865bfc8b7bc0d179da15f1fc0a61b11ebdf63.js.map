{"version":3,"sources":["file:///C:/chickenStarClient/client/assets/scripts/logic/fight/base/buff/BuffUI.ts"],"names":["_decorator","Component","Layers","Node","Vec3","view","Avatar","tab","FightMacro","ccclass","property","tempPos","BuffUI","abs","buffId","avatar","totalCount","offsetXY","get","buffUI","poolUIs","pop","nn","layer","Enum","DEFAULT","addComponent","set","ONE","node","scale","equals","ZERO","x","getVisibleSize","width","y","height","put","removeFromParent","reset","push","destory","i","length","destroy","recycle","active","setBuff","setBuffId","isMonster","z","info","configTab","BuffVFX","PERCENT","BuffLocation","getHitPos","subtract","getPosition","posFollow","setPvpBuff","create","addChild","setAnimationId","getData","BuffTableById","getValue","VFXID","subCount","addCount","update","dt","isValid","setOpaticy","isDead","isActive","parent","position","add"],"mappings":"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","sourcesContent":["import { _decorator, Component, Layers, Node, Prefab, Vec3, view } from \"cc\";\nimport { AbsRole } from \"../obj/role/AbsRole\";\nimport { Buff } from \"./Buff\";\nimport { Avatar } from \"../../animation/Avatar\";\nimport { tab } from \"../../../../Table/table_gen\";\nimport { FightMacro } from \"../../define/FightDefine\";\nimport { PvpRole } from \"../../pvp/obj/PvpRole\";\n\nconst { ccclass, property } = _decorator;\nconst tempPos = new Vec3(0, 0, 0)\n\n@ccclass('BuffUI')\nexport class BuffUI extends Component {\n    private static poolUIs: BuffUI[] = []\n\n    static get() {\n        let buffUI = BuffUI.poolUIs.pop()\n        if (buffUI == null) {\n            let nn = new Node(\"BuffUI\");\n            nn.layer = Layers.Enum.DEFAULT\n            buffUI = nn.addComponent(BuffUI)\n        }\n        tempPos.set(Vec3.ONE)\n        buffUI.node.scale = tempPos\n        if (tempPos.equals(Vec3.ZERO)) {\n            tempPos.x = view.getVisibleSize().width\n            tempPos.y = view.getVisibleSize().height\n        }\n        return buffUI\n    }\n\n    static put(buffUI: BuffUI) {\n        buffUI.node.removeFromParent()\n        buffUI.reset()\n        BuffUI.poolUIs.push(buffUI)\n    }\n    /** 销毁 */\n    static destory() {\n        for (let i = 0; i < BuffUI.poolUIs.length; i++) {\n            BuffUI.poolUIs[i].node.destroy()\n        }\n        BuffUI.poolUIs.length = 0\n    }\n\n    abs: AbsRole | PvpRole\n    buffId: number\n    avatar: Avatar\n    /** buff数量 */\n    totalCount: number = 0\n\n    offsetXY = new Vec3(0, 0, 0)\n    recycle() {\n        BuffUI.put(this)\n    }\n    reset() {\n        if (this.avatar) {\n            this.avatar.recycle()\n        }\n\n        this.avatar = null\n        this.abs = null\n        this.node.active = false\n    }\n\n    setBuff(buffId: number, abs: AbsRole) {\n        this.abs = abs\n        this.setBuffId(buffId)\n        if (abs.isMonster()) {\n            tempPos.z = 1\n            tempPos.x = tempPos.y = (abs.info.configTab.BuffVFX || FightMacro.PERCENT) / FightMacro.PERCENT\n            this.node.scale = tempPos\n\n            this.offsetXY.x = abs.info.configTab.BuffLocation[0] || 0\n            this.offsetXY.y = abs.info.configTab.BuffLocation[1] || 0\n        } else {\n\n            tempPos.set(abs.getHitPos()).subtract(abs.getPosition())\n            this.offsetXY.x = tempPos.x\n            this.offsetXY.y = tempPos.y\n        }\n\n        this.posFollow()\n    }\n\n    setPvpBuff(buffId: number, abs: PvpRole) {\n        this.abs = abs\n        this.setBuffId(buffId)\n        tempPos.set(abs.getHitPos()).subtract(abs.getPosition())\n        this.offsetXY.x = tempPos.x\n        this.offsetXY.y = tempPos.y\n    }\n\n    setBuffId(buffId: number) {\n        this.offsetXY.set(0, 0, 0)\n        this.buffId = buffId\n        this.node.active = true\n        this.avatar = Avatar.create()\n        this.node.addChild(this.avatar.node)\n        this.avatar.setAnimationId(tab.getData().BuffTableById.getValue(this.buffId).VFXID)\n    }\n\n    subCount() {\n        this.totalCount -= 1\n    }\n    addCount() {\n        this.totalCount += 1\n    }\n\n    update(dt) {\n        this.posFollow()\n    }\n\n    posFollow() {\n        if (this.abs && this.abs.isValid) {\n            this.avatar.setOpaticy(this.abs.isDead || !this.abs.isActive ? 0 : 255)\n            if (this.node.active) {\n                tempPos.set(this.offsetXY)\n                if (this.abs.node == this.node.parent) {\n                    this.node.position = tempPos\n                    return\n                }\n                if (this.abs.isActive) {\n                    tempPos.add(this.abs.getPosition())\n                }\n                this.node.position = tempPos\n            }\n        }\n    }\n\n}"]}