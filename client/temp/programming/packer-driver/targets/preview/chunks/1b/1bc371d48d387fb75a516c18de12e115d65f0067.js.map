{"version":3,"sources":["file:///C:/chickenStarClient/client/assets/scripts/logic/model/handbook/HandbookItem.ts"],"names":["_decorator","Color","Component","Label","Node","Sprite","ItemInfo","ItemPoolMgr","CommonItem","proto","Net","OpenFunctionMgr","LangMgr","RoleData","BattleMainDataControl","ccclass","property","HandbookItem","_openTab","initData","_tab","openIcon","setTexture","Icon","showType","ShowType","node_waiting","active","node_finish","node_content","destroyAllChildren","i","RewardItemId","length","itemId","itemCount","RewardItemNum","info","num","itemItem","ins","createItem","itemTs","getComponent","funcData","getOpenFunctionData","Name","k","lbl","string","isOpen","node_lock","BattleLv","lbl_condition_txt1","node","getCombineString","ids","getStageClearIds","indexOf","color","fromHEX","PlayerLv","lbl_condition_txt2","level","CreateDay","lbl_condition_txt3","newDate","Date","createTime","tomorrow","getFullYear","getMonth","getDate","times","getServerUtcTime","getTime","nowDay","Math","ceil","console","log","node_get","node_got","isReceivedRewards","sendMsg","msg","Msg_ReceiveOpenFunctionRewardReq","name","Send","Ptl","ReceiveOpenFunctionRewardReq"],"mappings":"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","sourcesContent":["import { _decorator, Color, Component, Label, Node, Sprite } from 'cc';\r\nimport { tab } from '../../../Table/table_gen';\r\nimport { ItemInfo } from '../item/ItemInfo';\r\nimport { ItemPoolMgr } from '../item/ItemPoolMgr';\r\nimport { CommonItem } from '../item/CommonItem';\r\nimport { proto } from 'client_protocol';\r\nimport { Net } from '../../net/Net';\r\nimport { OpenFunctionMgr } from '../../../Common/component/OpenFunctionMgr';\r\nimport { LangMgr } from '../../mgr/LangMgr';\r\nimport { RoleData } from '../role/RoleData';\r\nimport { BattleMainDataControl } from '../home/battle/BattleMainDataControl';\r\nconst { ccclass, property } = _decorator;\r\n\r\n@ccclass('HandbookItem')\r\nexport class HandbookItem extends Component {\r\n    @property(Sprite)\r\n    openIcon: Sprite = null;\r\n    @property([CommonItem])\r\n    commonItems: CommonItem[] = [];\r\n    @property(Node)\r\n    node_finish: Node = null;\r\n    @property(Node)\r\n    node_waiting: Node = null;\r\n    @property(Node)\r\n    node_got: Node = null;\r\n    @property(Node)\r\n    node_lock: Node = null;\r\n    @property(Node)\r\n    node_get: Node = null;\r\n    @property(Label)\r\n    lbl_condition_txt1: Label = null;\r\n    @property(Label)\r\n    lbl_condition_txt2: Label = null;\r\n    @property(Label)\r\n    lbl_condition_txt3: Label = null;\r\n    @property(Node)\r\n    node_content: Node = null;\r\n    private _openTab: tab.OpenFunctionTable = null;\r\n    initData(_tab: tab.OpenFunctionTable) {\r\n        this._openTab = _tab;\r\n        this.openIcon.setTexture(_tab.Icon);\r\n        const showType = _tab.ShowType;\r\n        this.node_waiting.active = showType === 2;\r\n        this.node_finish.active = showType === 1;\r\n        this.node_content.destroyAllChildren();\r\n        // 显示奖励\r\n        for (let i = 0; i < _tab.RewardItemId.length; i++) {\r\n            const itemId = _tab.RewardItemId[i];\r\n            const itemCount = _tab.RewardItemNum[i];\r\n\r\n            const info = new ItemInfo();\r\n            info.itemId = itemId;\r\n            info.num = itemCount;\r\n\r\n            const itemItem = ItemPoolMgr.ins.createItem(info, this.node_content);\r\n            const itemTs = itemItem.getComponent(CommonItem);\r\n            itemTs.initData(info);\r\n        }\r\n        // 是否已经领取奖励\r\n        const funcData = OpenFunctionMgr.ins.getOpenFunctionData(_tab.Name);\r\n        for (let k = 1; k <= 3; k++) {\r\n            const lbl = this[\"lbl_condition_txt\" + k];\r\n            lbl.string = \"\";\r\n        }\r\n        if (!funcData.isOpen) {\r\n            this.node_lock.active = true;\r\n            // 如果没有开放显示开放条件ui_handbook_\r\n            /* 1：主線關卡到達{0}|2：玩家等級達到{0}級|3：創角時間達到{0}天 */\r\n            if (_tab.BattleLv) {\r\n                this.lbl_condition_txt1.node.active = true;\r\n                this.lbl_condition_txt1.string = LangMgr.getCombineString(\"ui_handbook_1\", [_tab.BattleLv]);\r\n                const ids = BattleMainDataControl.ins.getStageClearIds();\r\n                if(ids.indexOf(_tab.BattleLv)>-1){\r\n                    this.lbl_condition_txt1.color = new Color().fromHEX(\"#47FA1E\");\r\n                }else{\r\n                    this.lbl_condition_txt1.color = new Color().fromHEX(\"#95AAC2\");\r\n                }\r\n            }else{\r\n                this.lbl_condition_txt1.node.active = false;\r\n                this.lbl_condition_txt1.string = \"\";\r\n            }\r\n            if (_tab.PlayerLv) {\r\n                this.lbl_condition_txt2.node.active = true;\r\n                this.lbl_condition_txt2.string = LangMgr.getCombineString(\"ui_handbook_2\", [_tab.PlayerLv]);\r\n                if(RoleData.ins.level>=_tab.PlayerLv){\r\n                    this.lbl_condition_txt2.color = new Color().fromHEX(\"#47FA1E\");\r\n                }else{\r\n                    this.lbl_condition_txt2.color = new Color().fromHEX(\"#95AAC2\");\r\n                }\r\n            }else{\r\n                this.lbl_condition_txt2.node.active = false;\r\n                this.lbl_condition_txt2.string = \"\";\r\n            }\r\n            if (_tab.CreateDay) {\r\n                this.lbl_condition_txt3.node.active = true;\r\n                this.lbl_condition_txt3.string = LangMgr.getCombineString(\"ui_handbook_3\", [_tab.CreateDay]);\r\n\r\n                const newDate = new Date(RoleData.ins.createTime*1000);\r\n                const tomorrow = new Date(newDate.getFullYear(), newDate.getMonth(), newDate.getDate() + 1);\r\n                const times = RoleData.ins.getServerUtcTime()- tomorrow.getTime()/1000;\r\n                let nowDay = 1;\r\n                if(times>0){\r\n                    nowDay = Math.ceil((RoleData.ins.getServerUtcTime() - tomorrow.getTime()/1000) / 86400) + 1;\r\n                }\r\n\r\n                if(nowDay>=_tab.CreateDay){\r\n                    this.lbl_condition_txt3.color = new Color().fromHEX(\"#47FA1E\");\r\n                }else{\r\n                    this.lbl_condition_txt3.color = new Color().fromHEX(\"#95AAC2\");\r\n                }\r\n\r\n            }else{\r\n                this.lbl_condition_txt3.node.active = false;\r\n                this.lbl_condition_txt3.string = \"\";\r\n            }\r\n            console.log(this.lbl_condition_txt1.string, this.lbl_condition_txt2.string, this.lbl_condition_txt3.string)\r\n            this.node_get.active = false;\r\n        } else {\r\n            this.node_got.active = funcData.isReceivedRewards;\r\n            this.node_get.active = !funcData.isReceivedRewards;\r\n        }\r\n        console.log(this.lbl_condition_txt1.string, this.lbl_condition_txt2.string, this.lbl_condition_txt3.string)\r\n    }\r\n    // 领取奖励\r\n    sendMsg() {\r\n        const funcData = OpenFunctionMgr.ins.getOpenFunctionData(this._openTab.Name);\r\n        if (funcData.isOpen && !funcData.isReceivedRewards) {\r\n            let msg = new proto.Msg_ReceiveOpenFunctionRewardReq();\r\n            msg.name = this._openTab.Name;\r\n            Net.Send(proto.Ptl.ReceiveOpenFunctionRewardReq, msg)\r\n        }\r\n    }\r\n}\r\n\r\n\r\n"]}