{"version":3,"sources":["file:///C:/chickenStarClient/client/assets/scripts/logic/model/rareBook/RareBookControl.ts"],"names":["_decorator","AbsControl","EventMgr","proto","Net","RareBookData","RedMgr","RedDotType","tab","OpenFunctionMgr","ccclass","property","RareBookControl","ins","_instance","register","onMsg","Ptl","CombineBookFragmentRsp","on_s2c_CombineBookFragmentRsp","UpgradeBookLevelRsp","on_s2c_UpgradeBookLevelRsp","UpgradeBookStarRsp","on_s2c_UpgradeBookStarRsp","BookFragmentSwitchRsp","on_s2c_BookFragmentSwitchRsp","UpdateBookSeriesData","on_s2c_Msg_UpdateBookSeriesData","TakeBookRsp","on_s2c_Msg_TakeBookRsp","DropBookRsp","on_s2c_Msg_DropBookRsp","UpdateBookPowerScore","on_s2c_Msg_UpdateBookPowerScore","registerCalculateFb","Weapon_Job_Archer","on_red_Tujian_Weapon_Job_Archer","Weapon_Job_Assassin","on_red_Tujian_Weapon_Job_Assassin","Weapon_Job_Priest","on_red_Tujian_Weapon_Job_Priest","Weapon_Job_Caster","on_red_Tujian_Weapon_Job_Caster","Weapon_Job_Warrior","on_red_Tujian_Weapon_Job_Warrior","Book_Job","on_red_Book_Job","BooK_Equip","on_red_Book_Equip","Book_collect","on_red_Book_collect","Weapon_recovery","on_red_Weapon_recovery","requestCombineBookFragment","fragmentItemId","msg","Msg_CombineBookFragmentReq","itemId","Send","CombineBookFragmentReq","requestUpgradeBookLevel","bookId","Msg_UpgradeBookLevelReq","UpgradeBookLevelReq","requestUpgradeBookStar","Msg_UpgradeBookStarReq","UpgradeBookStarReq","requestBookFragmentSwitch","Msg_BookFragmentSwitchReq","BookFragmentSwitchReq","requestTakeBook","id","Msg_TakeBookReq","TakeBookReq","requestDropBook","Msg_DropBookReq","DropBookReq","error","code","CommonErrorCode","Succeed","updateBook","book","updateBookCanUpLevelAndStar","refreshEvent","updateBookSeriesData","seriesData","updateSlotInfo","slot","powerScore","table","getBookDicTabByHeroClass","HeroClass","HeroClass_Archer","list","PhaseThreeBook","key","info","getBookInfoByItemId","tujianRedPoint","HeroClass_Assassin","HeroClass_Priest","HeroClass_Caster","HeroClass_Warrior","refreshfTujianRedPoint","heroClass","stateToChange","checkFunctionIsOpen","OpenFunctionName","OpenFunctionName_RareBook","infos","getBookInfos","bookTable","Class","isRedPoint","allSlots","Array","from","getContainerMap","values","k","slots","bookSlotTable","bookInfo","isLock","isHave","getCanBookInfosByHeroClass","length","bookCollectRedPointId","canExchangItems","getExchangBookFragments","item","bookfraTab","getData","BookFragmentTableById","getValue","t","Math","floor","num","BaseAmount"],"mappings":"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","sourcesContent":["import { _decorator, Component, ForwardFlow, Node } from 'cc';\r\nimport { AbsControl } from '../../../framework/base/IAbs';\r\nimport { EventMgr } from '../../mgr/EventMgr';\r\nimport { proto } from 'client_protocol';\r\nimport { Net } from '../../net/Net';\r\nimport { RareBookData } from './RareBookData';\r\nimport { RedMgr } from '../../mgr/RedMgr';\r\nimport { RedDotType } from '../../red/RedDotType';\r\nimport { tab } from '../../../Table/table_gen';\r\nimport { OpenFunctionMgr } from '../../../Common/component/OpenFunctionMgr';\r\nconst { ccclass, property } = _decorator;\r\n\r\n/**\r\n * \r\n * BareBookControl\r\n * zhudingchao\r\n * Wed May 22 2024 15:38:23 GMT+0800 (中国标准时间)\r\n * db://assets/scripts/logic/model/rareBook/BareBookControl.ts\r\n *\r\n */\r\n\r\n@ccclass('RareBookControl')\r\nexport class RareBookControl extends AbsControl {\r\n    private static _instance: RareBookControl;\r\n    public static get ins() {\r\n        if (null == this._instance) {\r\n            this._instance = new RareBookControl();\r\n        }\r\n        return this._instance;\r\n    }\r\n\r\n    register(): void {\r\n        EventMgr.onMsg(proto.Ptl.CombineBookFragmentRsp, this.on_s2c_CombineBookFragmentRsp, this);\r\n        EventMgr.onMsg(proto.Ptl.UpgradeBookLevelRsp, this.on_s2c_UpgradeBookLevelRsp, this);\r\n        EventMgr.onMsg(proto.Ptl.UpgradeBookStarRsp, this.on_s2c_UpgradeBookStarRsp, this);\r\n        EventMgr.onMsg(proto.Ptl.BookFragmentSwitchRsp, this.on_s2c_BookFragmentSwitchRsp, this);\r\n        EventMgr.onMsg(proto.Ptl.UpdateBookSeriesData, this.on_s2c_Msg_UpdateBookSeriesData, this);\r\n        EventMgr.onMsg(proto.Ptl.TakeBookRsp, this.on_s2c_Msg_TakeBookRsp, this);\r\n        EventMgr.onMsg(proto.Ptl.DropBookRsp, this.on_s2c_Msg_DropBookRsp, this);\r\n        EventMgr.onMsg(proto.Ptl.UpdateBookPowerScore, this.on_s2c_Msg_UpdateBookPowerScore, this);\r\n\r\n        RedMgr.ins.registerCalculateFb(RedDotType.Weapon_Job_Archer, this.on_red_Tujian_Weapon_Job_Archer, this);\r\n        RedMgr.ins.registerCalculateFb(RedDotType.Weapon_Job_Assassin, this.on_red_Tujian_Weapon_Job_Assassin, this);\r\n        RedMgr.ins.registerCalculateFb(RedDotType.Weapon_Job_Priest, this.on_red_Tujian_Weapon_Job_Priest, this);\r\n        RedMgr.ins.registerCalculateFb(RedDotType.Weapon_Job_Caster, this.on_red_Tujian_Weapon_Job_Caster, this);\r\n        RedMgr.ins.registerCalculateFb(RedDotType.Weapon_Job_Warrior, this.on_red_Tujian_Weapon_Job_Warrior, this);\r\n\r\n\r\n        RedMgr.ins.registerCalculateFb(RedDotType.Book_Job, this.on_red_Book_Job, this);\r\n        RedMgr.ins.registerCalculateFb(RedDotType.BooK_Equip, this.on_red_Book_Equip, this);\r\n\r\n        RedMgr.ins.registerCalculateFb(RedDotType.Book_collect, this.on_red_Book_collect, this);\r\n        RedMgr.ins.registerCalculateFb(RedDotType.Weapon_recovery, this.on_red_Weapon_recovery, this);\r\n\r\n\r\n\r\n    }\r\n\r\n    requestCombineBookFragment(fragmentItemId: number) {\r\n        let msg = new proto.Msg_CombineBookFragmentReq();\r\n        msg.itemId = fragmentItemId;\r\n        Net.Send(proto.Ptl.CombineBookFragmentReq, msg)\r\n\r\n    }\r\n    requestUpgradeBookLevel(bookId: number) {\r\n        let msg = new proto.Msg_UpgradeBookLevelReq();\r\n        msg.bookId = bookId;\r\n        Net.Send(proto.Ptl.UpgradeBookLevelReq, msg)\r\n    }\r\n    requestUpgradeBookStar(bookId: number) {\r\n        let msg = new proto.Msg_UpgradeBookStarReq();\r\n        msg.bookId = bookId;\r\n        Net.Send(proto.Ptl.UpgradeBookStarReq, msg)\r\n    }\r\n    requestBookFragmentSwitch() {\r\n        let msg = new proto.Msg_BookFragmentSwitchReq();\r\n        Net.Send(proto.Ptl.BookFragmentSwitchReq, msg)\r\n    }\r\n    requestTakeBook(id: number) {\r\n        let msg = new proto.Msg_TakeBookReq();\r\n        msg.bookId = id;\r\n        Net.Send(proto.Ptl.TakeBookReq, msg)\r\n    }\r\n    requestDropBook(id: number) {\r\n        let msg = new proto.Msg_DropBookReq();\r\n        msg.bookId = id;\r\n        Net.Send(proto.Ptl.DropBookReq, msg)\r\n    }\r\n    on_s2c_CombineBookFragmentRsp(msg: proto.Msg_CombineBookFragmentRsp) {\r\n        if (msg.error.code == proto.CommonErrorCode.Succeed) {\r\n\r\n        }\r\n    }\r\n    on_s2c_UpgradeBookLevelRsp(msg: proto.Msg_UpgradeBookLevelRsp) {\r\n        if (msg.error.code == proto.CommonErrorCode.Succeed) {\r\n            RareBookData.ins.updateBook(msg.book as proto.BookData)\r\n            RareBookData.ins.updateBookCanUpLevelAndStar();\r\n        }\r\n    }\r\n    on_s2c_UpgradeBookStarRsp(msg: proto.Msg_UpgradeBookStarRsp) {\r\n        if (msg.error.code == proto.CommonErrorCode.Succeed) {\r\n            RareBookData.ins.updateBook(msg.book as proto.BookData)\r\n            RareBookData.ins.updateBookCanUpLevelAndStar();\r\n        }\r\n    }\r\n    on_s2c_BookFragmentSwitchRsp(msg: proto.Msg_BookFragmentSwitchRsp) {\r\n        if (msg.error.code == proto.CommonErrorCode.Succeed) {\r\n\r\n            // RareBookData.ins.updateBook(msg.book as proto.BookData)\r\n\r\n            RedMgr.refreshEvent(RedDotType.Weapon_recovery);\r\n\r\n        }\r\n    }\r\n    on_s2c_Msg_UpdateBookSeriesData(msg: proto.Msg_UpdateBookSeriesData) {\r\n\r\n        RareBookData.ins.updateBookSeriesData(msg.seriesData as proto.BookSeriesData[])\r\n    }\r\n    on_s2c_Msg_TakeBookRsp(msg: proto.Msg_TakeBookRsp) {\r\n        if (msg.error.code == proto.CommonErrorCode.Succeed) {\r\n            RareBookData.ins.updateSlotInfo(msg.bookId, msg.slot, true);\r\n            RedMgr.refreshEvent(RedDotType.BooK_Equip);\r\n            // RareBookData.ins.updateBook(msg.book as proto.BookData)\r\n        }\r\n    }\r\n    on_s2c_Msg_DropBookRsp(msg: proto.Msg_DropBookRsp) {\r\n        if (msg.error.code == proto.CommonErrorCode.Succeed) {\r\n            RareBookData.ins.updateSlotInfo(msg.bookId, msg.slot, false);\r\n            RedMgr.refreshEvent(RedDotType.BooK_Equip);\r\n            // RareBookData.ins.updateBook(msg.book as proto.BookData)\r\n        }\r\n    }\r\n    on_s2c_Msg_UpdateBookPowerScore(msg: proto.Msg_UpdateBookPowerScore) {\r\n\r\n        RareBookData.ins.powerScore = msg.powerScore;\r\n        // RareBookData.ins.updateBook(msg.book as proto.BookData)\r\n\r\n    }\r\n\r\n    on_red_Tujian_Weapon_Job_Archer() {\r\n        let table = RareBookData.ins.getBookDicTabByHeroClass(tab.HeroClass.HeroClass_Archer);\r\n        if (table) {\r\n            let list = table.PhaseThreeBook;\r\n            for (let key in list) {\r\n                let info = RareBookData.ins.getBookInfoByItemId(list[key]);\r\n                if (info && info.tujianRedPoint) {\r\n                    return true;\r\n                }\r\n            }\r\n        }\r\n        return false;\r\n    }\r\n    on_red_Tujian_Weapon_Job_Assassin() {\r\n        let table = RareBookData.ins.getBookDicTabByHeroClass(tab.HeroClass.HeroClass_Assassin);\r\n        if (table) {\r\n            let list = table.PhaseThreeBook;\r\n            for (let key in list) {\r\n                let info = RareBookData.ins.getBookInfoByItemId(list[key]);\r\n                if (info && info.tujianRedPoint) {\r\n                    return true;\r\n                }\r\n            }\r\n        }\r\n        return false;\r\n\r\n    }\r\n    on_red_Tujian_Weapon_Job_Priest() {\r\n        let table = RareBookData.ins.getBookDicTabByHeroClass(tab.HeroClass.HeroClass_Priest);\r\n        if (table) {\r\n            let list = table.PhaseThreeBook;\r\n            for (let key in list) {\r\n                let info = RareBookData.ins.getBookInfoByItemId(list[key]);\r\n                if (info && info.tujianRedPoint) {\r\n                    return true;\r\n                }\r\n            }\r\n        }\r\n        return false;\r\n    }\r\n    on_red_Tujian_Weapon_Job_Caster() {\r\n        let table = RareBookData.ins.getBookDicTabByHeroClass(tab.HeroClass.HeroClass_Caster);\r\n        if (table) {\r\n            let list = table.PhaseThreeBook;\r\n            for (let key in list) {\r\n                let info = RareBookData.ins.getBookInfoByItemId(list[key]);\r\n                if (info && info.tujianRedPoint) {\r\n                    return true;\r\n                }\r\n            }\r\n        }\r\n        return false;\r\n    }\r\n    on_red_Tujian_Weapon_Job_Warrior() {\r\n        let table = RareBookData.ins.getBookDicTabByHeroClass(tab.HeroClass.HeroClass_Warrior);\r\n        if (table) {\r\n            let list = table.PhaseThreeBook;\r\n            for (let key in list) {\r\n                let info = RareBookData.ins.getBookInfoByItemId(list[key]);\r\n                if (info && info.tujianRedPoint) {\r\n                    return true;\r\n                }\r\n            }\r\n        }\r\n        return false;\r\n    }\r\n\r\n    refreshfTujianRedPoint(heroClass: tab.HeroClass) {\r\n        if (heroClass == tab.HeroClass.HeroClass_Warrior) {\r\n            RedMgr.refreshEvent(RedDotType.Weapon_Job_Warrior);\r\n        } else if (heroClass == tab.HeroClass.HeroClass_Caster) {\r\n            RedMgr.refreshEvent(RedDotType.Weapon_Job_Caster);\r\n        } else if (heroClass == tab.HeroClass.HeroClass_Priest) {\r\n            RedMgr.refreshEvent(RedDotType.Weapon_Job_Priest);\r\n        } else if (heroClass == tab.HeroClass.HeroClass_Archer) {\r\n            RedMgr.refreshEvent(RedDotType.Weapon_Job_Archer);\r\n        } else if (heroClass == tab.HeroClass.HeroClass_Assassin) {\r\n            RedMgr.refreshEvent(RedDotType.Weapon_Job_Assassin);\r\n        }\r\n    }\r\n\r\n    on_red_Book_Job() {\r\n        let stateToChange = {}\r\n        stateToChange[tab.HeroClass.HeroClass_Assassin] = false;\r\n        stateToChange[tab.HeroClass.HeroClass_Archer] = false;\r\n        stateToChange[tab.HeroClass.HeroClass_Priest] = false;\r\n        stateToChange[tab.HeroClass.HeroClass_Caster] = false;\r\n        stateToChange[tab.HeroClass.HeroClass_Warrior] = false;\r\n        if (OpenFunctionMgr.ins.checkFunctionIsOpen(tab.OpenFunctionName.OpenFunctionName_RareBook)) {\r\n            let infos = RareBookData.ins.getBookInfos(false);\r\n            for (let key in infos) {\r\n                if (infos[key].bookTable) {\r\n                    let heroClass = infos[key].bookTable.Class;\r\n                    if (!stateToChange[heroClass]) {\r\n                        stateToChange[heroClass] = infos[key].isRedPoint;\r\n                    }\r\n                }\r\n            }\r\n        }\r\n        return stateToChange;\r\n    }\r\n\r\n    // on_red_Book_Job_Archer() {\r\n    //     //---------因为初始化秘籍数据的时候功能开启数据没有 没有办法判断是否开启------------\r\n    //     // if (OpenFunctionMgr.ins.checkFunctionIsOpen(tab.OpenFunctionName.OpenFunctionName_RareBook)) {\r\n    //     let list = RareBookData.ins.getBookInfosByHeroClass(tab.HeroClass.HeroClass_Archer);\r\n    //     for (let key in list) {\r\n    //         if (list[key].isRedPoint) {\r\n    //             return true;\r\n    //         }\r\n    //     }\r\n    //     // }\r\n    //     return false;\r\n    // }\r\n    // on_red_Book_Job_Assassin() {\r\n    //     //---------因为初始化秘籍数据的时候功能开启数据没有 没有办法判断是否开启------------\r\n    //     // if (OpenFunctionMgr.ins.checkFunctionIsOpen(tab.OpenFunctionName.OpenFunctionName_RareBook)) {\r\n    //     let list = RareBookData.ins.getBookInfosByHeroClass(tab.HeroClass.HeroClass_Assassin);\r\n    //     for (let key in list) {\r\n    //         if (list[key].isRedPoint) {\r\n    //             return true;\r\n    //         }\r\n    //     }\r\n    //     // }\r\n    //     return false;\r\n\r\n    // }\r\n    // on_red_Book_Job_Priest() {\r\n    //     //---------因为初始化秘籍数据的时候功能开启数据没有 没有办法判断是否开启------------\r\n    //     if (OpenFunctionMgr.ins.checkFunctionIsOpen(tab.OpenFunctionName.OpenFunctionName_RareBook)) {\r\n    //         let list = RareBookData.ins.getBookInfosByHeroClass(tab.HeroClass.HeroClass_Priest);\r\n    //         for (let key in list) {\r\n    //             if (list[key].isRedPoint) {\r\n    //                 return true;\r\n    //             }\r\n    //         }\r\n    //     }\r\n    //     return false;\r\n    // }\r\n    // on_red_Book_Job_Caster() {\r\n    //     //---------因为初始化秘籍数据的时候功能开启数据没有 没有办法判断是否开启------------\r\n    //     if (OpenFunctionMgr.ins.checkFunctionIsOpen(tab.OpenFunctionName.OpenFunctionName_RareBook)) {\r\n    //         let list = RareBookData.ins.getBookInfosByHeroClass(tab.HeroClass.HeroClass_Caster);\r\n    //         for (let key in list) {\r\n    //             if (list[key].isRedPoint) {\r\n    //                 return true;\r\n    //             }\r\n    //         }\r\n    //     }\r\n    //     return false;\r\n    // }\r\n    // on_red_Book_Job_Warrior() {\r\n    //     //---------因为初始化秘籍数据的时候功能开启数据没有 没有办法判断是否开启------------\r\n    //     if (OpenFunctionMgr.ins.checkFunctionIsOpen(tab.OpenFunctionName.OpenFunctionName_RareBook)) {\r\n    //         let list = RareBookData.ins.getBookInfosByHeroClass(tab.HeroClass.HeroClass_Warrior);\r\n    //         for (let key in list) {\r\n    //             if (list[key].isRedPoint) {\r\n    //                 return true;\r\n    //             }\r\n    //         }\r\n    //     }\r\n    //     return false;\r\n    // }\r\n\r\n    // refreshfBookJobRedPoint(heroClass: tab.HeroClass = tab.HeroClass.HeroClass_Any) {\r\n    //     if (heroClass == tab.HeroClass.HeroClass_Any) {\r\n    //         RedMgr.refreshEvent(RedDotType.Book_Job);\r\n    //         RedMgr.refreshEvent(RedDotType.Book_Job_Caster);\r\n    //         RedMgr.refreshEvent(RedDotType.Book_Job_Priest);\r\n    //         RedMgr.refreshEvent(RedDotType.Book_Job_Archer);\r\n    //         RedMgr.refreshEvent(RedDotType.Book_Job_Assassin);\r\n    //     } else if (heroClass == tab.HeroClass.HeroClass_Warrior) {\r\n    //         RedMgr.refreshEvent(RedDotType.Book_Job_Warrior);\r\n    //     } else if (heroClass == tab.HeroClass.HeroClass_Caster) {\r\n    //         RedMgr.refreshEvent(RedDotType.Book_Job_Caster);\r\n    //     } else if (heroClass == tab.HeroClass.HeroClass_Priest) {\r\n    //         RedMgr.refreshEvent(RedDotType.Book_Job_Priest);\r\n    //     } else if (heroClass == tab.HeroClass.HeroClass_Archer) {\r\n    //         RedMgr.refreshEvent(RedDotType.Book_Job_Archer);\r\n    //     } else if (heroClass == tab.HeroClass.HeroClass_Assassin) {\r\n    //         RedMgr.refreshEvent(RedDotType.Book_Job_Assassin);\r\n    //     }\r\n    // }\r\n\r\n    on_red_Book_Equip() {\r\n        let stateToChange = {}\r\n        stateToChange[tab.HeroClass.HeroClass_Assassin] = false;\r\n        stateToChange[tab.HeroClass.HeroClass_Archer] = false;\r\n        stateToChange[tab.HeroClass.HeroClass_Priest] = false;\r\n        stateToChange[tab.HeroClass.HeroClass_Caster] = false;\r\n        stateToChange[tab.HeroClass.HeroClass_Warrior] = false;\r\n        //---------因为初始化秘籍数据的时候功能开启数据没有 没有办法判断是否开启------------\r\n        if (!OpenFunctionMgr.ins.checkFunctionIsOpen(tab.OpenFunctionName.OpenFunctionName_RareBook)) {\r\n            return stateToChange;\r\n        }\r\n\r\n        let allSlots = Array.from(RareBookData.ins.getContainerMap().values());\r\n        for (let k in allSlots) {\r\n            let slots = allSlots[k];\r\n            for (let key in slots) {\r\n                if (!stateToChange[slots[key].bookSlotTable.Class] && !slots[key].bookInfo && slots[key].isLock) {\r\n                    let isHave = RareBookData.ins.getCanBookInfosByHeroClass(slots[key].bookSlotTable.Class).length > 0;\r\n                    stateToChange[slots[key].bookSlotTable.Class] = isHave;\r\n                }\r\n            }\r\n        }\r\n        return stateToChange;\r\n\r\n    }\r\n\r\n    on_red_Book_collect() {\r\n        if (!OpenFunctionMgr.ins.checkFunctionIsOpen(tab.OpenFunctionName.OpenFunctionName_RareBook)) {\r\n            return false;\r\n        }\r\n        return RareBookData.ins.bookCollectRedPointId != \"\";\r\n    }\r\n    on_red_Weapon_recovery() {\r\n        if (!OpenFunctionMgr.ins.checkFunctionIsOpen(tab.OpenFunctionName.OpenFunctionName_RareBook)) {\r\n            return false;\r\n        }\r\n        let canExchangItems = RareBookData.ins.getExchangBookFragments();\r\n        for (let key in canExchangItems) {\r\n            let item = canExchangItems[key];\r\n            let bookfraTab = tab.getData().BookFragmentTableById.getValue(item.itemId)\r\n            let t = Math.floor(item.num / bookfraTab.BaseAmount);\r\n            if (t >= 1) {\r\n                return true;\r\n            }\r\n        }\r\n        return false;\r\n\r\n    }\r\n\r\n}"]}