{"version":3,"sources":["file:///C:/chickenStarClient/client/assets/scripts/logic/model/handbook/HandbookPop.ts"],"names":["_decorator","instantiate","Node","Prefab","ViewPop","tab","EventMgr","proto","UIMgr","ViewName","OpenFunctionMgr","HandbookItem","RedMgr","RedDotType","ccclass","property","statusPriority","HandbookPop","onShow","node_content","destroyAllChildren","tabs","getData","OpenFunctionTable","showTabs","i","length","openTab","ShowType","push","newList","sortList","console","log","k","item","pfb_item","parent","itemTs","getComponent","initData","onDestroy","register","onMsg","Ptl","ReceiveOpenFunctionRewardRsp","on_s2c_ReceiveOpenFunctionRewardRsp","unRegister","msg","error","code","CommonErrorCode","Succeed","ins","show","viewName","CongratulationPop","data","rewards","changeOpenFunctionDataByName","name","refreshEvent","Hand_book","list","listItem","funcData","getOpenFunctionData","Name","isReceivedRewards","isOpen","sort","a","b"],"mappings":"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","sourcesContent":["/*\r\n * @Date: 2024-06-11 09:37:28\r\n * @LastEditors: wzq\r\n * @program:江湖指南\r\n * @LastEditTime: 2024-07-24 10:46:09\r\n */\r\n\r\nimport { _decorator, Component, instantiate, Node, Prefab } from 'cc';\r\nimport { ViewPop } from '../../../framework/base/ViewPop';\r\nimport { tab } from '../../../Table/table_gen';\r\nimport { EventMgr } from '../../mgr/EventMgr';\r\nimport { proto } from 'client_protocol';\r\nimport { UIMgr } from '../../mgr/UIMgr';\r\nimport { ViewName } from '../../define/ViewDefine';\r\nimport { OpenFunctionMgr } from '../../../Common/component/OpenFunctionMgr';\r\nimport { HandbookItem } from './HandbookItem';\r\nimport { RedMgr } from '../../mgr/RedMgr';\r\nimport { RedDotType } from '../../red/RedDotType';\r\nconst { ccclass, property } = _decorator;\r\nconst statusPriority: { [key: string]: number } = {\r\n    '可领取': 1,\r\n    '未开启': 2,\r\n    '开发中': 3,\r\n    '已领取': 4,\r\n    'NONE':5\r\n};\r\n@ccclass('HandbookPop')\r\nexport class HandbookPop extends ViewPop {\r\n    @property(Prefab)\r\n    pfb_item: Prefab = null;\r\n    @property(Node)\r\n    node_content: Node = null;\r\n    onShow(): void {\r\n        this.node_content.destroyAllChildren();\r\n        const tabs = tab.getData().OpenFunctionTable;\r\n        const showTabs = [];\r\n        for (let i = 0; i < tabs.length; i++) {\r\n            const openTab = tabs[i];\r\n            if (openTab.ShowType === 0) {\r\n                continue;\r\n            }\r\n            showTabs.push(openTab);\r\n        }\r\n        const newList = this.sortList(showTabs);\r\n        console.log(newList)\r\n        for (let k = 0; k < newList.length; k++) {\r\n            const openTab = newList[k];\r\n            const item = instantiate(this.pfb_item);\r\n            item.parent = this.node_content;\r\n            const itemTs = item.getComponent(HandbookItem);\r\n            itemTs.initData(openTab);\r\n        }\r\n    }\r\n    protected onDestroy(): void {\r\n        super.onDestroy()\r\n    }\r\n    register(): void {\r\n        // 获取奖励刷新列表\r\n        EventMgr.onMsg(proto.Ptl.ReceiveOpenFunctionRewardRsp, this.on_s2c_ReceiveOpenFunctionRewardRsp, this)\r\n    }\r\n    unRegister(): void {\r\n        super.unRegister();\r\n    }\r\n    on_s2c_ReceiveOpenFunctionRewardRsp(msg: proto.Msg_ReceiveOpenFunctionRewardRsp) {\r\n        if (msg.error && msg.error.code != proto.CommonErrorCode.Succeed) return;\r\n        UIMgr.ins.show({ viewName: ViewName.CongratulationPop, data: msg.rewards })\r\n        OpenFunctionMgr.ins.changeOpenFunctionDataByName(msg.name);\r\n        RedMgr.refreshEvent(RedDotType.Hand_book);\r\n        this.onShow();\r\n    }\r\n    // 列表排序规则 可领取 未开启 开发中 已领取\r\n    sortList(list: tab.OpenFunctionTable[]) {\r\n        for(let i=0;i<list.length;i++){\r\n            let listItem:tab.OpenFunctionTable = list[i]\r\n            const funcData = OpenFunctionMgr.ins.getOpenFunctionData(listItem.Name);\r\n            if(!funcData.isReceivedRewards&&funcData.isOpen&&listItem.ShowType === 1){\r\n                listItem[\"status\"] = \"可领取\"\r\n                continue;\r\n            }\r\n            if(!funcData.isOpen&&listItem.ShowType === 1){\r\n                listItem[\"status\"] = \"未开启\";\r\n                continue;\r\n            }\r\n            if(listItem.ShowType === 2){\r\n                listItem[\"status\"] = \"开发中\"\r\n                continue;\r\n            }\r\n            if(funcData.isReceivedRewards){\r\n                listItem[\"status\"] = \"已领取\"\r\n                continue\r\n            }\r\n            listItem[\"status\"] = \"NONE\"\r\n        }\r\n        list.sort((a, b) => {\r\n            return statusPriority[a['status']] - statusPriority[b['status']];\r\n        });\r\n        return list;\r\n    }\r\n}\r\n\r\n\r\n"]}