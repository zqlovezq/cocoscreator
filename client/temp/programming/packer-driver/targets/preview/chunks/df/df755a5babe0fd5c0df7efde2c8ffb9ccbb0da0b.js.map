{"version":3,"sources":["file:///C:/chickenStarClient/client/assets/scripts/logic/model/pay/PayData.ts"],"names":["_decorator","tab","EventMgr","LocalEvent","ccclass","property","PayData","_payInfoMsg","_isShowFirstRecharge","_firstRechargeTabs","ins","_instance","purge","payInfoMsg","msg","emitLocal","FirstRecharge_Chang","isShowFirstRecharge","tables","getFirstRechargeTabs","firstRechargeInfo","boughtGoodsIds","length","getFirstRechargeTable","key","id","Id","indexOf","firstRechargeSucc","rechargeId","getData","FirstRechargeTable","table","find","a","RechargeId","push","i","setFirstRechargeTabs","_tab","ContainGoodsId"],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAASA,MAAAA,U,OAAAA,U;;AAGAC,MAAAA,G,iBAAAA,G;;AACAC,MAAAA,Q,iBAAAA,Q;;AACAC,MAAAA,U,iBAAAA,U;;;;;;;;;OACH;AAAEC,QAAAA,OAAF;AAAWC,QAAAA;AAAX,O,GAAwBL,U;AAE9B;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;yBAGaM,O,WADZF,OAAO,CAAC,SAAD,C,2BAAR,MACaE,OADb,CACuC;AAAA;AAAA,eAG3BC,WAH2B;AAAA,eAI3BC,oBAJ2B,GAIK,KAJL;AAAA,eAK3BC,kBAL2B,GAKoB,EALpB;AAAA;;AAMd,mBAAHC,GAAG,GAAG;AACpB,cAAI,QAAQ,KAAKC,SAAjB,EAA4B;AACxB,iBAAKA,SAAL,GAAiB,IAAIL,OAAJ,EAAjB;AACH;;AACD,iBAAO,KAAKK,SAAZ;AACH;;AACDC,QAAAA,KAAK,GAAG,CAEP;;AACa,YAAVC,UAAU,CAACC,GAAD,EAA+B;AACzC,eAAKP,WAAL,GAAmBO,GAAnB,CADyC,CAEzC;AACA;AACA;AACA;AACA;;AACA;AAAA;AAAA,oCAASC,SAAT,CAAmB;AAAA;AAAA,wCAAWC,mBAA9B;AACH;;AACa,YAAVH,UAAU,GAAG;AACb,iBAAO,KAAKN,WAAZ;AACH;AAED;;;AACAU,QAAAA,mBAAmB,GAAG;AAClB,cAAI,KAAKJ,UAAT,EAAqB;AACjB,gBAAIK,MAAM,GAAG,KAAKC,oBAAL,EAAb;;AACA,gBAAI,KAAKN,UAAL,CAAgBO,iBAAhB,CAAkCC,cAAlC,CAAiDC,MAAjD,IAA2DJ,MAAM,CAACI,MAAtE,EAA8E;AAC1E,qBAAO,KAAP;AACH;;AACD,mBAAO,IAAP;AACH;;AACD,iBAAO,KAAP;AACH;AACD;AACJ;AACA;AACA;;;AACIC,QAAAA,qBAAqB,GAAG;AACpB,cAAIL,MAAM,GAAG,KAAKC,oBAAL,EAAb;;AACA,cAAI,KAAKN,UAAT,EAAqB;AACjB,gBAAIQ,cAAc,GAAG,KAAKR,UAAL,CAAgBO,iBAAhB,CAAkCC,cAAvD;;AACA,iBAAK,IAAIG,GAAT,IAAgBN,MAAhB,EAAwB;AACpB,kBAAIO,EAAE,GAAGP,MAAM,CAACM,GAAD,CAAN,CAAYE,EAArB;;AACA,kBAAIL,cAAc,CAACM,OAAf,CAAuBF,EAAvB,IAA6B,CAAjC,EAAoC;AAChC,uBAAOP,MAAM,CAACM,GAAD,CAAb;AACH;AACJ;AACJ;;AACD,iBAAO,IAAP;AACH;AACD;;;AACAI,QAAAA,iBAAiB,CAACC,UAAD,EAAqB;AAClC,cAAIX,MAAM,GAAG;AAAA;AAAA,0BAAIY,OAAJ,GAAcC,kBAA3B;AACA,cAAIC,KAAK,GAAGd,MAAM,CAACe,IAAP,CAAYC,CAAC,IAAIA,CAAC,CAACC,UAAF,IAAgBN,UAAjC,CAAZ;;AACA,cAAIG,KAAJ,EAAW;AACP,iBAAKnB,UAAL,CAAgBO,iBAAhB,CAAkCC,cAAlC,CAAiDe,IAAjD,CAAsDJ,KAAK,CAACN,EAA5D;;AACA,gBAAIM,KAAK,CAACN,EAAN,KAAa,CAAjB,EAAoB;AAChB,mBAAK,IAAIW,CAAC,GAAG,CAAb,EAAgBA,CAAC,GAAG,KAAK5B,kBAAL,CAAwBa,MAA5C,EAAoDe,CAAC,EAArD,EAAyD;AACrD,qBAAKxB,UAAL,CAAgBO,iBAAhB,CAAkCC,cAAlC,CAAiDe,IAAjD,CAAsD,KAAK3B,kBAAL,CAAwB4B,CAAxB,EAA2BX,EAAjF;AACH;AACJ;;AACD;AAAA;AAAA,sCAASX,SAAT,CAAmB;AAAA;AAAA,0CAAWC,mBAA9B;AACH;AACJ;;AACDG,QAAAA,oBAAoB,GAAG;AACnB,cAAI,KAAKV,kBAAL,CAAwBa,MAAxB,KAAmC,CAAvC,EAA0C;AACtC,iBAAKgB,oBAAL;AACH;;AACD,iBAAO,KAAK7B,kBAAZ;AACH;;AACD6B,QAAAA,oBAAoB,GAAG;AACnB,cAAIpB,MAAM,GAAG;AAAA;AAAA,0BAAIY,OAAJ,GAAcC,kBAA3B;;AACA,eAAK,IAAIM,CAAC,GAAG,CAAb,EAAgBA,CAAC,GAAGnB,MAAM,CAACI,MAA3B,EAAmCe,CAAC,EAApC,EAAwC;AACpC,gBAAME,IAAI,GAAGrB,MAAM,CAACmB,CAAD,CAAnB;;AACA,gBAAIE,IAAI,CAACC,cAAL,CAAoBlB,MAApB,KAA+B,CAAnC,EAAsC;AAClC,mBAAKb,kBAAL,CAAwB2B,IAAxB,CAA6BG,IAA7B;AACH;AACJ;AACJ;;AApFkC,O,UAEpB5B,S","sourcesContent":["import { _decorator, Component, Node } from 'cc';\r\nimport { IClear } from '../../../framework/base/IAbs';\r\nimport { proto } from 'client_protocol';\r\nimport { tab } from '../../../Table/table_gen';\r\nimport { EventMgr } from '../../mgr/EventMgr';\r\nimport { LocalEvent } from '../../define/LocalEvent';\r\nconst { ccclass, property } = _decorator;\r\n\r\n/**\r\n * \r\n * PayData\r\n * zhudingchao\r\n * Wed Jun 26 2024 14:38:31 GMT+0800 (中国标准时间)\r\n * db://assets/scripts/logic/model/pay/PayData.ts\r\n *\r\n */\r\n\r\n@ccclass('PayData')\r\nexport class PayData implements IClear {\r\n\r\n    private static _instance: PayData;\r\n    private _payInfoMsg: proto.Msg_GetPayInfoRsp;\r\n    private _isShowFirstRecharge: boolean = false;\r\n    private _firstRechargeTabs: tab.FirstRechargeTable[] = []\r\n    public static get ins() {\r\n        if (null == this._instance) {\r\n            this._instance = new PayData();\r\n        }\r\n        return this._instance;\r\n    }\r\n    purge() {\r\n\r\n    }\r\n    set payInfoMsg(msg: proto.Msg_GetPayInfoRsp) {\r\n        this._payInfoMsg = msg;\r\n        // let b = this.isShowFirstRecharge();\r\n        // if (b != this._isShowFirstRecharge) {\r\n        //     this._isShowFirstRecharge = b;\r\n        //     EventMgr.emitLocal(LocalEvent.FirstRecharge_Chang);\r\n        // }\r\n        EventMgr.emitLocal(LocalEvent.FirstRecharge_Chang);\r\n    }\r\n    get payInfoMsg() {\r\n        return this._payInfoMsg;\r\n    }\r\n\r\n    /**是否显示首充活动 */\r\n    isShowFirstRecharge() {\r\n        if (this.payInfoMsg) {\r\n            let tables = this.getFirstRechargeTabs();\r\n            if (this.payInfoMsg.firstRechargeInfo.boughtGoodsIds.length == tables.length) {\r\n                return false;\r\n            }\r\n            return true;\r\n        }\r\n        return false;\r\n    }\r\n    /**\r\n     * 获得首充奖励id\r\n     * @returns \r\n     */\r\n    getFirstRechargeTable() {\r\n        let tables = this.getFirstRechargeTabs();\r\n        if (this.payInfoMsg) {\r\n            let boughtGoodsIds = this.payInfoMsg.firstRechargeInfo.boughtGoodsIds;\r\n            for (let key in tables) {\r\n                let id = tables[key].Id;\r\n                if (boughtGoodsIds.indexOf(id) < 0) {\r\n                    return tables[key];\r\n                }\r\n            }\r\n        }\r\n        return null;\r\n    }\r\n    /**首充完成 */\r\n    firstRechargeSucc(rechargeId: number) {\r\n        let tables = tab.getData().FirstRechargeTable;\r\n        let table = tables.find(a => a.RechargeId == rechargeId);\r\n        if (table) {\r\n            this.payInfoMsg.firstRechargeInfo.boughtGoodsIds.push(table.Id);\r\n            if (table.Id === 4) {\r\n                for (let i = 0; i < this._firstRechargeTabs.length; i++) {\r\n                    this.payInfoMsg.firstRechargeInfo.boughtGoodsIds.push(this._firstRechargeTabs[i].Id);\r\n                }\r\n            }\r\n            EventMgr.emitLocal(LocalEvent.FirstRecharge_Chang);\r\n        }\r\n    }\r\n    getFirstRechargeTabs() {\r\n        if (this._firstRechargeTabs.length === 0) {\r\n            this.setFirstRechargeTabs();\r\n        }\r\n        return this._firstRechargeTabs\r\n    }\r\n    setFirstRechargeTabs() {\r\n        let tables = tab.getData().FirstRechargeTable;\r\n        for (let i = 0; i < tables.length; i++) {\r\n            const _tab = tables[i];\r\n            if (_tab.ContainGoodsId.length === 0) {\r\n                this._firstRechargeTabs.push(_tab);\r\n            }\r\n        }\r\n    }\r\n}"]}