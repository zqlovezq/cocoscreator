{"version":3,"sources":["file:///C:/chickenStarClient/client/assets/scripts/logic/model/jianghu/dailyExplore/InstanceRewardPop.ts"],"names":["_decorator","instantiate","Node","Prefab","Toggle","ViewPop","AWARD_STATE","JIANGHU_TYPE","tab","GameplayViewDataMgr","proto","InstanceRewardPopItem","EventMgr","UIMgr","ViewName","InfiniteList","RedMgr","RedDotType","ccclass","property","InstanceRewardPop","view_type","NONE","gold_tabs","feed_tabs","cur_tabs","curExportInfo","register","onMsg","Ptl","ReceiveExploreStageFirstRewardRsp","on_s2c_ReceiveExploreStageFirstRewardRsp","msg","error","code","CommonErrorCode","Succeed","receivedFirstRewardStageIds","push","stageId","refreshEvent","ChallengeDailyAward","ins","show","viewName","CongratulationPop","data","rewards","content","list_view","getContent","item","getChildByName","String","itemTs","getComponent","setAwardState","GOT","scrollToIndex","clickChangeView","e","type","Number","getExportInfo","setCurFightStageId","setCurTabs","Reload","onShow","openData","i","getData","PveClearStageTable","length","dataTab","StageId","node_toggle","isChecked","Init","getCellNumber","getCellCount","bind","getCellSize","getCellHeight","getCellIdentifer","getCellView","getCellData","GetCellData","GoldStage","index","indexOf","pos","GetScrollPosOfCell","setContentPos","y","idx","identifer","pfb_item","exportData","view","onDestroy"],"mappings":"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","sourcesContent":["import { _decorator, Component, EventTouch, instantiate, Node, Prefab, Toggle } from 'cc';\r\nimport { ViewPop } from '../../../../framework/base/ViewPop';\r\nimport { AWARD_STATE, JIANGHU_TYPE } from '../../../../Common/script/EnumTypeMgr';\r\nimport { JadeDetailPop } from '../../jade/JadeDetailPop';\r\nimport { tab } from '../../../../Table/table_gen';\r\nimport { GameplayViewDataMgr } from '../GameplayViewDataMgr';\r\nimport { proto } from 'client_protocol';\r\nimport { InstanceRewardPopItem } from './InstanceRewardPopItem';\r\nimport { EventMgr } from '../../../mgr/EventMgr';\r\nimport { UIMgr } from '../../../mgr/UIMgr';\r\nimport { ViewName } from '../../../define/ViewDefine';\r\nimport InfiniteList from '../../../../Common/InfiniteList/InfiniteList';\r\nimport { RedMgr } from '../../../mgr/RedMgr';\r\nimport { RedDotType } from '../../../red/RedDotType';\r\nconst { ccclass, property } = _decorator;\r\n\r\n@ccclass('InstanceRewardPop')\r\nexport class InstanceRewardPop extends ViewPop {\r\n    @property(InfiniteList)\r\n    list_view: InfiniteList = null;\r\n    @property(Prefab)\r\n    pfb_item: Prefab = null;\r\n    @property(Node)\r\n    node_toggle: Node = null;\r\n    private view_type: JIANGHU_TYPE = JIANGHU_TYPE.NONE\r\n    private gold_tabs: tab.PveClearStageTable[] = [];\r\n    private feed_tabs: tab.PveClearStageTable[] = [];\r\n    private cur_tabs:tab.PveClearStageTable[] = [];\r\n    private curExportInfo: proto.IExportStageInfo = null;\r\n    register(): void {\r\n        // 领取奖励 刷新item\r\n        EventMgr.onMsg(proto.Ptl.ReceiveExploreStageFirstRewardRsp, this.on_s2c_ReceiveExploreStageFirstRewardRsp, this)\r\n    }\r\n    on_s2c_ReceiveExploreStageFirstRewardRsp(msg: proto.Msg_ReceiveExploreStageFirstRewardRsp) {\r\n        if (msg.error && msg.error.code != proto.CommonErrorCode.Succeed) return;\r\n        this.curExportInfo.receivedFirstRewardStageIds.push(msg.stageId);\r\n        RedMgr.refreshEvent(RedDotType.ChallengeDailyAward);\r\n        UIMgr.ins.show({ viewName: ViewName.CongratulationPop, data: msg.rewards })\r\n        const content = this.list_view.getContent();\r\n        const item = content.getChildByName(String(msg.stageId));\r\n        const itemTs = item.getComponent(InstanceRewardPopItem);\r\n        itemTs.setAwardState(AWARD_STATE.GOT);\r\n        this.scrollToIndex();\r\n    }\r\n    clickChangeView(e: EventTouch, type: string) {\r\n        if (this.view_type === Number(type)) {\r\n            return;\r\n        }\r\n        this.view_type = Number(type);\r\n        this.curExportInfo = GameplayViewDataMgr.ins.getExportInfo(this.view_type);\r\n        GameplayViewDataMgr.ins.setCurFightStageId(this.view_type);\r\n        this.setCurTabs();\r\n        this.list_view.Reload(false, true);\r\n        this.scrollToIndex();\r\n    }\r\n    onShow(): void {\r\n        // 首通奖励数据\r\n        this.view_type = this.openData;\r\n        this.curExportInfo = GameplayViewDataMgr.ins.getExportInfo(this.view_type);\r\n        for (let i = 0; i < tab.getData().PveClearStageTable.length; i++) {\r\n            const dataTab = tab.getData().PveClearStageTable[i];\r\n            if (dataTab.StageId < 10200) {\r\n                this.gold_tabs.push(dataTab) \r\n            } else if (dataTab.StageId < 10300) {\r\n                this.feed_tabs.push(dataTab);\r\n            }\r\n        }\r\n        this.node_toggle.getChildByName(\"Toggle\" + this.view_type).getComponent(Toggle).isChecked = true;\r\n        this.setCurTabs();\r\n        this.list_view.Init({\r\n            getCellNumber: this.getCellCount.bind(this),\r\n            getCellSize: this.getCellHeight.bind(this),\r\n            getCellIdentifer: this.getCellIdentifer.bind(this),\r\n            getCellView: this.getCellView.bind(this),\r\n            getCellData: this.GetCellData.bind(this),\r\n        });\r\n        this.scrollToIndex();\r\n    }\r\n    setCurTabs(){\r\n        if(this.view_type===JIANGHU_TYPE.GoldStage){\r\n            this.cur_tabs = this.gold_tabs\r\n        }else{\r\n            this.cur_tabs = this.feed_tabs\r\n        }\r\n    }\r\n    scrollToIndex() {\r\n        // 自动滚动到当前的位置\r\n        let index = 0;\r\n        for(let i=0;i<this.cur_tabs.length;i++){\r\n            const stageId = this.cur_tabs[i].StageId;\r\n            if( this.curExportInfo.receivedFirstRewardStageIds.indexOf(stageId)===-1){\r\n                index = i;\r\n                break;\r\n            }\r\n       }\r\n        // this.list_view.ScrollToCell(index-1);\r\n        const pos = this.list_view.GetScrollPosOfCell(index-1);\r\n        this.list_view.setContentPos(pos.y, 0,pos.y);\r\n    }\r\n    getCellCount() {\r\n        return this.cur_tabs.length;\r\n    }\r\n    getCellHeight(idx: number) {\r\n        return 160;\r\n    }\r\n    getCellIdentifer(idx: number) {\r\n        return \"InstanceRewardPopItem\"\r\n    }\r\n    getCellView(idx: number, identifer: string) {\r\n        return instantiate(this.pfb_item).getComponent(InstanceRewardPopItem);\r\n    }\r\n    GetCellData(idx: number) {\r\n        return { data: this.cur_tabs[idx], exportData: this.curExportInfo,view:this.view_type};\r\n    }\r\n    protected onDestroy(): void {\r\n        GameplayViewDataMgr.ins.setCurFightStageId(this.openData);\r\n        super.onDestroy();\r\n    }\r\n}\r\n\r\n\r\n"]}