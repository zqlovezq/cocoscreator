{"version":3,"sources":["file:///C:/chickenStarClient/client/assets/scripts/logic/model/activity/combine/CombineStarUpCellItem.ts"],"names":["_decorator","Button","Label","Node","Sprite","InfiniteCell","tab","HeroItem","HeroInfo","CommonItem","PayControl","proto","ActivityData","ChannelMgr","ItemInfo","ItemPoolMgr","Net","HeroDataControl","ButtonLock","ccclass","property","CombineStarUpCellItem","_tabData","_heroGrowData","_canReceive","UpdateContent","data","ins","getHeroGrowData","id","info","createDefaultData","HeroId","HeroStar","item_hero","setLevel","setFreeAward","setBuyAward","_tab","awardId","FreeRewardId","awardCount","FreeRewardCount","itemInfo","initItemData","item_free","initData","receivedFreeRewardStars","indexOf","setSelectState","node_lock","active","maxStar","getMaxPaintingStar","heroItemId","node_layout","destroyAllChildren","i","RewardIds","length","count","RewardCount","awardInfo","itemId","num","createRewadItem","rechargeId","RechargeId","rechargeTab","getData","RechargeTableById","getValue","lbl_price","string","getSdkRechargeShowPrice","setBuyBtn","buyCount","boughtNotFreeRewardTimesMap","remainTimes","LimitCount","lbl_remain_times","String","sp","btn_price","node","getComponent","grayscale","interactable","clickFree","msg","Msg_ReceiveActivityHeroGrowRewardReq","activityId","star","Send","Ptl","ReceiveActivityHeroGrowRewardReq","clickRMB","self","requestPay"],"mappings":"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","sourcesContent":["import { _decorator, Button, Component, Label, Node, Sprite } from 'cc';\r\nimport InfiniteCell from '../../../../Common/InfiniteList/InfiniteCell';\r\nimport { tab } from '../../../../Table/table_gen';\r\nimport { HeroItem } from '../../item/HeroItem';\r\nimport { HeroInfo } from '../../hero/HeroInfo';\r\nimport { CommonItem } from '../../item/CommonItem';\r\nimport { PayControl } from '../../pay/PayControl';\r\nimport { proto } from 'client_protocol';\r\nimport { ActivityData } from '../ActivityData';\r\nimport { ChannelMgr } from '../../../../channel/ChannelMgr';\r\nimport { ItemInfo } from '../../item/ItemInfo';\r\nimport { ItemPoolMgr } from '../../item/ItemPoolMgr';\r\nimport { Net } from '../../../net/Net';\r\nimport { HeroDataControl } from '../../hero/herobag/HeroDataControl';\r\nimport { ButtonLock } from '../../../utils/GameUtil';\r\nconst { ccclass, property } = _decorator;\r\n\r\n@ccclass('CombineStarUpCellItem')\r\nexport class CombineStarUpCellItem extends InfiniteCell {\r\n    @property(HeroItem)\r\n    item_hero: HeroItem = null;\r\n    @property(CommonItem)\r\n    item_free: CommonItem = null;\r\n    @property(Node)\r\n    node_layout: Node = null;\r\n    @property(Label)\r\n    lbl_remain_times: Label = null;\r\n    @property(Button)\r\n    btn_price: Button = null;\r\n    @property(Label)\r\n    lbl_price: Label = null;\r\n    @property(Node)\r\n    node_lock: Node = null;\r\n    private _tabData: tab.ActivityHeroGrowTable = null;\r\n    private _heroGrowData: proto.HeroGrow = null;\r\n    private _canReceive: boolean = false;\r\n    UpdateContent(data: any): void {\r\n        this._tabData = data.tab;\r\n        this._heroGrowData = ActivityData.ins.getHeroGrowData(data.id);\r\n        let info = new HeroInfo();\r\n        info.createDefaultData(this._tabData.HeroId, this._tabData.HeroStar);\r\n        this.item_hero.UpdateContent(info);\r\n        this.item_hero.setLevel(0);\r\n        // 设置免费奖励\r\n        this.setFreeAward();\r\n        // 设置付费奖励\r\n        this.setBuyAward();\r\n    }\r\n    setFreeAward() {\r\n        const _tab = this._tabData;\r\n        const awardId = _tab.FreeRewardId;\r\n        const awardCount = _tab.FreeRewardCount;\r\n        let itemInfo = new ItemInfo();\r\n        itemInfo.initItemData(awardId, awardCount);\r\n        this.item_free.initData(itemInfo);\r\n\r\n        if (this._heroGrowData.receivedFreeRewardStars.indexOf(_tab.HeroStar) > -1) {\r\n            // 已经领取\r\n            this.item_free.setSelectState(true);\r\n            this.node_lock.active = false;\r\n            this._canReceive = false;\r\n        } else {\r\n            // 是否可以领取\r\n            this.item_free.setSelectState(false);\r\n            const maxStar = HeroDataControl.ins.getMaxPaintingStar(this._heroGrowData.heroItemId);\r\n            this._canReceive = maxStar >= _tab.HeroStar;\r\n            this.node_lock.active = !this._canReceive;\r\n        }\r\n    }\r\n    setBuyAward() {\r\n        this.node_layout.destroyAllChildren();\r\n        const _tab = this._tabData;\r\n        for (let i = 0; i < _tab.RewardIds.length; i++) {\r\n            const id = _tab.RewardIds[i];\r\n            const count = _tab.RewardCount[i];\r\n            const awardInfo = new ItemInfo();\r\n            awardInfo.itemId = id;\r\n            awardInfo.num = count;\r\n            ItemPoolMgr.ins.createRewadItem(awardInfo, this.node_layout);\r\n        }\r\n        // 设置购买价格\r\n        const rechargeId = this._tabData.RechargeId\r\n        const rechargeTab = tab.getData().RechargeTableById.getValue(rechargeId);\r\n        this.lbl_price.string = ChannelMgr.getSdkRechargeShowPrice(rechargeTab);\r\n        this.setBuyBtn();\r\n    }\r\n    setBuyBtn() {\r\n        // 设置剩余次数\r\n        const buyCount = this._heroGrowData.boughtNotFreeRewardTimesMap[this._tabData.HeroStar]\r\n        const remainTimes = this._tabData.LimitCount - buyCount;\r\n        this.lbl_remain_times.string = String(remainTimes);\r\n        const sp = this.btn_price.node.getComponent(Sprite);\r\n        sp.grayscale = remainTimes <= 0;\r\n        this.btn_price.interactable = remainTimes > 0;\r\n    }\r\n    @ButtonLock(1, () => { })\r\n    clickFree() {\r\n        if (this._canReceive) {\r\n            let msg = new proto.Msg_ReceiveActivityHeroGrowRewardReq();\r\n            msg.activityId = this._heroGrowData.activityId;\r\n            msg.star = this._tabData.HeroStar;\r\n            Net.Send(proto.Ptl.ReceiveActivityHeroGrowRewardReq, msg)\r\n        }\r\n    }\r\n    clickRMB() {\r\n        var self = this;\r\n        if (this._heroGrowData.boughtNotFreeRewardTimesMap[this._tabData.HeroStar] >= this._tabData.LimitCount) {\r\n            return\r\n        }\r\n        PayControl.ins.requestPay(this._tabData.RechargeId, () => {\r\n            this._heroGrowData.boughtNotFreeRewardTimesMap[this._tabData.HeroStar]++;\r\n            self.setBuyBtn();\r\n        })\r\n    }\r\n}\r\n\r\n"]}