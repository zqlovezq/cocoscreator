{"version":3,"sources":["file:///C:/chickenStarClient/client/assets/scripts/logic/model/equip/EquipMasterInfo.ts"],"names":["_decorator","proto","tab","EquipData","ccclass","property","EquipMasterInfo","HeroMasterData","_qualityTable","_enhanceTable","_refineTable","qualityMasterLevel","enhanceMasterLevel","refineMasterLevel","_totalAttrMap","merge","masteInfo","qualityLv","enhanceLv","refineLv","initMaserLevel","list","getData","HeroMasterTable","cfg","HeroMasterTableById","getValue","Level","initTotalAttrMap","Map","atts","qualityTable","concat","AttrList","enhanceTable","refineTable","key","attrTab","EquipAttrTableById","addAttr","AttrType","Base","totalAttrMap","type","num","has","set","get","refreshQualityTable","ins","getHeroMasterTableByTypeAndLevel","MasterType","MasterType_Quality","refreshEnhanceTable","MasterType_Enhance","refreshRefineTable","MasterType_Refine"],"mappings":"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","sourcesContent":["import { _decorator, Component, Node } from 'cc';\r\nimport { proto } from 'client_protocol';\r\nimport { tab } from '../../../Table/table_gen';\r\nimport { EquipData } from './EquipData';\r\nconst { ccclass, property } = _decorator;\r\n\r\n@ccclass('EquipMasterInfo')\r\nexport class EquipMasterInfo extends proto.HeroMasterData {\r\n    private _qualityTable:tab.HeroMasterTable;\r\n    private _enhanceTable:tab.HeroMasterTable;\r\n    private _refineTable:tab.HeroMasterTable;\r\n\r\n    /**品质装备大师等级 */\r\n    public qualityMasterLevel:number=0; \r\n    public enhanceMasterLevel:number=0; \r\n    public refineMasterLevel:number=0; \r\n    private _totalAttrMap:Map<number,number>;\r\n\r\n   \r\n    merge(masteInfo: proto.HeroMasterData) {\r\n        if(masteInfo){\r\n            if(masteInfo.qualityLv){\r\n                this.qualityLv=masteInfo.qualityLv;\r\n            }else{\r\n                this.qualityLv=0;\r\n            }\r\n            if(masteInfo.enhanceLv){\r\n                this.enhanceLv=masteInfo.enhanceLv;\r\n            }else{\r\n                this.enhanceLv=0;\r\n            }\r\n            if(masteInfo.refineLv){\r\n                this.refineLv=masteInfo.refineLv;\r\n            }else{\r\n                this.refineLv=0;\r\n            }\r\n\r\n        }else{\r\n            this.enhanceLv=0;\r\n            this.qualityLv=0;\r\n            this.refineLv=0;\r\n        }\r\n        // for (const key in masteInfo) {\r\n        //     this[key] = masteInfo[key]\r\n        // }\r\n        this._enhanceTable=null;\r\n        this._refineTable=null;\r\n        this._qualityTable=null;\r\n        this._totalAttrMap=null;\r\n        this.initMaserLevel();\r\n      \r\n        \r\n    }\r\n    public initMaserLevel(){\r\n        let list=tab.getData().HeroMasterTable;\r\n        // this.qualityMasterLevel=0;\r\n        // for(let key in list){\r\n        //     let tabdata=list[key];\r\n        //     if(tabdata.Type==tab.MasterType.MasterType_Quality){\r\n        //         if(this.qualityLv>=tabdata.Require){\r\n        //             if(tabdata.Level>=this.qualityMasterLevel){\r\n        //                 this.qualityMasterLevel=tabdata.Level;\r\n        //             }\r\n        //         }\r\n        //     }else if(tabdata.Type==tab.MasterType.MasterType_Enhance){\r\n        //         if(this.enhanceLv>=tabdata.Require){\r\n        //             if(tabdata.Level>=this.enhanceMasterLevel){\r\n        //                 this.enhanceMasterLevel=tabdata.Level;\r\n        //             }\r\n        //         }\r\n        //     }else if(tabdata.Type==tab.MasterType.MasterType_Refine){\r\n        //         if(this.refineLv>=tabdata.Require){\r\n        //             if(tabdata.Level>=this.refineMasterLevel){\r\n        //                 this.refineMasterLevel=tabdata.Level;\r\n        //             }\r\n        //         }\r\n        //     }\r\n\r\n        // }\r\n        if (this.qualityLv != 0) {\r\n            let cfg = tab.getData().HeroMasterTableById.getValue(this.qualityLv);\r\n            if (cfg) {\r\n                this.qualityMasterLevel = cfg.Level;\r\n            }\r\n        }\r\n\r\n        if (this.enhanceLv != 0) {\r\n            let cfg = tab.getData().HeroMasterTableById.getValue(this.enhanceLv);\r\n            if (cfg) {\r\n                this.enhanceMasterLevel = cfg.Level;\r\n            }\r\n        }\r\n\r\n        if (this.refineLv != 0) {\r\n            let cfg = tab.getData().HeroMasterTableById.getValue(this.refineLv);\r\n            if (cfg) {\r\n                this.refineMasterLevel = cfg.Level;\r\n            }\r\n        }\r\n    }\r\n    private initTotalAttrMap(){\r\n        this._totalAttrMap=new Map();\r\n        let atts=[]\r\n        if(this.qualityTable){\r\n            atts=atts.concat(this.qualityTable.AttrList);\r\n        }\r\n        if(this.enhanceTable){\r\n            atts=atts.concat(this.enhanceTable.AttrList);\r\n        }\r\n        if(this.refineTable){\r\n            atts=atts.concat(this.refineTable.AttrList);\r\n        }\r\n        for(let key in atts){\r\n            let attrTab=tab.getData().EquipAttrTableById.getValue(atts[key]);\r\n            this.addAttr(attrTab.AttrType,attrTab.Base);\r\n        }\r\n    }\r\n    get totalAttrMap(){\r\n        if(!this._totalAttrMap){\r\n            this.initTotalAttrMap();\r\n        }\r\n        return this._totalAttrMap;\r\n    }\r\n\r\n    private addAttr(type:number,num:number){\r\n        if(this._totalAttrMap.has(type)){\r\n            this._totalAttrMap.set(type,this._totalAttrMap.get(type)+num);\r\n        }else{\r\n            this._totalAttrMap.set(type,num);\r\n        }\r\n    }\r\n\r\n    get qualityTable(){\r\n        if(this.qualityMasterLevel>0){\r\n            this.refreshQualityTable();\r\n            return this._qualityTable;\r\n        }else{\r\n            return null;\r\n        }\r\n    }\r\n    refreshQualityTable(){\r\n      \r\n        this._qualityTable=EquipData.ins.getHeroMasterTableByTypeAndLevel(tab.MasterType.MasterType_Quality,this.qualityMasterLevel);\r\n    }\r\n\r\n    get enhanceTable(){\r\n        if(this.enhanceMasterLevel>0){\r\n            this.refreshEnhanceTable();\r\n            return this._enhanceTable;\r\n        }else{\r\n            return null;\r\n        }\r\n    }\r\n    refreshEnhanceTable(){\r\n      \r\n        this._enhanceTable=EquipData.ins.getHeroMasterTableByTypeAndLevel(tab.MasterType.MasterType_Enhance,this.enhanceMasterLevel);\r\n    }\r\n\r\n    get refineTable(){\r\n        if(this.refineMasterLevel>0){\r\n            this.refreshRefineTable();\r\n            return this._refineTable;\r\n        }else{\r\n            return null;\r\n        }\r\n    }\r\n    refreshRefineTable(){\r\n        this._refineTable=EquipData.ins.getHeroMasterTableByTypeAndLevel(tab.MasterType.MasterType_Refine,this.refineMasterLevel);\r\n    }\r\n}\r\n\r\n\r\n"]}