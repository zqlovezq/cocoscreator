{"version":3,"sources":["file:///C:/chickenStarClient/client/assets/scripts/framework/action/ShakeAction.ts"],"names":["_decorator","Tween","Vec3","tween","v3","ccclass","property","AcitonType","ShakeAction","shakeTween","shakeNowPos","shakeNode","timeoutHandler","acs","acIndex","runActions","acNode","runOne","stopAll","stopShake","playNext","index","acData","delay","call","runAction","duration","tag","start","callback","position","repeatForever","to","time","Date","getTime","stop","stopAllByTag"],"mappings":"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","sourcesContent":["import { _decorator, Tween, Vec3, Node, tween, v3 } from 'cc';\nconst { ccclass, property } = _decorator;\n\n// //震屏\nexport interface ShakeActionData {\n    delay?: number\n    duration: number\n}\n// /**\n// * 动作枚举\n// */\nexport enum AcitonType {\n    shake = 1 //震屏\n}\n\n@ccclass('ShakeAction')\nexport class ShakeAction {\n    shakeTween: any\n    shakeNowPos: Vec3\n    shakeNode: Node\n    timeoutHandler: number\n    acs: ShakeActionData[]\n    acIndex: number\n    // /**\n    // * 播放震屏\n    // * @param acNode 动作节点\n    // * @param acs 动作序列\n    // */\n    runActions(acNode: Node, acs: ShakeActionData[]) {\n        this.shakeNode = acNode\n        this.acs = acs\n        this.runOne(0)\n    }\n    // /**\n    // * 停止震屏\n    // */\n    stopAll() {\n        this.stopShake()\n        this.acs = null\n    }\n    playNext() {\n        this.acIndex = this.acIndex + 1\n        this.runOne(this.acIndex)\n    }\n    runOne(index: number) {\n        if (this.acs == null) {\n            return\n        }\n        this.acIndex = index\n        var acData = this.acs[index]\n        if (acData == null) {\n            return\n        }\n        if (acData.delay) {\n            tween(this.shakeNode)\n                .delay(acData.delay)\n                .call(()=>{\n                    this.runAction(this.shakeNode, acData.duration)\n                })\n                .tag(-999)\n                .start()\n        } else {\n            this.runAction(this.shakeNode, acData.duration)\n        }\n    }\n    // /**\n    // *\n    // * @param acNode 动作节点\n    // * @param duration 时间（秒）\n    // */\n    runAction(acNode: Node, duration: number, callback?: any) {\n        this.stopShake()\n\n        this.shakeNode = acNode\n        this.shakeNowPos = new Vec3(acNode.position)\n        \n        this.shakeTween = tween(acNode).repeatForever(\n            tween()\n                .to(0.02, { position: v3(5, 7) })\n                .to(0.02, { position: v3(-6, 7) })\n                .to(0.02, { position: v3(-13, 3) })\n                .to(0.02, { position: v3(3, -6) })\n                .to(0.02, { position: v3(-5, 5) })\n                .to(0.02, { position: v3(2, -8) })\n                .to(0.02, { position: v3(-8, -10) })\n                .to(0.02, { position: v3(3, 10) })\n                .to(0.02, { position: v3(0, 0) })\n        ).start()\n\n        var time = new Date().getTime()\n\n        tween(this.shakeNode)\n        .delay(duration)\n        .call(()=>{\n            this.stopShake()\n            this.playNext()\n            callback && callback()\n        })\n        .tag(-999)\n        .start()\n    }\n    stopShake() {\n        if (this.shakeTween) {\n            this.shakeTween.stop()\n            this.shakeNode.position = this.shakeNowPos\n            this.shakeTween = null\n        }\n        Tween.stopAllByTag(999)\n    }\n\n}\n"]}