{"version":3,"sources":["file:///C:/chickenStarClient/client/assets/scripts/logic/model/rareBook/RareBookHandBookNode.ts"],"names":["_decorator","Component","instantiate","Label","Node","RareBookData","RareBookItem","UIMgr","ViewName","GameUtil","ccclass","property","RareBookHandBookNode","currTag","itemPrefab","allData","rareItems","onTouchItem","info","ins","show","viewName","RareBookDetailView","data","start","initView","updateScore","getBookInfos","count","key","isLock","numLab","string","length","initItems","scoreLab","convertNumber","powerScore","updateItem","itemId","updateView","node","active","index","bookTable","Class","parent","contentNode","push","getComponent","initData","onClickToggle","event","type","Number","currTargetNode","getChildByName","target"],"mappings":"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","sourcesContent":["import { _decorator, Component, instantiate, Label, Node, Prefab } from 'cc';\r\nimport { RareBookData } from './RareBookData';\r\nimport { tab } from '../../../Table/table_gen';\r\nimport { RareBookInfo } from './RareBookInfo';\r\nimport { RareBookItem } from './RareBookItem';\r\nimport { UIMgr } from '../../mgr/UIMgr';\r\nimport { ViewName } from '../../define/ViewDefine';\r\nimport { GameUtil } from '../../utils/GameUtil';\r\nconst { ccclass, property } = _decorator;\r\n\r\n/**\r\n * \r\n * RareBookHandBookItem\r\n * zhudingchao\r\n * Wed May 22 2024 11:19:11 GMT+0800 (中国标准时间)\r\n * db://assets/scripts/logic/model/rareBook/RareBookHandBookItem.ts\r\n *\r\n */\r\n\r\n@ccclass('RareBookHandBookNode')\r\nexport class RareBookHandBookNode extends Component {\r\n    @property(Label)\r\n    scoreLab:Label=null;\r\n    @property(Node)\r\n    contentNode:Node=null;\r\n    @property(Label)\r\n    numLab:Label=null;\r\n    @property(Node)\r\n    currTargetNode:Node=null;\r\n    private currTag:number=0;\r\n    private itemPrefab:Prefab=null;\r\n    private allData:Array<RareBookInfo>;\r\n    private rareItems:Array<RareBookItem>=[];\r\n    // private currTargetNode:Node;\r\n    start() {\r\n\r\n    }\r\n    initView(itemPrefab:Prefab=null){\r\n\r\n        this.allData=[];\r\n        if(itemPrefab){\r\n            this.itemPrefab=itemPrefab;\r\n        }\r\n        this.updateScore();\r\n        this.allData=RareBookData.ins.getBookInfos(true);\r\n        let count=0;\r\n        for(let key in this.allData){\r\n            if(this.allData[key].isLock){\r\n                count++;\r\n            }\r\n        }\r\n        // this.allData.sort((a,b)=>{\r\n        //     if(a.isRedPoint&&b.isRedPoint){\r\n        //         return b.bookTable.Aptitude-a.bookTable.Aptitude;\r\n        //     }\r\n        //     if(a.isRedPoint){\r\n        //         return -1;\r\n        //     }\r\n        //     if(b.isRedPoint){\r\n        //         return 1;\r\n        //     }\r\n        //     if(a.isLock&&b.isLock){\r\n        //         return b.bookTable.Aptitude-a.bookTable.Aptitude;\r\n        //     }\r\n        //     if(a.isLock){\r\n        //         return -1;\r\n        //     }\r\n        //     if(b.isLock){\r\n        //         return 1;\r\n        //     }\r\n        //     return b.bookTable.Aptitude-a.bookTable.Aptitude;\r\n        // })\r\n        \r\n        // let tables=tab.getData().BookTable;\r\n        // for(let key in tables){\r\n        //     let info=havaBooks.find(a=>a.itemId==tables[key].Id);\r\n        //     if(!info){\r\n        //         info=new RareBookInfo();\r\n        //         info.initItemId(tables[key].Id);\r\n        //     }\r\n            \r\n        //     this.allData.push(info);\r\n        // }\r\n        this.numLab.string=count+\"/\"+this.allData.length;\r\n        this.initItems();\r\n\r\n\r\n    }\r\n \r\n    public updateScore() {\r\n        this.scoreLab.string=GameUtil.convertNumber(RareBookData.ins.powerScore)+\"\";\r\n    }\r\n    updateItem(itemId:number){\r\n         for(let key in this.rareItems){\r\n            if(this.rareItems[key]&&this.rareItems[key].info.itemId==itemId){\r\n                    this.rareItems[key].updateView();\r\n            }\r\n         }\r\n    }\r\n    initItems(){\r\n        for(let key in this.rareItems){\r\n            this.rareItems[key].node.active=false;\r\n        }\r\n        let index=0;\r\n        for(let key in this.allData){\r\n            if(this.currTag==0||this.allData[key].bookTable.Class==this.currTag){\r\n                if(!this.rareItems[index]){\r\n                    let node=instantiate(this.itemPrefab);\r\n                    node.parent=this.contentNode;\r\n                    this.rareItems.push(node.getComponent(RareBookItem));\r\n                }\r\n                this.rareItems[index].node.active=true;\r\n                this.rareItems[index].initData(this.allData[key],true,this.onTouchItem,true,false,true);\r\n                index++;\r\n            }\r\n          \r\n            // this.rareItems[k\r\n        }\r\n    }\r\n    onTouchItem=(info:RareBookInfo)=>{\r\n        \r\n          UIMgr.ins.show({ viewName: ViewName.RareBookDetailView,data:{\"bookInfos\":this.allData,\"currInfo\":info}})\r\n        // UIMgr.ins.show({ viewName: ViewName.RareBookRewardPreviewPop})\r\n        // UIMgr.ins.show({ viewName: ViewName.RareBookEquipPop,data:{\"bookInfo\":info}})\r\n        //    UIMgr.ins.show({ viewName: ViewName.WeaponPop})\r\n    }\r\n\r\n    onClickToggle(event,type){\r\n        type=Number(type);\r\n        if(this.currTag!=type){\r\n            this.currTag=type;\r\n            this.initItems();\r\n            if (this.currTargetNode) {\r\n                this.currTargetNode.getChildByName(\"redNode\").active = true;\r\n            }\r\n            event.target.getChildByName(\"redNode\").active = false;\r\n            this.currTargetNode = event.target;\r\n        }\r\n\r\n    }\r\n  \r\n\r\n\r\n}"]}