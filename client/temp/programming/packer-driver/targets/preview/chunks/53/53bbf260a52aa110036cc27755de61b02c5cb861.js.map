{"version":3,"sources":["file:///C:/chickenStarClient/client/assets/scripts/logic/model/rareBook/RareBookDetailView.ts"],"names":["_decorator","Button","Color","error","instantiate","Label","Node","Prefab","RichText","Toggle","ViewBase","RareBookItem","tab","RareBookData","LangMgr","RareBookAttributeItem","CommonItem","ShowItemNotEnoughTips","ShowTips","UIMgr","RareBookSmallItem","ConsumeResourceItem","ItemPoolMgr","ItemInfo","ItemData","HeroStar","ViewName","WeaponItem","EventMgr","proto","RareBookControl","LocalEvent","ccclass","property","RareBookDetailView","bookInfos","currIndex","currBookInfo","currTag","attrItems","studyComItems","comprehendItems","nextLevelTable","nextStarTable","register","onMsg","Ptl","CombineBookFragmentRsp","on_s2c_CombineBookFragmentRsp","UpgradeBookLevelRsp","on_s2c_UpgradeBookLevelRsp","UpgradeBookStarRsp","on_s2c_UpgradeBookStarRsp","onLocal","JumpLayerSuceess","onJumpLayerSuceess","opName","Module","Module_RareBookView","onClose","onShow","openData","infos","ins","getBookInfos","indexOf","initView","isLock","toggle","isChecked","firstLookRed","isRedPoint","emitLocal","updateBookRedPoint","initBaseView","v","getLab","HeroClass","bookTable","Class","vocationLab","string","getCombineString","setViewShowStage","updateRed","bookItem","initData","initDetailView","initStudyView","initComprehendView","detailNode","active","studyNode","comprehendNode","attrMap","index","hideArrtItem","forEach","value","key","item","creatorItem","advanceId","getBookAdvanceId","itemId","arrowNode","comItems","node","initBookItemId","onTouchWeaponItem","describeRichtext","bookStarTable","BookDescription","updateBtnState","starItem","showStar","star","studyLevelUpNode","getChildByName","getComponent","interactable","bookSmallItem","describeRichtext2","isLevelLimit","studyMaxLevelNode","studyLimitLevelNode","nextLevel","level","nextLavelTable","getBookLevelTable","Aptitude","nextAttrMap","getAttrMapByLevelRatio","Ratio","get","MaterialIdList","id","num","MaterialCountList","info","currNum","getCount","initItemData","itemTable","Type","ItemType","ItemType_Currency","consumeResourceItem","needNum","createItem","stuffLayout","push","gotoBtnNode","activateBtnNode","isCanActivate","bookSmallItem2","isMaxStar","nextStar","getBoolStarTable","comprehendLevelUpNode","comprehendMaxLevelNode","nextStarNode","starArrowNode","nowStar","ratio","bookLevelTable","AttrType","AttrValue","totoal","isConsumeOther","Quality","getData","GetKeyValue_ConfigTable","BookStarUniversalMaterialQuality","Number","stuffLayout2","parent","hideConsumeFenMu","describeRichtext3","Description","BookStarUniversalMaterial","currNum2","comprehendHaveLab","comprehendNeedLab","cStr","InterfaceTxtGreen","InterfaceTxtRed","color","fromHEX","attrItemPrefab","attributeNode","onClickToggle","event","tag","scheduleOnce","onClickLeft","length","onClickRight","onClickGroppop","show","viewName","RareBookGroupPop","data","onClickPreView","RareBookLevelPreviewPop","onClickGotoBtn","onClickUpStar","requestUpgradeBookStar","onClickStudy","itemid","isItemsEnoughByList","CurrencyType","CurrencyType_Gold","ResourceBuyPop","requestUpgradeBookLevel","RareBookInfoItemPop","onClickActivate","requestCombineBookFragment","fragmentTable","Id","updateBookItemView","updateView","msg","code","CommonErrorCode","Succeed","StarUpPop","redPoints","isCanLevel","isCanStudy","isCanStar","isCanUpStar","onDisable"],"mappings":"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","sourcesContent":["import { _decorator, Button, Color, Component, error, instantiate, Label, log, Node, Prefab, RichText, Toggle } from 'cc';\r\nimport { ViewBase } from '../../../framework/base/ViewBase';\r\nimport { RareBookItem } from './RareBookItem';\r\nimport { HeroItem } from '../item/HeroItem';\r\nimport { RareBookInfo } from './RareBookInfo';\r\nimport { tab } from '../../../Table/table_gen';\r\nimport { RareBookData } from './RareBookData';\r\nimport { LangMgr } from '../../mgr/LangMgr';\r\nimport { RareBookAttributeItem } from './RareBookAttributeItem';\r\nimport { CommonItem } from '../item/CommonItem';\r\nimport { ShowItemNotEnoughTips, ShowTips, UIMgr } from '../../mgr/UIMgr';\r\nimport { RareBookSmallItem } from './RareBookSmallItem';\r\nimport { ConsumeResourceItem } from '../common/ConsumeResourceItem';\r\nimport { ItemPoolMgr } from '../item/ItemPoolMgr';\r\nimport { ItemInfo } from '../item/ItemInfo';\r\nimport { ItemData } from '../item/ItemData';\r\nimport { HeroStar } from '../hero/HeroStar';\r\nimport { ViewName } from '../../define/ViewDefine';\r\nimport { WeaponItem } from '../common/WeaponItem';\r\nimport { EventMgr } from '../../mgr/EventMgr';\r\nimport { proto } from 'client_protocol';\r\nimport { RareBookControl } from './RareBookControl';\r\nimport { LocalEvent } from '../../define/LocalEvent';\r\nconst { ccclass, property } = _decorator;\r\n\r\n/**\r\n * \r\n * RareBookDetailView\r\n * zhudingchao\r\n * Thu May 23 2024 15:50:18 GMT+0800 (中国标准时间)\r\n * db://assets/scripts/logic/model/rareBook/RareBookDetailView.ts\r\n *\r\n */\r\n\r\n@ccclass('RareBookDetailView')\r\nexport class RareBookDetailView extends ViewBase {\r\n    @property(RareBookItem)\r\n    bookItem: RareBookItem = null;\r\n    // @property(Node)\r\n    // grouppopBtnNode: Node = null;\r\n    @property(Label)\r\n    vocationLab: Label = null;\r\n    @property(Node)\r\n    attributeNode: Node = null;\r\n    @property(Node)\r\n    arrowNode: Node = null;\r\n    @property([WeaponItem])\r\n    comItems: Array<WeaponItem> = [];\r\n    @property(RichText)\r\n    describeRichtext: RichText = null;\r\n    @property(Node)\r\n    detailNode: Node = null;\r\n    @property(Node)\r\n    studyNode: Node = null;\r\n    @property(Node)\r\n    comprehendNode: Node = null;\r\n    @property(Prefab)\r\n    attrItemPrefab: Prefab = null;\r\n    @property(Node)\r\n    gotoBtnNode: Node = null;\r\n    @property(RareBookSmallItem)\r\n    bookSmallItem: RareBookSmallItem = null;\r\n    @property(RareBookSmallItem)\r\n    bookSmallItem2: RareBookSmallItem = null;\r\n    @property(RichText)\r\n    describeRichtext2: RichText = null;\r\n    @property(Label)\r\n    describeRichtext3: Label = null;\r\n    @property(Node)\r\n    studyLevelUpNode: Node = null;\r\n    @property(Node)\r\n    studyMaxLevelNode: Node = null;\r\n    @property(Node)\r\n    studyLimitLevelNode: Node = null;\r\n    @property(Node)\r\n    stuffLayout: Node = null;\r\n    @property(Node)\r\n    stuffLayout2: Node = null;\r\n    @property(ConsumeResourceItem)\r\n    consumeResourceItem: ConsumeResourceItem = null;\r\n    @property(HeroStar)\r\n    nowStar: HeroStar = null;\r\n    @property(HeroStar)\r\n    nextStar: HeroStar = null;\r\n    @property(Node)\r\n    nowStarNode: Node = null;\r\n    @property(Node)\r\n    nextStarNode: Node = null;\r\n    @property(Node)\r\n    starArrowNode: Node = null;\r\n    @property(Node)\r\n    comprehendLevelUpNode: Node = null;\r\n    @property(Node)\r\n    comprehendMaxLevelNode: Node = null;\r\n    @property(Label)\r\n    comprehendNeedLab: Label = null;\r\n    @property(Label)\r\n    comprehendHaveLab: Label = null;\r\n    @property(Node)\r\n    activateBtnNode: Node = null;\r\n    @property(Toggle)\r\n    toggle: Toggle = null;\r\n    @property(HeroStar)\r\n    starItem: HeroStar = null;\r\n    @property([Node])\r\n    redPoints: Node[] = [];\r\n    private bookInfos: Array<RareBookInfo>;\r\n    private currIndex: number = 0;\r\n    private currBookInfo: RareBookInfo;\r\n    private currTag: number = 1;\r\n    private attrItems: Array<RareBookAttributeItem> = [];\r\n\r\n    private studyComItems: Array<CommonItem>;\r\n    private comprehendItems: Array<CommonItem>;\r\n    private nextLevelTable: tab.BookLevelTable;\r\n    private nextStarTable: tab.BookStarTable;\r\n    // private isGrouppop:boolean=false;  //是否是融汇\r\n    register(): void {\r\n        EventMgr.onMsg(proto.Ptl.CombineBookFragmentRsp, this.on_s2c_CombineBookFragmentRsp, this);\r\n        EventMgr.onMsg(proto.Ptl.UpgradeBookLevelRsp, this.on_s2c_UpgradeBookLevelRsp, this);\r\n        EventMgr.onMsg(proto.Ptl.UpgradeBookStarRsp, this.on_s2c_UpgradeBookStarRsp, this);\r\n        EventMgr.onLocal(LocalEvent.JumpLayerSuceess, this.onJumpLayerSuceess, this);\r\n    }\r\n\r\n    onJumpLayerSuceess(opName: tab.Module) {\r\n        if (opName == tab.Module.Module_RareBookView) {\r\n            this.onClose()\r\n        }\r\n    }\r\n    onShow(): void {\r\n        if (this.openData[\"bookInfos\"]) {\r\n            this.bookInfos = this.openData[\"bookInfos\"];\r\n        } else {\r\n            let infos = RareBookData.ins.getBookInfos(true);\r\n            //排序-------------\r\n            this.bookInfos = infos;\r\n        }\r\n        if (this.openData[\"index\"]) {\r\n            this.currIndex = this.openData[\"index\"];\r\n        }\r\n        if (this.openData[\"currInfo\"]) {\r\n            this.currBookInfo = this.openData[\"currInfo\"];\r\n        }\r\n        if (!this.bookInfos) {\r\n            error(\"打开view数据错误\");\r\n            return;\r\n        }\r\n        if (this.currBookInfo) {\r\n            this.currIndex = this.bookInfos.indexOf(this.currBookInfo);\r\n        }\r\n        this.initView();\r\n\r\n\r\n    }\r\n    initView() {\r\n        this.currBookInfo = this.bookInfos[this.currIndex];\r\n        if (!this.currBookInfo.isLock && this.currTag != 1) {\r\n            this.currTag = 1;\r\n            this.toggle.isChecked = true;\r\n        }\r\n        if (this.currBookInfo.isLock && this.currBookInfo.firstLookRed) {\r\n            this.currBookInfo.isRedPoint = false;\r\n            EventMgr.emitLocal(LocalEvent.updateBookRedPoint);\r\n        }\r\n        this.initBaseView();\r\n        let v = LangMgr.getLab(tab.HeroClass[this.currBookInfo.bookTable.Class]);\r\n        this.vocationLab.string = LangMgr.getCombineString(\"ui_rarebook_1\", [v]);\r\n        this.setViewShowStage();\r\n        this.updateRed();\r\n        // if (this.currTag == 1) {\r\n        //     this.initDetailView();\r\n        // }else if(this.currTag==2){\r\n        //     this.initStudyView();\r\n        // }else if(this.currTag==3){\r\n        //     this.initComprehendView();\r\n        // }\r\n    }\r\n    initBaseView() {\r\n        this.bookItem.initData(this.currBookInfo, false, null, true, true);\r\n        // let stab = RareBookData.ins.getSerieTableByBookId(this.currBookInfo.itemId);\r\n        // if (stab) {\r\n        //     this.grouppopBtnNode.active = true;\r\n        // } else {\r\n        //     this.grouppopBtnNode.active = false;\r\n        // }\r\n    }\r\n    setViewShowStage() {\r\n        if (this.currTag == 1) {\r\n            this.initDetailView();\r\n        } else if (this.currTag == 2) {\r\n            this.initStudyView();\r\n        } else if (this.currTag == 3) {\r\n            this.initComprehendView();\r\n        }\r\n    }\r\n    initDetailView() {\r\n        this.detailNode.active = true;\r\n        this.studyNode.active = false;\r\n        this.comprehendNode.active = false;\r\n\r\n        let attrMap = this.currBookInfo.attrMap;\r\n        let index = 0;\r\n        this.hideArrtItem();\r\n        attrMap.forEach((value, key) => {\r\n            let item = this.creatorItem(index);\r\n            item.initView(key, value);\r\n            index++;\r\n        });\r\n        let advanceId = RareBookData.ins.getBookAdvanceId(this.currBookInfo.itemId);\r\n        if (advanceId) {\r\n            this.arrowNode.active = true;\r\n            this.comItems[0].node.active = true;\r\n            this.comItems[0].initBookItemId(advanceId, true, true, false, this.onTouchWeaponItem);\r\n            this.comItems[1].node.active = true;\r\n            this.comItems[1].initData(this.currBookInfo, true, true, false, this.onTouchWeaponItem)\r\n        } else {\r\n            this.comItems[0].node.active = true;\r\n            this.comItems[0].initData(this.currBookInfo, true, true, false, this.onTouchWeaponItem);\r\n            this.comItems[1].node.active = false;\r\n            this.arrowNode.active = false;\r\n        }\r\n        this.describeRichtext.string = LangMgr.getLab(this.currBookInfo.bookStarTable.BookDescription);\r\n        this.updateBtnState();\r\n        this.starItem.showStar(this.currBookInfo.star);\r\n        // this.gotoBtnNode.active = !this.currBookInfo.isLock;\r\n\r\n\r\n    }\r\n    initStudyView() {\r\n        this.studyLevelUpNode.getChildByName(\"broke_btn\").getComponent(Button).interactable = true\r\n        this.detailNode.active = false;\r\n        this.studyNode.active = true;\r\n        this.comprehendNode.active = false;\r\n        if (!this.studyComItems) {\r\n            this.studyComItems = [];\r\n        }\r\n        this.bookSmallItem.initView(this.currBookInfo, true)\r\n        this.describeRichtext2.string = LangMgr.getLab(this.currBookInfo.bookStarTable.BookDescription);\r\n        if (!this.currBookInfo.isLevelLimit()) {\r\n            this.studyLevelUpNode.active = true;\r\n            this.studyMaxLevelNode.active = false;\r\n            this.studyLimitLevelNode.active = false;\r\n            let nextLevel = this.currBookInfo.level + 1;\r\n            let nextLavelTable = RareBookData.ins.getBookLevelTable(this.currBookInfo.bookTable.Aptitude, this.currBookInfo.bookTable.Class, nextLevel)\r\n            this.nextLevelTable = nextLavelTable;\r\n            if (nextLavelTable) {\r\n                let attrMap = this.currBookInfo.attrMap;\r\n                let nextAttrMap = this.currBookInfo.getAttrMapByLevelRatio(nextLavelTable.Ratio);\r\n                let index = 0;\r\n                this.hideArrtItem();\r\n                attrMap.forEach((value, key) => {\r\n                    let item = this.creatorItem(index);\r\n                    item.initView(key, value, nextAttrMap.get(key));\r\n                    index++;\r\n                });\r\n\r\n                index = 0;\r\n                for (let key in nextLavelTable.MaterialIdList) {\r\n                    let id = nextLavelTable.MaterialIdList[key];\r\n                    let num = nextLavelTable.MaterialCountList[key];\r\n                    let info = new ItemInfo();\r\n                    let currNum = ItemData.ins.getCount(id);\r\n                    info.initItemData(id, currNum);\r\n                    if (info.itemTable.Type == tab.ItemType.ItemType_Currency) {\r\n                        this.consumeResourceItem.initData(id, num);\r\n                    } else {\r\n                        info.needNum = num;\r\n                        if (!this.studyComItems[index]) {\r\n                            let item = ItemPoolMgr.ins.createItem(info, this.stuffLayout, true, true,);\r\n                            this.studyComItems.push(item.getComponent(CommonItem));\r\n                        } else {\r\n                            this.studyComItems[index].initData(info, true, true);\r\n                        }\r\n\r\n                        index++;\r\n\r\n                    }\r\n\r\n\r\n                }\r\n\r\n            } else {\r\n                let attrMap = this.currBookInfo.attrMap;\r\n                let index = 0;\r\n                this.hideArrtItem();\r\n                attrMap.forEach((value, key) => {\r\n                    let item = this.creatorItem(index);\r\n                    item.initView(key, value, -1);\r\n                    index++;\r\n                });\r\n                //满级状态\r\n                this.studyLevelUpNode.active = false;\r\n                this.studyMaxLevelNode.active = false;\r\n                this.studyLimitLevelNode.active = true;\r\n            }\r\n        } else {\r\n            let attrMap = this.currBookInfo.attrMap;\r\n            let index = 0;\r\n            this.hideArrtItem();\r\n            attrMap.forEach((value, key) => {\r\n                let item = this.creatorItem(index);\r\n                item.initView(key, value, -1);\r\n                index++;\r\n            });\r\n            //等级上限\r\n            this.nextLevelTable = null;\r\n            this.studyLevelUpNode.active = false;\r\n            this.studyMaxLevelNode.active = true;\r\n            this.studyLimitLevelNode.active = false;\r\n        }\r\n\r\n    }\r\n\r\n    updateBtnState() {\r\n        if (this.currBookInfo.isLock) {\r\n            this.gotoBtnNode.active = false;\r\n            this.activateBtnNode.active = false;\r\n        } else {\r\n            if (this.currBookInfo.isCanActivate()) {\r\n                this.activateBtnNode.active = true;\r\n                this.gotoBtnNode.active = false;\r\n            } else {\r\n                this.gotoBtnNode.active = true;\r\n                this.activateBtnNode.active = false;\r\n            }\r\n        }\r\n\r\n\r\n    }\r\n\r\n    initComprehendView() {\r\n        this.detailNode.active = false;\r\n        this.studyNode.active = false;\r\n        this.comprehendNode.active = true;\r\n        if (!this.comprehendItems) {\r\n            this.comprehendItems = [];\r\n        }\r\n        this.bookSmallItem2.initView(this.currBookInfo, true)\r\n        if (!this.currBookInfo.isMaxStar()) {\r\n            let nextStar = this.currBookInfo.star + 1;\r\n            let nextStarTable = RareBookData.ins.getBoolStarTable(this.currBookInfo.itemId, nextStar)\r\n            if (nextStarTable) {\r\n                this.comprehendLevelUpNode.active = true;\r\n                this.comprehendMaxLevelNode.active = false;\r\n                this.nextStarNode.active = true;\r\n                this.starArrowNode.active = true;\r\n                this.nowStar.showStar(this.currBookInfo.star);\r\n                this.nextStar.showStar(nextStar);\r\n                let attrMap = this.currBookInfo.attrMap;\r\n                let ratio = this.currBookInfo.bookLevelTable ? this.currBookInfo.bookLevelTable.Ratio : 0\r\n                let nextAttrMap = this.currBookInfo.getAttrMapByLevelRatio(ratio, nextStarTable.AttrType, nextStarTable.AttrValue);\r\n                let index = 0;\r\n                this.hideArrtItem();\r\n                attrMap.forEach((value, key) => {\r\n                    let item = this.creatorItem(index);\r\n                    item.initView(key, value, nextAttrMap.get(key));\r\n                    index++;\r\n                });\r\n\r\n                for (let key in this.comprehendItems) {\r\n                    this.comprehendItems[key].node.active = false;\r\n                }\r\n                index = 0;\r\n                let totoal: number = 0;\r\n                let isConsumeOther = this.currBookInfo.itemTable.Quality >= tab.getData().GetKeyValue_ConfigTable().BookStarUniversalMaterialQuality;\r\n                // for (let key in nextStarTable.MaterialIdList) {\r\n                let id = this.currBookInfo.bookStarTable.MaterialIdList[index];\r\n                let num = this.currBookInfo.bookStarTable.MaterialCountList[index];\r\n                let info = new ItemInfo();\r\n                let currNum = Number(ItemData.ins.getCount(id));\r\n                info.initItemData(id, currNum);\r\n                if (!this.comprehendItems[index]) {\r\n                    let item = ItemPoolMgr.ins.createItem(info, this.stuffLayout2);\r\n                    item.parent = this.stuffLayout2;\r\n                    this.comprehendItems.push(item.getComponent(CommonItem));\r\n                } else {\r\n                    this.comprehendItems[index].node.active = true;\r\n                    // this.comprehendItems[index].initData(info, true,true);\r\n                }\r\n                if (currNum > num) {\r\n                    info.needNum = num;\r\n                    info.num = num;\r\n                } else {\r\n                    if (isConsumeOther) {\r\n                        info.needNum = currNum;\r\n                        info.num = currNum;\r\n                    } else {\r\n                        info.needNum = num;\r\n                        info.num = currNum;\r\n                    }\r\n\r\n                }\r\n                this.comprehendItems[index].initData(info, true, true);\r\n                this.comprehendItems[index].hideConsumeFenMu();\r\n                totoal += currNum;\r\n\r\n                // if(this.currBookInfo.)\r\n\r\n                this.describeRichtext3.string = LangMgr.getLab(nextStarTable.Description);\r\n                if (this.currBookInfo.itemTable.Quality >= tab.getData().GetKeyValue_ConfigTable().BookStarUniversalMaterialQuality && totoal < num) {\r\n                    index++;\r\n                    let itemId = tab.getData().GetKeyValue_ConfigTable().BookStarUniversalMaterial;\r\n                    let info = new ItemInfo();\r\n                    let currNum2 = Number(ItemData.ins.getCount(itemId));\r\n                    info.initItemData(itemId, currNum2);\r\n                    if (!this.comprehendItems[index]) {\r\n                        let item = ItemPoolMgr.ins.createItem(info, this.stuffLayout2, true);\r\n                        item.parent = this.stuffLayout2;\r\n                        this.comprehendItems.push(item.getComponent(CommonItem));\r\n                    } else {\r\n                        this.comprehendItems[index].node.active = true;\r\n\r\n                    }\r\n                    info.needNum = num - currNum;\r\n                    if (info.needNum <= currNum2) {\r\n                        info.num = info.needNum;\r\n                    } else {\r\n                        info.num = currNum2;\r\n                    }\r\n                    this.comprehendItems[index].initData(info, true, true);\r\n                    this.comprehendItems[index].hideConsumeFenMu();\r\n                    totoal += currNum2;\r\n                }\r\n\r\n                this.comprehendHaveLab.string = totoal + \"\";\r\n                this.comprehendNeedLab.string = num + \"\";\r\n                let cStr = \"\"\r\n                if (totoal >= num) {\r\n                    cStr = tab.getData().GetKeyValue_ConfigTable().InterfaceTxtGreen;\r\n\r\n                } else {\r\n                    cStr = tab.getData().GetKeyValue_ConfigTable().InterfaceTxtRed;\r\n                }\r\n                this.comprehendHaveLab.color = new Color().fromHEX(cStr);\r\n                // index++;\r\n                // }\r\n            }\r\n            this.nextStarTable = nextStarTable;\r\n        } else {\r\n            this.nowStar.showStar(this.currBookInfo.star);\r\n            this.nextStarNode.active = false;\r\n            this.starArrowNode.active = false;\r\n            this.comprehendLevelUpNode.active = false;\r\n            this.comprehendMaxLevelNode.active = true;\r\n            this.describeRichtext3.string = LangMgr.getLab(this.currBookInfo.bookStarTable.Description);\r\n            //满级状态\r\n            this.nextStarTable = null;\r\n            let attrMap = this.currBookInfo.attrMap;\r\n            let index = 0;\r\n            this.hideArrtItem();\r\n            attrMap.forEach((value, key) => {\r\n                let item = this.creatorItem(index);\r\n                item.initView(key, value, -1);\r\n                index++;\r\n            });\r\n        }\r\n\r\n    }\r\n    private hideArrtItem() {\r\n        for (let key in this.attrItems) {\r\n            this.attrItems[key].node.active = false;\r\n        }\r\n    }\r\n    creatorItem(index: number) {\r\n        if (!this.attrItems[index]) {\r\n            let node = instantiate(this.attrItemPrefab);\r\n            node.parent = this.attributeNode;\r\n            this.attrItems.push(node.getComponent(RareBookAttributeItem));\r\n        }\r\n        this.attrItems[index].node.active = true;\r\n        return this.attrItems[index];\r\n\r\n    }\r\n\r\n\r\n    onClickToggle(event, tag) {\r\n        tag = Number(tag);\r\n        if (this.currBookInfo.isLock) {\r\n            if (this.currTag != tag) {\r\n                this.currTag = tag;\r\n                this.setViewShowStage();\r\n            }\r\n        } else {\r\n            if (tag != 1) {\r\n                this.scheduleOnce(() => {\r\n                    this.toggle.isChecked = true;\r\n                })\r\n                ShowTips(LangMgr.getLab(\"Tips_rarebook_1\"))\r\n                //ShowTips(\"获得后解锁\")\r\n            }\r\n        }\r\n\r\n\r\n\r\n    }\r\n    onClickLeft() {\r\n        this.currIndex--;\r\n        if (this.currIndex < 0) {\r\n            this.currIndex = this.bookInfos.length - 1;\r\n        }\r\n        this.initView();\r\n    }\r\n    onClickRight() {\r\n        this.currIndex++;\r\n        if (this.currIndex >= this.bookInfos.length) {\r\n            this.currIndex = 0;\r\n        }\r\n        this.initView();\r\n    }\r\n    onClickGroppop() {\r\n        UIMgr.ins.show({ viewName: ViewName.RareBookGroupPop, data: { \"itemId\": this.currBookInfo.itemId } })\r\n    }\r\n\r\n    onClickPreView() {\r\n        UIMgr.ins.show({ viewName: ViewName.RareBookLevelPreviewPop, data: { \"bookInfo\": this.currBookInfo } })\r\n    }\r\n    onClickGotoBtn() {\r\n        //ShowTips(\"前往寻经\");\r\n        ShowTips(LangMgr.getLab(\"ui_rarebook_11\"));\r\n    }\r\n    /**\r\n     * 点击升星\r\n     */\r\n    onClickUpStar() {\r\n        if (this.currBookInfo.bookStarTable && !this.currBookInfo.isMaxStar()) {\r\n            let id = this.currBookInfo.bookStarTable.MaterialIdList[0];\r\n            let needNum = this.currBookInfo.bookStarTable.MaterialCountList[0];\r\n            let currNum = Number(ItemData.ins.getCount(id));\r\n            if (this.currBookInfo.itemTable.Quality >= tab.getData().GetKeyValue_ConfigTable().BookStarUniversalMaterialQuality) {\r\n                let itemId = tab.getData().GetKeyValue_ConfigTable().BookStarUniversalMaterial;\r\n                let currNum2 = Number(ItemData.ins.getCount(itemId));\r\n                currNum += currNum2;\r\n\r\n            }\r\n            if (needNum <= currNum) {\r\n                RareBookControl.ins.requestUpgradeBookStar(this.currBookInfo.id);\r\n            } else {\r\n                ShowItemNotEnoughTips(id);\r\n            }\r\n        }\r\n\r\n    }\r\n    onClickStudy() {\r\n        if (this.nextLevelTable) {\r\n            let itemid = ItemData.ins.isItemsEnoughByList(this.nextLevelTable.MaterialIdList, this.nextLevelTable.MaterialCountList);\r\n            if (itemid > 0) {\r\n                if (itemid === tab.CurrencyType.CurrencyType_Gold){\r\n                    ShowItemNotEnoughTips(tab.CurrencyType.CurrencyType_Gold);\r\n                    UIMgr.ins.show({ viewName: ViewName.ResourceBuyPop, data: { \"itemId\": tab.CurrencyType.CurrencyType_Gold } })\r\n                }else{\r\n                    ShowItemNotEnoughTips(itemid);\r\n                }\r\n                return;\r\n            }\r\n            this.studyLevelUpNode.getChildByName(\"broke_btn\").getComponent(Button).interactable = false\r\n            RareBookControl.ins.requestUpgradeBookLevel(this.currBookInfo.id);\r\n        }\r\n\r\n    }\r\n\r\n    onTouchWeaponItem(item: WeaponItem) {\r\n        UIMgr.ins.show({ viewName: ViewName.RareBookInfoItemPop, data: { \"bookInfo\": item.info } });\r\n    }\r\n    onClickActivate() {\r\n        RareBookControl.ins.requestCombineBookFragment(this.currBookInfo.fragmentTable.Id);\r\n    }\r\n\r\n    updateBookItemView() {\r\n        this.bookItem.updateView();\r\n    }\r\n\r\n\r\n    on_s2c_CombineBookFragmentRsp(msg: proto.Msg_CombineBookFragmentRsp) {\r\n        if (msg.error.code == proto.CommonErrorCode.Succeed) {\r\n            // if(this.currBookInfo.id==msg.bookId){\r\n            this.updateBookItemView();\r\n            this.updateBtnState();\r\n            this.updateRed();\r\n            // }\r\n        }\r\n    }\r\n    on_s2c_UpgradeBookLevelRsp(msg: proto.Msg_UpgradeBookLevelRsp) {\r\n        if (msg.error && msg.error.code != proto.CommonErrorCode.Succeed) return;\r\n        // if(msg.error.code==proto.CommonErrorCode.Succeed){\r\n        this.updateBookItemView();\r\n        this.initStudyView();\r\n        this.updateRed();\r\n        // }\r\n    }\r\n    on_s2c_UpgradeBookStarRsp(msg: proto.Msg_UpgradeBookStarRsp) {\r\n        if (msg.error && msg.error.code != proto.CommonErrorCode.Succeed) return;\r\n        // if(msg.error.code==proto.CommonErrorCode.Succeed){\r\n        this.updateBookItemView();\r\n        this.initComprehendView();\r\n        UIMgr.ins.show({ viewName: ViewName.StarUpPop, data: { \"bookInfo\": this.currBookInfo } })\r\n        this.updateRed();\r\n        // }\r\n    }\r\n    // protected onDestroy(): void {\r\n    //     super.onDestroy();\r\n    //     EventMgr.unTarget(this);\r\n    // }\r\n\r\n    updateRed() {\r\n        // let isCanActivate=this.currBookInfo.isCanActivate();\r\n        this.redPoints[0].active = false;\r\n        let isCanLevel = this.currBookInfo.isLock && this.currBookInfo.isCanStudy;\r\n        let isCanStar = this.currBookInfo.isLock && this.currBookInfo.isCanUpStar;\r\n        this.redPoints[1].active = isCanLevel;\r\n        this.redPoints[2].active = isCanStar;\r\n        this.redPoints[3].active = isCanLevel;\r\n        this.redPoints[4].active = isCanStar;\r\n    }\r\n    protected onDisable(): void {\r\n        this.starItem.onDisable();\r\n        this.nextStar.onDisable();\r\n        this.nowStar.onDisable();\r\n    }\r\n}"]}