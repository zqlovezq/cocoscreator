{"version":3,"sources":["file:///C:/chickenStarClient/client/assets/scripts/logic/model/activity/signGift/SignInGiftData.ts"],"names":["_decorator","AbsControl","AWARD_STATE","RedMgr","RedDotType","tab","ccclass","property","SignInGiftData","curSignDay","gotSignDays","ins","_instance","initSignInGift","msg","signInDays","receivedDays","refreshEvent","SignGiftRed","getSignDay","getGotGignDays","canReceive","length","checkActivityEnd","getData","SignInGiftTable","receiveGift","day","concat","getSignState","LOCK","indexOf","GOT","RECEIVE","getNotGetData","tabs","i","Day","SignInGiftTableByDay","getValue"],"mappings":"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","sourcesContent":["import { _decorator, Component, Node } from 'cc';\r\nimport { AbsControl } from '../../../../framework/base/IAbs';\r\nimport { proto } from 'client_protocol';\r\nimport { AWARD_STATE } from '../../../../Common/script/EnumTypeMgr';\r\nimport { RedMgr } from '../../../mgr/RedMgr';\r\nimport { RedDotType } from '../../../red/RedDotType';\r\nimport { tab } from '../../../../Table/table_gen';\r\nconst { ccclass, property } = _decorator;\r\n\r\n@ccclass('SignInGiftData')\r\nexport class SignInGiftData extends AbsControl {\r\n    private curSignDay: number = -1;\r\n    private gotSignDays: number[] = [];\r\n    private static _instance: SignInGiftData;\r\n    public static get ins() {\r\n        if (null == this._instance) {\r\n            this._instance = new SignInGiftData();\r\n        }\r\n        return this._instance;\r\n    }\r\n    initSignInGift(msg: proto.Msg_GetSignInGiftInfoRsp) {\r\n        this.curSignDay = msg.signInDays ? msg.signInDays : 0;\r\n        this.gotSignDays = msg.receivedDays ? msg.receivedDays : [];\r\n        RedMgr.refreshEvent(RedDotType.SignGiftRed);\r\n    }\r\n    getSignDay() {\r\n        return this.curSignDay;\r\n    }\r\n    getGotGignDays() {\r\n        return this.gotSignDays;\r\n    }\r\n    // 有可领取的奖励\r\n    canReceive(): boolean {\r\n        return this.gotSignDays.length < this.curSignDay;\r\n    }\r\n    // 判断活动是否结束\r\n    checkActivityEnd(){\r\n        return this.gotSignDays.length===tab.getData().SignInGiftTable.length\r\n    }\r\n    // 获取礼品\r\n    receiveGift(day: number[]) {\r\n        this.gotSignDays = this.gotSignDays.concat(day);\r\n    }\r\n    // 判断当前签到奖励状态\r\n    getSignState(day: number): AWARD_STATE {\r\n        if (day > this.curSignDay) {\r\n            return AWARD_STATE.LOCK\r\n        } else {\r\n            if (this.gotSignDays.indexOf(day) > -1) {\r\n                return AWARD_STATE.GOT\r\n            } else {\r\n                return AWARD_STATE.RECEIVE;\r\n            }\r\n        }\r\n    }\r\n    // 获取当前没有领取奖励的id\r\n    getNotGetData():tab.SignInGiftTable{\r\n        const tabs = tab.getData().SignInGiftTable;\r\n        for(let i=0;i<tabs.length;i++){\r\n            const day = tabs[i].Day;\r\n            if(this.curSignDay>=day){\r\n                // 表示可领的奖励\r\n                if(this.gotSignDays.indexOf(day) > -1){\r\n                    // 已经领过\r\n                    continue\r\n                }else{\r\n                    return tabs[i]\r\n                }\r\n            }else{\r\n                break;\r\n            }\r\n        }\r\n        return tab.getData().SignInGiftTableByDay.getValue(this.curSignDay);\r\n    }\r\n}\r\n\r\n\r\n"]}