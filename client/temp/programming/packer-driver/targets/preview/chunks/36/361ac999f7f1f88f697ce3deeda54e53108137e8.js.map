{"version":3,"sources":["file:///C:/chickenStarClient/client/assets/scripts/logic/model/recruit/RecruitLimitView.ts"],"names":["_decorator","instantiate","Label","Node","Prefab","RichText","ScrollView","Sprite","Vec2","ViewPop","ActivityData","createAnimation","setTextTime","RoleData","tab","TaskData","RecruitLimitItem","ItemData","HeroDataControl","ShowItemNotEnoughTips","ShowTips","UIMgr","LangMgr","proto","Net","EventMgr","ViewName","HeroData","RecruitType","RecruitLimitToggleItem","ccclass","property","RecruitLimitView","actInfos","curInfo","countDown","actTab","_isGacha","_curGachaCount","_recruitHerosMap","Map","curIndex","onShow","setRecruitMap","ins","getAllUpData","switchView","createToggle","actIndex","Number","endTime","getServerUtcTime","timeUpdate","unschedule","schedule","getData","GachaUpTableById","getValue","activityTable","Param1","node_spine","AnimationId","createTaskList","gachaTab","GachaTableById","GachaIds","itemId","ItemId","itemTab","ItemTableById","sp_recruit_item_1","setTexture","Icon","sp_recruit_item_10","heroId","String","slice","heroItemTab","lbl_tips1","string","getCombineString","getLab","Name","refreshTips","clear","heros","getHeros","i","length","heroInfo","heroTab","heroTable","Aptitude","HeroAptitude","HeroAptitude_SR","has","Id","set","get","onDestroy","register","onMsg","Ptl","GachaRsp","on_s2c_GachaRsp","ReceiveActivityGachaUpTasksRewardsRsp","on_s2c_ReceiveActivityGachaUpTasksRewardsRsp","unRegister","onClose","lbl_time","node_content","destroyAllChildren","taskIds","TaskIds","item","pfb_item","addChild","name","itemTs","getComponent","initData","TabId","taskInfo","getGachaUpTaskInfo","progress","taskTable","FinishParam1","lbl_progress_gacha","scroll_view","scrollToTop","getAllUpGotTaskProgress","scrollTo","totalCount","ShowCount","drop","data","id","sum","lbl_tips","gachaTen","sendGacha","gachaOnce","self","count","ItemCount","itemCount","getCount","getHeroBagFull","msg","Msg_GachaReq","fromAdv","Send","GachaReq","error","code","CommonErrorCode","Succeed","refreshTaskProgress","showGachaView","rewards","_rewards","_id","show","viewName","RecruitGetPop","type","GaChaUp","map","node_toggle_content","_key","pfb_toggle_item","parent","setData","onClickGacha","jumpLayer","Module","Module_RecruitView","getChildByName","gotAward","activityId","onClickLimitProbability","RecruitLimitProbabilityPop1000"],"mappings":"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","sourcesContent":["import { _decorator, Component, instantiate, Label, Node, Prefab, RichText, ScrollView, Sprite, Vec2 } from 'cc';\r\nimport { ViewPop } from '../../../framework/base/ViewPop';\r\nimport { ActivityData } from '../activity/ActivityData';\r\nimport { ActivityOpenInfo } from '../activity/ActivityOpenInfo';\r\nimport { createAnimation, setTextTime } from '../../utils/GameUtil';\r\nimport { RoleData } from '../role/RoleData';\r\nimport { tab } from '../../../Table/table_gen';\r\nimport { TaskData } from '../task/TaskData';\r\nimport { TaskInfo } from '../task/TaskInfo';\r\nimport { RecruitLimitItem } from './RecruitLimitItem';\r\nimport { ItemData } from '../item/ItemData';\r\nimport { HeroDataControl } from '../hero/herobag/HeroDataControl';\r\nimport { ShowItemNotEnoughTips, ShowTips, UIMgr } from '../../mgr/UIMgr';\r\nimport { LangMgr } from '../../mgr/LangMgr';\r\nimport { proto } from 'client_protocol';\r\nimport { Net } from '../../net/Net';\r\nimport { EventMgr } from '../../mgr/EventMgr';\r\nimport { ViewName } from '../../define/ViewDefine';\r\nimport { HeroData } from '../hero/HeroData';\r\nimport { RecruitType } from '../../../Common/script/EnumTypeMgr';\r\nimport { RecruitLimitToggleItem } from './RecruitLimitToggleItem';\r\nconst { ccclass, property } = _decorator;\r\n\r\n@ccclass('RecruitLimitView')\r\nexport class RecruitLimitView extends ViewPop {\r\n    @property(Node)\r\n    node_spine: Node = null;\r\n    @property(Label)\r\n    lbl_time: Label = null;\r\n    @property(Prefab)\r\n    pfb_item: Prefab = null;\r\n    @property(Node)\r\n    node_content: Node = null;\r\n    @property(ScrollView)\r\n    scroll_view: ScrollView = null;\r\n    @property(Label)\r\n    lbl_progress_gacha: Label = null;\r\n    @property(Sprite)\r\n    sp_recruit_item_1: Sprite = null;\r\n    @property(Sprite)\r\n    sp_recruit_item_10: Sprite = null;\r\n    @property(RichText)\r\n    lbl_tips: RichText = null;\r\n    @property(RichText)\r\n    lbl_tips1: RichText = null;\r\n\r\n    @property(Prefab)\r\n    pfb_toggle_item: Prefab = null;\r\n    @property(Node)\r\n    node_toggle_content: Node = null;\r\n\r\n    private actInfos: ActivityOpenInfo[] = [];\r\n    private curInfo: ActivityOpenInfo = null;\r\n    private countDown: number = 0;\r\n    private actTab: tab.GachaUpTable = null;\r\n    private _isGacha: boolean = false;\r\n    private _curGachaCount: number = 0;\r\n    public _recruitHerosMap: Map<number, number> = new Map();\r\n    public curIndex: number = 0;\r\n    onShow(): void {\r\n        this.setRecruitMap();\r\n        this.actInfos = ActivityData.ins.getAllUpData();\r\n        this.switchView(0)\r\n        this.createToggle();\r\n    }\r\n    switchView(actIndex: number) {\r\n        this.curIndex = actIndex;\r\n        this.curInfo = this.actInfos[actIndex];\r\n        this.countDown = Number(this.curInfo.endTime) - RoleData.ins.getServerUtcTime();\r\n        this.timeUpdate();\r\n        this.unschedule(this.timeUpdate);\r\n        this.schedule(this.timeUpdate, 1);\r\n\r\n        this.actTab = tab.getData().GachaUpTableById.getValue(this.curInfo.activityTable.Param1);\r\n        createAnimation(this.node_spine, this.actTab.AnimationId);\r\n        this.createTaskList();\r\n\r\n        const gachaTab: tab.GachaTable = tab.getData().GachaTableById.getValue(this.actTab.GachaIds[0]);\r\n        const itemId = gachaTab.ItemId;\r\n        const itemTab: tab.ItemTable = tab.getData().ItemTableById.getValue(itemId);\r\n        this.sp_recruit_item_1.setTexture(itemTab.Icon);\r\n        this.sp_recruit_item_10.setTexture(itemTab.Icon);\r\n\r\n        const heroId = Number(String(this.actTab.AnimationId).slice(0, 4));\r\n        const heroItemTab = tab.getData().ItemTableById.getValue(heroId);\r\n        this.lbl_tips1.string = LangMgr.getCombineString(\"ui_recruit_9\", [LangMgr.getLab(heroItemTab.Name)]);\r\n        this.refreshTips();\r\n    }\r\n    /* 初始化map */\r\n    setRecruitMap() {\r\n        this._recruitHerosMap.clear();\r\n        const heros = HeroData.ins.getHeros();\r\n        for (let i = 0; i < heros.length; i++) {\r\n            const heroInfo = heros[i];\r\n            const heroTab = heroInfo.heroTable;\r\n            if (heroTab.Aptitude == tab.HeroAptitude.HeroAptitude_SR) {\r\n                if (this._recruitHerosMap.has(heroTab.Id)) {\r\n                    this._recruitHerosMap.set(heroTab.Id, this._recruitHerosMap.get(heroTab.Id) + 1)\r\n                } else {\r\n                    this._recruitHerosMap.set(heroTab.Id, 1);\r\n                }\r\n            }\r\n        }\r\n    }\r\n    protected onDestroy(): void {\r\n        super.onDestroy();\r\n    }\r\n    register(): void {\r\n        EventMgr.onMsg(proto.Ptl.GachaRsp, this.on_s2c_GachaRsp, this);\r\n        EventMgr.onMsg(proto.Ptl.ReceiveActivityGachaUpTasksRewardsRsp, this.on_s2c_ReceiveActivityGachaUpTasksRewardsRsp, this)\r\n    }\r\n    unRegister(): void {\r\n        super.unRegister();\r\n    }\r\n    timeUpdate() {\r\n        this.countDown--;\r\n        if (this.countDown <= 0) {\r\n            this.unschedule(this.timeUpdate);\r\n            this.onClose();\r\n        } else {\r\n            this.lbl_time.string = setTextTime(this.countDown);\r\n        }\r\n    }\r\n    // 创建任务列表\r\n    createTaskList() {\r\n        this.node_content.destroyAllChildren();\r\n        const taskIds = this.actTab.TaskIds;\r\n        for (let i = taskIds.length - 1; i >= 0; i--) {\r\n            const item = instantiate(this.pfb_item);\r\n            this.node_content.addChild(item);\r\n            item.name = String(taskIds[i]);\r\n            const itemTs = item.getComponent(RecruitLimitItem);\r\n            itemTs.initData(this.curInfo.TabId, taskIds[i]);\r\n            const taskInfo = TaskData.ins.getGachaUpTaskInfo(taskIds[i]);\r\n\r\n            if(!this._curGachaCount&&i===taskIds.length-1&&taskInfo.progress>=taskInfo.taskTable.FinishParam1){\r\n                this._curGachaCount = taskInfo.progress;\r\n            }\r\n\r\n            if (!this._curGachaCount && taskInfo.progress < taskInfo.taskTable.FinishParam1) {\r\n                this._curGachaCount = taskInfo.progress;\r\n            }\r\n        }\r\n        this.lbl_progress_gacha.string = String(this._curGachaCount);\r\n        if (this._curGachaCount === 0) {\r\n            this.scroll_view.scrollToTop();\r\n        } else {\r\n            const progress = ActivityData.ins.getAllUpGotTaskProgress(this.curInfo.TabId)\r\n            this.scroll_view.scrollTo(new Vec2(0, progress), 0.3);\r\n        }\r\n    }\r\n    // 刷新tips\r\n    refreshTips() {\r\n        const gachaTab: tab.GachaTable = tab.getData().GachaTableById.getValue(this.actTab.GachaIds[0]);\r\n        let totalCount = gachaTab.ShowCount;\r\n        for (let i = 0; i < RoleData.ins.drop.data.length; i++) {\r\n            const data = RoleData.ins.drop.data[i];\r\n            if (data.id == \"up_100\") {\r\n                totalCount = totalCount - data.sum;\r\n                break;\r\n            }\r\n        }\r\n        this.lbl_tips.string = LangMgr.getCombineString(\"ui_recruit_10\", [totalCount]);\r\n    }\r\n    /* 十连抽 */\r\n    private gachaTen() {\r\n        // 点击抽卡播放xuanzhuan结束后弹出抽卡展示界面\r\n        if (this._isGacha) {\r\n            return\r\n        }\r\n        this.sendGacha(this.actTab.GachaIds[1]);\r\n    }\r\n\r\n    /* 单抽 */\r\n    private gachaOnce() {\r\n        if (this._isGacha) {\r\n            return\r\n        }\r\n        this.sendGacha(this.actTab.GachaIds[0]);\r\n    }\r\n    sendGacha(id: number) {\r\n        const self = this;\r\n        const gachaTab = tab.getData().GachaTableById.getValue(id);\r\n        const count = gachaTab.ItemCount;\r\n        const itemId = gachaTab.ItemId;\r\n        const itemCount = ItemData.ins.getCount(itemId);\r\n        if (HeroDataControl.ins.getHeroBagFull(gachaTab.ItemCount)) {\r\n            ShowTips(LangMgr.getLab(\"Tips_herobag_1\"))\r\n            return\r\n        }\r\n        if (itemCount < count) {\r\n            ShowItemNotEnoughTips(itemId);\r\n            return;\r\n        }\r\n        let msg = new proto.Msg_GachaReq();\r\n        msg.id = id;\r\n        msg.fromAdv = false;\r\n        Net.Send(proto.Ptl.GachaReq, msg);\r\n    }\r\n\r\n    on_s2c_GachaRsp(msg: proto.Msg_GachaRsp) {\r\n        if (msg.error && msg.error.code != proto.CommonErrorCode.Succeed) return;\r\n        if (msg.id % 100 === 1) {\r\n            this._curGachaCount += 1;\r\n        } else {\r\n            this._curGachaCount += 10;\r\n        }\r\n        this.refreshTaskProgress();\r\n        this.showGachaView(msg.rewards, msg.id);\r\n        this.createTaskList();\r\n        this.refreshTips();\r\n    }\r\n    // 刷新任务数据\r\n    refreshTaskProgress() {\r\n        const taskIds = this.actTab.TaskIds;\r\n        for (let i = 0; i < taskIds.length; i++) {\r\n            const taskInfo = TaskData.ins.getGachaUpTaskInfo(taskIds[i]);\r\n            taskInfo.progress = this._curGachaCount;\r\n        }\r\n    }\r\n    showGachaView(_rewards: proto.IItem[], _id: number) {\r\n        UIMgr.ins.show({\r\n            viewName: ViewName.RecruitGetPop, data: {\r\n                rewards: _rewards,\r\n                id: _id,\r\n                type: RecruitType.GaChaUp,\r\n                map: this._recruitHerosMap\r\n            }\r\n        });\r\n    }\r\n    createToggle() {\r\n        this.node_toggle_content.destroyAllChildren();\r\n        if(this.actInfos.length>1){\r\n            for (let i = 0; i < this.actInfos.length; i++) {\r\n                const _key = this.actInfos[i];\r\n                let item = null;\r\n                let itemTs: RecruitLimitToggleItem = null;\r\n                item = instantiate(this.pfb_toggle_item);\r\n                item.parent = this.node_toggle_content;\r\n                item.name = String(_key);\r\n                itemTs = item.getComponent(RecruitLimitToggleItem);\r\n                itemTs.setData(i, this);\r\n            }\r\n        }\r\n    }\r\n    onClickGacha() {\r\n        UIMgr.ins.jumpLayer(tab.Module.Module_RecruitView);\r\n    }\r\n    on_s2c_ReceiveActivityGachaUpTasksRewardsRsp(msg: proto.Msg_ReceiveActivityGachaUpTasksRewardsRsp) {\r\n        if (!msg.error || msg.error.code == proto.CommonErrorCode.Succeed) {\r\n            for (let i = 0; i < msg.taskIds.length; i++) {\r\n                const item = this.node_content.getChildByName(String(msg.taskIds[i]));\r\n                const itemTs = item.getComponent(RecruitLimitItem);\r\n                itemTs.gotAward();\r\n                const progress = ActivityData.ins.getAllUpGotTaskProgress(msg.activityId)\r\n                this.scroll_view.scrollTo(new Vec2(0, progress), 0.3);\r\n            }\r\n        }\r\n    }\r\n    onClickLimitProbability(){\r\n        UIMgr.ins.show({ viewName: ViewName.RecruitLimitProbabilityPop1000})\r\n    }\r\n}\r\n\r\n\r\n"]}