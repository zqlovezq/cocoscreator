{"version":3,"sources":["file:///C:/chickenStarClient/client/assets/scripts/logic/model/recruit/RecruitGetPop.ts"],"names":["_decorator","Node","Prefab","Animation","instantiate","Sprite","Label","ViewPop","tab","proto","HeroItem","HeroInfo","CommonItem","ItemInfo","ShowTips","UIMgr","ViewName","Net","HeroDataControl","WeaponItem","ItemData","gachaReplace","RecruitType","RoleData","LangMgr","GuideController","EventMgr","LocalEvent","ccclass","property","RecruitGetPop","_rewards","_showNum","_gachaNum","_gachaId","_curStage","_herosMap","Map","_curRecruitType","None","unRegister","register","onLocal","showNewOver","autoShowHeroAnim","onShow","openData","rewards","id","map","type","node_limit","active","i","node_types","length","GaChaUp","gachaTab","getData","GachaTableById","getValue","ItemCount","getChildByName","node_extra","configRecycle","GetKeyValue_ConfigTable","HeroRecycleReward","extraId","extraCount","extraId1","extraCount1","reward","itemId","Number","num","splice","heroTab","HeroTableById","aptitude","Aptitude","ins","autoDisband","HeroAptitude","HeroAptitude_N","extraTab","ItemTableById","extraTab1","sp_extra_item_1","node","parent","sp_extra_item","node_get_item","setTexture","Icon","lbl_extra_count","string","String","lbl_extra_count_1","unschedule","addItem","schedule","itemCount","itemTab","children","item","destroyAllChildren","getComponent","play","Type","ItemType","ItemType_Hero","createHero","ItemType_Material","ItemType_Piece","createItem","ItemType_Book","createBook","_heroItem","pfb_hero_item","itemTs","heroInfo","star","DefaultStar","UpdateContent","setSelect","setLevel","setAutoDisband","heroTable","setPiece","HeroAptitude_SSR","showNewHeroPop","HeroAptitude_SR","getNewSRHero","deleteNewSRHero","_commonItem","pfb_common_item","itemData","initData","_bookItem","pfb_rare_book","initBookItemId","show","viewName","RareBookInfoItemPop","data","info","bookTab","BookTableById","showNewBookPop","HeroAptitude_R","get","set","clearHeros","node_item1","node_item10","self","RareBookGetPop","NewHeroPop","scheduleOnce","sendGacha","isGuiding","slef","Book","BookGuarantee","getHeroBagFull","getLab","count","ItemId","getCount","sendMsg","msg","Msg_GachaReq","Send","Ptl","GachaReq","canSendMsg","onDestroy","emitLocal","hideHeroPop"],"mappings":"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","sourcesContent":["import { _decorator, Component, Node, Prefab, Animation, instantiate, AnimationComponent, Sprite, Label, log } from 'cc';\r\nimport { ViewPop } from '../../../framework/base/ViewPop';\r\nimport { tab } from '../../../Table/table_gen';\r\nimport { proto } from 'client_protocol';\r\nimport { HeroItem } from '../item/HeroItem';\r\nimport { HeroInfo } from '../hero/HeroInfo';\r\nimport { ItemPoolMgr } from '../item/ItemPoolMgr';\r\nimport { CommonItem } from '../item/CommonItem';\r\nimport { ItemInfo } from '../item/ItemInfo';\r\nimport { ShowTips, UIMgr } from '../../mgr/UIMgr';\r\nimport { ViewName } from '../../define/ViewDefine';\r\nimport { NewHeroPop } from '../common/NewHeroPop';\r\nimport { Net } from '../../net/Net';\r\nimport { HeroDataControl } from '../hero/herobag/HeroDataControl';\r\nimport { WeaponItem } from '../common/WeaponItem';\r\nimport { RareBookGetPop } from '../rareBook/RareBookGetPop';\r\nimport { ItemData } from '../item/ItemData';\r\nimport { gachaReplace } from '../../utils/GameUtil';\r\nimport { RecruitType } from '../../../Common/script/EnumTypeMgr';\r\nimport { RoleData } from '../role/RoleData';\r\nimport { LangMgr } from '../../mgr/LangMgr';\r\nimport { GuideController } from '../../guide/GuideController';\r\nimport { EventMgr } from '../../mgr/EventMgr';\r\nimport { LocalEvent } from '../../define/LocalEvent';\r\nconst { ccclass, property } = _decorator;\r\n\r\n@ccclass('RecruitGetPop')\r\nexport class RecruitGetPop extends ViewPop {\r\n    @property(Prefab)\r\n    pfb_common_item: Prefab = null;\r\n    @property(Prefab)\r\n    pfb_hero_item: Prefab = null;\r\n    @property(Prefab)\r\n    pfb_new_hero: Prefab = null;\r\n    @property(Prefab)\r\n    pfb_rare_book: Prefab = null;\r\n    @property(Node)\r\n    node_item1: Node = null;\r\n    @property(Node)\r\n    node_item10: Node = null;\r\n    @property(Sprite)\r\n    sp_extra_item: Sprite = null;\r\n    @property(Label)\r\n    lbl_extra_count: Label = null;\r\n\r\n    @property(Sprite)\r\n    sp_extra_item_1: Sprite = null;\r\n    @property(Label)\r\n    lbl_extra_count_1: Label = null;\r\n    @property(Node)\r\n    node_extra: Node = null;\r\n    @property(Node)\r\n    node_get_item: Node = null;\r\n\r\n    @property([Node])\r\n    node_types: Node[] = [];\r\n    @property(Node)\r\n    node_limit: Node = null;\r\n\r\n    private _rewards: proto.IItem[] = [];\r\n    private _showNum: number = 0;\r\n    private _gachaNum: number = 0;\r\n    private _gachaId: number = 0;\r\n    private _curStage: Node = null;\r\n    private _herosMap: Map<number, number | boolean> = new Map();\r\n    private _curRecruitType: RecruitType = RecruitType.None\r\n    unRegister(): void {\r\n        super.unRegister();\r\n    }\r\n    register(): void {\r\n        EventMgr.onLocal(LocalEvent.showNewOver, this.autoShowHeroAnim, this)\r\n    }\r\n    onShow(): void {\r\n        this._rewards = this.openData.rewards;\r\n        this._gachaId = this.openData.id;\r\n        this._herosMap = this.openData.map;\r\n        this._curRecruitType = this.openData.type;\r\n        this.node_limit.active = false;\r\n        for (let i = 0; i < this.node_types.length; i++) {\r\n            this.node_types[i].active = false;\r\n        }\r\n        if (this._curRecruitType === RecruitType.GaChaUp) {\r\n            this._curStage = this.node_limit\r\n        }else{\r\n            this._curStage = this.node_types[this._curRecruitType - 1];\r\n        }\r\n        this._curStage.active = true;\r\n        const gachaTab = tab.getData().GachaTableById.getValue(this._gachaId);\r\n        // 消耗道具数量\r\n        this._gachaNum = gachaTab.ItemCount;\r\n        if (this._gachaNum === 1000) {\r\n            this._gachaNum = 1;\r\n        }\r\n        this._curStage.getChildByName(\"btn_node\").getChildByName(\"recruit1_btn\").active = this._gachaNum === 1;\r\n        this._curStage.getChildByName(\"btn_node\").getChildByName(\"recruit10_btn\").active = this._gachaNum === 10;\r\n        this._showNum = 0;\r\n\r\n        this.node_extra.active = false;\r\n        const configRecycle = tab.getData().GetKeyValue_ConfigTable().HeroRecycleReward;\r\n        let extraId = 0;\r\n        let extraCount = 0;\r\n        let extraId1 = configRecycle[0];\r\n        let extraCount1 = 0;\r\n        for (let i = this._rewards.length - 1; i >= 0; i--) {\r\n            const reward = this._rewards[i];\r\n            if (reward.itemId === 51 || reward.itemId === 81 || reward.itemId === 82) {\r\n                if (!extraId) {\r\n                    extraId = reward.itemId;\r\n                    extraCount = Number(reward.num);\r\n                }\r\n                this._rewards.splice(i, 1);\r\n            } else {\r\n                const heroTab = tab.getData().HeroTableById.getValue(reward.itemId);\r\n                if (heroTab) {\r\n                    const aptitude = heroTab.Aptitude;\r\n                    if (RoleData.ins.autoDisband && aptitude === tab.HeroAptitude.HeroAptitude_N) {\r\n                        extraCount1 += configRecycle[1];\r\n                    }\r\n                }\r\n            }\r\n        }\r\n        const extraTab = tab.getData().ItemTableById.getValue(extraId);\r\n        const extraTab1 = tab.getData().ItemTableById.getValue(extraId1);\r\n        this.sp_extra_item_1.node.parent.active = extraCount1 > 0;\r\n        this.sp_extra_item.node.parent.active = extraCount > 0;\r\n        this.node_get_item.active = extraCount > 0 && extraCount1 > 0;\r\n        if (extraTab) {\r\n            this.sp_extra_item.setTexture(extraTab.Icon);\r\n            this.lbl_extra_count.string = String(extraCount * this._gachaNum);\r\n        }\r\n        if (extraTab1) {\r\n            this.sp_extra_item_1.setTexture(extraTab1.Icon);\r\n            this.lbl_extra_count_1.string = String(extraCount1);\r\n        }\r\n        this.unschedule(this.addItem);\r\n        this.schedule(this.addItem, 0.15, this._gachaNum - 1);\r\n    }\r\n    addItem() {\r\n        if (!this._rewards[this._showNum]) {\r\n            return;\r\n        }\r\n        const reward = this._rewards[this._showNum];\r\n        const itemId = reward.itemId;\r\n        const itemCount = Number(reward.num);\r\n        const itemTab = tab.getData().ItemTableById.getValue(itemId);\r\n        const children = this[\"node_item\" + this._gachaNum].children;\r\n        // for(let i=0;i<children.length;i++){\r\n        const item = children[this._showNum];\r\n        item.destroyAllChildren();\r\n        item.getComponent(Animation).play();\r\n        if (itemTab.Type === tab.ItemType.ItemType_Hero) {\r\n            this.createHero(item, itemId, 0);\r\n        } else if (itemTab.Type === tab.ItemType.ItemType_Material || itemTab.Type === tab.ItemType.ItemType_Piece) {\r\n            if (itemId > 6100 && itemId < 10000) {\r\n                this.createHero(item, itemId - 4000, itemCount);\r\n            } else {\r\n                this.createItem(item, itemId, itemCount);\r\n            }\r\n        } else if (itemTab.Type === tab.ItemType.ItemType_Book) {\r\n            this.createBook(item, itemId)\r\n        }\r\n        this._showNum++;\r\n        if (this._showNum >= this._gachaNum) {\r\n            this.node_extra.active = true;\r\n            this.unschedule(this.addItem);\r\n        }\r\n    }\r\n    createHero(item: Node, itemId: number, itemCount?: number) {\r\n        const _heroItem = instantiate(this.pfb_hero_item);\r\n        _heroItem.parent = item;\r\n        const itemTs = _heroItem.getComponent(HeroItem);\r\n        const heroTab = tab.getData().HeroTableById.getValue(itemId);\r\n        const heroInfo = new HeroInfo();\r\n        heroInfo.itemId = itemId;\r\n        heroInfo.star = heroTab.DefaultStar;\r\n        itemTs.UpdateContent(heroInfo);\r\n        itemTs.setSelect(false);\r\n        itemTs.setLevel(0);\r\n        itemTs.setAutoDisband(heroInfo.heroTable.Aptitude === tab.HeroAptitude.HeroAptitude_N);\r\n        if (itemCount) {\r\n            itemTs.setPiece(itemCount);\r\n        } else {\r\n            if (heroTab.Aptitude === tab.HeroAptitude.HeroAptitude_SSR) {\r\n                this.showNewHeroPop(itemId);\r\n            } else if (heroTab.Aptitude === tab.HeroAptitude.HeroAptitude_SR) {\r\n                // 判断是否是首次\r\n                if (HeroDataControl.ins.getNewSRHero(itemId)) {\r\n                    this.showNewHeroPop(itemId);\r\n                    HeroDataControl.ins.deleteNewSRHero(itemId)\r\n                }\r\n            }\r\n        }\r\n    }\r\n    createItem(item: Node, itemId: number, itemCount: Number) {\r\n        const _commonItem = instantiate(this.pfb_common_item);\r\n        _commonItem.parent = item;\r\n        const itemTs = _commonItem.getComponent(CommonItem);\r\n        const itemData = new ItemInfo();\r\n        itemData.itemId = itemId;\r\n        itemData.num = Number(itemCount);\r\n        itemTs.initData(itemData);\r\n    }\r\n    createBook(item: Node, itemId: number) {\r\n        const _bookItem = instantiate(this.pfb_rare_book);\r\n        _bookItem.parent = item;\r\n        const itemTs = _bookItem.getComponent(WeaponItem);\r\n        itemTs.initBookItemId(itemId, true, true, false, () => {\r\n            UIMgr.ins.show({ viewName: ViewName.RareBookInfoItemPop, data: { \"bookInfo\": itemTs.info } });\r\n        });\r\n        const bookTab = tab.getData().BookTableById.getValue(itemId);\r\n        if (bookTab.Aptitude === tab.HeroAptitude.HeroAptitude_SR) {\r\n            // 显示弹窗\r\n            this.showNewBookPop(itemId);\r\n        } else if (bookTab.Aptitude === tab.HeroAptitude.HeroAptitude_R) {\r\n            if (!this._herosMap.get(itemId)) {\r\n                this._herosMap.set(itemId, true);\r\n                this.showNewBookPop(itemId);\r\n            }\r\n        }\r\n    }\r\n    clearHeros() {\r\n        this._showNum = 0;\r\n        this.unschedule(this.addItem);\r\n        if (this._gachaNum === 1) {\r\n            this.node_item1.getChildByName(\"item1\").destroyAllChildren()\r\n        } else {\r\n            for (let i = 1; i <= 10; i++) {\r\n                this.node_item10.getChildByName(\"item\" + i).destroyAllChildren()\r\n            }\r\n        }\r\n    }\r\n    // 如果当前是新秘籍\r\n    showNewBookPop(itemId: number) {\r\n        const self = this;\r\n        this.unschedule(this.addItem);\r\n        UIMgr.ins.show({\r\n            viewName: ViewName.RareBookGetPop, data: {\r\n                itemId: itemId\r\n            }\r\n        })\r\n    }\r\n    // 如果当前是新英雄\r\n    showNewHeroPop(itemId: number) {\r\n        const self = this;\r\n        this.unschedule(this.addItem);\r\n        UIMgr.ins.show({\r\n            viewName: ViewName.NewHeroPop, data: {\r\n                itemId: itemId\r\n            }\r\n        })\r\n    }\r\n    /* 继续播放动画 */\r\n    autoShowHeroAnim() {\r\n        const children = this[\"node_item\" + this._gachaNum].children;\r\n        const item = children[this._showNum - 1];\r\n        item.getComponent(Animation).play();\r\n        this.scheduleOnce(() => {\r\n            this.schedule(this.addItem, 0.15, this._gachaNum - this._showNum - 1)\r\n        }, 0.15)\r\n    }\r\n    sendGacha() {\r\n        if(GuideController.ins.isGuiding()){\r\n            return;\r\n        }\r\n        const slef = this;\r\n        if (this._showNum !== this._gachaNum) {\r\n            return;\r\n        }\r\n        if (this._curRecruitType != RecruitType.Book && this._curRecruitType != RecruitType.BookGuarantee) {\r\n            if (HeroDataControl.ins.getHeroBagFull(this._gachaNum)) {\r\n                ShowTips(LangMgr.getLab(\"Tips_herobag_1\"))\r\n                return\r\n            }\r\n        }\r\n\r\n        const gachaTab = tab.getData().GachaTableById.getValue(this._gachaId);\r\n        const count = gachaTab.ItemCount;\r\n        const itemId = gachaTab.ItemId;\r\n\r\n        const itemCount = ItemData.ins.getCount(itemId);\r\n\r\n\r\n        const sendMsg = (() => {\r\n            slef.clearHeros();\r\n            let msg = new proto.Msg_GachaReq();\r\n            msg.id = slef._gachaId;\r\n            Net.Send(proto.Ptl.GachaReq, msg);\r\n        })\r\n\r\n        if (itemCount < count) {\r\n            let canSendMsg = gachaReplace(this._gachaId, this._curRecruitType, sendMsg);\r\n            if (!canSendMsg) {\r\n                return;\r\n            }\r\n        }\r\n        sendMsg();\r\n    }\r\n    protected onDestroy(): void {\r\n        super.onDestroy();\r\n        if (GuideController.ins.isGuiding()) {\r\n            EventMgr.emitLocal(LocalEvent.hideHeroPop);\r\n        }\r\n    }\r\n}\r\n\r\n\r\n"]}