{"version":3,"sources":["file:///C:/chickenStarClient/client/assets/scripts/logic/model/association/AssociationTaskPop.ts"],"names":["_decorator","instantiate","Label","Node","Prefab","ViewPop","AssociationData","TaskCaseItem","TaskData","tab","TaskBoxItem","TASKDAILY","EventMgr","proto","UIMgr","ViewName","ccclass","property","AssociationTaskPop","onShow","asyncView","onDestroy","register","onMsg","Ptl","ReceiveGuildDailyTasksRewardsRsp","on_s2c_ReceiveGuildDailyTasksRewardsRsp","ReceiveGuildTaskChestRewardsRsp","on_s2c_ReceiveGuildTaskChestRewardsRsp","msg","error","code","CommonErrorCode","Succeed","ins","show","viewName","CongratulationPop","data","rewards","unRegister","node_content","destroyAllChildren","tasks","getAllTasksTab","i","length","taskId","Id","taskInfo","getGuildTaskInfo","item","pfb_item","parent","com","getComponent","initData","updateBoxItem","actives","getData","GetKeyValue_ConfigTable","GuildDailyTaskRewardNeedCount","dailyActiveNum","getAssocitionInfo","dailyFinishedTaskNumber","activeNumLab","string","lastValue","pro","taskBoxItems","initView","GUILD"],"mappings":"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","sourcesContent":["import { _decorator, Component, instantiate, Label, Node, Prefab } from 'cc';\r\nimport { ViewPop } from '../../../framework/base/ViewPop';\r\nimport { AssociationData } from './AssociationData';\r\nimport { TaskCaseItem } from '../task/TaskCaseItem';\r\nimport { TaskData } from '../task/TaskData';\r\nimport { tab } from '../../../Table/table_gen';\r\nimport { ItemData } from '../item/ItemData';\r\nimport { TaskBoxItem } from '../task/TaskBoxItem';\r\nimport { TASKDAILY } from '../../../Common/script/EnumTypeMgr';\r\nimport { EventMgr } from '../../mgr/EventMgr';\r\nimport { proto } from 'client_protocol';\r\nimport { UIMgr } from '../../mgr/UIMgr';\r\nimport { ViewName } from '../../define/ViewDefine';\r\nconst { ccclass, property } = _decorator;\r\n\r\n@ccclass('AssociationTaskPop')\r\nexport class AssociationTaskPop extends ViewPop {\r\n    @property(Prefab)\r\n    pfb_item:Prefab = null;\r\n    @property(Node)\r\n    node_content:Node = null;\r\n    @property([TaskBoxItem])\r\n    taskBoxItems: Array<TaskBoxItem> = [];\r\n    @property(Label)\r\n    activeNumLab:Label = null;\r\n    onShow(): void {\r\n        this.asyncView();\r\n    }\r\n    protected onDestroy(): void {\r\n        super.onDestroy()\r\n    }\r\n    register(): void {\r\n        EventMgr.onMsg(proto.Ptl.ReceiveGuildDailyTasksRewardsRsp, this.on_s2c_ReceiveGuildDailyTasksRewardsRsp, this);\r\n        EventMgr.onMsg(proto.Ptl.ReceiveGuildTaskChestRewardsRsp, this.on_s2c_ReceiveGuildTaskChestRewardsRsp, this);\r\n    }\r\n    on_s2c_ReceiveGuildTaskChestRewardsRsp(msg: proto.Msg_ReceiveGuildTaskChestRewardsRsp){\r\n        if (!msg.error || msg.error.code == proto.CommonErrorCode.Succeed) {\r\n            UIMgr.ins.show({ viewName: ViewName.CongratulationPop, data: msg.rewards })\r\n            this.asyncView();\r\n        }\r\n    }\r\n    unRegister(): void {\r\n        super.unRegister()\r\n    }\r\n    asyncView(){\r\n        // 获取所有的帮会任务\r\n        this.node_content.destroyAllChildren();\r\n        const tasks = AssociationData.ins.getAllTasksTab();\r\n        for(let i=0;i<tasks.length;i++){\r\n            const taskId = tasks[i].Id\r\n            const taskInfo = TaskData.ins.getGuildTaskInfo(taskId);\r\n            const item = instantiate(this.pfb_item);\r\n            item.parent = this.node_content;\r\n            let com = item.getComponent(TaskCaseItem);\r\n            com.initData(taskInfo);\r\n        }\r\n        this.updateBoxItem();\r\n    }\r\n    updateBoxItem(){\r\n        let actives = tab.getData().GetKeyValue_ConfigTable().GuildDailyTaskRewardNeedCount;\r\n        const dailyActiveNum = AssociationData.ins.getAssocitionInfo().dailyFinishedTaskNumber;\r\n        this.activeNumLab.string = dailyActiveNum + \"\";\r\n        for (let i: number = 0; i < actives.length; i++) {\r\n            let lastValue = 0;\r\n            let pro = 0;\r\n            if (i > 0) {\r\n                lastValue = actives[i - 1];\r\n            }\r\n            if (dailyActiveNum <= lastValue) {\r\n                pro = 0;\r\n            } else if (dailyActiveNum >= actives[i]) {\r\n                pro = 1;\r\n            } else {\r\n                pro = (dailyActiveNum - lastValue) / (actives[i] - lastValue);\r\n            }\r\n            this.taskBoxItems[i].initView(TASKDAILY.GUILD, i, pro, actives[i]);\r\n        }\r\n    }\r\n    on_s2c_ReceiveGuildDailyTasksRewardsRsp(msg: proto.Msg_ReceiveGuildDailyTasksRewardsRsp){\r\n        if (!msg.error||msg.error.code == proto.CommonErrorCode.Succeed) {\r\n            AssociationData.ins.getAssocitionInfo().dailyFinishedTaskNumber++;\r\n            this.asyncView();\r\n            UIMgr.ins.show({ viewName: ViewName.CongratulationPop, data: msg.rewards })\r\n        }\r\n    }\r\n}\r\n\r\n\r\n"]}