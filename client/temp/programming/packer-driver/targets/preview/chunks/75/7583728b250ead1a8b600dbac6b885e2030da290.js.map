{"version":3,"sources":["file:///C:/chickenStarClient/client/assets/scripts/logic/model/activity/combine/CombineActivityMainView.ts"],"names":["_decorator","instantiate","Label","Node","Prefab","Sprite","ViewPop","ViewName","tab","CombineStarUpItem","CombineToggleItem","createAnimation","setTextTime","ActivityData","BattlePassItem","HeroDataControl","LangMgr","UIMgr","EventMgr","proto","CombineGiftItem","RedMgr","RedDotType","RoleData","CombineAccumulatedRechargeItem","ccclass","property","CombineActivityMainView","currNode","curActivityId","showHeroId","register","onMsg","Ptl","ReceiveBattlePassTaskRewardsRsp","on_s2c_ReceiveBattlePassTaskRewardsRsp","ReceiveActivityHeroGrowRewardRsp","on_s2c_ReceiveActivityHeroGrowRewardRsp","BuyFixedShopCommodityRsp","on_s2c_BuyFixedShopCommodityRsp","unRegister","onDestroy","onShow","groups","ins","getAllActivityGroup","info","i","openData","TabId","countDown","Number","endTime","getServerUtcTime","timeUpdate","unschedule","node","active","lbl_time","string","schedule","length","_tab","getData","ActivityTableByActivityId","getValue","ActivityIds","createToggle","switchView","activityId","node_hero","activityInfo","view_type","Type","OpenFunctionName","OpenFunctionName_ActivityHeroGrow","hero_grow_layer","pfb_hero_grow","parent","activityNode","getComponent","heroGrowData","getHeroGrowData","listData","getHeroGrowTabs","heroItemId","showHeroSpine","AnimationId","OpenFunctionName_BattlePassSignIn1","battleLayer","pfb_battle_pass","Param1","battleData","BattlePassTableById","OpenFunctionName_ActivityMall","mallLayer","pfb_up_mall","mallData","MallTableByMallId","OpenFunctionName_ActivityCumulativeRecharge","rechargeLayer","pfb_recharge","tabList","node_toggle_content","destroyAllChildren","_key","item","itemTs","pfb_toggle_item","name","String","setData","animationId","node_spine","heroId","slice","heroTab","HeroTableById","itemTab","ItemTableById","heroClassTable","HeroClassTableByHeroClass","Class","heroAptitudeTab","HeroAptitudeTableByHeroAptitude","Aptitude","itemQualityTab","getItemQualityTableByStar","DefaultStar","sp_quality_star_bg","node_quality","getChildByName","sp_quality","sp_quality_bg","setTexture","HeroBagGrowthQuality","HeroBagLevelQuality","Icon","sp_class","lbl_hero_name","getLab","Name","lbl_class_desc","Speciality","clickShowHero","refreshBookData","show","viewName","HeroBagView","data","viewType","zIndex","msg","error","code","CommonErrorCode","Succeed","refreshView","refreshEvent","Combine_Pass","CongratulationPop","rewards","refreshHeroGrowData","star","Combine_Grow","Combine_Shop","onClickGachaBtn","RecruitLimitView"],"mappings":"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","sourcesContent":["import { _decorator, Component, error, instantiate, Label, Node, Prefab, Sprite } from 'cc';\r\nimport { ViewPop } from '../../../../framework/base/ViewPop';\r\nimport { ViewName } from '../../../define/ViewDefine';\r\nimport { tab } from '../../../../Table/table_gen';\r\nimport { CombineStarUpItem } from './CombineStarUpItem';\r\nimport { CombineToggleItem } from './CombineToggleItem';\r\nimport { createAnimation, setTextTime } from '../../../utils/GameUtil';\r\nimport { ActivityData } from '../ActivityData';\r\nimport { BattlePassItem } from '../battlePass/BattlePassItem';\r\nimport { HeroDataControl } from '../../hero/herobag/HeroDataControl';\r\nimport { LangMgr } from '../../../mgr/LangMgr';\r\nimport { UIMgr } from '../../../mgr/UIMgr';\r\nimport { EventMgr } from '../../../mgr/EventMgr';\r\nimport { proto } from 'client_protocol';\r\nimport { CombineGiftItem } from './CombineGiftItem';\r\nimport { RedMgr } from '../../../mgr/RedMgr';\r\nimport { RedDotType } from '../../../red/RedDotType';\r\nimport { RoleData } from '../../role/RoleData';\r\nimport { CombineAccumulatedRechargeItem } from './CombineAccumulatedRechargeItem';\r\nconst { ccclass, property } = _decorator;\r\n\r\n@ccclass('CombineActivityMainView')\r\nexport class CombineActivityMainView extends ViewPop {\r\n    @property(Node)\r\n    activityNode: Node = null;\r\n    @property(Prefab)\r\n    pfb_toggle_item: Prefab = null;\r\n    @property(Prefab)\r\n    pfb_hero_grow: Prefab = null;\r\n    @property(Prefab)\r\n    pfb_battle_pass:Prefab = null;\r\n    @property(Prefab)\r\n    pfb_up_mall:Prefab = null;\r\n    @property(Prefab)\r\n    pfb_recharge:Prefab = null;\r\n    @property(Node)\r\n    node_toggle_content: Node = null;\r\n    @property(Node)\r\n    node_spine: Node = null;\r\n    @property(Node)\r\n    node_quality:Node = null;\r\n    @property(Label)\r\n    lbl_hero_name:Label = null;\r\n    @property(Label)\r\n    lbl_class_desc:Label = null;\r\n    @property(Sprite)\r\n    sp_class:Sprite = null;\r\n    @property(Label)\r\n    lbl_time:Label = null;\r\n    @property(Node)\r\n    node_hero:Node = null;\r\n\r\n    private currNode: Node = null;\r\n    public curActivityId: number = 0;\r\n    private showHeroId:number = 0;\r\n    register(): void {\r\n        EventMgr.onMsg(proto.Ptl.ReceiveBattlePassTaskRewardsRsp, this.on_s2c_ReceiveBattlePassTaskRewardsRsp, this);\r\n        EventMgr.onMsg(proto.Ptl.ReceiveActivityHeroGrowRewardRsp, this.on_s2c_ReceiveActivityHeroGrowRewardRsp, this);\r\n        EventMgr.onMsg(proto.Ptl.BuyFixedShopCommodityRsp, this.on_s2c_BuyFixedShopCommodityRsp, this);\r\n    }\r\n    unRegister(): void {\r\n        super.unRegister();\r\n    }\r\n    protected onDestroy(): void {\r\n        super.onDestroy();\r\n    }\r\n    onShow(): void {\r\n        // 获取活动分组\r\n        const groups = ActivityData.ins.getAllActivityGroup();\r\n        for(let i=0;i<groups.length;i++){\r\n            const info = groups[i]\r\n            if(this.openData===info.TabId){\r\n                let countDown = Number(info.endTime)-RoleData.ins.getServerUtcTime();\r\n                const timeUpdate = (()=>{\r\n                    countDown--;\r\n                    if(countDown<=0){\r\n                        this.unschedule(timeUpdate);\r\n                        this.node.active = false;\r\n                    }else{\r\n                        this.lbl_time.string = setTextTime(countDown);\r\n                    }\r\n                })\r\n                timeUpdate();\r\n                this.unschedule(timeUpdate);\r\n                this.schedule(timeUpdate, 1);\r\n            }\r\n        }\r\n        const _tab = tab.getData().ActivityTableByActivityId.getValue(this.openData);\r\n        this.curActivityId = _tab.ActivityIds[0];\r\n        this.createToggle(_tab.ActivityIds);\r\n        this.switchView(this.curActivityId);\r\n    }\r\n    switchView(activityId: number) {\r\n        if (this.currNode) {\r\n            this.currNode.active = false;\r\n        }\r\n        this.node_hero.active = true;\r\n        this.curActivityId = activityId;\r\n        const activityInfo = tab.getData().ActivityTableByActivityId.getValue(activityId);\r\n        const view_type = activityInfo.Type;\r\n        switch (view_type) {\r\n            // 养成活动\r\n            case tab.OpenFunctionName.OpenFunctionName_ActivityHeroGrow:\r\n                if (!this[\"view\" + activityId]) {\r\n                    const hero_grow_layer = instantiate(this.pfb_hero_grow);\r\n                    hero_grow_layer.parent = this.activityNode;\r\n                    if (hero_grow_layer) {\r\n                        this[\"view\" + activityId] = hero_grow_layer.getComponent(CombineStarUpItem);\r\n                        this.currNode = hero_grow_layer;\r\n                        this[\"view\" + activityId].onShow(activityId);\r\n                    }\r\n                } else {\r\n                    this[\"view\" + activityId].node.active = true;\r\n                    this.currNode = this[\"view\" + activityId].node;\r\n                    this[\"view\" + activityId].onShow(activityId);\r\n                }\r\n                const heroGrowData = ActivityData.ins.getHeroGrowData(activityId);\r\n                const listData = ActivityData.ins.getHeroGrowTabs(activityId, heroGrowData.heroItemId);\r\n                this.showHeroSpine(listData[0].AnimationId);\r\n                break;\r\n            // 登录战令\r\n            case tab.OpenFunctionName.OpenFunctionName_BattlePassSignIn1:\r\n                if (!this[\"view\" + activityId]) {\r\n                    const battleLayer = instantiate(this.pfb_battle_pass);\r\n                    battleLayer.parent = this.activityNode;\r\n                    if (battleLayer) {\r\n                        this[\"view\" + activityId] = battleLayer.getComponent(BattlePassItem);\r\n                        this.currNode = battleLayer;\r\n                        this[\"view\" + activityId].onShow(null,activityInfo.Param1);\r\n                    }\r\n                } else {\r\n                    this[\"view\" + activityId].node.active = true;\r\n                    this.currNode = this[\"view\" + activityId].node;\r\n                    this[\"view\" + activityId].onShow(null,activityInfo.Param1);\r\n                }\r\n                const battleData =tab.getData().BattlePassTableById.getValue(activityInfo.Param1);\r\n                this.showHeroSpine(battleData.AnimationId);\r\n                break;\r\n            case tab.OpenFunctionName.OpenFunctionName_ActivityMall:\r\n                if (!this[\"view\" + activityId]) {\r\n                    const mallLayer = instantiate(this.pfb_up_mall);\r\n                    mallLayer.parent = this.activityNode;\r\n                    if (mallLayer) {\r\n                        this[\"view\" + activityId] = mallLayer.getComponent(CombineGiftItem);\r\n                        this.currNode = mallLayer;\r\n                        this[\"view\" + activityId].onShow(activityInfo.Param1);\r\n                    }\r\n                } else {\r\n                    this[\"view\" + activityId].node.active = true;\r\n                    this.currNode = this[\"view\" + activityId].node;\r\n                    this[\"view\" + activityId].onShow(activityInfo.Param1);\r\n                }\r\n                const mallData =tab.getData().MallTableByMallId.getValue(activityInfo.Param1);\r\n                this.showHeroSpine(mallData.AnimationId);\r\n                break\r\n            case tab.OpenFunctionName.OpenFunctionName_ActivityCumulativeRecharge:\r\n                this.node_hero.active = false;\r\n                if (!this[\"view\" + activityId]) {\r\n                    const rechargeLayer = instantiate(this.pfb_recharge);\r\n                    rechargeLayer.parent = this.activityNode;\r\n                    if (rechargeLayer) {\r\n                        this[\"view\" + activityId] = rechargeLayer.getComponent(CombineAccumulatedRechargeItem);\r\n                        this.currNode = rechargeLayer;\r\n                        this[\"view\" + activityId].onShow(activityId);\r\n                    }\r\n                } else {\r\n                    this[\"view\" + activityId].node.active = true;\r\n                    this.currNode = this[\"view\" + activityId].node;\r\n                    this[\"view\" + activityId].onShow(activityId);\r\n                }\r\n                break;\r\n            default:\r\n                break;\r\n        }\r\n    }\r\n    createToggle(tabList: number[]) {\r\n        this.node_toggle_content.destroyAllChildren();\r\n        for (let i = 0; i < tabList.length; i++) {\r\n            const _key = tabList[i];\r\n            let item = null;\r\n            let itemTs: CombineToggleItem = null;\r\n            item = instantiate(this.pfb_toggle_item);\r\n            item.parent = this.node_toggle_content;\r\n            item.name = String(_key);\r\n            itemTs = item.getComponent(CombineToggleItem);\r\n            itemTs.setData(_key, this);\r\n            this[\"view\" + _key] = null;\r\n        }\r\n    }\r\n    // 展示spine动画\r\n    showHeroSpine(animationId: number) {\r\n        createAnimation(this.node_spine, animationId);\r\n        const heroId = Number(String(animationId).slice(0,4));\r\n        this.showHeroId = heroId;\r\n        const heroTab = tab.getData().HeroTableById.getValue(heroId);\r\n        const itemTab = tab.getData().ItemTableById.getValue(heroId);\r\n        const heroClassTable = tab.getData().HeroClassTableByHeroClass.getValue(heroTab.Class);\r\n        const heroAptitudeTab = tab.getData().HeroAptitudeTableByHeroAptitude.getValue(heroTab.Aptitude);\r\n        const itemQualityTab = HeroDataControl.ins.getItemQualityTableByStar(heroTab.DefaultStar);\r\n\r\n        const sp_quality_star_bg = this.node_quality.getChildByName(\"quality2_img\").getComponent(Sprite)\r\n        const sp_quality = this.node_quality.getChildByName(\"quality_icon\").getComponent(Sprite)\r\n        const sp_quality_bg = this.node_quality.getChildByName(\"quality1_img\").getComponent(Sprite);\r\n        sp_quality_star_bg.setTexture(itemQualityTab.HeroBagGrowthQuality)\r\n        sp_quality_bg.setTexture(itemQualityTab.HeroBagLevelQuality);\r\n        sp_quality.setTexture(heroAptitudeTab.Icon);\r\n        this.sp_class.setTexture(heroClassTable.Icon);\r\n        this.lbl_hero_name.string = LangMgr.getLab(itemTab.Name);\r\n        this.lbl_class_desc.string = LangMgr.getLab(heroTab.Speciality)\r\n    }\r\n    clickShowHero(){\r\n        HeroDataControl.ins.refreshBookData(this.showHeroId);\r\n        UIMgr.ins.show({ viewName: ViewName.HeroBagView, data: { viewType: 2 }, zIndex: 300 })\r\n    }\r\n    on_s2c_ReceiveBattlePassTaskRewardsRsp(msg: proto.Msg_ReceiveBattlePassTaskRewardsRsp) {\r\n        if (msg.error && msg.error.code != proto.CommonErrorCode.Succeed) return;\r\n        this.currNode.getComponent(BattlePassItem).refreshView();\r\n        RedMgr.refreshEvent(RedDotType.Combine_Pass);\r\n    }\r\n    on_s2c_ReceiveActivityHeroGrowRewardRsp(msg:proto.Msg_ReceiveActivityHeroGrowRewardRsp){\r\n        if (!msg.error || msg.error.code == proto.CommonErrorCode.Succeed) {\r\n            UIMgr.ins.show({ viewName: ViewName.CongratulationPop, data: msg.rewards})\r\n            // 刷新一下数据\r\n            ActivityData.ins.refreshHeroGrowData(msg.activityId,msg.star);\r\n            this.currNode.getComponent(CombineStarUpItem).refreshView(); \r\n            RedMgr.refreshEvent(RedDotType.Combine_Grow);\r\n        }\r\n    }\r\n    on_s2c_BuyFixedShopCommodityRsp(msg: proto.Msg_BuyFixedShopCommodityRsp) {\r\n        if (msg.error && msg.error.code != proto.CommonErrorCode.Succeed) return;\r\n        this.currNode.getComponent(CombineGiftItem).refreshView();\r\n        RedMgr.refreshEvent(RedDotType.Combine_Shop);\r\n    }\r\n    onClickGachaBtn(){\r\n        UIMgr.ins.show({ viewName: ViewName.RecruitLimitView})\r\n    }\r\n}\r\n\r\n\r\n"]}