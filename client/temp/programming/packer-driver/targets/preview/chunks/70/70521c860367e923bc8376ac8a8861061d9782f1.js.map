{"version":3,"sources":["file:///C:/chickenStarClient/client/assets/scripts/logic/fight/result/FightWinPop.ts"],"names":["_decorator","Label","Node","ViewPop","proto","ItemInfo","ItemPoolMgr","CommonItem","FightRootControl","tab","LangMgr","DamageStatisticsData","AdMgr","Net","EventMgr","UIMgr","ViewName","RoleData","GameplayViewDataMgr","OpenFunctionMgr","FightData","FincaFightData","ccclass","property","FightWinPop","awards","onLoad","ins","isPvp","curClearStageId","lbl_skill_count","node","parent","active","node_double","damage_Node","register","onMsg","Ptl","ReceiveMainStageDoubleRewardsRsp","on_s2c_ReceiveMainStageDoubleRewardsRsp","msg","error","code","CommonErrorCode","Succeed","show","viewName","CongratulationPop","data","rewards","unRegister","onShow","openData","i","length","award","createCommonItem","pveTab","getData","PveStageTableByStageId","getValue","stageId","StageType","PveStageType","PveStageType_FeedStage","PveStageType_GoldStage","addExportInfo","lbl_name","string","getLab","StageName","String","totalKill","adTimes","getAdCountByType","AdType","AdType_MainChapterReward","maxTimes","getAdCountMaxByType","isOpen","checkFunctionIsOpen","OpenFunctionName","OpenFunctionName_WinResultDoubleReward","PveStageType_PVPBattle","PveStageType_MainChapter","lbl_ad_times","fincaFight_result","getCombineString","getChangeScoreStr","fincaBattleFightRsp","newScore","onDestroy","info","itemId","num","itemItem","createItem","node_content","itemTs","getComponent","setTouchCallBack","clickGoHomeBtn","pvpEnd","enterMain","clickAd","playVideoAd","Msg_ReceiveMainStageDoubleRewardsReq","Send","ReceiveMainStageDoubleRewardsReq","clickDamageDetail","event","FightDamageRankPop"],"mappings":"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","sourcesContent":["import { _decorator, Component, EventTouch, Label, Node } from 'cc';\r\nimport { ViewPop } from '../../../framework/base/ViewPop';\r\nimport { proto } from 'client_protocol';\r\nimport { ItemInfo } from '../../model/item/ItemInfo';\r\nimport { ItemPoolMgr } from '../../model/item/ItemPoolMgr';\r\nimport { CommonItem } from '../../model/item/CommonItem';\r\nimport { FightRootControl } from '../FightRootControl';\r\nimport { tab } from '../../../Table/table_gen';\r\nimport { BattleMainDataControl } from '../../model/home/battle/BattleMainDataControl';\r\nimport { LangMgr } from '../../mgr/LangMgr';\r\nimport { DamageStatisticsData } from '../base/damage/DamageStatisticsData';\r\nimport { AdMgr } from '../../model/AdMgr';\r\nimport { Net } from '../../net/Net';\r\nimport { EventMgr } from '../../mgr/EventMgr';\r\nimport { UIMgr } from '../../mgr/UIMgr';\r\nimport { ViewName } from '../../define/ViewDefine';\r\nimport { RoleData } from '../../model/role/RoleData';\r\nimport { GameplayViewDataMgr } from '../../model/jianghu/GameplayViewDataMgr';\r\nimport { OpenFunctionMgr } from '../../../Common/component/OpenFunctionMgr';\r\nimport { FightData } from '../data/FightData';\r\nimport { FincaFightData } from '../../model/fincaFight/FincaFightData';\r\nconst { ccclass, property } = _decorator;\r\n\r\n@ccclass('FightWinPop')\r\nexport class FightWinPop extends ViewPop {\r\n    @property(Node)\r\n    node_content: Node = null;\r\n    @property(Label)\r\n    lbl_name: Label = null;\r\n    @property(Label)\r\n    lbl_skill_count: Label = null;\r\n    @property(Node)\r\n    node_double: Node = null;\r\n    @property(Label)\r\n    lbl_ad_times: Label = null;\r\n    @property(Node)\r\n    damage_Node: Node = null\r\n\r\n    @property(Label)\r\n    fincaFight_result: Label = null;\r\n\r\n\r\n    private awards: proto.Item[] = [];\r\n    protected onLoad(): void {\r\n        super.onLoad()\r\n        if (FightData.ins.isPvp) {\r\n            RoleData.ins.curClearStageId = 60001;\r\n            this.lbl_skill_count.node.parent.active = false\r\n            this.node_double.active = false\r\n            this.damage_Node.active = false\r\n        }\r\n    }\r\n    register(): void {\r\n        EventMgr.onMsg(proto.Ptl.ReceiveMainStageDoubleRewardsRsp, this.on_s2c_ReceiveMainStageDoubleRewardsRsp, this);\r\n    }\r\n    on_s2c_ReceiveMainStageDoubleRewardsRsp(msg: proto.Msg_ReceiveMainStageDoubleRewardsRsp) {\r\n        if (msg.error && msg.error.code != proto.CommonErrorCode.Succeed) return;\r\n        // 领取双倍奖励\r\n        UIMgr.ins.show({ viewName: ViewName.CongratulationPop, data: msg.rewards });\r\n    }\r\n    unRegister(): void {\r\n        super.unRegister()\r\n    }\r\n    onShow(): void {\r\n        // 创建奖励\r\n        this.awards = this.openData;\r\n        for (let i = 0; i < this.awards.length; i++) {\r\n            const award: proto.Item = this.awards[i];\r\n            this.createCommonItem(award);\r\n        }\r\n        // 设置关卡名称\r\n        const pveTab = tab.getData().PveStageTableByStageId.getValue(FightData.ins.stageId);\r\n\r\n        if (pveTab.StageType === tab.PveStageType.PveStageType_FeedStage || pveTab.StageType === tab.PveStageType.PveStageType_GoldStage) {\r\n            GameplayViewDataMgr.ins.addExportInfo(pveTab.StageType, RoleData.ins.curClearStageId);\r\n        }\r\n\r\n        // this.lbl_name.string = LangMgr.getLab(chapterData.Name);\r\n        this.lbl_name.string = LangMgr.getLab(pveTab.StageName);\r\n        // 击杀怪物数量\r\n        this.lbl_skill_count.string = String(DamageStatisticsData.ins.totalKill);\r\n        // 设置广告次数\r\n        const adTimes = AdMgr.ins.getAdCountByType(tab.AdType.AdType_MainChapterReward);\r\n        const maxTimes = AdMgr.ins.getAdCountMaxByType(tab.AdType.AdType_MainChapterReward);\r\n        const isOpen = OpenFunctionMgr.ins.checkFunctionIsOpen(tab.OpenFunctionName.OpenFunctionName_WinResultDoubleReward)\r\n        this.node_double.active = (maxTimes > adTimes) && isOpen && pveTab.StageType != tab.PveStageType.PveStageType_PVPBattle;\r\n\r\n        if (pveTab.StageType !== tab.PveStageType.PveStageType_MainChapter) {\r\n            this.node_double.active = false;\r\n        }\r\n        this.lbl_ad_times.string = \"(\" + (maxTimes - adTimes) + \"/\" + maxTimes + \")\"\r\n\r\n        if (pveTab.StageType == tab.PveStageType.PveStageType_PVPBattle) {\r\n            this.fincaFight_result.node.active = true\r\n            this.fincaFight_result.string = LangMgr.getCombineString(\"ui_fincafight_13\", [ FincaFightData.ins.getChangeScoreStr(FightData.ins.fincaBattleFightRsp.newScore)])\r\n        }\r\n    }\r\n    protected onDestroy(): void {\r\n        super.onDestroy()\r\n    }\r\n    createCommonItem(data: proto.Item) {\r\n        const info = new ItemInfo();\r\n        info.itemId = data.itemId;\r\n        info.num = data.num;\r\n        const itemItem = ItemPoolMgr.ins.createItem(info, this.node_content);\r\n        const itemTs = itemItem.getComponent(CommonItem);\r\n        itemTs.setTouchCallBack(() => {\r\n\r\n        })\r\n    }\r\n    // 点击确定返回主页\r\n    clickGoHomeBtn() {\r\n        if (FightData.ins.isPvp) {\r\n            FightRootControl.ins.pvpEnd()\r\n            return\r\n        }\r\n        FightRootControl.ins.enterMain();\r\n    }\r\n    // 点击领取广告奖励\r\n    clickAd() {\r\n        this.node_double.active = false;\r\n        AdMgr.ins.playVideoAd(tab.AdType.AdType_MainChapterReward, () => {\r\n            let msg = new proto.Msg_ReceiveMainStageDoubleRewardsReq();\r\n            Net.Send(proto.Ptl.ReceiveMainStageDoubleRewardsReq, msg);\r\n        })\r\n\r\n    }\r\n    // 点击战斗伤害详情\r\n    clickDamageDetail(event: EventTouch) {\r\n        UIMgr.ins.show({ viewName: ViewName.FightDamageRankPop, data: { event: event } })\r\n    }\r\n}\r\n\r\n\r\n"]}