{"version":3,"sources":["file:///C:/chickenStarClient/client/assets/scripts/logic/model/weapon/WeaponPop.ts"],"names":["_decorator","instantiate","Node","Prefab","ProgressBar","tab","WeaponInfoItem","RareBookData","WeaponItem","ViewPop","OpenFunctionMgr","ccclass","property","WeaponPop","currTag","boosDicTabs","currWeaponItem","currNode","onTocchItem","weapon","isOpen","ins","checkFunctionIsOpen","OpenFunctionName","OpenFunctionName_RareBook","atpTab","getData","HeroAptitudeTableByHeroAptitude","getValue","info","bookTable","Aptitude","HeroAptitude","HeroAptitude_SR","setSelect","showFunctionTips","redPointNode","active","tujianRedPoint","updateWeaponInfoItem","register","onShow","Map","tabs","BookDictionary","key","bookId","PhaseOneBook","heroClass","getBookInfoByItemId","Class","set","initView","defaultToggleNode","getChildByName","currTab","get","updateItem","toggles1","PhaseTwoBook","toggles2","allLock","PhaseThreeBook","isLock","toggles3","proBar","progress","children","getComponent","item","isShowLock","isShowRedPoint","weaponItem","length","weaponItemPrefab","parent","bookInfo","com","initData","setNotOpen","setShowStar","onClickProToggle","event","tag","Number","target"],"mappings":"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","sourcesContent":["import { _decorator, Component, EventTouch, instantiate, Node, Prefab, ProgressBar, Toggle } from 'cc';\r\nimport { ViewBase } from '../../../framework/base/ViewBase';\r\nimport { tab } from '../../../Table/table_gen';\r\nimport { WeaponInfoItem } from '../common/WeaponInfoItem';\r\nimport { RareBookData } from '../rareBook/RareBookData';\r\nimport { WeaponItem } from '../common/WeaponItem';\r\nimport { ViewPop } from '../../../framework/base/ViewPop';\r\nimport { OpenFunctionMgr } from '../../../Common/component/OpenFunctionMgr';\r\nconst { ccclass, property } = _decorator;\r\n\r\n/**\r\n * \r\n * WeaponPop\r\n * zhudingchao\r\n * Tue May 28 2024 15:38:56 GMT+0800 (中国标准时间)\r\n * db://assets/scripts/logic/model/weapon/WeaponPop.ts\r\n *\r\n */\r\n\r\n@ccclass('WeaponPop')\r\nexport class WeaponPop extends ViewPop {\r\n    @property([Node])\r\n    toggles1: Array<Node> = [];\r\n    @property([Node])\r\n    toggles2: Array<Node> = [];\r\n    @property([Node])\r\n    toggles3: Array<Node> = [];\r\n    @property(ProgressBar)\r\n    proBar: ProgressBar = null;\r\n    @property(WeaponInfoItem)\r\n    WeaponInfoItem: WeaponInfoItem = null;\r\n    @property(Node)\r\n    defaultToggleNode: Node = null;\r\n    @property(Prefab)\r\n    weaponItemPrefab: Prefab = null;\r\n\r\n    private currTag: number = 1;\r\n    private boosDicTabs: Map<number, tab.BookDictionary>;\r\n\r\n    private currWeaponItem: WeaponItem;\r\n    private currNode: Node;\r\n    register(): void {\r\n\r\n    }\r\n    onShow(): void {\r\n        this.boosDicTabs = new Map();\r\n        let tabs = tab.getData().BookDictionary;\r\n        for (let key in tabs) {\r\n            let bookId = tabs[key].PhaseOneBook;\r\n            let heroClass = RareBookData.ins.getBookInfoByItemId(bookId).bookTable.Class;\r\n            this.boosDicTabs.set(heroClass, tabs[key]);\r\n        }\r\n        this.initView();\r\n        this.currNode = this.defaultToggleNode;\r\n        this.currNode.getChildByName(\"redNode\").active = false;\r\n    }\r\n    initView() {\r\n        let currTab = this.boosDicTabs.get(this.currTag);\r\n        this.updateItem(this.toggles1[0], currTab.PhaseOneBook, false)\r\n        for (let key in currTab.PhaseTwoBook) {\r\n            this.updateItem(this.toggles2[key], currTab.PhaseTwoBook[key], false);\r\n        }\r\n        let allLock = true;\r\n        for (let key in currTab.PhaseThreeBook) {\r\n            let isLock = this.updateItem(this.toggles3[key], currTab.PhaseThreeBook[key], true,true);\r\n            if (allLock) {\r\n                allLock = isLock;\r\n            }\r\n        }\r\n        this.proBar.progress = allLock ? 1 : 0.5;\r\n        this.currWeaponItem = this.toggles1[0].children[0].getComponent(WeaponItem);\r\n        this.currWeaponItem.setSelect(true);\r\n        this.updateWeaponInfoItem();\r\n    }\r\n\r\n    private updateItem(item: Node, bookId: number, isShowLock: boolean,isShowRedPoint:boolean=false) {\r\n        let weaponItem: Node = null;\r\n        if (item.children.length == 0) {\r\n            weaponItem = instantiate(this.weaponItemPrefab);\r\n            weaponItem.parent = item;\r\n        } else {\r\n            weaponItem = item.children[0];\r\n        }\r\n        let bookInfo = RareBookData.ins.getBookInfoByItemId(bookId);\r\n        let com = weaponItem.getComponent(WeaponItem);\r\n        com.initData(bookInfo, true, true, isShowLock, this.onTocchItem);\r\n        com.setNotOpen();\r\n        if(isShowRedPoint&&bookInfo.tujianRedPoint){\r\n            com.redPointNode.active=true;\r\n        }else{\r\n            com.redPointNode.active=false;\r\n        }\r\n        return bookInfo.isLock;\r\n    }\r\n    onTocchItem = (weapon: WeaponItem) => {\r\n        const isOpen = OpenFunctionMgr.ins.checkFunctionIsOpen(tab.OpenFunctionName.OpenFunctionName_RareBook);\r\n        let atpTab = tab.getData().HeroAptitudeTableByHeroAptitude.getValue(weapon.info.bookTable.Aptitude);\r\n        if(!isOpen&&atpTab.HeroAptitude===tab.HeroAptitude.HeroAptitude_SR){\r\n            this.currWeaponItem.setSelect(false);\r\n            OpenFunctionMgr.ins.showFunctionTips(tab.OpenFunctionName.OpenFunctionName_RareBook)\r\n            this.currWeaponItem = weapon;\r\n        }else{\r\n            if (this.currWeaponItem != weapon) {\r\n                this.currWeaponItem.setSelect(false);\r\n                weapon.setSelect(true);\r\n                if(weapon.redPointNode){\r\n                    weapon.redPointNode.active=false;\r\n                    weapon.info.tujianRedPoint=false;\r\n                }\r\n                this.currWeaponItem = weapon;\r\n                this.updateWeaponInfoItem();\r\n            }\r\n        }\r\n    }\r\n    updateWeaponInfoItem() {\r\n        this.WeaponInfoItem.initData(this.currWeaponItem.info);\r\n        this.WeaponInfoItem.setShowStar(this.currWeaponItem.info.bookTable.Aptitude == tab.HeroAptitude.HeroAptitude_SR);\r\n    }\r\n\r\n    onClickProToggle(event: EventTouch, tag) {\r\n        tag = Number(tag);\r\n        if (tag != this.currTag) {\r\n            this.currTag = tag;\r\n            this.initView();\r\n            if (this.currNode) {\r\n                this.currNode.getChildByName(\"redNode\").active = true;\r\n            }\r\n            event.target.getChildByName(\"redNode\").active = false;\r\n            this.currNode = event.target;\r\n        }\r\n\r\n        // tab.HeroClass\r\n    }\r\n}"]}