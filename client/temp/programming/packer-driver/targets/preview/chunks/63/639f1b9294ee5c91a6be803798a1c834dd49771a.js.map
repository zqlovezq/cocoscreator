{"version":3,"sources":["file:///C:/chickenStarClient/client/assets/scripts/logic/model/activity/wonderfulActivity/ActivityMainView.ts"],"names":["_decorator","instantiate","Node","Prefab","Toggle","ViewPop","ACTIVITY_GIFT_VIEW","MALLNAME","CycleGiftView","ChapterGiftView","tab","BattleMainDataControl","OpenFunctionMgr","MallDataMgr","Func","NewHandGiftView","proto","Net","EventMgr","RedMgr","RedDotType","ccclass","property","ActivityMainView","cycle_view","chapter_view","hand_view","hand_view2","view_type","NONE","currNode","chapterMap","Map","onShow","fixed_msg","Msg_GetFixedShopInfoMapReq","Send","Ptl","GetFixedShopInfoMapReq","initView","openData","console","log","ins","getFixedShopExpireTime","NewPlayerMall","node_toggle_NewPlayerMall","active","node_toggle_NewPlayerMall2","NewPlayerMall2","toggle_Cycle","node","checkFunctionIsOpen","OpenFunctionName","OpenFunctionName_SpecialGiftDaily","toggle_NewPlayerMall","isChecked","toggle_NewPlayerMall2","CYCLE","CHAPTER","toggle_chapter","setChapterMap","switchView","refreshHandGiftRed","updateCycleActivityRed","clear","ChapterId","getPassChapterId","i","getData","MallTable","length","_mallTab","_mallId","MallId","MallType","MallType_MainChapterGift","k","MallItemTabe","mallTab","OpenFunction","isOpen","ChapterGiftTab","MainChapterGiftTableByMallId","getValue","MainChapterId","boughtCount","getFixedShopData","get","Id","set","size","refreshChapterRed","onDestroy","register","onMsg","GetFixedShopInfoMapRsp","on_s2c_GetFixedShopInfoMapRsp","AdvWatchDataPush","msg","unRegister","clickSwitchView","e","view","Number","_cycle_view","pfb_cycle","parent","activityNode","getComponent","_chapter_view","pfb_chapter","_hand_view","pfb_mall","_hand_view2","isRed","forEach","val","key","local","Boolean","getItem","node_red_chapter","newBoughtCount","newBoughtCount2","mallItemTab","MallItemTabeById","mallItemTab2","node_red_NewPlayerMall","LimitCount","node_red_NewPlayerMall2","dailyRed","GachaAds","weekRed","MonthRed","node_activity_red"],"mappings":"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","sourcesContent":["import { _decorator, Component, error, EventTouch, instantiate, Node, Prefab, Toggle } from 'cc';\r\nimport { ViewPop } from '../../../../framework/base/ViewPop';\r\nimport { ACTIVITY_GIFT_VIEW, MALLNAME } from '../../../../Common/script/EnumTypeMgr';\r\nimport { ViewName } from '../../../define/ViewDefine';\r\nimport { ClientView } from '../../../mgr/ClientView';\r\nimport { LoadResAsync } from '../../../mgr/ResMgr';\r\nimport { CycleGiftView } from './CycleGiftView';\r\nimport { ChapterGiftView } from './ChapterGiftView';\r\nimport { tab } from '../../../../Table/table_gen';\r\nimport { BattleMainDataControl } from '../../home/battle/BattleMainDataControl';\r\nimport { OpenFunctionMgr } from '../../../../Common/component/OpenFunctionMgr';\r\nimport { MallDataMgr } from '../../shop/MallDataMgr';\r\nimport { Func } from '../../../utils/Func';\r\nimport { NewHandGiftView } from './NewHandGiftView';\r\nimport { proto } from 'client_protocol';\r\nimport { Net } from '../../../net/Net';\r\nimport { EventMgr } from '../../../mgr/EventMgr';\r\nimport { RedMgr } from '../../../mgr/RedMgr';\r\nimport { RedDotType } from '../../../red/RedDotType';\r\nconst { ccclass, property } = _decorator;\r\n\r\n@ccclass('ActivityMainView')\r\nexport class ActivityMainView extends ViewPop {\r\n    @property(Node)\r\n    activityNode: Node = null;\r\n    @property(Toggle)\r\n    toggle_chapter: Toggle = null;\r\n    @property(Toggle)\r\n    toggle_Cycle: Toggle = null;\r\n    @property(Toggle)\r\n    toggle_NewPlayerMall: Toggle = null;\r\n    @property(Toggle)\r\n    toggle_NewPlayerMall2: Toggle = null;\r\n    @property(Node)\r\n    node_red_chapter: Node = null;\r\n    @property(Node)\r\n    node_red_NewPlayerMall: Node = null;\r\n    @property(Node)\r\n    node_red_NewPlayerMall2: Node = null;\r\n    @property(Node)\r\n    node_toggle_NewPlayerMall: Node = null;\r\n    @property(Node)\r\n    node_toggle_NewPlayerMall2: Node = null;\r\n    @property(Node)\r\n    node_activity_red:Node = null;\r\n\r\n    @property(Prefab)\r\n    pfb_cycle:Prefab = null;//周期礼包\r\n    @property(Prefab)\r\n    pfb_chapter:Prefab = null;//章节礼包\r\n    @property(Prefab)\r\n    pfb_mall:Prefab = null;//新手商场\r\n\r\n    private cycle_view: CycleGiftView = null;\r\n    private chapter_view: ChapterGiftView = null;\r\n    private hand_view: NewHandGiftView = null;\r\n    private hand_view2: NewHandGiftView = null;\r\n    private view_type: ACTIVITY_GIFT_VIEW = ACTIVITY_GIFT_VIEW.NONE;\r\n    private currNode: Node = null;\r\n    private chapterMap: Map<MALLNAME, tab.MallItemTabe> = new Map();\r\n\r\n    onShow(): void {\r\n        // 获取固定商店信息\r\n        let fixed_msg = new proto.Msg_GetFixedShopInfoMapReq();\r\n        Net.Send(proto.Ptl.GetFixedShopInfoMapReq, fixed_msg);\r\n    }\r\n\r\n    initView() {\r\n        this.view_type = this.openData?this.openData[0]:ACTIVITY_GIFT_VIEW.NONE;\r\n        console.log(MallDataMgr.ins.getFixedShopExpireTime(MALLNAME.NewPlayerMall))\r\n        this.node_toggle_NewPlayerMall.active = MallDataMgr.ins.getFixedShopExpireTime(MALLNAME.NewPlayerMall) > 0\r\n        this.node_toggle_NewPlayerMall2.active = MallDataMgr.ins.getFixedShopExpireTime(MALLNAME.NewPlayerMall2) > 0\r\n        this.toggle_Cycle.node.active = OpenFunctionMgr.ins.checkFunctionIsOpen(tab.OpenFunctionName.OpenFunctionName_SpecialGiftDaily);\r\n\r\n        if (this.node_toggle_NewPlayerMall.active){\r\n            this.view_type = ACTIVITY_GIFT_VIEW.NewPlayerMall;\r\n            this.toggle_NewPlayerMall.isChecked = true;\r\n        }else if (this.node_toggle_NewPlayerMall2.active){\r\n            this.view_type = ACTIVITY_GIFT_VIEW.NewPlayerMall2;\r\n            this.toggle_NewPlayerMall2.isChecked = true;\r\n        }else if (this.toggle_Cycle.node.active ){\r\n            this.view_type = ACTIVITY_GIFT_VIEW.CYCLE;\r\n            this.toggle_Cycle.isChecked = true;\r\n        }else{\r\n            this.view_type = ACTIVITY_GIFT_VIEW.CHAPTER;\r\n            this.toggle_chapter.isChecked = true;\r\n        }\r\n\r\n        // if (this.view_type == ACTIVITY_GIFT_VIEW.NONE) {\r\n        //     console.error(\"没有显示的页签\")\r\n        //     this.view_type = ACTIVITY_GIFT_VIEW.CYCLE;\r\n        // }\r\n        this.setChapterMap();\r\n        this.switchView();\r\n        this.refreshHandGiftRed();\r\n        this.updateCycleActivityRed();\r\n        // this.toggle_Cycle.isChecked = true\r\n    }\r\n\r\n    setChapterMap() {\r\n        // 获取当前的章节\r\n        this.chapterMap.clear();\r\n        const ChapterId = BattleMainDataControl.ins.getPassChapterId();\r\n        if (ChapterId === 0) {\r\n            return;\r\n        }\r\n        for (let i = 0; i < tab.getData().MallTable.length; i++) {\r\n            const _mallTab = tab.getData().MallTable[i];\r\n            const _mallId = _mallTab.MallId;\r\n            if (_mallTab.MallType == tab.MallType.MallType_MainChapterGift) {\r\n                // 章节礼包\r\n                for (let k = 0; k < tab.getData().MallItemTabe.length; k++) {\r\n                    const mallTab = tab.getData().MallItemTabe[k];\r\n                    if (mallTab.MallId === _mallId) {\r\n                        // 判定开启条件\r\n                        if (mallTab.OpenFunction) {\r\n                            const isOpen = OpenFunctionMgr.ins.checkFunctionIsOpen(mallTab.OpenFunction);\r\n                            if (!isOpen) {\r\n                                continue;\r\n                            }\r\n                        }\r\n                        // 获取MainChapterGiftTable数据\r\n                        const ChapterGiftTab = tab.getData().MainChapterGiftTableByMallId.getValue(mallTab.MallId);\r\n                        // 是否达到通关条件\r\n                        if (ChapterGiftTab.MainChapterId <= ChapterId) {\r\n                            // 是否购买了\r\n                            const boughtCount = MallDataMgr.ins.getFixedShopData(mallTab.MallId).get(mallTab.Id);\r\n                            if (boughtCount === 0) {\r\n                                this.chapterMap.set(mallTab.Id, mallTab);\r\n                            }\r\n                        }\r\n                    }\r\n                }\r\n            }\r\n        }\r\n        this.toggle_chapter.node.active = this.chapterMap.size > 0;\r\n        this.refreshChapterRed();\r\n    }\r\n    protected onDestroy(): void {\r\n        super.onDestroy()\r\n    }\r\n    register(): void {\r\n        /* 商店固定信息 */\r\n        EventMgr.onMsg(proto.Ptl.GetFixedShopInfoMapRsp, this.on_s2c_GetFixedShopInfoMapRsp, this);\r\n        EventMgr.onMsg(proto.Ptl.AdvWatchDataPush, this.updateCycleActivityRed, this);\r\n    }\r\n    on_s2c_GetFixedShopInfoMapRsp(msg: proto.Msg_GetFixedShopInfoMapRsp) {\r\n        this.initView()\r\n    }\r\n    unRegister(): void {\r\n        super.unRegister();\r\n    }\r\n    clickSwitchView(e: EventTouch, view: string) {\r\n        this.view_type = Number(view);\r\n        this.switchView();\r\n    }\r\n    async switchView() {\r\n        if (this.currNode) {\r\n            this.currNode.active = false;\r\n        }\r\n        switch (this.view_type) {\r\n            case ACTIVITY_GIFT_VIEW.CYCLE:\r\n                if (!this.cycle_view) {\r\n                    const _cycle_view = instantiate(this.pfb_cycle);\r\n                    _cycle_view.parent = this.activityNode;\r\n                    if (_cycle_view) {\r\n                        this.cycle_view = _cycle_view.getComponent(CycleGiftView);\r\n                        this.currNode = _cycle_view;\r\n                        this.cycle_view.onShow(this.openData);\r\n                    }\r\n                } else {\r\n                    this.cycle_view.node.active = true;\r\n                    this.currNode = this.cycle_view.node;\r\n                    this.cycle_view.onShow(this.openData);\r\n                }\r\n                break;\r\n            case ACTIVITY_GIFT_VIEW.CHAPTER:\r\n                // 章节礼包\r\n                if (!this.chapter_view) {\r\n                    const _chapter_view =instantiate(this.pfb_chapter);\r\n                    _chapter_view.parent = this.activityNode;\r\n                    if (_chapter_view) {\r\n                        this.chapter_view = _chapter_view.getComponent(ChapterGiftView);\r\n                        this.currNode = _chapter_view;\r\n                        this.chapter_view.onShow(this.chapterMap);\r\n                    }\r\n                } else {\r\n                    this.chapter_view.node.active = true;\r\n                    this.currNode = this.chapter_view.node;\r\n                    this.chapter_view.onShow();\r\n                }\r\n                break\r\n            case ACTIVITY_GIFT_VIEW.NewPlayerMall:\r\n                // 新手商城\r\n                if (!this.hand_view) {\r\n                    const _hand_view = instantiate(this.pfb_mall);\r\n                    _hand_view.parent = this.activityNode;\r\n                    if (_hand_view) {\r\n                        this.hand_view = _hand_view.getComponent(NewHandGiftView);\r\n                        this.currNode = _hand_view;\r\n                        this.hand_view.onShow(MALLNAME.NewPlayerMall);\r\n                    }\r\n                } else {\r\n                    this.hand_view.node.active = true;\r\n                    this.currNode = this.hand_view.node;\r\n                    this.hand_view.onShow(MALLNAME.NewPlayerMall);\r\n                }\r\n                break\r\n            case ACTIVITY_GIFT_VIEW.NewPlayerMall2:\r\n                // 精英商城\r\n                if (!this.hand_view2) {\r\n                    const _hand_view2 = instantiate(this.pfb_mall);\r\n                    _hand_view2.parent = this.activityNode;\r\n                    if (_hand_view2) {\r\n                        this.hand_view2 = _hand_view2.getComponent(NewHandGiftView);\r\n                        this.currNode = _hand_view2;\r\n                        this.hand_view2.onShow(MALLNAME.NewPlayerMall2);\r\n                    }\r\n                } else {\r\n                    this.hand_view2.node.active = true;\r\n                    this.currNode = this.hand_view2.node;\r\n                    this.hand_view2.onShow(MALLNAME.NewPlayerMall2);\r\n                }\r\n            default:\r\n                break;\r\n        }\r\n    }\r\n    // async createView(viewName: ViewName) {\r\n    //     let viewTab = ClientView.ins.getViewTab(viewName);\r\n    //     if (viewTab) {\r\n    //         let pfb: Prefab = await LoadResAsync(viewTab.Path, Prefab)\r\n    //         let view = instantiate(pfb);\r\n    //         view.parent = this.activityNode;\r\n    //         return view;\r\n    //     } else {\r\n    //         error(\"view路径没有配置\", viewName)\r\n    //     }\r\n    //     return null;\r\n    // }\r\n    // 章节礼包红点\r\n    refreshChapterRed() {\r\n        let isRed = false;\r\n        this.chapterMap.forEach((val, key) => {\r\n            const local = Boolean(Func.getItem(\"chapter_gift_\" + key));\r\n            if (!local && !isRed) {\r\n                isRed = true;\r\n            }\r\n        })\r\n        this.node_red_chapter.active = isRed;\r\n    }\r\n    // 新手礼包 精英礼包红点\r\n    refreshHandGiftRed() {\r\n        // 新手礼包\r\n        const newBoughtCount = MallDataMgr.ins.getFixedShopData(MALLNAME.NewPlayerMall).get(7001);\r\n        const newBoughtCount2 = MallDataMgr.ins.getFixedShopData(MALLNAME.NewPlayerMall2).get(7101);\r\n        const mallItemTab = tab.getData().MallItemTabeById.getValue(7001);\r\n        const mallItemTab2 = tab.getData().MallItemTabeById.getValue(7101);\r\n        this.node_red_NewPlayerMall.active = newBoughtCount < mallItemTab.LimitCount;\r\n        this.node_red_NewPlayerMall2.active = newBoughtCount2 < mallItemTab2.LimitCount;\r\n    }\r\n    // 日礼包 周礼包 月礼包红点\r\n    updateCycleActivityRed(){\r\n        const dailyRed = RedMgr.ins.isRed(RedDotType.GachaAds, \"11\");\r\n        const weekRed = RedMgr.ins.isRed(RedDotType.GachaAds, \"12\");\r\n        const MonthRed = RedMgr.ins.isRed(RedDotType.GachaAds, \"13\");\r\n        this.node_activity_red.active = dailyRed||weekRed||MonthRed\r\n    }\r\n}\r\n\r\n\r\n"]}