{"version":3,"sources":["file:///C:/chickenStarClient/client/assets/scripts/logic/model/equip/EquipContainerInfo.ts"],"names":["_decorator","proto","EquipMasterInfo","EquipData","ccclass","property","EquipContainerInfo","EquipContainerData","_masterInfo","_totalAttrMap","merge","info","key","creatorNull","heroClass","data","slotData","slot","EquipSlotData","equipId","refineLv","masterData","HeroMasterData","enhanceLv","qualityLv","initMasterInfo","masteInfo","initTotalAttrMap","Map","equipInfo","ins","getEquipInfoById","attrs","totalAttr","forEach","value","addAttr","masterAttr","totalAttrMap","type","num","has","set","get"],"mappings":"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","sourcesContent":["import { _decorator, Component, Node } from 'cc';\r\nimport { proto } from 'client_protocol';\r\nimport { EquipMasterInfo } from './EquipMasterInfo';\r\nimport { EquipSlotInfo } from './EquipSlotInfo';\r\nimport { EquipData } from './EquipData';\r\nconst { ccclass, property } = _decorator;\r\n\r\n@ccclass('EquipContainerInfo')\r\nexport class EquipContainerInfo extends proto.EquipContainerData {\r\n\r\n    private _masterInfo: EquipMasterInfo;\r\n    private _totalAttrMap: Map<number, number>;\r\n\r\n    merge(info: any) {\r\n        for (const key in info) {\r\n            this[key] = info[key]\r\n        }\r\n\r\n    }\r\n\r\n    creatorNull(heroClass: number) {\r\n        let data = new proto.EquipContainerData();\r\n        data.heroClass = heroClass;\r\n        data.slotData = [null, null, null, null, null, null];\r\n        let slot = new proto.EquipSlotData();\r\n        slot.equipId = 0;\r\n        slot.refineLv = 0;\r\n        slot.refineLv = 0;\r\n        data.masterData = new proto.HeroMasterData();\r\n        data.masterData.enhanceLv = 0;\r\n        data.masterData.qualityLv = 0;\r\n        data.masterData.refineLv = 0;\r\n        this.merge(data);\r\n    }\r\n    private initMasterInfo() {\r\n        if (!this.masterData) {\r\n            this.masterData = new proto.HeroMasterData();\r\n            this.masterData.enhanceLv = 0;\r\n            this.masterData.qualityLv = 0;\r\n            this.masterData.refineLv = 0;\r\n        }\r\n        this._masterInfo = new EquipMasterInfo();\r\n        this._masterInfo.merge(this.masterData as proto.HeroMasterData);\r\n    }\r\n    get masteInfo() {\r\n        if (!this._masterInfo) {\r\n            this.initMasterInfo();\r\n        }\r\n        return this._masterInfo;\r\n    }\r\n    initTotalAttrMap() {\r\n        this._totalAttrMap = new Map();\r\n        for (let key in this.slotData) {\r\n            let slot = this.slotData[key];\r\n            if (slot && slot.equipId&&slot.equipId!=0) {\r\n                let equipInfo = EquipData.ins.getEquipInfoById(slot.equipId);\r\n                if(equipInfo){\r\n                    let attrs = equipInfo.totalAttr;\r\n                    attrs.forEach((value, key) => {\r\n                        this.addAttr(key, value);\r\n                    })\r\n                }\r\n              \r\n\r\n            }\r\n        }\r\n        let masterAttr=this.masteInfo.totalAttrMap;\r\n        masterAttr.forEach((value,key)=>{\r\n            this.addAttr(key, value);\r\n        })\r\n\r\n\r\n    }\r\n\r\n    private addAttr(type: number, num: number) {\r\n        if (this._totalAttrMap.has(type)) {\r\n            this._totalAttrMap.set(type, this._totalAttrMap.get(type) + num);\r\n        } else {\r\n            this._totalAttrMap.set(type, num);\r\n        }\r\n    }\r\n\r\n    get totalAttrMap() {\r\n        if (!this._totalAttrMap) {\r\n            this.initTotalAttrMap();\r\n        }\r\n        return this._totalAttrMap;\r\n    }\r\n\r\n}\r\n\r\n\r\n"]}