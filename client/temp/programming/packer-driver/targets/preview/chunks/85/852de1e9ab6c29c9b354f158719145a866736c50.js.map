{"version":3,"sources":["file:///C:/chickenStarClient/client/assets/scripts/logic/model/equip/EquipResolvePop.ts"],"names":["_decorator","log","Node","ViewPop","CommonItem","EquipData","ItemPoolMgr","ItemInfo","GameUtil","EventMgr","proto","EquipControl","tab","UIMgr","ViewName","EquipmentItem","ccclass","property","EquipResolvePop","currEquipItem","currSelectEquips","currResolveItems","currPostion","currQuality","currTag","register","onMsg","Ptl","DecomposeEquipRsp","on_s2c_DecomposeEquipRsp","start","openData","initView","initEquipItem","equipNode","active","jadeNode","initJadeItem","clearResolveItem","removeComItem","allEquips","ins","getEquips","currEquips","value","isWear","itemTable","BagType","BagType_Equip","equipTable","Type","quality","push","sort","a","b","key","node","createEquipItem","contentNode","com","getComponent","setTouchCallBack","onTouchItem","bind","BagType_Jade","locked","comItem","isSelectState","setSelectState","equipInfo","index","indexOf","splice","updateResolveItems","onClickPosition","event","type","position","Number","positionNode","onClickQuality","qualityNode","onClickPositionBtn","onClickQualityBtn","onClickOneSelect","onClickResolve","ids","id","length","reqDecomposeEquips","putEquipItem","rewards","rews","convertRewardsByList","Materials","item","find","itemId","num","initItemData","createItem","resolveContentNode","putCommonItem","onDisable","msg","error","code","CommonErrorCode","Succeed","show","viewName","CongratulationPop","data","items","onDestroy","unTarget","onToggle","onJadeToggle"],"mappings":"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","sourcesContent":["import { _decorator, Component, log, Node, TangentWeightMode } from 'cc';\r\nimport { ViewPop } from '../../../framework/base/ViewPop';\r\nimport { CommonItem } from '../item/CommonItem';\r\nimport { EquipData } from './EquipData';\r\nimport { EquipInfo } from './EquipInfo';\r\nimport { ItemPoolMgr } from '../item/ItemPoolMgr';\r\nimport { ItemInfo } from '../item/ItemInfo';\r\nimport { GameUtil } from '../../utils/GameUtil';\r\nimport { EventMgr } from '../../mgr/EventMgr';\r\nimport { proto } from 'client_protocol';\r\nimport { EquipControl } from './EquipControl';\r\nimport { tab } from '../../../Table/table_gen';\r\nimport { UIMgr } from '../../mgr/UIMgr';\r\nimport { ViewName } from '../../define/ViewDefine';\r\nimport { EquipmentItem } from '../item/EquipmentItem';\r\nconst { ccclass, property } = _decorator;\r\n\r\n@ccclass('EquipResolvePop')\r\nexport class EquipResolvePop extends ViewPop {\r\n    @property(Node)\r\n    equipNode: Node = null;\r\n    @property(Node)\r\n    jadeNode: Node = null;\r\n\r\n\r\n    @property(Node)\r\n    positionNode: Node = null;\r\n    @property(Node)\r\n    qualityNode: Node = null;\r\n    @property(Node)\r\n    contentNode: Node = null;\r\n\r\n    @property(Node)\r\n    resolveContentNode: Node = null;\r\n\r\n    private currEquipItem: Array<EquipmentItem>;\r\n    private currSelectEquips: Array<EquipInfo>;\r\n    private currResolveItems: Array<CommonItem>;\r\n\r\n    private currPostion: number = 0;\r\n    private currQuality: number = 0;\r\n    private currTag: number=1;\r\n\r\n    register(): void {\r\n        this.currSelectEquips = [];\r\n        this.currEquipItem = [];\r\n        EventMgr.onMsg(proto.Ptl.DecomposeEquipRsp, this.on_s2c_DecomposeEquipRsp, this)\r\n    }\r\n    start(): void {\r\n        if(this.openData&&this.openData[\"tag\"]){\r\n            this.currTag=this.openData[\"tag\"];\r\n        }\r\n        this.initView();\r\n\r\n    }\r\n    private initView(){\r\n     \r\n        if(this.currTag==1){\r\n            this.initEquipItem();\r\n            this.equipNode.active=true;\r\n            this.jadeNode.active=false;\r\n        }else{\r\n            this.equipNode.active=false;\r\n            this.jadeNode.active=true;\r\n            this.initJadeItem();\r\n        }\r\n    }\r\n    initEquipItem() {\r\n        this.clearResolveItem();\r\n        this.removeComItem();\r\n        this.currSelectEquips = [];\r\n        let allEquips = EquipData.ins.getEquips();\r\n        let currEquips: Array<EquipInfo> = [];\r\n        for (let value of allEquips) {\r\n            if (!value.isWear&&value.itemTable.BagType==tab.BagType.BagType_Equip) {\r\n                if (this.currPostion == 0 || this.currPostion == value.equipTable.Type) {\r\n                    if (this.currQuality == 0 || value.quality <= this.currQuality) {\r\n                        currEquips.push(value);\r\n                    }\r\n                }\r\n            }\r\n        }\r\n        currEquips.sort((a, b) => {\r\n            return a.quality - b.quality;\r\n        })\r\n        for (let key in currEquips) {\r\n            let node = ItemPoolMgr.ins.createEquipItem(currEquips[key],this.contentNode);\r\n            let com = node.getComponent(EquipmentItem);\r\n            com.setTouchCallBack(this.onTouchItem.bind(this));\r\n            this.currEquipItem.push(com);\r\n\r\n        }\r\n    }\r\n    initJadeItem() {\r\n       this.clearResolveItem();\r\n        this.removeComItem();\r\n        this.currSelectEquips = [];\r\n        let allEquips = EquipData.ins.getEquips();\r\n        let currEquips: Array<EquipInfo> = [];\r\n        for (let value of allEquips) {\r\n            if (!value.isWear&&value.itemTable.BagType==tab.BagType.BagType_Jade&&!value.locked) {\r\n                {\r\n                    if (this.currQuality == 0 || value.quality == this.currQuality) {\r\n                        currEquips.push(value);\r\n                    }\r\n                }\r\n            }\r\n        }\r\n        currEquips.sort((a, b) => {\r\n            return a.quality - b.quality;\r\n        })\r\n        for (let key in currEquips) {\r\n            let node = ItemPoolMgr.ins.createEquipItem(currEquips[key],this.contentNode);\r\n            let com = node.getComponent(EquipmentItem);\r\n            com.setTouchCallBack(this.onTouchItem.bind(this));\r\n            this.currEquipItem.push(com);\r\n\r\n        }\r\n    }\r\n    onTouchItem(comItem: CommonItem) {\r\n        let b = !comItem.isSelectState;\r\n        comItem.setSelectState(b);\r\n        if (b) {\r\n            this.currSelectEquips.push(comItem.equipInfo)\r\n        } else {\r\n            let index = this.currSelectEquips.indexOf(comItem.equipInfo);\r\n            if (index >= 0) {\r\n                this.currSelectEquips.splice(index, 1);\r\n            }\r\n        }\r\n        this.updateResolveItems();\r\n    }\r\n    onClickPosition(event, type) {\r\n        let position = Number(type);\r\n        if (this.currPostion != position) {\r\n            this.currPostion = position;\r\n            this.initEquipItem();\r\n        }\r\n        this.positionNode.active = false;\r\n\r\n    }\r\n    onClickQuality(event, type) {\r\n        let quality = Number(type);\r\n        if (this.currQuality != quality) {\r\n            this.currQuality = quality;\r\n            this.initEquipItem();\r\n        }\r\n        this.qualityNode.active = false;\r\n\r\n    }\r\n    onClickPositionBtn() {\r\n        this.positionNode.active = !this.positionNode.active;\r\n    }\r\n    onClickQualityBtn() {\r\n        this.qualityNode.active = !this.qualityNode.active;\r\n    }\r\n    onClickOneSelect() {\r\n        this.currSelectEquips = [];\r\n        for (let key in this.currEquipItem) {\r\n            this.currEquipItem[key].setSelectState(true);\r\n            this.currSelectEquips.push(this.currEquipItem[key].equipInfo);\r\n        }\r\n        this.updateResolveItems();\r\n\r\n    }\r\n    onClickResolve() {\r\n        let ids = [];\r\n        for (let key in this.currSelectEquips) {\r\n            ids.push(this.currSelectEquips[key].id);\r\n        }\r\n        if(ids.length>0){\r\n            EquipControl.ins.reqDecomposeEquips(ids);\r\n        }\r\n        \r\n\r\n    }\r\n    private removeComItem() {\r\n        for (let key in this.currEquipItem) {\r\n            ItemPoolMgr.ins.putEquipItem(this.currEquipItem[key].node)\r\n        }\r\n        this.currEquipItem = [];\r\n    }\r\n\r\n    updateResolveItems() {\r\n\r\n\r\n        this.clearResolveItem();\r\n\r\n        let rewards: Array<ItemInfo> = [];\r\n        for (let key in this.currSelectEquips) {\r\n            let equipInfo = this.currSelectEquips[key];\r\n            let rews = GameUtil.convertRewardsByList(equipInfo.equipTable.Materials);\r\n            for (let value of rews) {\r\n                let item = rewards.find((a) => a.itemId === value.itemId);\r\n                if (item) {\r\n                    item.num += value.num;\r\n                } else {\r\n                    item = new ItemInfo();\r\n                    item.initItemData(value.itemId, value.num);\r\n                    rewards.push(item);\r\n                }\r\n            }\r\n        }\r\n\r\n        for (let value of rewards) {\r\n            let node = ItemPoolMgr.ins.createItem(value,this.resolveContentNode,false,false);\r\n            let com = node.getComponent(CommonItem);\r\n            // com.setIsTouchItem(false);\r\n            this.currResolveItems.push(com);\r\n        }\r\n\r\n    }\r\n    private clearResolveItem() {\r\n        for (let key in this.currResolveItems) {\r\n            ItemPoolMgr.ins.putCommonItem(this.currResolveItems[key].node)\r\n        }\r\n        this.currResolveItems = [];\r\n    }\r\n    protected onDisable(): void {\r\n        this.removeComItem();\r\n        this.clearResolveItem();\r\n    }\r\n    /**\r\n   * 分解装备成功\r\n   * @param msg \r\n   */\r\n    on_s2c_DecomposeEquipRsp(msg: proto.Msg_DecomposeEquipRsp) {\r\n\r\n        if (msg.error.code == proto.CommonErrorCode.Succeed) {\r\n            // EquipData.ins.removeEquipByIds(msg.equipList);\r\n            this.clearResolveItem();\r\n            this.initEquipItem();\r\n            log(\"收到分解成功消息\")\r\n            UIMgr.ins.show({ viewName: ViewName.CongratulationPop, data: msg.items })\r\n        }\r\n        // EquipData.ins.updateEquipMasterData(msg.heroClass,msg.masterData);\r\n    }\r\n    protected onDestroy(): void {\r\n        EventMgr.unTarget(this);\r\n    }\r\n    public onToggle(event,type){\r\n        if(this.currTag!=Number(type)){\r\n            this.currTag=Number(type);\r\n            this.initView();\r\n        }\r\n    }\r\n    onJadeToggle(event, type: number) {\r\n        if (this.currQuality != Number(type)) {\r\n            this.currQuality = Number(type);\r\n            this.initJadeItem();\r\n        }\r\n    }\r\n\r\n}\r\n\r\n\r\n"]}