{"version":3,"sources":["file:///C:/chickenStarClient/client/assets/scripts/logic/model/rareBook/RareBookGuaranteedPop.ts"],"names":["_decorator","Label","RichText","sp","Sprite","ViewPop","proto","Net","tab","ItemData","ShowItemNotEnoughTips","UIMgr","ViewName","LangMgr","EventMgr","OpenFunctionMgr","ccclass","property","RareBookGuaranteedPop","Skeleton","gachaData","onShow","self","getData","GachaTableById","getValue","needCount","ItemCount","curCount","ins","getCount","lbl_cur_count","string","openTab","OpenFunctionTableByName","OpenFunctionName","OpenFunctionName_GachaBookSR","rich_txt_recruit","getCombineString","itemTab","ItemTableById","sp_icon","setTexture","Icon","schedule","randomAction","spineAction","getRandomValue","spine_draw","setAnimation","randomNumber","Math","random","on_s2c_GachaRsp","msg","error","code","CommonErrorCode","Succeed","onDisable","unschedule","onDestroy","register","onMsg","Ptl","GachaRsp","unRegister","clickGacha","isOpen","checkFunctionIsOpen","showFunctionTips","Msg_GachaReq","id","Id","Send","GachaReq","showGachaProbabilityView","event","type","show","viewName","RareBookSrProbabilityPop"],"mappings":"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","sourcesContent":["import { _decorator, Component, EventTouch, Label, Node, RichText, sp, SpringJoint2D, Sprite } from 'cc';\r\nimport { ViewPop } from '../../../framework/base/ViewPop';\r\nimport { proto } from 'client_protocol';\r\nimport { Net } from '../../net/Net';\r\nimport { tab } from '../../../Table/table_gen';\r\nimport { ItemData } from '../item/ItemData';\r\nimport { ShowItemNotEnoughTips, UIMgr } from '../../mgr/UIMgr';\r\nimport { ViewName } from '../../define/ViewDefine';\r\nimport { LangMgr } from '../../mgr/LangMgr';\r\nimport { EventMgr } from '../../mgr/EventMgr';\r\nimport { RecruitType } from '../../../Common/script/EnumTypeMgr';\r\nimport { OpenFunctionMgr } from '../../../Common/component/OpenFunctionMgr';\r\nconst { ccclass, property } = _decorator;\r\n\r\n@ccclass('RareBookGuaranteedPop')\r\nexport class RareBookGuaranteedPop extends ViewPop {\r\n    @property(Label)\r\n    lbl_cur_count: Label = null;\r\n    @property(RichText)\r\n    rich_txt_recruit: RichText = null;\r\n    @property(Sprite)\r\n    sp_icon: Sprite = null;\r\n    @property(sp.Skeleton)\r\n    spine_draw: sp.Skeleton = null;\r\n    private gachaData: tab.GachaTable = null;\r\n    onShow(): void {\r\n        // 当前的gacha数据为\r\n        const self = this;\r\n        this.gachaData = tab.getData().GachaTableById.getValue(1000);\r\n        // 需要消耗的数量\r\n        const needCount = this.gachaData.ItemCount;\r\n        // 当前道具数量\r\n        const curCount = ItemData.ins.getCount(82);\r\n        this.lbl_cur_count.string = curCount + \"/\" + needCount;\r\n        // 解锁条件\r\n        const openTab: tab.OpenFunctionTable = tab.getData().OpenFunctionTableByName.getValue(tab.OpenFunctionName.OpenFunctionName_GachaBookSR);\r\n        this.rich_txt_recruit.string = LangMgr.getCombineString(\"ui_rarebook_4\", [needCount]);\r\n        const itemTab = tab.getData().ItemTableById.getValue(82);\r\n        this.sp_icon.setTexture(itemTab.Icon);\r\n\r\n        this.schedule(this.randomAction, 2)\r\n    }\r\n    randomAction() {\r\n        let spineAction = this.getRandomValue();\r\n        this.spine_draw.setAnimation(0, spineAction, false);\r\n    }\r\n    getRandomValue(): string {\r\n        const randomNumber = Math.random(); // 生成一个 [0, 1) 之间的随机数\r\n        if (randomNumber < 0.5) {\r\n            return \"idle\"; // 50%的概率返回1\r\n        } else {\r\n            return \"xuanzhuan\"; // 50%的概率返回2\r\n        }\r\n    }\r\n    on_s2c_GachaRsp(msg: proto.Msg_GachaRsp) {\r\n        if (msg.error && msg.error.code != proto.CommonErrorCode.Succeed) return;\r\n        const curCount = ItemData.ins.getCount(82);\r\n        const needCount = this.gachaData.ItemCount;\r\n        this.lbl_cur_count.string = curCount + \"/\" + needCount;\r\n    }\r\n    protected onDisable(): void {\r\n        this.unschedule(this.randomAction)\r\n    }\r\n    protected onDestroy(): void {\r\n        super.onDestroy()\r\n    }\r\n    register(): void {\r\n        EventMgr.onMsg(proto.Ptl.GachaRsp, this.on_s2c_GachaRsp, this);\r\n    }\r\n    unRegister(): void {\r\n        super.unRegister()\r\n    }\r\n    /* 点击招募 */\r\n    clickGacha() {\r\n        // 先判断是否道具足够\r\n        // 判断功能是否开启\r\n        const isOpen = OpenFunctionMgr.ins.checkFunctionIsOpen(tab.OpenFunctionName.OpenFunctionName_GachaBookSR);\r\n        if(!isOpen){\r\n            OpenFunctionMgr.ins.showFunctionTips(tab.OpenFunctionName.OpenFunctionName_GachaBookSR);\r\n            return;\r\n        }\r\n        const needCount = this.gachaData.ItemCount;\r\n        const curCount = ItemData.ins.getCount(82);\r\n        if (curCount < needCount) {\r\n            // 道具不足\r\n            ShowItemNotEnoughTips(82);\r\n            return\r\n        }\r\n        // 是否解锁\r\n\r\n        let msg = new proto.Msg_GachaReq();\r\n        msg.id = this.gachaData.Id;\r\n        Net.Send(proto.Ptl.GachaReq, msg);\r\n    }\r\n    /* 显示概率公示界面 */\r\n    showGachaProbabilityView(event: EventTouch, type: string) {\r\n        UIMgr.ins.show({viewName:ViewName.RareBookSrProbabilityPop})\r\n        // UIMgr.ins.show({\r\n        //     viewName: ViewName.RecruitProbabilityPop, data: {\r\n        //         type: RecruitType.BookGuarantee\r\n        //     }\r\n        // });\r\n    }\r\n}\r\n\r\n\r\n"]}