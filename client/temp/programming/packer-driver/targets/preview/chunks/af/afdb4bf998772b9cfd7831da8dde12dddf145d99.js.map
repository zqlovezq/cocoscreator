{"version":3,"sources":["file:///C:/chickenStarClient/client/assets/scripts/logic/model/friends/FriendListItem.ts"],"names":["_decorator","Label","Node","Sprite","PlayerHeadItem","InfiniteCell","proto","FriendControl","ShowTips","RoleData","TimeUtil","LangMgr","GameUtil","FriendData","tab","ccclass","property","FriendListItem","type","info","register","UpdateContent","data","initView","nameLab","string","name","headItem","initHeadInfo","roleInfo","forceLab","convertNumber","powerScore","myFriendNode","active","FriendListType","FriendList","applicationNode","ApplyList","addNode","blacklistNode","BlackList","addBtnSpr","grayscale","isSendAddFrined","offlineTime","lastTime","ins","getServerUtcTime","str","formaterWithOutSecond2","offlineTimeLab","offlineNode","onLineNode","sendValueSpr","isGiveGift","getValueSpr","receiveGiftState","onClickChat","getLab","onClickGetValue","requestRecvGift","id","onClickSendValue","requestGivingGift","onClickDenine","requestRemoveFriendApply","onClickAccept","friendInfo","getMyFreindInfos","max","getData","GetKeyValue_ConfigTable","FriendMaxCount","length","requestConfirmFriend","onClickAdd","requestAddFriend","onClickDelect","requestRemoveBlacklist"],"mappings":"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","sourcesContent":["import { _decorator, Component, EditBox, Label, Node, Sprite, spriteAssembler } from 'cc';\r\nimport { ComponentBase } from '../../../framework/base/ComponentBase';\r\nimport { PlayerHeadItem } from '../common/PlayerHeadItem';\r\nimport InfiniteCell from '../../../Common/InfiniteList/InfiniteCell';\r\nimport { SimpleRoleInfo } from './SimpleRoleInfo';\r\nimport { proto } from 'client_protocol';\r\nimport { FriendControl } from './FriendControl';\r\nimport { ShowTips } from '../../mgr/UIMgr';\r\nimport { RoleData } from '../role/RoleData';\r\nimport { TimeUtil } from '../../utils/TimeUtil';\r\nimport { LangMgr } from '../../mgr/LangMgr';\r\nimport { GameUtil } from '../../utils/GameUtil';\r\nimport { FriendData } from './FriendData';\r\nimport { tab } from '../../../Table/table_gen';\r\nconst { ccclass, property } = _decorator;\r\n\r\n/**\r\n * \r\n * FriendListItem\r\n * zhudingchao\r\n * Fri Jun 07 2024 17:42:17 GMT+0800 (中国标准时间)\r\n * db://assets/scripts/logic/model/friends/FriendListItem.ts\r\n *\r\n */\r\n\r\n@ccclass('FriendListItem')\r\nexport class FriendListItem extends InfiniteCell {\r\n    @property(PlayerHeadItem)\r\n    headItem: PlayerHeadItem = null;\r\n    @property(Label)\r\n    forceLab: Label = null;\r\n    @property(Node)\r\n    myFriendNode: Node = null;\r\n    @property(Node)\r\n    applicationNode: Node = null;\r\n    @property(Node)\r\n    addNode: Node = null;\r\n    @property(Node)\r\n    blacklistNode: Node = null;\r\n    @property(Label)\r\n    nameLab: Label = null;\r\n    @property(Label)\r\n    titleLab: Label = null;\r\n    @property(Node)\r\n    titleNode: Node = null;\r\n    @property(Node)\r\n    onLineNode: Node = null;\r\n    @property(Node)\r\n    offlineNode: Node = null;\r\n    @property(Label)\r\n    offlineTimeLab: Label = null;\r\n    @property(Sprite)\r\n    getValueSpr: Sprite = null;\r\n    @property(Sprite)\r\n    sendValueSpr: Sprite = null;\r\n    @property(Sprite)\r\n    addBtnSpr: Sprite = null;\r\n    private type: number;\r\n    private info: SimpleRoleInfo;\r\n\r\n\r\n\r\n    register(): void {\r\n\r\n    }\r\n    UpdateContent(data: any): void {\r\n        if (data) {\r\n            this.type = data[\"type\"];\r\n            this.info = data[\"info\"];\r\n            this.initView();\r\n        }\r\n    }\r\n    initView() {\r\n        this.nameLab.string = this.info.name;\r\n        this.headItem.initHeadInfo({ roleInfo: this.info });\r\n        this.forceLab.string = GameUtil.convertNumber(this.info.powerScore) + \"\";\r\n        this.myFriendNode.active = this.type == proto.FriendListType.FriendList;\r\n        this.applicationNode.active = this.type == proto.FriendListType.ApplyList;\r\n        this.addNode.active = this.type == 3;\r\n        this.blacklistNode.active = this.type == proto.FriendListType.BlackList;\r\n        if (this.type == 3) {\r\n            this.addBtnSpr.grayscale = this.info.isSendAddFrined;\r\n        } else if (this.type == proto.FriendListType.FriendList) {\r\n            if (this.info.offlineTime > 0) {\r\n                let lastTime = RoleData.ins.getServerUtcTime() - this.info.offlineTime;\r\n                let str = TimeUtil.formaterWithOutSecond2(lastTime);\r\n                this.offlineTimeLab.string = str;\r\n                this.offlineNode.active = true;\r\n                this.onLineNode.active = false;\r\n            } else {\r\n                this.offlineNode.active = false;\r\n                this.onLineNode.active = true;\r\n            }\r\n            this.sendValueSpr.grayscale = this.info.isGiveGift;\r\n            this.getValueSpr.grayscale = this.info.receiveGiftState != 1;\r\n        }\r\n\r\n\r\n    }\r\n    onClickChat() {\r\n        //ShowTips(\"点击聊天\")\r\n        ShowTips(LangMgr.getLab(\"Tips_friend_17\"))\r\n    }\r\n    onClickGetValue() {\r\n        if (this.info.receiveGiftState == 1) {\r\n            FriendControl.ins.requestRecvGift([this.info.id])\r\n        }\r\n    }\r\n    onClickSendValue() {\r\n        if (!this.info.isGiveGift) {\r\n            FriendControl.ins.requestGivingGift([this.info.id])\r\n        }\r\n    }\r\n    onClickDenine() {\r\n        FriendControl.ins.requestRemoveFriendApply([this.info.id]);\r\n    }\r\n    onClickAccept() {\r\n        // 获取好友列表\r\n        const friendInfo = FriendData.ins.getMyFreindInfos();\r\n        let max = tab.getData().GetKeyValue_ConfigTable().FriendMaxCount;\r\n        if(friendInfo.length>=max){\r\n            ShowTips(LangMgr.getLab(\"Tips_friend_18\"))\r\n        }else{\r\n            FriendControl.ins.requestConfirmFriend([this.info.id]);\r\n        }\r\n    }\r\n    onClickAdd() {\r\n        if (!this.info.isSendAddFrined) {\r\n            FriendControl.ins.requestAddFriend(this.info.id);\r\n            this.info.isSendAddFrined = true;\r\n            this.addBtnSpr.grayscale = this.info.isSendAddFrined;\r\n        }\r\n\r\n    }\r\n    onClickDelect() {\r\n        FriendControl.ins.requestRemoveBlacklist(this.info.id);\r\n    }\r\n}"]}