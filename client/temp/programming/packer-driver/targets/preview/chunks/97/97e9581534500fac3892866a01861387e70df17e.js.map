{"version":3,"sources":["file:///C:/chickenStarClient/client/assets/scripts/logic/model/activity/rookieTask/RookieTaskBarItem.ts"],"names":["_decorator","Component","Label","Node","ProgressBar","tab","RookieTaskMgr","CommonItem","ItemInfo","proto","Net","ccclass","property","RookieTaskBarItem","taskScoreTab","initData","scoreTab","newPlayerTaskTab","getData","ActivityNewPlayerTaskTableById","getValue","Id","newPlayertrial","ins","getTrialTask","Group","socre","score","receiveIds","receivedScoreIds","isGot","indexOf","lbl_score","string","String","Score","itemInfo","itemId","RewardId","num","RewardNum","common_item","setSelectState","node_red","active","lastScoreTab","ActivityNewPlayerTaskScoreTableById","lastScore","node_bar","progress","setTouchCallBack","msg","Msg_ReceiveNewPlayerTrialScoreRewardsReq","scoreId","Send","Ptl","ReceiveNewPlayerTrialScoreRewardsReq","gotItem"],"mappings":"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","sourcesContent":["import { _decorator, Component, Label, Node, ProgressBar } from 'cc';\r\nimport { tab } from '../../../../Table/table_gen';\r\nimport { RookieTaskMgr } from './RookieTaskMgr';\r\nimport { CommonItem } from '../../item/CommonItem';\r\nimport { ItemInfo } from '../../item/ItemInfo';\r\nimport { proto } from 'client_protocol';\r\nimport { Net } from '../../../net/Net';\r\nimport { HeroData } from '../../hero/HeroData';\r\nconst { ccclass, property } = _decorator;\r\n\r\n@ccclass('RookieTaskBarItem')\r\nexport class RookieTaskBarItem extends Component {\r\n    @property(CommonItem)\r\n    common_item:CommonItem = null;\r\n    @property(Label)\r\n    lbl_score:Label = null;\r\n    @property(Node)\r\n    node_red:Node = null;\r\n    @property(ProgressBar)\r\n    node_bar:ProgressBar = null;\r\n    private taskScoreTab:tab.ActivityNewPlayerTaskScoreTable = null;\r\n    initData(scoreTab:tab.ActivityNewPlayerTaskScoreTable){\r\n        this.taskScoreTab = scoreTab;\r\n        const newPlayerTaskTab = tab.getData().ActivityNewPlayerTaskTableById.getValue(this.taskScoreTab.Id);\r\n        const newPlayertrial =RookieTaskMgr.ins.getTrialTask(newPlayerTaskTab.Group);\r\n        const socre = newPlayertrial.score;\r\n        const receiveIds = newPlayertrial.receivedScoreIds;\r\n        const isGot = receiveIds.indexOf(this.taskScoreTab.Id)>-1\r\n        this.lbl_score.string = String(this.taskScoreTab.Score);\r\n        const itemInfo = new ItemInfo();\r\n        itemInfo.itemId = this.taskScoreTab.RewardId;\r\n        itemInfo.num = this.taskScoreTab.RewardNum;\r\n        this.common_item.initData(itemInfo);\r\n        this.common_item.setSelectState(isGot);\r\n        this.node_red.active = !isGot&&socre>=this.taskScoreTab.Score;\r\n\r\n        // 判断上一阶段的分数\r\n        const lastScoreTab = tab.getData().ActivityNewPlayerTaskScoreTableById.getValue(scoreTab.Id-1);\r\n        const lastScore = lastScoreTab?lastScoreTab.Score:0\r\n        this.node_bar.progress = socre>=this.taskScoreTab.Score?1:(socre-lastScore)/(this.taskScoreTab.Score-lastScore);\r\n\r\n        // 是否是英雄\r\n        this.common_item.setTouchCallBack(null);\r\n        if(!isGot&&socre>=this.taskScoreTab.Score){\r\n            this.common_item.setTouchCallBack(()=>{\r\n                // 领取奖励\r\n                let msg = new proto.Msg_ReceiveNewPlayerTrialScoreRewardsReq();\r\n                msg.scoreId = this.taskScoreTab.Id;\r\n                Net.Send(proto.Ptl.ReceiveNewPlayerTrialScoreRewardsReq , msg)\r\n            })\r\n        }\r\n    }\r\n    gotItem(){\r\n        this.common_item.setSelectState(true);\r\n        this.common_item.setTouchCallBack(null);\r\n        this.node_red.active = false;\r\n    }\r\n}\r\n\r\n\r\n"]}