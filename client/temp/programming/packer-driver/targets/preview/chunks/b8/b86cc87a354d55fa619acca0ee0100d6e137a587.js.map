{"version":3,"sources":["file:///C:/chickenStarClient/client/assets/scripts/logic/model/hero/herobag/HeroBagItem.ts"],"names":["_decorator","Component","Label","log","Node","Sprite","proto","HeroDataControl","HeroData","HeroTeamControl","tab","HeroStar","RedMgr","RedDotType","Net","HeroRed","ccclass","property","HeroBagItem","touchCallBack","heroInfo","teamSlots","_itemId","onLoad","node","on","EventType","TOUCH_END","onTouchItem","UpdateContent","data","itemId","name","String","itemTab","getData","ItemTableById","getValue","heroTab","HeroTableById","heroClassTable","HeroClassTableByHeroClass","Class","heroAptitudeTab","HeroAptitudeTableByHeroAptitude","Aptitude","itemQualityTab","id","node_award_book","active","ins","getById","level","getHeroLevel","maxLevel","heroStarUpTable","MaxLevel","lbl_level","string","node_select","Number","heroId","star","getItemQualityTableByStar","DefaultStar","bookId","awardMap","getBookReceivedIds","awardObj","get","isReceived","awardTab","HeroAlbumTableByHeroAptitude","awardItemTab","ItemId","count","ItemNum","getChildByName","getComponent","setTexture","Icon","num_label","sp_quality_bg","HeroBagQuality","sp_quality_star_bg","HeroStarBg","sp_vocation","sp_hero","sp_quality","node_star","showStar","itemData","getByItemId","_awardMap","has","grayscale","node_inTeam","heroInTeam","node_red","isRed","HeroupLevel","HeroupStar","checkWearEquip","HeroReplace","setRed","show","setTouchCallBack","callBack","onDisable","onDestroy","targetOff","clickGetAward","msg","Msg_ReceiveHeroAlbumRewardReq","heroItemId","Send","Ptl","ReceiveHeroAlbumRewardReq"],"mappings":"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","sourcesContent":["import { _decorator, Component, Label, log, Node, Sprite, SpriteRenderer, Vec2, Vec3 } from 'cc';\r\nimport { proto } from 'client_protocol';\r\nimport { HeroDataControl } from './HeroDataControl';\r\nimport { HeroInfo } from '../HeroInfo';\r\nimport { HeroData } from '../HeroData';\r\nimport { HeroTeamControl } from '../HeroTeamControl';\r\nimport { tab } from '../../../../Table/table_gen';\r\nimport { HeroStar } from '../HeroStar';\r\nimport { RedMgr } from '../../../mgr/RedMgr';\r\nimport { RedDotType } from '../../../red/RedDotType';\r\nimport { ItemData } from '../../item/ItemData';\r\nimport { Net } from '../../../net/Net';\r\nimport { HeroRed } from './HeroRed';\r\nconst { ccclass, property } = _decorator;\r\n\r\n@ccclass('HeroBagItem')\r\nexport class HeroBagItem extends Component {\r\n    @property(Sprite)\r\n    sp_hero: Sprite = null;//英雄头像\r\n    @property(Sprite)\r\n    sp_vocation: Sprite = null;//职业\r\n    @property(Sprite)\r\n    sp_quality: Sprite = null;//品质\r\n    @property(Sprite)\r\n    sp_quality_bg: Sprite = null;//品质框\r\n    @property(Sprite)\r\n    sp_quality_star_bg: Sprite = null;//装备星级职业底\r\n    @property(Node)\r\n    node_star: Node = null;\r\n    @property(Label)\r\n    lbl_level: Label = null;\r\n    @property(Node)\r\n    node_inTeam: Node = null;\r\n    @property(Node)\r\n    node_select: Node = null;\r\n    @property(Node)\r\n    node_red: Node = null;\r\n    @property(Node)\r\n    node_award_book: Node = null;\r\n    @property(Node)\r\n    num_label: Node = null;\r\n    private touchCallBack: Function;\r\n    private heroInfo: HeroInfo;\r\n    private teamSlots: proto.ITeamSlot[] = [];\r\n    private _itemId: number = 0;\r\n    protected onLoad(): void {\r\n        /* 点击事件 */\r\n        /* 切换立绘 */\r\n        this.node.on(Node.EventType.TOUCH_END, this.onTouchItem, this)\r\n    }\r\n    UpdateContent(data: HeroInfo) {\r\n        this._itemId = data.itemId;\r\n        this.node.name = String(data.itemId)\r\n        let itemTab = tab.getData().ItemTableById.getValue(data.itemId);\r\n        let heroTab = tab.getData().HeroTableById.getValue(data.itemId);\r\n        let heroClassTable = tab.getData().HeroClassTableByHeroClass.getValue(heroTab.Class);\r\n        let heroAptitudeTab = tab.getData().HeroAptitudeTableByHeroAptitude.getValue(heroTab.Aptitude);\r\n        /* 获取品质 */\r\n        let itemQualityTab = null;\r\n        if (data.id) {\r\n            this.node_award_book.active = false;\r\n            this.heroInfo = HeroData.ins.getById(data.id);\r\n\r\n            let level = this.heroInfo.getHeroLevel()\r\n            let maxLevel = this.heroInfo.heroStarUpTable.MaxLevel;\r\n            if (maxLevel < this.heroInfo.getHeroLevel()) {\r\n                level = maxLevel;\r\n            }\r\n\r\n            this.lbl_level.string = String(level);\r\n            this.node_select.active = Number(this.heroInfo.id) === HeroDataControl.ins.heroId;\r\n            let star = this.heroInfo.star;\r\n            itemQualityTab = HeroDataControl.ins.getItemQualityTableByStar(star);\r\n        } else {\r\n            /* 图签 */\r\n            this.lbl_level.node.active = false;\r\n            itemQualityTab = HeroDataControl.ins.getItemQualityTableByStar(heroTab.DefaultStar);\r\n            this.node_select.active = data.itemId === HeroDataControl.ins.bookId;\r\n            this.node.name = String(data.itemId);\r\n            let awardMap = HeroDataControl.ins.getBookReceivedIds();\r\n            const awardObj = awardMap.get(data.itemId);\r\n            this.node_award_book.active = awardObj && !awardObj.isReceived;\r\n            if (this.node_award_book.active) {\r\n                let awardTab = tab.getData().HeroAlbumTableByHeroAptitude.getValue(heroTab.Aptitude);\r\n                let awardItemTab = tab.getData().ItemTableById.getValue(awardTab.ItemId);\r\n                let count = awardTab.ItemNum;\r\n                this.node_award_book.getChildByName(\"reward_icon\").getComponent(Sprite).setTexture(awardItemTab.Icon);\r\n                this.num_label.getComponent(Label).string = String(count);\r\n            }\r\n        }\r\n        this.sp_quality_bg.setTexture(itemQualityTab.HeroBagQuality);\r\n        this.sp_quality_star_bg.setTexture(itemQualityTab.HeroStarBg)\r\n        this.sp_vocation.setTexture(heroClassTable.Icon);\r\n        this.sp_hero.setTexture(itemTab.Icon);\r\n        this.sp_quality.setTexture(heroAptitudeTab.Icon);\r\n        this.node_star.getComponent(HeroStar).showStar(data.star);\r\n        let itemData = HeroData.ins.getByItemId(data.itemId);\r\n\r\n        let _awardMap = HeroDataControl.ins.getBookReceivedIds();\r\n        if ((!itemData && !_awardMap.has(data.itemId)) || this.node_award_book.active) {\r\n            this.sp_hero.grayscale = true;\r\n            this.sp_quality_bg.grayscale = true;\r\n            this.sp_quality_star_bg.grayscale = true\r\n            this.node_inTeam.active = false;\r\n        } else {\r\n            this.sp_hero.grayscale = false;\r\n            this.sp_quality_bg.grayscale = false;\r\n            this.sp_quality_star_bg.grayscale = false\r\n            this.node_inTeam.active = !!HeroTeamControl.ins.heroInTeam(data.id);\r\n        }\r\n        /* 处理红点逻辑 */\r\n        if(data.id&&HeroTeamControl.ins.heroInTeam(data.id)){\r\n            this.node_red.active = RedMgr.ins.isRed(RedDotType.HeroupLevel, String(data.id)) || RedMgr.ins.isRed(RedDotType.HeroupStar, String(data.id)) || HeroRed.ins.checkWearEquip(data);\r\n        }else{\r\n            // 判断是否是可推荐的上阵的英雄\r\n            this.node_red.active = RedMgr.ins.isRed(RedDotType.HeroReplace, String(data.id))\r\n        }\r\n    }\r\n    setRed(show: boolean) {\r\n        this.node_red.active = show;\r\n    }\r\n    setTouchCallBack(callBack: Function) {\r\n        this.touchCallBack = callBack;\r\n    }\r\n    private onTouchItem() {\r\n        if (this.touchCallBack) {\r\n            this.touchCallBack();\r\n        } else {\r\n            log(\"点击了item\");\r\n        }\r\n    }\r\n    protected onDisable(): void {\r\n        this.node_star.getComponent(HeroStar).onDisable();\r\n    }\r\n    protected onDestroy(): void {\r\n        this.node.targetOff(this);\r\n    }\r\n    /* 点击领取奖励 */\r\n    clickGetAward() {\r\n        let msg = new proto.Msg_ReceiveHeroAlbumRewardReq();\r\n        msg.heroItemId = this._itemId;\r\n        Net.Send(proto.Ptl.ReceiveHeroAlbumRewardReq, msg)\r\n    }\r\n}\r\n\r\n\r\n"]}