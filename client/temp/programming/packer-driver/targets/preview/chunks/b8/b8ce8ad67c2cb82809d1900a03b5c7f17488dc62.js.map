{"version":3,"sources":["file:///C:/chickenStarClient/client/assets/scripts/logic/model/activity/heroRoad/HeroRoadView.ts"],"names":["_decorator","instantiate","Label","Node","Prefab","ComponentBase","HeroRoadItem","UIMgr","tab","ActivityData","EventMgr","proto","ViewName","RoleData","TimeUtil","LangMgr","ccclass","property","HeroRoadView","items","register","onMsg","Ptl","HeroCollectionPush","on_s2c_HeroCollectionPush","GetHeroCollectionRewardRsp","on_s2c_GetHeroCollectionRewardRsp","initView","msg","ins","heroCollectionMsg","collectionDatas","collectionData","getProgress","type","key","sum","tables","getData","HeroCollectionTable","node","itemPrefab","parent","contentNode","com","getComponent","push","state","index","rewardList","indexOf","Id","activatedList","Type","updateTimer","closeTime","updateView","table","lastTimer","Number","Math","floor","getServerUtcTime","ret","formaterWithOutSecond3","day","hours","timeLab","string","getCombineString","active","onClickHelp","show","viewName","CommonHelpPop","data","error","code","CommonErrorCode","Succeed","CongratulationPop","rewards"],"mappings":"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","sourcesContent":["import { _decorator, Component, instantiate, Label, Node, Prefab } from 'cc';\r\nimport { ComponentBase } from '../../../../framework/base/ComponentBase';\r\nimport { HeroRoadItem } from './HeroRoadItem';\r\nimport { ShowTips, UIMgr } from '../../../mgr/UIMgr';\r\nimport { tab } from '../../../../Table/table_gen';\r\nimport { ActivityData } from '../ActivityData';\r\nimport { EventMgr } from '../../../mgr/EventMgr';\r\nimport { proto } from 'client_protocol';\r\nimport { ViewName } from '../../../define/ViewDefine';\r\nimport { RoleData } from '../../role/RoleData';\r\nimport { TimeUtil } from '../../../utils/TimeUtil';\r\nimport { LangMgr } from '../../../mgr/LangMgr';\r\nconst { ccclass, property } = _decorator;\r\n\r\n/**\r\n * \r\n * HeroRoadView\r\n * zhudingchao\r\n * Mon Jun 24 2024 14:03:58 GMT+0800 (中国标准时间)\r\n * db://assets/scripts/logic/model/activity/heroRoad/HeroRoadView.ts\r\n *\r\n */\r\n\r\n@ccclass('HeroRoadView')\r\nexport class HeroRoadView extends ComponentBase {\r\n    @property(Label)\r\n    timeLab: Label = null;\r\n    @property(Node)\r\n    contentNode: Node = null;\r\n    @property(Prefab)\r\n    itemPrefab: Prefab = null;\r\n    private items: Array<HeroRoadItem>;\r\n    register(): void {\r\n        EventMgr.onMsg(proto.Ptl.HeroCollectionPush, this.on_s2c_HeroCollectionPush, this)\r\n        EventMgr.onMsg(proto.Ptl.GetHeroCollectionRewardRsp, this.on_s2c_GetHeroCollectionRewardRsp, this)\r\n    }\r\n    initView() {\r\n        this.items = [];\r\n        let msg = ActivityData.ins.heroCollectionMsg;\r\n        let collectionDatas = msg.collectionData;\r\n        let getProgress = (type: tab.HeroCollectionType) => {\r\n            for (let key in collectionDatas) {\r\n                if (collectionDatas[key].type == type) {\r\n                    return collectionDatas[key].sum;\r\n                }\r\n            }\r\n            return 0;\r\n        }\r\n\r\n        let tables = tab.getData().HeroCollectionTable;\r\n        for (let key in tables) {\r\n            let node = instantiate(this.itemPrefab);\r\n            node.parent = this.contentNode;\r\n            let com = node.getComponent(HeroRoadItem);\r\n            this.items.push(com);\r\n            let state = 0;\r\n            let index = msg.rewardList.indexOf(tables[key].Id);\r\n            if (index >= 0) {\r\n                state = 2;\r\n            } else {\r\n                index = msg.activatedList.indexOf(tables[key].Id);\r\n                if (index >= 0) {\r\n                    state = 1;\r\n                }\r\n            }\r\n            com.initView(tables[key], state, getProgress(tables[key].Type));\r\n        }\r\n        this.updateTimer(msg.closeTime);\r\n\r\n\r\n        // for(let i:number=0;i<10;i++){\r\n        //     let node=instantiate(this.itemPrefab);\r\n        //     node.parent=this.contentNode;\r\n        //     let com=node.getComponent(HeroRoadItem);\r\n        //     this.items.push(com);\r\n        // }\r\n\r\n    }\r\n    updateView() {\r\n        let msg = ActivityData.ins.heroCollectionMsg;\r\n        let collectionDatas = msg.collectionData;\r\n        let getProgress = (type: tab.HeroCollectionType) => {\r\n            for (let key in collectionDatas) {\r\n                if (collectionDatas[key].type == type) {\r\n                    return collectionDatas[key].sum;\r\n                }\r\n            }\r\n            return 0;\r\n        }\r\n        for (let key in this.items) {\r\n            let table = this.items[key].table;\r\n            let state = 0;\r\n            let index = msg.rewardList.indexOf(table.Id);\r\n            if (index >= 0) {\r\n                state = 2;\r\n            } else {\r\n                index = msg.activatedList.indexOf(table.Id);\r\n                if (index >= 0) {\r\n                    state = 1;\r\n                }\r\n            }\r\n            this.items[key].updateView(state, getProgress(table.Type));\r\n        }\r\n        this.updateTimer(msg.closeTime);\r\n    }\r\n    updateTimer(closeTime:number){\r\n        let lastTimer=Number(closeTime)-Math.floor(RoleData.ins.getServerUtcTime());\r\n        if(lastTimer>0){\r\n           let ret= TimeUtil.formaterWithOutSecond3(lastTimer);\r\n           let day=ret.day?ret.day:0;\r\n           let hours=ret.hours?ret.hours:0;\r\n           this.timeLab.string=LangMgr.getCombineString(\"ui_commondesc_71\",[day,hours])\r\n        }else{\r\n            this.timeLab.node.active=false;\r\n        }\r\n\r\n    }\r\n\r\n    onClickHelp() {\r\n        // ShowTips(\"弹出通用说明框\")\r\n        UIMgr.ins.show({viewName:ViewName.CommonHelpPop,data:{\"content\":\"待策划配置\"}});\r\n    }\r\n    /**舰队启航 */\r\n    on_s2c_HeroCollectionPush(msg: proto.Msg_HeroCollectionPush) {\r\n        this.updateView();\r\n    }\r\n    // 领取舰队启航奖励\r\n    on_s2c_GetHeroCollectionRewardRsp(msg: proto.Msg_GetHeroCollectionRewardRsp) {\r\n        if (!msg.error || msg.error.code == proto.CommonErrorCode.Succeed) {\r\n            UIMgr.ins.show({ viewName: ViewName.CongratulationPop, data: msg.rewards })\r\n            this.updateView();\r\n        }\r\n    }\r\n}"]}