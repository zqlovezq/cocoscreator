{"version":3,"sources":["file:///C:/chickenStarClient/client/assets/scripts/logic/model/fincaFight/FincaBagItem.ts"],"names":["_decorator","Component","Label","log","Node","Sprite","HeroStar","tab","HeroDataControl","FincaFightData","ShowTips","LangMgr","EventMgr","LocalEvent","ccclass","property","FincaBagItem","touchCallBack","heroInfo","UpdateContent","data","node","name","String","id","itemTab","itemTable","heroTab","heroTable","heroClassTable","getData","HeroClassTableByHeroClass","getValue","Class","heroAptitudeTab","HeroAptitudeTableByHeroAptitude","Aptitude","itemQualityTab","level","getHeroLevel","maxLevel","heroStarUpTable","MaxLevel","lbl_level","string","star","ins","getItemQualityTableByStar","sp_quality_bg","setTexture","HeroBagQuality","sp_quality_star_bg","HeroStarBg","sp_vocation","Icon","sp_hero","sp_quality","node_star","getComponent","showStar","inTeam","getHeroInTeam","node_select","active","setSelectCircle","curSelectHero","isShow","node_select_1","setTouchCallBack","callBack","onTouchItem","changeSelect","index","HeroToggleIndex","teamIndex","heroIds","emitLocal","Finca_Team_Change","canReplace","checkReplaceHero","getLab","console","onDisable","onDestroy","targetOff","parent","getChildByName","isValid","itemTs"],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAASA,MAAAA,U,OAAAA,U;AAAYC,MAAAA,S,OAAAA,S;AAAWC,MAAAA,K,OAAAA,K;AAAOC,MAAAA,G,OAAAA,G;AAAKC,MAAAA,I,OAAAA,I;AAAMC,MAAAA,M,OAAAA,M;;AAEzCC,MAAAA,Q,iBAAAA,Q;;AAEAC,MAAAA,G,iBAAAA,G;;AACAC,MAAAA,e,iBAAAA,e;;AACAC,MAAAA,c,iBAAAA,c;;AAEAC,MAAAA,Q,iBAAAA,Q;;AACAC,MAAAA,O,iBAAAA,O;;AACAC,MAAAA,Q,iBAAAA,Q;;AACAC,MAAAA,U,iBAAAA,U;;;;;;;;;OACH;AAAEC,QAAAA,OAAF;AAAWC,QAAAA;AAAX,O,GAAwBf,U;;8BAGjBgB,Y,WADZF,OAAO,CAAC,cAAD,C,UAEHC,QAAQ,CAACV,MAAD,C,UAERU,QAAQ,CAACV,MAAD,C,UAERU,QAAQ,CAACV,MAAD,C,UAERU,QAAQ,CAACV,MAAD,C,UAERU,QAAQ,CAACV,MAAD,C,UAERU,QAAQ,CAACX,IAAD,C,UAERW,QAAQ,CAACb,KAAD,C,UAERa,QAAQ,CAACX,IAAD,C,WAERW,QAAQ,CAACX,IAAD,C,2BAlBb,MACaY,YADb,SACkCf,SADlC,CAC4C;AAAA;AAAA;;AAAA;;AAEjB;AAFiB;;AAIb;AAJa;;AAMd;AANc;;AAQX;AARW;;AAUN;AAVM;;AAAA;;AAAA;;AAAA;;AAAA,eAmBhCgB,aAnBgC;AAAA,eAoBhCC,QApBgC;AAAA;;AAqBxCC,QAAAA,aAAa,CAACC,IAAD,EAAiB;AAC1B,eAAKF,QAAL,GAAgBE,IAAhB;AACA,eAAKC,IAAL,CAAUC,IAAV,GAAiBC,MAAM,CAACH,IAAI,CAACI,EAAN,CAAvB;AACA,cAAIC,OAAO,GAAG,KAAKP,QAAL,CAAcQ,SAA5B;AACA,cAAIC,OAAO,GAAG,KAAKT,QAAL,CAAcU,SAA5B;AACA,cAAIC,cAAc,GAAG;AAAA;AAAA,0BAAIC,OAAJ,GAAcC,yBAAd,CAAwCC,QAAxC,CAAiDL,OAAO,CAACM,KAAzD,CAArB;AACA,cAAIC,eAAe,GAAG;AAAA;AAAA,0BAAIJ,OAAJ,GAAcK,+BAAd,CAA8CH,QAA9C,CAAuDL,OAAO,CAACS,QAA/D,CAAtB;AACA;;AACA,cAAIC,cAAc,GAAG,IAArB;AACA,cAAIC,KAAK,GAAG,KAAKpB,QAAL,CAAcqB,YAAd,EAAZ;AACA,cAAIC,QAAQ,GAAG,KAAKtB,QAAL,CAAcuB,eAAd,CAA8BC,QAA7C;;AACA,cAAIF,QAAQ,GAAG,KAAKtB,QAAL,CAAcqB,YAAd,EAAf,EAA6C;AACzCD,YAAAA,KAAK,GAAGE,QAAR;AACH;;AACD,eAAKG,SAAL,CAAeC,MAAf,GAAwBrB,MAAM,CAACe,KAAD,CAA9B;AACA,cAAIO,IAAI,GAAG,KAAK3B,QAAL,CAAc2B,IAAzB;AACAR,UAAAA,cAAc,GAAG;AAAA;AAAA,kDAAgBS,GAAhB,CAAoBC,yBAApB,CAA8CF,IAA9C,CAAjB;AACA,eAAKG,aAAL,CAAmBC,UAAnB,CAA8BZ,cAAc,CAACa,cAA7C;AACA,eAAKC,kBAAL,CAAwBF,UAAxB,CAAmCZ,cAAc,CAACe,UAAlD;AACA,eAAKC,WAAL,CAAiBJ,UAAjB,CAA4BpB,cAAc,CAACyB,IAA3C;AACA,eAAKC,OAAL,CAAaN,UAAb,CAAwBxB,OAAO,CAAC6B,IAAhC;AACA,eAAKE,UAAL,CAAgBP,UAAhB,CAA2Bf,eAAe,CAACoB,IAA3C;AACA,eAAKG,SAAL,CAAeC,YAAf;AAAA;AAAA,oCAAsCC,QAAtC,CAA+CvC,IAAI,CAACyB,IAApD;AAEA,cAAMe,MAAM,GAAG;AAAA;AAAA,gDAAed,GAAf,CAAmBe,aAAnB,CAAiC,KAAK3C,QAAL,CAAcM,EAA/C,CAAf;AACA,eAAKsC,WAAL,CAAiBC,MAAjB,GAA0BH,MAAM,GAAC,CAAC,CAAlC;AACA,eAAKI,eAAL,CAAqB,KAAK9C,QAAL,CAAcM,EAAd,KAAqB;AAAA;AAAA,gDAAesB,GAAf,CAAmBmB,aAA7D;AACH;;AACDD,QAAAA,eAAe,CAACE,MAAD,EAAgB;AAC3B,eAAKC,aAAL,CAAmBJ,MAAnB,GAA4BG,MAA5B;AACH;;AACDE,QAAAA,gBAAgB,CAACC,QAAD,EAAqB;AACjC,eAAKpD,aAAL,GAAqBoD,QAArB;AACH;;AACOC,QAAAA,WAAW,GAAG;AAClB,cAAI,KAAKrD,aAAT,EAAwB;AACpB,iBAAKA,aAAL;AACH,WAFD,MAEO;AACHd,YAAAA,GAAG,CAAC,SAAD,CAAH;AACA,iBAAKoE,YAAL;AACA;AAAA;AAAA,kDAAezB,GAAf,CAAmBmB,aAAnB,GAAmC,KAAK/C,QAAL,CAAcM,EAAjD;AACA,gBAAMgD,KAAK,GAAG;AAAA;AAAA,kDAAe1B,GAAf,CAAmB2B,eAAjC;AACA,gBAAMC,SAAS,GAAG;AAAA;AAAA,kDAAe5B,GAAf,CAAmBe,aAAnB,CAAiC,KAAK3C,QAAL,CAAcM,EAA/C,CAAlB,CALG,CAMH;;AACA,gBAAIkD,SAAS,GAAC,CAAC,CAAf,EAAkB;AACd;AAAA;AAAA,oDAAe5B,GAAf,CAAmB6B,OAAnB,CAA2BD,SAA3B,IAAwC,CAAxC;AACA;AAAA;AAAA,wCAASE,SAAT,CAAmB;AAAA;AAAA,4CAAWC,iBAA9B,EAAgDH,SAAS,GAAC,CAA1D;AACH,aAHD,MAGO;AACH;AACA,kBAAMI,UAAU,GAAG;AAAA;AAAA,oDAAehC,GAAf,CAAmBiC,gBAAnB,CAAoC,KAAK7D,QAAL,CAAcM,EAAlD,CAAnB;;AACA,kBAAGsD,UAAH,EAAc;AACV;AAAA;AAAA,sDAAehC,GAAf,CAAmB6B,OAAnB,CAA2BH,KAAK,GAAG,CAAnC,IAAwC,KAAKtD,QAAL,CAAcM,EAAtD;AACA;AAAA;AAAA,0CAASoD,SAAT,CAAmB;AAAA;AAAA,8CAAWC,iBAA9B,EAAgDL,KAAhD;AACH,eAHD,MAGK;AACD;AAAA;AAAA,0CAAS;AAAA;AAAA,wCAAQQ,MAAR,CAAe,cAAf,CAAT;AACH;AACJ;;AACDC,YAAAA,OAAO,CAAC9E,GAAR,CAAY;AAAA;AAAA,kDAAe2C,GAAf,CAAmB6B,OAA/B;AACH;AACJ;;AACSO,QAAAA,SAAS,GAAS;AACxB,eAAKzB,SAAL,CAAeC,YAAf;AAAA;AAAA,oCAAsCwB,SAAtC;AACH;;AACSC,QAAAA,SAAS,GAAS;AACxB,eAAK9D,IAAL,CAAU+D,SAAV,CAAoB,IAApB;AACH,SAtFuC,CAuFxC;;;AACAb,QAAAA,YAAY,GAAE;AACV,cAAMlD,IAAI,GAAG,KAAKA,IAAL,CAAUgE,MAAV,CAAiBC,cAAjB,CAAgC/D,MAAM,CAAC;AAAA;AAAA,gDAAeuB,GAAf,CAAmBmB,aAApB,CAAtC,CAAb;;AACA,cAAG5C,IAAI,IAAEA,IAAI,CAACkE,OAAd,EAAsB;AAClB,gBAAMC,MAAM,GAAGnE,IAAI,CAACqC,YAAL,CAAkB1C,YAAlB,CAAf;;AACA,gBAAGwE,MAAM,IAAEA,MAAM,CAACD,OAAlB,EAA0B;AACtBC,cAAAA,MAAM,CAACxB,eAAP,CAAuB,KAAvB;AACH;AACJ;;AACD,eAAKA,eAAL,CAAqB,IAArB;AACH;;AAjGuC,O;;;;;iBAEtB,I;;;;;;;iBAEI,I;;;;;;;iBAED,I;;;;;;;iBAEG,I;;;;;;;iBAEK,I;;;;;;;iBAEX,I;;;;;;;iBAEC,I;;;;;;;iBAEC,I;;;;;;;iBAEE,I","sourcesContent":["import { _decorator, Component, Label, log, Node, Sprite } from 'cc';\r\nimport { HeroInfo } from '../hero/HeroInfo';\r\nimport { HeroStar } from '../hero/HeroStar';\r\nimport { HeroData } from '../hero/HeroData';\r\nimport { tab } from '../../../Table/table_gen';\r\nimport { HeroDataControl } from '../hero/herobag/HeroDataControl';\r\nimport { FincaFightData } from './FincaFightData';\r\nimport { FincaFightTeamState } from '../../../Common/script/EnumTypeMgr';\r\nimport { ShowTips } from '../../mgr/UIMgr';\r\nimport { LangMgr } from '../../mgr/LangMgr';\r\nimport { EventMgr } from '../../mgr/EventMgr';\r\nimport { LocalEvent } from '../../define/LocalEvent';\r\nconst { ccclass, property } = _decorator;\r\n\r\n@ccclass('FincaBagItem')\r\nexport class FincaBagItem extends Component {\r\n    @property(Sprite)\r\n    sp_hero: Sprite = null;//英雄头像\r\n    @property(Sprite)\r\n    sp_vocation: Sprite = null;//职业\r\n    @property(Sprite)\r\n    sp_quality: Sprite = null;//品质\r\n    @property(Sprite)\r\n    sp_quality_bg: Sprite = null;//品质框\r\n    @property(Sprite)\r\n    sp_quality_star_bg: Sprite = null;//装备星级职业底\r\n    @property(Node)\r\n    node_star: Node = null;\r\n    @property(Label)\r\n    lbl_level: Label = null;\r\n    @property(Node)\r\n    node_select: Node = null;\r\n    @property(Node)\r\n    node_select_1: Node = null;\r\n    private touchCallBack: Function;\r\n    private heroInfo: HeroInfo;\r\n    UpdateContent(data: HeroInfo) {\r\n        this.heroInfo = data;\r\n        this.node.name = String(data.id);\r\n        let itemTab = this.heroInfo.itemTable;\r\n        let heroTab = this.heroInfo.heroTable;\r\n        let heroClassTable = tab.getData().HeroClassTableByHeroClass.getValue(heroTab.Class);\r\n        let heroAptitudeTab = tab.getData().HeroAptitudeTableByHeroAptitude.getValue(heroTab.Aptitude);\r\n        /* 获取品质 */\r\n        let itemQualityTab = null;\r\n        let level = this.heroInfo.getHeroLevel()\r\n        let maxLevel = this.heroInfo.heroStarUpTable.MaxLevel;\r\n        if (maxLevel < this.heroInfo.getHeroLevel()) {\r\n            level = maxLevel;\r\n        }\r\n        this.lbl_level.string = String(level);\r\n        let star = this.heroInfo.star;\r\n        itemQualityTab = HeroDataControl.ins.getItemQualityTableByStar(star);\r\n        this.sp_quality_bg.setTexture(itemQualityTab.HeroBagQuality);\r\n        this.sp_quality_star_bg.setTexture(itemQualityTab.HeroStarBg)\r\n        this.sp_vocation.setTexture(heroClassTable.Icon);\r\n        this.sp_hero.setTexture(itemTab.Icon);\r\n        this.sp_quality.setTexture(heroAptitudeTab.Icon);\r\n        this.node_star.getComponent(HeroStar).showStar(data.star);\r\n\r\n        const inTeam = FincaFightData.ins.getHeroInTeam(this.heroInfo.id);\r\n        this.node_select.active = inTeam>-1;\r\n        this.setSelectCircle(this.heroInfo.id === FincaFightData.ins.curSelectHero);\r\n    }\r\n    setSelectCircle(isShow:boolean){\r\n        this.node_select_1.active = isShow\r\n    }\r\n    setTouchCallBack(callBack: Function) {\r\n        this.touchCallBack = callBack;\r\n    }\r\n    private onTouchItem() {\r\n        if (this.touchCallBack) {\r\n            this.touchCallBack();\r\n        } else {\r\n            log(\"点击了item\");\r\n            this.changeSelect();\r\n            FincaFightData.ins.curSelectHero = this.heroInfo.id;\r\n            const index = FincaFightData.ins.HeroToggleIndex;\r\n            const teamIndex = FincaFightData.ins.getHeroInTeam(this.heroInfo.id);\r\n            // 点击的英雄是否在队伍中\r\n            if (teamIndex>-1) {\r\n                FincaFightData.ins.heroIds[teamIndex] = 0;\r\n                EventMgr.emitLocal(LocalEvent.Finca_Team_Change,teamIndex+1);\r\n            } else {\r\n                // 判断不在队伍中的英雄是否可以替换\r\n                const canReplace = FincaFightData.ins.checkReplaceHero(this.heroInfo.id);\r\n                if(canReplace){\r\n                    FincaFightData.ins.heroIds[index - 1] = this.heroInfo.id;\r\n                    EventMgr.emitLocal(LocalEvent.Finca_Team_Change,index);\r\n                }else{\r\n                    ShowTips(LangMgr.getLab(\"Tips_finca_4\"))\r\n                }\r\n            }\r\n            console.log(FincaFightData.ins.heroIds);\r\n        }\r\n    }\r\n    protected onDisable(): void {\r\n        this.node_star.getComponent(HeroStar).onDisable();\r\n    }\r\n    protected onDestroy(): void {\r\n        this.node.targetOff(this);\r\n    }\r\n    // 替换选择状态\r\n    changeSelect(){\r\n        const node = this.node.parent.getChildByName(String(FincaFightData.ins.curSelectHero));\r\n        if(node&&node.isValid){\r\n            const itemTs = node.getComponent(FincaBagItem);\r\n            if(itemTs&&itemTs.isValid){\r\n                itemTs.setSelectCircle(false);\r\n            }\r\n        }\r\n        this.setSelectCircle(true);   \r\n    }\r\n}\r\n\r\n\r\n"]}