{"version":3,"sources":["file:///C:/chickenStarClient/client/assets/scripts/logic/model/rank/RankMyRankItem.ts"],"names":["_decorator","Component","Label","Node","RichText","tab","LangMgr","HeroInfo","ViewName","UIMgr","HeroItem","PlayerHeadItem","RANKING_TYPE","SimpleRoleInfo","getTimeTXT","ccclass","property","RankMyRankItem","_rank_data","_rank_index","_rankType","NONE","UpdateContent","data","console","log","index","rankType","rankData","node_hero","active","HERO","node_player","setRankHeroData","setRankPlayerData","lbl_rank","string","String","itemId","itemTab","getData","ItemTableById","getValue","heroTab","HeroTableById","lbl_power_score","powerScore","lbl_hero_Name","ins","getLab","Name","lbl_player_Name","roleName","heroInfo","star","id","level","hero_item","setTouchCallBack","show","viewName","CheckRoleInfoHeroPop","heroData","lbl_player_node_force","node","lbl_player_node_damage","lbl_player_node_level","lbl_player_node_chapter","score","chapterInfo","Math","floor","times","level_txt","getChildByName","getComponent","time_txt","lbl_player_node_name","simple","name","playerInfo","merge","palyerHerdItem","initHeadInfo","roleInfo","setCloseCallBack","CheckRoleInfoPop","LEVEL","POWER","CHAPTER","table","QuestLogTableByLevel","reputation","lbl_player_node_reputation"],"mappings":"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","sourcesContent":["/*\r\n * @Date: 2024-06-12 17:41:34\r\n * @LastEditors: wzq\r\n * @LastEditTime: 2024-06-21 17:38:01\r\n */\r\n\r\nimport { _decorator, Component, Label, Node, RichText } from 'cc';\r\nimport InfiniteCell from '../../../Common/InfiniteList/InfiniteCell';\r\nimport { proto } from 'client_protocol';\r\nimport { tab } from '../../../Table/table_gen';\r\nimport { LangMgr } from '../../mgr/LangMgr';\r\nimport { HeroInfo } from '../hero/HeroInfo';\r\nimport { ViewName } from '../../define/ViewDefine';\r\nimport { UIMgr } from '../../mgr/UIMgr';\r\nimport { HeroItem } from '../item/HeroItem';\r\nimport { PlayerHeadItem } from '../common/PlayerHeadItem';\r\nimport { RANKING_TYPE } from '../../../Common/script/EnumTypeMgr';\r\nimport { SimpleRoleInfo } from '../friends/SimpleRoleInfo';\r\nimport { getTimeTXT } from '../../utils/GameUtil';\r\nconst { ccclass, property } = _decorator;\r\n\r\n@ccclass('RankMyRankItem')\r\nexport class RankMyRankItem extends Component {\r\n    @property(Label)\r\n    lbl_rank:Label = null;\r\n    @property(Label)\r\n    lbl_power_score:Label = null;\r\n    @property(Label)\r\n    lbl_hero_Name:Label = null;\r\n    @property(Label)\r\n    lbl_player_Name:Label = null;\r\n    @property(HeroItem)\r\n    hero_item:HeroItem = null;\r\n\r\n    @property(Label)\r\n    lbl_player_node_name:Label = null;\r\n    @property(Label)\r\n    lbl_player_node_force:Label = null;\r\n    @property(PlayerHeadItem)\r\n    palyerHerdItem:PlayerHeadItem=null;\r\n    @property(Node)\r\n    lbl_player_node_chapter:Node = null;\r\n    @property(Label)\r\n    lbl_player_node_level:Label = null;\r\n    @property(Label)\r\n    lbl_player_node_damage:Label = null;\r\n    @property(RichText)\r\n    lbl_player_node_reputation:RichText = null;\r\n\r\n    @property(Node)\r\n    node_player:Node = null;\r\n    @property(Node)\r\n    node_hero:Node = null;\r\n\r\n    private _rank_data:proto.ISimpleHero|proto.ISimpleRank = null;\r\n    private _rank_index:number = 0;\r\n    private _rankType:RANKING_TYPE = RANKING_TYPE.NONE;\r\n    UpdateContent(data: any): void {\r\n        console.log(data);\r\n        this._rank_index = data.index;\r\n        this._rankType = data.rankType\r\n        this._rank_data = data.rankData;\r\n        this.node_hero.active = this._rankType===RANKING_TYPE.HERO;\r\n        this.node_player.active = this._rankType!==RANKING_TYPE.HERO;\r\n        if(this._rankType===RANKING_TYPE.HERO){\r\n            this.setRankHeroData();\r\n        }else{\r\n            this.setRankPlayerData();\r\n        }\r\n    }\r\n    // 设置基本信息\r\n    setRankHeroData(){\r\n        const rankData = this._rank_data as proto.ISimpleHero\r\n        this.lbl_rank.string = String(this._rank_index+4);\r\n        const itemId = rankData.itemId;\r\n        const itemTab = tab.getData().ItemTableById.getValue(itemId);\r\n        const heroTab = tab.getData().HeroTableById.getValue(itemId);\r\n        // 显示战斗力\r\n        this.lbl_power_score.string = String(rankData.powerScore);\r\n        this.lbl_hero_Name.string = LangMgr.ins.getLab(itemTab.Name);\r\n        this.lbl_player_Name.string = rankData.roleName;\r\n\r\n        const heroInfo = new HeroInfo();\r\n        heroInfo.itemId = itemId;\r\n        heroInfo.star = rankData.star;\r\n        heroInfo.id = 0;\r\n        heroInfo.level = rankData.level;\r\n        this.hero_item.UpdateContent(heroInfo);\r\n        this.hero_item.setTouchCallBack(()=>{\r\n            UIMgr.ins.show({ viewName: ViewName.CheckRoleInfoHeroPop,data:{\r\n                heroData:this._rank_data\r\n            }})\r\n        })\r\n    }\r\n    setRankPlayerData(){\r\n        this.lbl_player_node_force.node.active = false;\r\n        this.lbl_player_node_damage.node.active = false;\r\n        this.lbl_player_node_level.node.active = false;\r\n        this.lbl_player_node_chapter.active = false;\r\n        const rankData = this._rank_data as proto.ISimpleRank;\r\n        this.lbl_rank.string = String(this._rank_index+4);\r\n        if(rankData.score){\r\n            // 用关卡通关时间和关卡Id拼接得分\r\n            // score := int64(stageId)*1000000 + int64(alive)%1000000\r\n            const chapterInfo = Math.floor(rankData.score/1000000);\r\n            const times = rankData.score%1000000;\r\n            const level_txt = this.lbl_player_node_chapter.getChildByName(\"level_txt\").getComponent(Label);\r\n            const time_txt = this.lbl_player_node_chapter.getChildByName(\"time_txt\").getComponent(Label);\r\n            time_txt.string = getTimeTXT(times);\r\n            level_txt.string = Math.floor(chapterInfo/100)+\"-\"+chapterInfo%100\r\n        }\r\n        // 玩家名字\r\n        this.lbl_player_node_name.string = rankData.simple.name;\r\n        const playerInfo = new SimpleRoleInfo();\r\n        playerInfo.merge(rankData.simple);\r\n        this.palyerHerdItem.initHeadInfo({roleInfo:playerInfo});\r\n        this.palyerHerdItem.setCloseCallBack(()=>{\r\n            UIMgr.ins.show({viewName: ViewName.CheckRoleInfoPop,data:{\"rankData\":playerInfo}})\r\n        })\r\n        if(this._rankType===RANKING_TYPE.LEVEL){\r\n            // 等级榜\r\n            this.lbl_player_node_level.node.active = true;\r\n            this.lbl_player_node_level.string = String(rankData.simple.level);\r\n        }else if(this._rankType===RANKING_TYPE.POWER){\r\n            this.lbl_player_node_force.node.active = true;\r\n            this.lbl_player_node_force.string = String(rankData.simple.powerScore);\r\n        }else if(this._rankType===RANKING_TYPE.CHAPTER){\r\n            this.lbl_player_node_chapter.active = true;\r\n        }\r\n\r\n        let table=tab.getData().QuestLogTableByLevel.getValue(rankData.simple.reputation);\r\n        if(table){\r\n            this.lbl_player_node_reputation.string=LangMgr.ins.getLab(table.Name);\r\n        }else{\r\n            this.lbl_player_node_reputation.node.active = false;\r\n        }\r\n    }\r\n}\r\n\r\n\r\n"]}