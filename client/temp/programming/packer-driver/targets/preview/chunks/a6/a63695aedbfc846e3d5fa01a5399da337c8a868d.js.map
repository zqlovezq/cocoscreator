{"version":3,"sources":["file:///C:/chickenStarClient/client/assets/scripts/logic/model/fincaFight/FincaFightView.ts"],"names":["_decorator","instantiate","Label","Node","Prefab","Sprite","ViewScreen","FincaFightData","FincaFightControl","EventMgr","proto","FincaFightItem","ButtonLock","UIMgr","ViewName","SimpleRoleInfo","PlayerHeadItem","LangMgr","ItemPoolMgr","HeroData","tab","Net","ccclass","property","FincaFightView","reward_type","top_player_list","newSocre","register","onMsg","Ptl","GetFincaBattleOpponentsRsp","on_s2c_GetFincaBattleOpponentsRsp","GetFincaBattleFightRecordsRsp","on_s2c_GetFincaBattleFightRecordsRsp","GetSimpleRankRsp","on_s2c_GetSimpleRankRsp","FincaBattleFightRsp","on_s2c_FincaBattleFightRsp","GetFincaBattleInfoRsp","on_s2c_GetFincaBattleInfoRsp","msg","setView","score","error","code","CommonErrorCode","Succeed","newScore","setAsyncView","isSweepPvp","rewards","length","ins","show","viewName","CongratulationPop","data","setFincaFightTeamTab","checkAllBooks","checkTeamInfo","onShow","finca_msg","Msg_GetFincaBattleInfoReq","Send","GetFincaBattleInfoReq","heroChange","i","heroIds","heroInfo","getById","reqSetFincaBattleHeroIds","onClickChangeHero","onDestroy","unRegister","lbl_free_times","string","String","freeTimes","reqGetFincaBattleOpponents","reqGetRank","refreshOpponentsList","opponents","list","node_list_content","destroyAllChildren","roleInfo","item","pfb_list_item","parent","itemTs","getComponent","setData","onClickReport","reqGetFincaBattleFightRecords","FincaFightLogPop","fightRecords","FincaFightStageView","rankList","FincaRanking","ranking","FincaRankingSimple","selfSimple","rankStr","getLab","lbl_my_ranking","getCombineString","lbl_my_ranking_score","node_no_rank_txt","active","setTopRank","switchView","rank_nodes","setRankItem","node","nameTxt","getChildByName","infoTxt","nobodyTxt","palyerHerdItem","roleId","simple","id","indexOf","robotId","Number","slice","tabInfo","getData","RobotTableById","getValue","setCloseCallBack","lbl_lv","sp_head","PlayerLevel","itemHeadTab","ItemTableById","Image","setTexture","Icon","Name","playerInfo","merge","name","initHeadInfo","CheckRoleInfoPop","showRewardPop","FincaFightRankRewardPop","e","type","showRewardInfo","getRewards","selfReward","node_reward","key","createRewadItem"],"mappings":"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","sourcesContent":["import { _decorator, EventTouch, instantiate, Label, Node, Prefab, Sprite } from \"cc\";\nimport { ViewScreen } from \"../../../framework/base/ViewScreen\";\nimport { FincaFightData } from \"./FincaFightData\";\nimport { FincaFightControl } from \"./FincaFightControl\";\nimport { EventMgr } from \"../../mgr/EventMgr\";\nimport { proto } from \"client_protocol\";\nimport { FincaFightItem } from \"./FincaFightItem\";\nimport { ButtonLock, GameUtil } from \"../../utils/GameUtil\";\nimport { UIMgr } from \"../../mgr/UIMgr\";\nimport { ViewName } from \"../../define/ViewDefine\";\nimport { SimpleRoleInfo } from \"../friends/SimpleRoleInfo\";\nimport { PlayerHeadItem } from \"../common/PlayerHeadItem\";\nimport { LangMgr } from \"../../mgr/LangMgr\";\nimport { ItemPoolMgr } from \"../item/ItemPoolMgr\";\nimport { HeroData } from \"../hero/HeroData\";\nimport { tab } from \"../../../Table/table_gen\";\nimport { Net } from \"../../net/Net\";\n\nconst { ccclass, property } = _decorator;\n\n\n/** PVP */\n@ccclass('FincaFightView')\nexport class FincaFightView extends ViewScreen {\n    @property(Label)\n    lbl_free_times: Label = null;\n    @property(Node)\n    node_list_content: Node = null;\n    @property(Prefab)\n    pfb_list_item: Prefab = null;\n    @property([Node])\n    rank_nodes: Node[] = [];\n    @property(Node)\n    node_reward: Node = null;\n    @property(Label)\n    lbl_my_ranking: Label = null;\n    @property(Label)\n    lbl_my_ranking_score: Label = null;\n    @property(Node)\n    node_no_rank_txt: Node = null;\n    private reward_type: number = 0;\n    private top_player_list: proto.ISimpleRank[] = [];\n    private newSocre:number = 0;\n    register(): void {\n        EventMgr.onMsg(proto.Ptl.GetFincaBattleOpponentsRsp, this.on_s2c_GetFincaBattleOpponentsRsp, this);\n        EventMgr.onMsg(proto.Ptl.GetFincaBattleFightRecordsRsp, this.on_s2c_GetFincaBattleFightRecordsRsp, this);\n        EventMgr.onMsg(proto.Ptl.GetSimpleRankRsp, this.on_s2c_GetSimpleRankRsp, this);\n        EventMgr.onMsg(proto.Ptl.FincaBattleFightRsp, this.on_s2c_FincaBattleFightRsp, this);\n        EventMgr.onMsg(proto.Ptl.GetFincaBattleInfoRsp, this.on_s2c_GetFincaBattleInfoRsp, this);\n    }\n    on_s2c_GetFincaBattleInfoRsp(msg: proto.Msg_GetFincaBattleInfoRsp){\n        this.setView();\n        this.newSocre = msg.score;\n    }\n    on_s2c_FincaBattleFightRsp(msg: proto.Msg_FincaBattleFightRsp) {\n        if (msg.error && msg.error.code != proto.CommonErrorCode.Succeed) return;\n        // 刷新界面\n        this.newSocre = msg.newScore;\n        this.setAsyncView();\n        if (FincaFightControl.isSweepPvp) {\n            if (msg.rewards.length > 0) {\n                UIMgr.ins.show({ viewName: ViewName.CongratulationPop, data: msg.rewards })\n            }\n        }\n        FincaFightControl.isSweepPvp = false;\n    }\n    setView(){\n        FincaFightData.ins.setFincaFightTeamTab();\n        FincaFightData.ins.checkAllBooks();\n        this.checkTeamInfo();\n        this.setAsyncView();\n    }\n    onShow(): void {\n        let finca_msg = new proto.Msg_GetFincaBattleInfoReq();\n        Net.Send(proto.Ptl.GetFincaBattleInfoReq, finca_msg);\n    }\n    // 判断队伍信息\n    checkTeamInfo() {\n        let heroChange = false;\n        for (let i = 0; i < FincaFightData.ins.heroIds.length; i++) {\n            const heroInfo = HeroData.ins.getById(FincaFightData.ins.heroIds[i]);\n            if (!heroInfo && FincaFightData.ins.heroIds[i] !== 0) {\n                FincaFightData.ins.heroIds[i] = 0;\n                heroChange = true;\n            }\n        }\n        if (heroChange) {\n            // 重新保存阵容\n            FincaFightControl.ins.reqSetFincaBattleHeroIds(FincaFightData.ins.heroIds);\n        }\n        if (!FincaFightData.ins.heroIds[0]) {\n            this.onClickChangeHero();\n        }\n    }\n    protected onDestroy(): void {\n        super.onDestroy\n    }\n    unRegister(): void {\n        super.unRegister();\n    }\n    // 设置动态信息\n    setAsyncView() {\n        // 当前免费次数\n        this.lbl_free_times.string = String(FincaFightData.ins.freeTimes);\n        // 获取对手信息设置list列表\n        FincaFightControl.ins.reqGetFincaBattleOpponents();\n        // 获取排行榜信息\n        FincaFightControl.ins.reqGetRank();\n    }\n    // 获取庄园战对手\n    on_s2c_GetFincaBattleOpponentsRsp(msg: proto.Msg_GetFincaBattleOpponentsRsp) {\n        if (msg.error && msg.error.code != proto.CommonErrorCode.Succeed) return;\n        this.refreshOpponentsList(msg.opponents)\n    }\n    refreshOpponentsList(list: proto.IFincaBattleRole[]) {\n        this.node_list_content.destroyAllChildren();\n        for (let i = 0; i < list.length; i++) {\n            const roleInfo: proto.IFincaBattleRole = list[i];\n            const item = instantiate(this.pfb_list_item);\n            item.parent = this.node_list_content;\n            const itemTs = item.getComponent(FincaFightItem);\n            itemTs.setData(roleInfo);\n        }\n    }\n    // 点击战报按钮显示战斗界面\n    @ButtonLock(1, () => { })\n    onClickReport() {\n        FincaFightControl.ins.reqGetFincaBattleFightRecords();\n    }\n    // 获取战报信息\n    on_s2c_GetFincaBattleFightRecordsRsp(msg: proto.Msg_GetFincaBattleFightRecordsRsp) {\n        if (msg.error && msg.error.code != proto.CommonErrorCode.Succeed) return;\n        UIMgr.ins.show({ viewName: ViewName.FincaFightLogPop, data: msg.fightRecords })\n    }\n    // 调整阵型\n    onClickChangeHero() {\n        UIMgr.ins.show({ viewName: ViewName.FincaFightStageView })\n    }\n    on_s2c_GetSimpleRankRsp(msg: proto.Msg_GetRankRsp) {\n        if (msg.error && msg.error.code != proto.CommonErrorCode.Succeed) return;\n        this.top_player_list = msg.rankList;\n        FincaFightData.ins.FincaRanking = msg.ranking + 1;\n        FincaFightData.ins.FincaRankingSimple = msg.selfSimple;\n        const rankStr = msg.ranking > -1 ? msg.ranking + 1 : LangMgr.getLab(\"ui_rank_1\")\n        this.lbl_my_ranking.string = LangMgr.getCombineString(\"ui_fincafight_4\", [rankStr])\n        if(this.newSocre){\n            this.lbl_my_ranking_score.string = LangMgr.getCombineString(\"ui_fincafight_5\", [this.newSocre]);\n        }else{\n            this.lbl_my_ranking_score.string = LangMgr.getCombineString(\"ui_fincafight_5\", [msg.selfSimple ? msg.selfSimple.score : 0]);\n        }\n        this.node_no_rank_txt.active = msg.ranking === -1;\n        this.setTopRank();\n        // 当前奖励\n        this.switchView(null, \"1\");\n    }\n    setTopRank() {\n        for (let i = 0; i < this.rank_nodes.length; i++) {\n            const data = this.top_player_list[i];\n            this.setRankItem(this.rank_nodes[i], data);\n        }\n    }\n    setRankItem(node: Node, data: proto.ISimpleRank) {\n        const nameTxt = node.getChildByName(\"name_txt\").getComponent(Label);\n        const infoTxt = node.getChildByName(\"info_txt\").getComponent(Label);\n        const nobodyTxt = node.getChildByName(\"nobody_txt\");\n        const palyerHerdItem = node.getChildByName(\"PlayerHeadItem\").getComponent(PlayerHeadItem);\n\n        if (data) {\n            nameTxt.node.active = true;\n            infoTxt.node.active = true;\n            nobodyTxt.active = false;\n            palyerHerdItem.node.active = true;\n\n            infoTxt.string = LangMgr.getCombineString(\"ui_fincafight_13\", [data.score]);\n\n            const roleId = data.simple.id;\n            if (roleId.indexOf(\"r_\") > -1) {\n                // 当前是机器人 SimpleRoleInfo\n                const robotId = Number(roleId.slice(-1));\n                const tabInfo = tab.getData().RobotTableById.getValue(robotId);\n                palyerHerdItem.setCloseCallBack(() => { })\n                const lbl_lv = palyerHerdItem.node.getChildByName(\"lv_node\").getChildByName(\"lv_txt\").getComponent(Label);\n                const sp_head = palyerHerdItem.node.getChildByName(\"head_node\").getChildByName(\"head_img\").getComponent(Sprite);\n                lbl_lv.string = String(tabInfo.PlayerLevel);\n                let itemHeadTab = tab.getData().ItemTableById.getValue(tabInfo.Image);\n                sp_head.setTexture(itemHeadTab.Icon);\n                nameTxt.string = LangMgr.getLab(tabInfo.Name);\n            } else {\n                const playerInfo = new SimpleRoleInfo();\n                playerInfo.merge(data.simple);\n                nameTxt.string = data.simple.name;\n                palyerHerdItem.initHeadInfo({ roleInfo: playerInfo });\n                palyerHerdItem.setCloseCallBack(() => {\n                    UIMgr.ins.show({ viewName: ViewName.CheckRoleInfoPop, data: { \"roleId\": roleId } })\n                })\n            }\n\n        } else {\n            nameTxt.node.active = false;\n            infoTxt.node.active = false;\n            nobodyTxt.active = true;\n            palyerHerdItem.node.active = false;\n        }\n    }\n    // 展示奖励弹窗\n    showRewardPop() {\n        UIMgr.ins.show({ viewName: ViewName.FincaFightRankRewardPop })\n    }\n    // 切换奖励信息\n    switchView(e: EventTouch, type: string) {\n        if (e && Number(type) === this.reward_type) {\n            return\n        }\n        this.reward_type = Number(type);\n        this.showRewardInfo();\n    }\n    // 显示\n    showRewardInfo() {\n        const rewards = FincaFightData.ins.getRewards(this.reward_type, true).selfReward;\n        this.node_reward.destroyAllChildren();\n        for (let key in rewards) {\n            ItemPoolMgr.ins.createRewadItem(rewards[key], this.node_reward);\n        }\n    }\n}"]}