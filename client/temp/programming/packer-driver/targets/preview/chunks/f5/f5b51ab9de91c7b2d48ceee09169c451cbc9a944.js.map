{"version":3,"sources":["file:///C:/chickenStarClient/client/assets/scripts/logic/model/common/ItemBuyPop.ts"],"names":["_decorator","Button","Label","Node","Sprite","ViewPop","CommonItem","ItemInfo","LangMgr","CommonTipsPop","ShowItemNotEnoughTips","proto","Net","tab","MallDataMgr","ItemData","ccclass","property","ItemBuyPop","_itemCount","_maxRemainCount","_curCostDiamond","mallItemId","mallItemTab","_CostItemId","_CostItemNum","_GetItemId","_GetItemNum","boughtCount","onShow","ins","getFixedShopData","openData","name","Number","getData","MallItemTabeById","getValue","get","Id","LimitCount","GetItemIds","GetItemNum","CostItemIds","CostItemNum","node_btn","getComponent","interactable","grayscale","award","itemId","num","common_item","initData","lbl_name","string","getLab","itemTable","Name","updateLbl","onDestroy","register","unRegister","clickAdd","clickSub","clickMax","lbl_num","String","totalCount","lbl_cost_diamon","lbl_limit","onClickBtn","itemCostTab","ItemTableById","itemGetTab","tipsStr","getCombineString","create","val","haveCount","getCount","msg","Msg_BuyFixedShopCommodityReq","commodityId","Send","Ptl","BuyFixedShopCommodityReq"],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAASA,MAAAA,U,OAAAA,U;AAAYC,MAAAA,M,OAAAA,M;AAAmBC,MAAAA,K,OAAAA,K;AAAOC,MAAAA,I,OAAAA,I;AAAMC,MAAAA,M,OAAAA,M;;AAC5CC,MAAAA,O,iBAAAA,O;;AACAC,MAAAA,U,iBAAAA,U;;AACAC,MAAAA,Q,iBAAAA,Q;;AACAC,MAAAA,O,iBAAAA,O;;AACAC,MAAAA,a,iBAAAA,a;;AACAC,MAAAA,qB,iBAAAA,qB;;AACAC,MAAAA,K,oBAAAA,K;;AACAC,MAAAA,G,iBAAAA,G;;AACAC,MAAAA,G,iBAAAA,G;;AACAC,MAAAA,W,kBAAAA,W;;AACAC,MAAAA,Q,kBAAAA,Q;;;;;;;;;OACH;AAAEC,QAAAA,OAAF;AAAWC,QAAAA;AAAX,O,GAAwBjB,U;;4BAGjBkB,U,WADZF,OAAO,CAAC,YAAD,C,UAEHC,QAAQ,CAACf,KAAD,C,UAERe,QAAQ,CAACf,KAAD,C,UAERe,QAAQ;AAAA;AAAA,mC,UAERA,QAAQ,CAACd,IAAD,C,UAERc,QAAQ,CAACf,KAAD,C,UAERe,QAAQ,CAACf,KAAD,C,2BAZb,MACagB,UADb;AAAA;AAAA,8BACwC;AAAA;AAAA;;AAAA;;AAAA;;AAAA;;AAAA;;AAAA;;AAAA;;AAAA,eAa5BC,UAb4B,GAaP,CAbO;AAAA,eAc5BC,eAd4B,GAcF,CAdE;AAAA,eAe5BC,eAf4B,GAeF,CAfE;AAAA,eAgB5BC,UAhB4B,GAgBP,CAhBO;AAAA,eAiB5BC,WAjB4B,GAiBT,IAjBS;AAAA,eAmB5BC,WAnB4B,GAmBN,CAnBM;AAAA,eAoB5BC,YApB4B,GAoBL,CApBK;AAAA,eAqB5BC,UArB4B,GAqBP,CArBO;AAAA,eAsB5BC,WAtB4B,GAsBN,CAtBM;AAAA,eAuB5BC,WAvB4B,GAuBN,CAvBM;AAAA;;AAyBpCC,QAAAA,MAAM,GAAS;AACX;AAAA;AAAA,0CAAYC,GAAZ,CAAgBC,gBAAhB,CAAiC,KAAKC,QAAL,CAAcC,IAA/C;AACA,eAAKX,UAAL,GAAkBY,MAAM,CAAC,KAAKF,QAAL,CAAcC,IAAf,CAAN,GAA6B,EAA7B,GAAkC,CAApD;AACA,eAAKV,WAAL,GAAmB;AAAA;AAAA,0BAAIY,OAAJ,GAAcC,gBAAd,CAA+BC,QAA/B,CAAwC,KAAKf,UAA7C,CAAnB;AACA,eAAKM,WAAL,GAAmB;AAAA;AAAA,0CAAYE,GAAZ,CAAgBC,gBAAhB,CAAiC,KAAKC,QAAL,CAAcC,IAA/C,EAAqDK,GAArD,CAAyD,KAAKf,WAAL,CAAiBgB,EAA1E,CAAnB;AACA,eAAKnB,eAAL,GAAuB,KAAKG,WAAL,CAAiBiB,UAAjB,GAA8B,KAAKZ,WAA1D;AAEA,eAAKF,UAAL,GAAkB,KAAKH,WAAL,CAAiBkB,UAAjB,CAA4B,CAA5B,CAAlB;AACA,eAAKd,WAAL,GAAmB,KAAKJ,WAAL,CAAiBmB,UAAjB,CAA4B,CAA5B,CAAnB;AACA,eAAKlB,WAAL,GAAmB,KAAKD,WAAL,CAAiBoB,WAAjB,CAA6B,CAA7B,CAAnB;AACA,eAAKlB,YAAL,GAAoB,KAAKF,WAAL,CAAiBqB,WAAjB,CAA6B,CAA7B,CAApB;;AAEA,cAAI,KAAKxB,eAAL,GAAuB,CAA3B,EAA8B;AAC1B,iBAAKD,UAAL,GAAkB,CAAlB;AACH,WAFD,MAEO;AACH,iBAAK0B,QAAL,CAAcC,YAAd,CAA2B7C,MAA3B,EAAmC8C,YAAnC,GAAkD,KAAlD;AACA,iBAAKF,QAAL,CAAcC,YAAd,CAA2B1C,MAA3B,EAAmC4C,SAAnC,GAA+C,IAA/C;AACH;;AACD,cAAMC,KAAK,GAAG;AAAA;AAAA,qCAAd;AACAA,UAAAA,KAAK,CAACC,MAAN,GAAe,KAAKxB,UAApB;AACAuB,UAAAA,KAAK,CAACE,GAAN,GAAY,KAAKxB,WAAjB;AACA,eAAKyB,WAAL,CAAiBC,QAAjB,CAA0BJ,KAA1B;AACA,eAAKK,QAAL,CAAcC,MAAd,GAAuB;AAAA;AAAA,kCAAQC,MAAR,CAAeP,KAAK,CAACQ,SAAN,CAAgBC,IAA/B,CAAvB;AACA,eAAKC,SAAL;AACH;;AACSC,QAAAA,SAAS,GAAS;AACxB,gBAAMA,SAAN;AACH;;AACDC,QAAAA,QAAQ,GAAS,CAEhB;;AACDC,QAAAA,UAAU,GAAS;AACf,gBAAMA,UAAN;AACH;;AACOC,QAAAA,QAAQ,GAAG;AACf,eAAK5C,UAAL;;AACA,cAAI,KAAKA,UAAL,GAAkB,KAAKC,eAA3B,EAA4C;AACxC,iBAAKD,UAAL,GAAkB,KAAKC,eAAvB;AACH;;AACD,eAAKuC,SAAL;AACH,SAjEmC,CAkEpC;;;AACQK,QAAAA,QAAQ,GAAG;AACf,eAAK7C,UAAL;;AACA,cAAI,KAAKC,eAAL,IAAwB,CAAxB,IAA6B,KAAKD,UAAL,GAAkB,CAAnD,EAAsD;AAClD,iBAAKA,UAAL,GAAkB,CAAlB;AACH;;AACD,cAAI,KAAKA,UAAL,GAAkB,CAAtB,EAAyB;AACrB,iBAAKA,UAAL,GAAkB,CAAlB;AACH;;AACD,eAAKwC,SAAL;AACH,SA5EmC,CA6EpC;;;AACQM,QAAAA,QAAQ,GAAG;AACf,eAAK9C,UAAL,GAAkB,KAAKC,eAAvB;AACA,eAAKuC,SAAL;AACH;;AACDA,QAAAA,SAAS,GAAG;AACR,eAAKO,OAAL,CAAaX,MAAb,GAAsBY,MAAM,CAAC,KAAKhD,UAAN,CAA5B;AACA,cAAIiD,UAAU,GAAG,KAAK3C,YAAL,GAAoB,KAAKN,UAA1C;AACA,eAAKE,eAAL,GAAuB+C,UAAvB;AACA,eAAKC,eAAL,CAAqBd,MAArB,GAA8BY,MAAM,CAACC,UAAD,CAApC;AACA,eAAKE,SAAL,CAAef,MAAf,GAAyB,KAAK3B,WAAL,GAAmB,KAAKT,UAAzB,GAAuC,GAAvC,GAA6C,KAAKI,WAAL,CAAiBiB,UAAtF;AACH;;AACD+B,QAAAA,UAAU,GAAG;AACT,cAAMC,WAAW,GAAG;AAAA;AAAA,0BAAIrC,OAAJ,GAAcsC,aAAd,CAA4BpC,QAA5B,CAAqC,KAAKb,WAA1C,CAApB;AACA,cAAMkD,UAAU,GAAG;AAAA;AAAA,0BAAIvC,OAAJ,GAAcsC,aAAd,CAA4BpC,QAA5B,CAAqC,KAAKX,UAA1C,CAAnB;AACA,cAAMiD,OAAO,GAAG;AAAA;AAAA,kCAAQC,gBAAR,CAAyB,iBAAzB,EAA4C,CAAC;AAAA;AAAA,kCAAQpB,MAAR,CAAegB,WAAW,CAACd,IAA3B,CAAD,EAAkC,KAAKrC,eAAvC,EAAwD;AAAA;AAAA,kCAAQmC,MAAR,CAAekB,UAAU,CAAChB,IAA1B,CAAxD,CAA5C,CAAhB;AACA;AAAA;AAAA,8CAAcmB,MAAd,CAAqBF,OAArB,EAAgCG,GAAD,IAAS;AACpC,gBAAIA,GAAJ,EAAS;AACL,kBAAMC,SAAS,GAAG;AAAA;AAAA,wCAASjD,GAAT,CAAakD,QAAb,CAAsB,KAAKxD,WAA3B,CAAlB;;AACA,kBAAIuD,SAAS,GAAG,KAAK1D,eAArB,EAAsC;AAClC;AAAA;AAAA,oEAAsB,KAAKG,WAA3B;AACH,eAFD,MAEO;AACH,oBAAIyD,GAAG,GAAG,IAAI;AAAA;AAAA,oCAAMC,4BAAV,EAAV;AACAD,gBAAAA,GAAG,CAACE,WAAJ,GAAkB,KAAK7D,UAAvB;AACA2D,gBAAAA,GAAG,CAAC9B,GAAJ,GAAU,KAAKhC,UAAf;AACA;AAAA;AAAA,gCAAIiE,IAAJ,CAAS;AAAA;AAAA,oCAAMC,GAAN,CAAUC,wBAAnB,EAA6CL,GAA7C;AACH;AACJ;AACJ,WAZD;AAaH;;AA1GmC,O;;;;;iBAEX,I;;;;;;;iBAER,I;;;;;;;iBAES,I;;;;;;;iBAET,I;;;;;;;iBAEE,I;;;;;;;iBAEF,I","sourcesContent":["import { _decorator, Button, Component, Label, Node, Sprite } from 'cc';\r\nimport { ViewPop } from '../../../framework/base/ViewPop';\r\nimport { CommonItem } from '../item/CommonItem';\r\nimport { ItemInfo } from '../item/ItemInfo';\r\nimport { LangMgr } from '../../mgr/LangMgr';\r\nimport { CommonTipsPop } from './CommonTipsPop';\r\nimport { ShowItemNotEnoughTips } from '../../mgr/UIMgr';\r\nimport { proto } from 'client_protocol';\r\nimport { Net } from '../../net/Net';\r\nimport { tab } from '../../../Table/table_gen';\r\nimport { MallDataMgr } from '../shop/MallDataMgr';\r\nimport { ItemData } from '../item/ItemData';\r\nconst { ccclass, property } = _decorator;\r\n\r\n@ccclass('ItemBuyPop')\r\nexport class ItemBuyPop extends ViewPop {\r\n    @property(Label)\r\n    lbl_cost_diamon: Label = null;\r\n    @property(Label)\r\n    lbl_num: Label = null;\r\n    @property(CommonItem)\r\n    common_item: CommonItem = null;\r\n    @property(Node)\r\n    node_btn: Node = null;\r\n    @property(Label)\r\n    lbl_limit: Label = null;\r\n    @property(Label)\r\n    lbl_name:Label = null;\r\n    private _itemCount: number = 0;\r\n    private _maxRemainCount: number = 0;\r\n    private _curCostDiamond: number = 0;\r\n    private mallItemId: number = 0;\r\n    private mallItemTab: any = null;\r\n\r\n    private _CostItemId: number = 0;\r\n    private _CostItemNum: number = 0;\r\n    private _GetItemId: number = 0;\r\n    private _GetItemNum: number = 0;\r\n    private boughtCount: number = 0;\r\n\r\n    onShow(): void {\r\n        MallDataMgr.ins.getFixedShopData(this.openData.name)\r\n        this.mallItemId = Number(this.openData.name) * 10 + 1;\r\n        this.mallItemTab = tab.getData().MallItemTabeById.getValue(this.mallItemId);\r\n        this.boughtCount = MallDataMgr.ins.getFixedShopData(this.openData.name).get(this.mallItemTab.Id);\r\n        this._maxRemainCount = this.mallItemTab.LimitCount - this.boughtCount;\r\n\r\n        this._GetItemId = this.mallItemTab.GetItemIds[0];\r\n        this._GetItemNum = this.mallItemTab.GetItemNum[0];\r\n        this._CostItemId = this.mallItemTab.CostItemIds[0];\r\n        this._CostItemNum = this.mallItemTab.CostItemNum[0];\r\n\r\n        if (this._maxRemainCount > 0) {\r\n            this._itemCount = 1;\r\n        } else {\r\n            this.node_btn.getComponent(Button).interactable = false;\r\n            this.node_btn.getComponent(Sprite).grayscale = true;\r\n        }\r\n        const award = new ItemInfo();\r\n        award.itemId = this._GetItemId;\r\n        award.num = this._GetItemNum;\r\n        this.common_item.initData(award);\r\n        this.lbl_name.string = LangMgr.getLab(award.itemTable.Name);\r\n        this.updateLbl();\r\n    }\r\n    protected onDestroy(): void {\r\n        super.onDestroy();\r\n    }\r\n    register(): void {\r\n\r\n    }\r\n    unRegister(): void {\r\n        super.unRegister();\r\n    }\r\n    private clickAdd() {\r\n        this._itemCount++;\r\n        if (this._itemCount > this._maxRemainCount) {\r\n            this._itemCount = this._maxRemainCount;\r\n        }\r\n        this.updateLbl();\r\n    }\r\n    // sub碎片\r\n    private clickSub() {\r\n        this._itemCount--;\r\n        if (this._maxRemainCount >= 1 && this._itemCount < 1) {\r\n            this._itemCount = 1;\r\n        }\r\n        if (this._itemCount < 0) {\r\n            this._itemCount = 0;\r\n        }\r\n        this.updateLbl();\r\n    }\r\n    // max碎片\r\n    private clickMax() {\r\n        this._itemCount = this._maxRemainCount;\r\n        this.updateLbl();\r\n    }\r\n    updateLbl() {\r\n        this.lbl_num.string = String(this._itemCount);\r\n        let totalCount = this._CostItemNum * this._itemCount;\r\n        this._curCostDiamond = totalCount;\r\n        this.lbl_cost_diamon.string = String(totalCount);\r\n        this.lbl_limit.string = (this.boughtCount + this._itemCount) + \"/\" + this.mallItemTab.LimitCount\r\n    }\r\n    onClickBtn() {\r\n        const itemCostTab = tab.getData().ItemTableById.getValue(this._CostItemId);\r\n        const itemGetTab = tab.getData().ItemTableById.getValue(this._GetItemId);\r\n        const tipsStr = LangMgr.getCombineString(\"Tips_common_buy\", [LangMgr.getLab(itemCostTab.Name),this._curCostDiamond ,LangMgr.getLab(itemGetTab.Name)]);\r\n        CommonTipsPop.create(tipsStr, ((val) => {\r\n            if (val) {\r\n                const haveCount = ItemData.ins.getCount(this._CostItemId)\r\n                if (haveCount < this._curCostDiamond) {\r\n                    ShowItemNotEnoughTips(this._CostItemId);\r\n                } else {\r\n                    let msg = new proto.Msg_BuyFixedShopCommodityReq();\r\n                    msg.commodityId = this.mallItemId;\r\n                    msg.num = this._itemCount;\r\n                    Net.Send(proto.Ptl.BuyFixedShopCommodityReq, msg);\r\n                }\r\n            }\r\n        }))\r\n    }\r\n}\r\n\r\n\r\n"]}