{"version":3,"sources":["file:///C:/chickenStarClient/client/assets/scripts/logic/model/recruit/BannerPop.ts"],"names":["_decorator","Label","ViewPop","UIMgr","ViewName","ActivityData","setTextTime","Func","RecruitType","RoleData","ccclass","property","BannerPop","endTimer","updateTimer","lbl_time","string","unschedule","onClose","onShow","activityInfo","ins","getAllUpData","serverTime","getServerUtcTime","endTime","schedule","currentDate","Date","dismissTime","toDateString","setItem","GaChaUp","onDestroy","register","unRegister","onClickGo","groups","getAllActivityGroup","info","show","viewName","CombineActivityMainView","data","TabId"],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAASA,MAAAA,U,OAAAA,U;AAAuBC,MAAAA,K,OAAAA,K;;AACvBC,MAAAA,O,iBAAAA,O;;AACAC,MAAAA,K,iBAAAA,K;;AACAC,MAAAA,Q,iBAAAA,Q;;AACAC,MAAAA,Y,iBAAAA,Y;;AACiBC,MAAAA,W,iBAAAA,W;;AACjBC,MAAAA,I,iBAAAA,I;;AACAC,MAAAA,W,iBAAAA,W;;AAEAC,MAAAA,Q,iBAAAA,Q;;;;;;;;;OACH;AAAEC,QAAAA,OAAF;AAAWC,QAAAA;AAAX,O,GAAwBX,U;;2BAGjBY,S,WADZF,OAAO,CAAC,WAAD,C,UAEHC,QAAQ,CAACV,KAAD,C,2BAFb,MACaW,SADb;AAAA;AAAA,8BACuC;AAAA;AAAA;;AAAA;;AAAA,eAG3BC,QAH2B,GAGT,IAHS;;AAAA,eAgCnCC,WAhCmC,GAgCrB,MAAM;AAChB,iBAAKD,QAAL;;AACA,gBAAI,KAAKA,QAAL,IAAiB,CAArB,EAAwB;AACpB;AACA,mBAAKE,QAAL,CAAcC,MAAd,GAAuB;AAAA;AAAA,8CAAY,KAAKH,QAAjB,CAAvB;AACH,aAHD,MAGO;AACH,mBAAKI,UAAL,CAAgB,KAAKH,WAArB;AACA,mBAAKI,OAAL;AACH;AACJ,WAzCkC;AAAA;;AAInCC,QAAAA,MAAM,GAAS;AACX,cAAMC,YAAY,GAAG;AAAA;AAAA,4CAAaC,GAAb,CAAiBC,YAAjB,GAAgC,CAAhC,CAArB,CADW,CAEX;;AACA,cAAMC,UAAU,GAAG;AAAA;AAAA,oCAASF,GAAT,CAAaG,gBAAb,EAAnB;AACA,eAAKX,QAAL,GAAiBO,YAAY,CAACK,OAAb,GAAuBF,UAAxC;AACA,eAAKT,WAAL;AACA,eAAKG,UAAL,CAAgB,KAAKH,WAArB;AACA,eAAKY,QAAL,CAAc,KAAKZ,WAAnB,EAAgC,CAAhC;AAEA,cAAMa,WAAW,GAAG,IAAIC,IAAJ,EAApB;AACA,cAAMC,WAAW,GAAGF,WAAW,CAACG,YAAZ,EAApB;AACA;AAAA;AAAA,4BAAKC,OAAL,CAAa,gBAAgB;AAAA;AAAA,0CAAYC,OAAzC,EAAkDH,WAAlD;AACH;;AACSI,QAAAA,SAAS,GAAS;AACxB,gBAAMA,SAAN;AACH;;AACDC,QAAAA,QAAQ,GAAS,CAEhB;;AACDC,QAAAA,UAAU,GAAS;AACf,gBAAMA,UAAN;AACH;;AACDC,QAAAA,SAAS,GAAG;AACR,eAAKlB,OAAL;AACA,cAAMmB,MAAM,GAAG;AAAA;AAAA,4CAAahB,GAAb,CAAiBiB,mBAAjB,EAAf;AACA,cAAMC,IAAI,GAAGF,MAAM,CAAC,CAAD,CAAnB;AACA;AAAA;AAAA,8BAAMhB,GAAN,CAAUmB,IAAV,CAAe;AAAEC,YAAAA,QAAQ,EAAE;AAAA;AAAA,sCAASC,uBAArB;AAA8CC,YAAAA,IAAI,EAAEJ,IAAI,CAACK;AAAzD,WAAf;AACH;;AA/BkC,O;;;;;iBAEjB,I","sourcesContent":["import { _decorator, Component, Label, Node } from 'cc';\r\nimport { ViewPop } from '../../../framework/base/ViewPop';\r\nimport { UIMgr } from '../../mgr/UIMgr';\r\nimport { ViewName } from '../../define/ViewDefine';\r\nimport { ActivityData } from '../activity/ActivityData';\r\nimport { formatTimestamp, setTextTime } from '../../utils/GameUtil';\r\nimport { Func } from '../../utils/Func';\r\nimport { RecruitType } from '../../../Common/script/EnumTypeMgr';\r\nimport { LangMgr } from '../../mgr/LangMgr';\r\nimport { RoleData } from '../role/RoleData';\r\nconst { ccclass, property } = _decorator;\r\n\r\n@ccclass('BannerPop')\r\nexport class BannerPop extends ViewPop {\r\n    @property(Label)\r\n    lbl_time: Label = null;\r\n    private endTimer:number = null;\r\n    onShow(): void {\r\n        const activityInfo = ActivityData.ins.getAllUpData()[0];\r\n        // this.lbl_time.string = LangMgr.getCombineString(\"ui_activity_7\", [formatTimestamp(activityInfo.startTime) + \" - \" + formatTimestamp(activityInfo.endTime)])\r\n        const serverTime = RoleData.ins.getServerUtcTime();\r\n        this.endTimer =  activityInfo.endTime - serverTime;\r\n        this.updateTimer();\r\n        this.unschedule(this.updateTimer)\r\n        this.schedule(this.updateTimer, 1)\r\n        \r\n        const currentDate = new Date();\r\n        const dismissTime = currentDate.toDateString()\r\n        Func.setItem(\"dismissTime\" + RecruitType.GaChaUp, dismissTime)\r\n    }\r\n    protected onDestroy(): void {\r\n        super.onDestroy()\r\n    }\r\n    register(): void {\r\n\r\n    }\r\n    unRegister(): void {\r\n        super.unRegister();\r\n    }\r\n    onClickGo() {\r\n        this.onClose();\r\n        const groups = ActivityData.ins.getAllActivityGroup();\r\n        const info = groups[0];\r\n        UIMgr.ins.show({ viewName: ViewName.CombineActivityMainView, data: info.TabId })\r\n    }\r\n    updateTimer = () => {\r\n        this.endTimer--;\r\n        if (this.endTimer >= 0) {\r\n            //this.lbl_time.string = LangMgr.getLab(\"ui_commondesc_109\")+setTextTime(this.endTimer);\r\n            this.lbl_time.string = setTextTime(this.endTimer);\r\n        } else {\r\n            this.unschedule(this.updateTimer);\r\n            this.onClose();\r\n        }\r\n    }\r\n}\r\n\r\n\r\n"]}