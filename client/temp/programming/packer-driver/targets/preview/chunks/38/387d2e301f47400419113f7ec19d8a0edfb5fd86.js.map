{"version":3,"sources":["file:///C:/chickenStarClient/client/assets/scripts/logic/model/activity/signGift/SignInGiftPop.ts"],"names":["_decorator","instantiate","Node","Prefab","ScrollView","Vec2","ViewPop","tab","SignInGiftItem","EventMgr","proto","SignInGiftData","UIMgr","ViewName","RedMgr","RedDotType","LocalEvent","ccclass","property","SignInGiftPop","onShow","i","getData","SignInGiftTable","length","signTab","item","pfb_item","node_content","addChild","name","String","Day","itemTs","getComponent","initData","scrollToReward","onDestroy","register","onMsg","Ptl","ReceiveSignInGiftRsp","on_s2c_ReceiveSignInGiftRsp","unRegister","msg","error","code","CommonErrorCode","Succeed","ins","receiveGift","days","show","viewName","CongratulationPop","data","rewards","day","getChildByName","SignInGiftTableByDay","getValue","refreshEvent","SignGiftRed","getNotGetData","maxLen","Math","ceil","curLen","floor","scroll_view","scrollTo","onClose","emitLocal","LocalMsg_QueueUI_deleteUI"],"mappings":"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","sourcesContent":["import { _decorator, Component, instantiate, Node, Prefab, ScrollView, Vec2 } from 'cc';\r\nimport { ViewPop } from '../../../../framework/base/ViewPop';\r\nimport { tab } from '../../../../Table/table_gen';\r\nimport { SignInGiftItem } from './SignInGiftItem';\r\nimport { EventMgr } from '../../../mgr/EventMgr';\r\nimport { proto } from 'client_protocol';\r\nimport { SignInGiftData } from './SignInGiftData';\r\nimport { UIMgr } from '../../../mgr/UIMgr';\r\nimport { ViewName } from '../../../define/ViewDefine';\r\nimport { RedMgr } from '../../../mgr/RedMgr';\r\nimport { RedDotType } from '../../../red/RedDotType';\r\nimport { LocalEvent } from '../../../define/LocalEvent';\r\nconst { ccclass, property } = _decorator;\r\n\r\n@ccclass('SignInGiftPop')\r\nexport class SignInGiftPop extends ViewPop {\r\n    @property(Prefab)\r\n    pfb_item:Prefab = null;\r\n    @property(Node)\r\n    node_content:Node = null;\r\n    @property(ScrollView)\r\n    scroll_view:ScrollView = null;\r\n    onShow(): void {\r\n        for(let i=0;i<tab.getData().SignInGiftTable.length;i++){\r\n            const signTab = tab.getData().SignInGiftTable[i];\r\n            const item = instantiate(this.pfb_item);\r\n            this.node_content.addChild(item);\r\n            item.name = String(signTab.Day);\r\n            const itemTs = item.getComponent(SignInGiftItem);\r\n            itemTs.initData(signTab);\r\n        }\r\n        this.scrollToReward();\r\n    }\r\n    protected onDestroy(): void {\r\n        super.onDestroy()\r\n    }\r\n    register(): void {\r\n        EventMgr.onMsg(proto.Ptl.ReceiveSignInGiftRsp, this.on_s2c_ReceiveSignInGiftRsp, this);\r\n    }\r\n    unRegister(): void {\r\n        super.unRegister();\r\n    }\r\n    on_s2c_ReceiveSignInGiftRsp(msg:proto.Msg_ReceiveSignInGiftRsp){\r\n        if (msg.error && msg.error.code != proto.CommonErrorCode.Succeed) return;\r\n        SignInGiftData.ins.receiveGift(msg.days);\r\n        UIMgr.ins.show({ viewName: ViewName.CongratulationPop, data: msg.rewards});\r\n        for(let i=0;i<msg.days.length;i++){\r\n            const day = msg.days[i];\r\n            const item = this.node_content.getChildByName(String(day));\r\n            const itemTs = item.getComponent(SignInGiftItem);\r\n            const signTab = tab.getData().SignInGiftTableByDay.getValue(day);\r\n            itemTs.initData(signTab);\r\n        }\r\n        RedMgr.refreshEvent(RedDotType.SignGiftRed);\r\n    }\r\n    scrollToReward(){\r\n        const signTab =  SignInGiftData.ins.getNotGetData();\r\n        if(signTab){\r\n            const maxLen = Math.ceil(tab.getData().SignInGiftTable.length/5);\r\n            const curLen = Math.floor((signTab.Day-1)/5);\r\n            if(curLen===maxLen-1){\r\n                this.scroll_view.scrollTo(new Vec2(0,0),0.2)\r\n            }else{\r\n                this.scroll_view.scrollTo(new Vec2(0,1-curLen/maxLen),0.2)\r\n            }\r\n        }\r\n    }\r\n    onClose(): void {\r\n        super.onClose();\r\n        EventMgr.emitLocal(LocalEvent.LocalMsg_QueueUI_deleteUI);\r\n    }\r\n}\r\n\r\n\r\n"]}