{"version":3,"sources":["file:///C:/chickenStarClient/client/assets/scripts/logic/model/home/battle/BattleMainView.ts"],"names":["_decorator","instantiate","Label","Node","NodeEventType","Prefab","ProgressBar","ScrollView","UITransform","Vec2","ViewScreen","ViewName","ShowTips","UIMgr","Net","InfiniteList","BattleMainItem","EventMgr","LocalEvent","tab","proto","BattleMainDataControl","RedMgr","RedDotType","ItemData","LangMgr","CommonItem","ItemInfo","setTextTime_3","RoleData","stepBranchGuide","GuideController","DisableGuideController","PowerDifficultyTag","TRIALLAYER","BattleMainEliteData","BattleMainEliteControl","ccclass","property","BattleMainView","_scrollView","_clickIdx","_starClickIdx","_bTouch","_showGuildFinger","_viewLayer","NONE","_selfData","register","onLocal","Level_Item_Select","levelSelect","onMsg","Ptl","ReceiveMainFirstRewardRsp","on_s2c_ReceiveMainFirstRewardRsp","GetMainStageInfoRsp","on_s2c_GetMainStageInfoRsp","GetMainStageCleardRecordsRsp","on_s2c_GetMainStageCleardRecordsRsp","ReceiveEliteClearStageRewardsRsp","on_s2c_ReceiveEliteClearStageRewardsRsp","msg","list_levels","Refresh","getChapterId","refreshEvent","StageFirstReward","error","code","CommonErrorCode","Succeed","rewards","self","addReceiveFirstRewardId","stageId","indexes","ins","hideView","BattleMainRewardPop","setBattleReward","show","viewName","CongratulationPop","data","ChapterAward","setEliteBattleReward","onDestroy","node","active","emitLocal","hidePop","onEnterBattle","console","log","Disconnect","switchView","e","type","Number","node_elite","ROOKIE","node_ordinary","ELITE","node_bg_elite","node_bg_ordinary","node_power","setView","onShow","openData","getContent","getComponent","setAnchorPoint","on","onScrolling","onScrollEnd","TOUCH_START","_onTouchStar","TOUCH_END","_onTouchEnded","TOUCH_CANCEL","_onTouchCancel","Init","getCellNumber","getCellCount","bind","getCellSize","getCellWidth","getCellIdentifer","getCellView","getCellData","GetCellData","Reload","scrollToOffset","islock","getStageIsLock","countData","getChapterCount","lbl_elite_count","string","curCount","maxCount","item","target","parent","stopAutoScroll","isNaN","name","dataIndex","getData","MainChapterTable","length","pfb_level_item","idx","index","offset","getScrollOffset","x","updateItemScale","scrollViewMidX","width","itemChildren","children","markScale","forEach","worldPos","convertToWorldSpaceAR","position","viewPos","convertToNodeSpaceAR","distanceToCenter","Math","abs","scale","max","getChildByName","setScale","itemTs","content","pos","GetScrollPosOfCell","contentX","getPosition","dis","moveX","node_tip","node_battle_btn","lbl_desc","clientData","failTimes","setClientData","battleShow","node_complete","getLab","MainChapterTableById","getValue","Introduction","scheduleOnce","setSelect","String","ClickStage","setStageId","ids","getStageClearIds","indexOf","clickShowClearAward","getReceiveStageId","_stageId","_chapterId","chapterId","Id","clickBattleBtn","powerData","getByItemId","CurrencyType","CurrencyType_Stamina","powerCont","num","str","getCombineString","itemTable","Name","ResourceBuyPop","Msg_StartStageReq","registerGuildeSelectLeader","Send","StartStageReq","receiveAwards","getReceiveFirstRewardIds","clearIds","rewardTabData","PveClearStageTableByStageId","rewardIds","ClearRewardItemIds","rewardNums","ClearRewardItemNum","canReceive","node_reward_show","node_reward_elite","i","award_items","com","setTouchCallBack","item_data","itemId","initData","reqReceiveEliteClearStageRewards","setAwards","getCurFightStageId","ChapterFristRewardTableById","lastIdx","award_bar","progress","setProgressDot","lbl_reward","Time","getAllIndex","Msg_ReceiveMainFirstRewardReq","ReceiveMainFirstRewardReq","isActive","progressNode","dot","isGot","getReceiveFirstRewardById","Boolean","onRecordClick","Msg_GetMainStageCleardRecordsReq","GetMainStageCleardRecordsReq","BattleMainRecordPop"],"mappings":"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","sourcesContent":["import { _decorator, EventTouch, instantiate, Label, Layers, Node, NodeEventType, Prefab, ProgressBar, ScrollView, Size, Sprite, SpriteFrame, Tween, tween, UITransform, Vec2, Vec3, view } from 'cc';\nimport { ViewScreen } from '../../../../framework/base/ViewScreen';\nimport { ViewName } from '../../../define/ViewDefine';\nimport { ShowTips, UIMgr } from '../../../mgr/UIMgr';\nimport { Net } from '../../../net/Net';\nimport InfiniteList from '../../../../Common/InfiniteList/InfiniteList';\nimport { BattleMainItem } from './BattleMainItem';\nimport { EventMgr } from '../../../mgr/EventMgr';\nimport { LocalEvent } from '../../../define/LocalEvent';\nimport { tab } from '../../../../Table/table_gen';\nimport { proto } from 'client_protocol';\nimport { BattleMainDataControl } from './BattleMainDataControl';\nimport { RedMgr } from '../../../mgr/RedMgr';\nimport { RedDotType } from '../../../red/RedDotType';\nimport { ItemData } from '../../item/ItemData';\nimport { LangMgr } from '../../../mgr/LangMgr';\nimport { CommonItem } from '../../item/CommonItem';\nimport { ItemInfo } from '../../item/ItemInfo';\nimport { setTextTime_3 } from '../../../utils/GameUtil';\nimport { RoleData } from '../../role/RoleData';\nimport { stepBranchGuide } from '../../../guide/GuideTask';\nimport { GuideController } from '../../../guide/GuideController';\nimport { DisableGuideController } from '../../../guide/GuideCommand';\nimport { PowerDifficultyTag } from '../PowerDifficultyTag';\nimport { TRIALLAYER } from '../../../../Common/script/EnumTypeMgr';\nimport { BattleMainEliteData } from './BattleMainEliteData';\nimport { BattleMainEliteControl } from './BattleMainEliteControl';\nconst { ccclass, property } = _decorator;\n\n@ccclass('BattleMainView')\nexport class BattleMainView extends ViewScreen {\n    @property(Prefab)\n    pfb_level_item: Prefab = null;\n\n    @property(InfiniteList)\n    list_levels: InfiniteList = null;\n\n    @property(Node)\n    node_battle_btn: Node = null;\n    @property(Node)\n    node_tip: Node = null;\n    @property(Label)\n    lbl_desc: Label = null;\n\n    @property([CommonItem])\n    award_items: CommonItem[] = [];\n    @property(ProgressBar)\n    award_bar: ProgressBar = null;\n    @property(Label)\n    lbl_reward: Label = null;\n    @property(Node)\n    node_ordinary: Node = null;\n    @property(Node)\n    node_elite: Node = null;\n    @property(Node)\n    node_reward_show: Node = null;\n    @property(Node)\n    node_reward_elite: Node = null;\n    @property(Node)\n    node_complete: Node = null;\n    @property(Label)\n    lbl_elite_count: Label = null;\n\n    @property(Node)\n    node_bg_elite: Node = null;\n    @property(Node)\n    node_bg_ordinary: Node = null;\n    @property(Node)\n    node_power:Node = null;\n\n    private _scrollView: ScrollView = null;\n    private _clickIdx: number = 0;\n    private _starClickIdx: number = 0;\n    private _bTouch: boolean = false;\n    private _showGuildFinger: boolean = false;\n    private _viewLayer: TRIALLAYER = TRIALLAYER.NONE;\n    private _selfData: any = null;\n    register(): void {\n        EventMgr.onLocal(LocalEvent.Level_Item_Select, this.levelSelect, this);\n        EventMgr.onMsg(proto.Ptl.ReceiveMainFirstRewardRsp, this.on_s2c_ReceiveMainFirstRewardRsp, this);\n        EventMgr.onMsg(proto.Ptl.GetMainStageInfoRsp, this.on_s2c_GetMainStageInfoRsp, this);\n        EventMgr.onMsg(proto.Ptl.GetMainStageCleardRecordsRsp, this.on_s2c_GetMainStageCleardRecordsRsp, this);\n        EventMgr.onMsg(proto.Ptl.ReceiveEliteClearStageRewardsRsp, this.on_s2c_ReceiveEliteClearStageRewardsRsp, this);\n    }\n\n    on_s2c_GetMainStageInfoRsp(msg: proto.Msg_GetMainStageInfoRsp) {\n        this.list_levels.Refresh();\n        this.levelSelect([this._selfData.getChapterId() - 1]);\n        RedMgr.refreshEvent(RedDotType.StageFirstReward);\n    }\n    /* 领取首通奖励 */\n    on_s2c_ReceiveMainFirstRewardRsp(msg: proto.Msg_ReceiveMainFirstRewardRsp) {\n        if (msg.error && msg.error.code != proto.CommonErrorCode.Succeed) return;\n        if (msg.rewards) {\n            // 刷新列表状态\n            var self = this;\n            self._selfData.addReceiveFirstRewardId(msg.stageId, msg.indexes);\n            UIMgr.ins.hideView(ViewName.BattleMainRewardPop);\n            self.setBattleReward();\n            UIMgr.ins.show({ viewName: ViewName.CongratulationPop, data: msg.rewards })\n            RedMgr.refreshEvent(RedDotType.StageFirstReward);\n            RedMgr.refreshEvent(RedDotType.ChapterAward);\n        }\n    }\n    /* 领取精英首通奖励 */\n    on_s2c_ReceiveEliteClearStageRewardsRsp(msg: proto.Msg_ReceiveEliteClearStageRewardsRsp) {\n        if (msg.error && msg.error.code != proto.CommonErrorCode.Succeed) return;\n        if (msg.rewards) {\n            this._selfData.addReceiveFirstRewardId(msg.stageId);\n            this.setEliteBattleReward();\n        }\n    }\n    protected onDestroy(): void {\n        super.onDestroy();\n        if (GuideController.ins.node.active && this._showGuildFinger) {\n            DisableGuideController();\n        }\n        EventMgr.emitLocal(LocalEvent.hidePop);\n    }\n    onEnterBattle() {\n        console.log(\"进入战斗\")\n        Net.Disconnect()\n    }\n    switchView(e: EventTouch, type: string) {\n        if (Number(type) === this._viewLayer) {\n            return;\n        }\n        this._viewLayer = Number(type);\n        this.node_elite.active = this._viewLayer === TRIALLAYER.ROOKIE;\n        this.node_ordinary.active = this._viewLayer === TRIALLAYER.ELITE;\n        this.node_bg_elite.active = this._viewLayer === TRIALLAYER.ELITE;\n        this.node_bg_ordinary.active = this._viewLayer === TRIALLAYER.ROOKIE;\n        if (this._viewLayer === TRIALLAYER.ROOKIE) {\n            this._selfData = BattleMainDataControl.ins;\n        } else {\n            this._selfData = BattleMainEliteData.ins;\n        }\n        this.node_power.active = this._viewLayer === TRIALLAYER.ROOKIE\n        console.log(\"cocos 当前章节为=\", this._selfData.getChapterId());\n        this.setView();\n    }\n    onShow(): void {\n        this._viewLayer = this.openData ? this.openData : TRIALLAYER.ROOKIE;\n        this._selfData = this._viewLayer === TRIALLAYER.ROOKIE ? BattleMainDataControl.ins : BattleMainEliteData.ins;\n        console.log(\"cocos 当前章节为=\", this._selfData.getChapterId());\n        this.node_power.active = this._viewLayer === TRIALLAYER.ROOKIE\n        this.node_elite.active = this._viewLayer === TRIALLAYER.ROOKIE && this._selfData.getChapterId() >= 2;\n        this.node_ordinary.active = this._viewLayer === TRIALLAYER.ELITE;\n        this.node_bg_elite.active = this._viewLayer === TRIALLAYER.ELITE;\n        this.node_bg_ordinary.active = this._viewLayer === TRIALLAYER.ROOKIE;\n        this._showGuildFinger = false;\n        this.list_levels.getContent().getComponent(UITransform).setAnchorPoint(0, 0.5);\n        this._scrollView = this.list_levels.getComponent(ScrollView);\n        this.setView();\n        this.list_levels.node.on(\"scrolling\", this.onScrolling, this);\n        this.list_levels.node.on(\"scroll-ended\", this.onScrollEnd, this);\n        this._scrollView.node.on(NodeEventType.TOUCH_START, this._onTouchStar, this, true);\n        this._scrollView.node.on(NodeEventType.TOUCH_END, this._onTouchEnded, this, true);\n        this._scrollView.node.on(NodeEventType.TOUCH_CANCEL, this._onTouchCancel, this);\n    }\n    setView() {\n        this.list_levels.Init({\n            getCellNumber: this.getCellCount.bind(this),\n            getCellSize: this.getCellWidth.bind(this),\n            getCellIdentifer: this.getCellIdentifer.bind(this),\n            getCellView: this.getCellView.bind(this),\n            getCellData: this.GetCellData.bind(this),\n        });\n        this.list_levels.Reload(true, true);\n        this.list_levels.scrollToOffset(new Vec2(0, 5), 1, true);\n        let islock = this._selfData.getStageIsLock(this._selfData.getChapterId());\n        if (islock) {\n            this.levelSelect([this._selfData.getChapterId() - 2]);\n        } else {\n            this.levelSelect([this._selfData.getChapterId() - 1]);\n        }\n        if (this._viewLayer === TRIALLAYER.ROOKIE) {\n            this.setBattleReward();\n            const countData = BattleMainEliteData.ins.getChapterCount();\n            this.lbl_elite_count.string = countData.curCount + \"/\" + countData.maxCount;\n        } else {\n            this.setEliteBattleReward();\n        }\n    }\n    private onScrollEnd() {\n        if (this._bTouch) {\n            this._bTouch = false;\n            this.levelSelect([this._clickIdx]);\n        }\n    }\n    _onTouchCancel(e: EventTouch) {\n        this._onTouchEnded(e);\n    }\n    _onTouchStar(e: EventTouch) {\n        this._bTouch = true;\n        this._starClickIdx = this._clickIdx;\n    }\n    _onTouchEnded(e: EventTouch) {\n        let item = e.target.parent;\n        this._bTouch = false;\n        this._scrollView.stopAutoScroll();\n        if (this._starClickIdx === this._clickIdx && !isNaN(item.name)) {\n            let dataIndex = item.getComponent(BattleMainItem).dataIndex;\n            this.levelSelect([dataIndex]);\n        } else {\n            this.levelSelect([this._clickIdx]);\n        }\n    }\n    getCellCount() {\n        return tab.getData().MainChapterTable.length;\n    }\n    getCellWidth() {\n        return 300;\n    }\n    getCellIdentifer() {\n        return \"BattleMainItem\";\n    }\n    getCellView() {\n        return instantiate(this.pfb_level_item).getComponent(BattleMainItem);\n    }\n    GetCellData(idx: number) {\n        return { index: idx, ins: this._selfData }\n    }\n    onScrolling() {\n        const offset = this.list_levels.getScrollOffset();\n        if (offset.x > 0) {\n            this._clickIdx = 0;\n            this._bTouch = false;\n            this.levelSelect([this._clickIdx]);\n        } else {\n            this.updateItemScale();\n        }\n    }\n    updateItemScale() {\n        const scrollViewMidX = this.list_levels.node.getComponent(UITransform).width / 2;\n        let itemChildren = this.list_levels.getContent().children;\n        let markScale = 0;\n        let dataIndex = 0;\n        itemChildren.forEach(item => {\n            const worldPos = item.parent.getComponent(UITransform).convertToWorldSpaceAR(item.position);\n            const viewPos = this.list_levels.node.getComponent(UITransform).convertToNodeSpaceAR(worldPos);\n            const distanceToCenter = Math.abs(viewPos.x - scrollViewMidX);\n            const scale = Math.max(0.6, 0.6 + 0.6 * (1 - distanceToCenter / scrollViewMidX));\n            item.getChildByName(\"info_node\").setScale(scale, scale);\n            let itemTs = item.getComponent(BattleMainItem)\n            if (markScale < scale) {\n                markScale = scale;\n                dataIndex = itemTs.dataIndex;\n            }\n        })\n        this._clickIdx = dataIndex;\n    }\n    levelSelect(data) {\n        this._clickIdx = data[0]\n        const content = this.list_levels.getContent();\n        let pos = this.list_levels.GetScrollPosOfCell(this._clickIdx);\n        const scrollViewMidX = this.list_levels.node.getComponent(UITransform).width / 2;\n        const contentX = content.getPosition().x;\n        const dis = pos.x + contentX\n        let moveX = contentX - (dis - scrollViewMidX);\n        // const time = (dis / 2000) > 0.1 ? 0.1 : (dis / 2000);\n        this._scrollView.scrollToOffset(new Vec2(Math.abs(moveX), 0), 0.1);\n        let islock = this._selfData.getStageIsLock(this._clickIdx + 1);\n        this.node_tip.active = islock;\n        this.node_battle_btn.active = !islock;\n        this.lbl_desc.node.parent.active = !islock;\n\n        if (RoleData.ins.clientData.failTimes === \"true\") {\n            RoleData.ins.setClientData(\"failTimes\", \"false\")\n            stepBranchGuide(501);\n        }\n        let battleShow = false;\n        if (this._viewLayer === TRIALLAYER.ELITE && this.node_battle_btn.active) {\n            this.node_battle_btn.active = false;\n            battleShow = true\n        } else {\n            this.node_complete.active = false;\n        }\n        // 是否显示文本\n        this.lbl_desc.string = LangMgr.getLab(tab.getData().MainChapterTableById.getValue(this._clickIdx + 1).Introduction);\n        this.scheduleOnce(() => {\n            let itemChildren = content.children;\n            itemChildren.forEach(item => {\n                const itemTs = item.getComponent(BattleMainItem);\n                itemTs.setSelect(itemTs.dataIndex === this._clickIdx)\n            })\n            const item = content.getChildByName(String(this._clickIdx))\n            if (item) {\n                const stageId = item.getComponent(BattleMainItem).ClickStage;\n                this.node_battle_btn.getComponent(PowerDifficultyTag) && this.node_battle_btn.getComponent(PowerDifficultyTag).setStageId(stageId)\n                if (this._viewLayer === TRIALLAYER.ELITE) {\n                    // 判断精英副本是否通关\n                    const ids = this._selfData.getStageClearIds();\n                    if (ids.indexOf(stageId) > -1) {\n                        this.node_battle_btn.active = false;\n                        this.node_complete.active = true;\n                    } else {\n                        this.node_complete.active = false;\n                        this.node_battle_btn.active = battleShow;\n                    }\n                }\n            }\n        }, 0.1);\n    }\n    /* 点击显示通关奖励 */\n    clickShowClearAward() {\n        const content = this.list_levels.getContent();\n        const item = content.getChildByName(String(this._clickIdx))\n        const stageId = item.getComponent(BattleMainItem).ClickStage;\n        if (this._selfData.getReceiveStageId()) {\n            /* 有可领取的奖励 */\n            let _stageId = this._selfData.getReceiveStageId();\n            let _chapterId = this._selfData.getChapterId(_stageId);\n            UIMgr.ins.show({ viewName: ViewName.BattleMainRewardPop, data: { chapterId: _chapterId, Id: _stageId, ins: this._selfData } })\n        } else {\n            UIMgr.ins.show({ viewName: ViewName.BattleMainRewardPop, data: { chapterId: this._clickIdx + 1, Id: stageId, ins: this._selfData } })\n        }\n    }\n    /* 点击通关 */\n    clickBattleBtn() {\n        /* 如果体力不足 前端拦截 */\n        const powerData = ItemData.ins.getByItemId(tab.CurrencyType.CurrencyType_Stamina);\n        const powerCont = powerData.num;\n        if (this._viewLayer===TRIALLAYER.ROOKIE&&powerCont < 5) {\n            // 体力不足返回\n            let str = LangMgr.getCombineString(\"Tips_itemshortage\", [LangMgr.getLab(powerData.itemTable.Name)]);\n            ShowTips(str);\n            UIMgr.ins.show({ viewName: ViewName.ResourceBuyPop, data: { \"itemId\": tab.CurrencyType.CurrencyType_Stamina } })\n            return\n        }\n        if (GuideController.ins.node.active && this._showGuildFinger) {\n            DisableGuideController();\n        }\n        const content = this.list_levels.getContent();\n        const item = content.getChildByName(String(this._clickIdx))\n        const stageId = item.getComponent(BattleMainItem).ClickStage;\n        let msg = new proto.Msg_StartStageReq();\n        msg.stageId = stageId;\n\n        if(msg.stageId===103){\n            GuideController.ins.registerGuildeSelectLeader();\n        }\n\n        Net.Send(proto.Ptl.StartStageReq, msg)\n    }\n    setEliteBattleReward() {\n        const stageId = this._selfData.getReceiveStageId();\n        const receiveAwards = this._selfData.getReceiveFirstRewardIds();\n        const clearIds = this._selfData.getStageClearIds();\n        const rewardTabData = tab.getData().PveClearStageTableByStageId.getValue(stageId);\n        const rewardIds = rewardTabData.ClearRewardItemIds;\n        const rewardNums = rewardTabData.ClearRewardItemNum;\n        const canReceive = receiveAwards.indexOf(stageId) === -1 && clearIds.indexOf(stageId) > -1;\n        this.node_reward_show.active = false;\n        this.node_reward_elite.active = true;\n        for (let i = 0; i < this.award_items.length; i++) {\n            const com = this.award_items[i];\n            com.setTouchCallBack(null);\n            if (rewardIds[i]) {\n                com.node.parent.active = true;\n                com.node.parent.getChildByName(\"canget_node\").active = canReceive;\n                const item_data = new ItemInfo();\n                item_data.itemId = rewardIds[i];\n                item_data.num = rewardNums[i];\n                com.initData(item_data, true, false);\n                if (canReceive) {\n                    com.setTouchCallBack(() => {\n                        BattleMainEliteControl.ins.reqReceiveEliteClearStageRewards(stageId);\n                    })\n                }\n            } else {\n                com.node.parent.active = false;\n            }\n        }\n    }\n    /* 设置通关奖励界面 */\n    setBattleReward() {\n        this.node_reward_show.active = true;\n        this.node_reward_elite.active = false;\n        const stageId = this._selfData.getReceiveStageId();\n        if (stageId) {\n            this.setAwards(stageId, true);\n        } else {\n            this.setAwards(this._selfData.getCurFightStageId(), false);\n        }\n        if (this._selfData.getReceiveFirstRewardIds().length === 0 && this._selfData.getStageClearIds().length >= 3) {\n            this._showGuildFinger = true;\n            stepBranchGuide(507);\n        }\n    }\n    setAwards(stageId: number, canReceive: boolean) {\n        const rewardTabData = tab.getData().ChapterFristRewardTableById.getValue(stageId);\n        const ids = this._selfData.getReceiveFirstRewardIds();\n        let idx = 0;\n        if (ids.length > 0) {\n            const lastIdx = ids[ids.length - 1].index;\n            idx = lastIdx < 2 ? lastIdx + 1 : 0;\n        } else {\n            idx = 0;\n        }\n        this.award_bar.progress = idx / 2;\n        const rewardIds = rewardTabData[\"RewardItemIds\" + (idx + 1)];\n        const rewardNums = rewardTabData[\"RewardItemNum\" + (idx + 1)];\n        this.setProgressDot(stageId, idx, true);\n        this.lbl_reward.string = setTextTime_3(rewardTabData.Time[idx]) + LangMgr.getLab(\"ui_commondesc_57\");\n        for (let i = 0; i < this.award_items.length; i++) {\n            const com = this.award_items[i];\n            com.setTouchCallBack(null);\n            if (rewardIds[i]) {\n                com.node.parent.active = true;\n                com.node.parent.getChildByName(\"canget_node\").active = canReceive;\n                const item_data = new ItemInfo();\n                item_data.itemId = rewardIds[i];\n                item_data.num = rewardNums[i];\n                com.initData(item_data, true, false);\n                if (canReceive) {\n                    const indexes = this._selfData.getAllIndex(stageId);\n                    com.setTouchCallBack(() => {\n                        let msg = new proto.Msg_ReceiveMainFirstRewardReq();\n                        msg.indexes = [indexes[0]];\n                        msg.stageId = stageId;\n                        Net.Send(proto.Ptl.ReceiveMainFirstRewardReq, msg)\n                    })\n                } else {\n                    com.setTouchCallBack(() => {\n                        UIMgr.ins.show({ viewName: ViewName.BattleMainRewardPop, data: { chapterId: this._clickIdx + 1, Id: stageId } })\n                    })\n                }\n            } else {\n                com.node.parent.active = false;\n            }\n        }\n    }\n    setProgressDot(stageId: number, idx: number, isActive: boolean) {\n        const progressNode = this.award_bar.node.parent;\n        for (let i = 1; i <= 3; i++) {\n            const dot = progressNode.getChildByName(\"dot_\" + i);\n            const isGot = this._selfData.getReceiveFirstRewardById(stageId, (i - 1));\n            dot.active = Boolean(isGot) || (isActive && idx === (i - 1));\n        }\n    }\n\n    onRecordClick() {\n        const content = this.list_levels.getContent();\n        const item = content.getChildByName(String(this._clickIdx))\n        const stageId = item.getComponent(BattleMainItem).ClickStage;\n\n        console.log(stageId)\n        let msg = new proto.Msg_GetMainStageCleardRecordsReq();\n        msg.stageId = stageId;\n        Net.Send(proto.Ptl.GetMainStageCleardRecordsReq, msg)\n    }\n\n    on_s2c_GetMainStageCleardRecordsRsp(msg: proto.Msg_GetMainStageCleardRecordsRsp) {\n        if (msg.error.code != proto.CommonErrorCode.Succeed) {\n            return\n        }\n        UIMgr.ins.show({ viewName: ViewName.BattleMainRecordPop, data: msg })\n    }\n}\n"]}