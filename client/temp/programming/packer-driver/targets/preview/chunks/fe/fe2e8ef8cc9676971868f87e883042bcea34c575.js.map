{"version":3,"sources":["file:///C:/chickenStarClient/client/assets/scripts/logic/model/shop/MallMainView.ts"],"names":["_decorator","instantiate","Label","Node","Prefab","Toggle","ViewPop","InfiniteList","MallLayoutCell","tab","MallTabItem","proto","Net","EventMgr","getTimeUntilNextDay","getTimeUntilNextMonth","getTimeUntilNextWeek","setTextTime","ViewName","ShowItemNotEnoughTips","ShowTips","UIMgr","RoleData","MallDataMgr","ResourceItem","ItemData","OpenFunctionMgr","MALLNAME","LangMgr","Global","ccclass","property","MallMainView","_view_type","MallTab","MallTab_None","_view_name","NONE","_shop_view","Map","_cost_daily","_daily_shop_data","_list","_vacation","_countDown","_dailyCountDown","register","onMsg","Ptl","BuyDailyShopCommodityOneClickRsp","on_s2c_BuyDailyShopCommodityOneClickRsp","BuyDailyShopCommodityRsp","on_s2c_BuyDailyShopCommodityRsp","BuyFixedShopCommodityRsp","on_s2c_BuyFixedShopCommodityRsp","RefreshDailyShopRsp","on_s2c_RefreshDailyShopRsp","onShow","ins","getDailyShopData","openData","MallTab_Tab2","getView","hideView","createShopBaseData","refreshView","msg","error","code","CommonErrorCode","Succeed","initDailyShop","set","DailyShop","slots","list_view","Refresh","show","viewName","CongratulationPop","data","rewards","i","length","slot","commodityId","isBought","groupData","groupListData","index","getData","MallTable","mallTab","mallName","MallId","k","MallItemTabe","itemTab","has","arr","get","concat","MallTab_Tab1","MallTab_Tab5","BuyDiamondsTable","toggleArr","Object","keys","forEach","key","_key","Number","isNaN","MallTab_SpecialGiftTab1","malltab","isOpen","Function","checkFunctionIsOpen","node_MallTabItem","initData","isInit","name","node","getChildByName","getComponent","isChecked","Init","getCellNumber","getCellCount","bind","getCellSize","getCellHeight","getCellIdentifer","getCellView","getCellData","GetCellData","Reload","node_vocation","active","MallTab_Tab3","node_challenge","MallTab_Tab4","node_challenge_toggle","OpenFunctionName","OpenFunctionName_Association","node_vocation_toggle","setResourceItem","refreshExtraData","pfb_item","idx","view","type","splitCount","_mallTabData","_MallTab","result","listData","getMallItemTabByType","sort","slot1","slot2","ViewSpecial","isReview","push","slice","clickSwitchShop","e","clickSwitchVocation","onDestroy","node_daily_refresh","node_free_btn","parent","node_time","freeRefreshTime","lastFreeRefreshTime","countData","getDailyCountdown","isCountDown","count","updateDailyTime","unschedule","schedule","freeBtn","noFreeBtn","node_nofree_btn","isFree","isNoFree","numTxt","string","String","needDiamond","updateTime","lbl_count_time","console","log","lbl_daily_time","curTime","getServerUtcTime","timeCount","maxTime","GetKeyValue_ConfigTable","DailyShopFreeRefreshCD","clickDailyRefresh","getLab","diamond","Msg_RefreshDailyShopReq","Send","RefreshDailyShopReq","freeRefreshTimes","notFreeRefreshTimes","maxFreeRefreshTimes","DailyShopFreeRefreshCount","maxNoFreeRefreshTimes","DailyShopBuyRefreshCount","getPrivilegeValue","VipBonus","VipBonus_DailyShopRefresh","DailyShopBuyCostDiamonds","onClickBuyDailyShop","canBuy","materialEnough","noEnouthItem","clear","_dailyShopData","DailyShopItemTableById","getValue","_CostItemId","CostItemId","_CostItemNum","CostItemNum","value","itemCount","getCount","Msg_BuyDailyShopCommodityOneClickReq","BuyDailyShopCommodityOneClickReq","AssassinShop","ArcherShop","PriestShop","CasterShop","WarriorShop","resource_item","setItemIds","BossShop","DismissalShop","DiamondShop","GuildShop","PvpShop"],"mappings":"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","sourcesContent":["import { _decorator, Component, EventTouch, instantiate, Label, Node, Prefab, Toggle } from 'cc';\r\nimport { ViewPop } from '../../../framework/base/ViewPop';\r\nimport InfiniteList from '../../../Common/InfiniteList/InfiniteList';\r\nimport { MallLayoutCell } from './MallLayoutCell';\r\nimport { tab } from '../../../Table/table_gen';\r\nimport { MallTabItem } from './MallTabItem';\r\nimport { proto } from 'client_protocol';\r\nimport { Net } from '../../net/Net';\r\nimport { EventMgr } from '../../mgr/EventMgr';\r\nimport { getTimeUntilNextDay, getTimeUntilNextMonth, getTimeUntilNextWeek, setTextTime } from '../../utils/GameUtil';\r\nimport { ViewName } from '../../define/ViewDefine';\r\nimport { ShowItemNotEnoughTips, ShowTips, UIMgr } from '../../mgr/UIMgr';\r\nimport { RoleData } from '../role/RoleData';\r\nimport { MallDataMgr } from './MallDataMgr';\r\nimport { ResourceItem } from '../common/ResourceItem';\r\nimport { ItemData } from '../item/ItemData';\r\nimport { OpenFunctionMgr } from '../../../Common/component/OpenFunctionMgr';\r\nimport { MALLNAME } from '../../../Common/script/EnumTypeMgr';\r\nimport { LangMgr } from '../../mgr/LangMgr';\r\nimport { Global } from '../../../Global';\r\nconst { ccclass, property } = _decorator;\r\n\r\n@ccclass('MallMainView')\r\nexport class MallMainView extends ViewPop {\r\n    @property(Prefab)\r\n    pfb_item: Prefab = null;\r\n    @property(InfiniteList)\r\n    list_view: InfiniteList = null;\r\n    @property(MallTabItem)\r\n    node_MallTabItem: MallTabItem = null;\r\n    @property(Node)\r\n    node_vocation: Node = null;\r\n    @property(Node)\r\n    node_challenge: Node = null;\r\n    @property(Label)\r\n    lbl_daily_time: Label = null;\r\n    @property(Label)\r\n    lbl_count_time: Label = null;\r\n    @property(Node)\r\n    node_daily_refresh: Node = null;\r\n    @property(Node)\r\n    node_time: Node = null;\r\n    @property(Node)\r\n    node_free_btn: Node = null;\r\n    @property(Node)\r\n    node_nofree_btn: Node = null;\r\n    @property(ResourceItem)\r\n    resource_item: ResourceItem = null;\r\n    @property(Node)\r\n    node_vocation_toggle: Node = null;\r\n    @property(Node)\r\n    node_challenge_toggle: Node = null;\r\n    private _view_type: tab.MallTab = tab.MallTab.MallTab_None;\r\n    private _view_name: MALLNAME = MALLNAME.NONE;\r\n    private _shop_view: Map<MALLNAME, any[]> = new Map();\r\n    private _cost_daily: Map<number, number> = new Map();\r\n    private _daily_shop_data: proto.Msg_GetDailyShopInfoRsp = null;\r\n    private _list = []\r\n    private _vacation = -1;\r\n    private _countDown: number = 0;\r\n    private _dailyCountDown: number = 0;\r\n    register(): void {\r\n        // 一键购买每日商品\r\n        EventMgr.onMsg(proto.Ptl.BuyDailyShopCommodityOneClickRsp, this.on_s2c_BuyDailyShopCommodityOneClickRsp, this);\r\n        // 购买每日商品\r\n        EventMgr.onMsg(proto.Ptl.BuyDailyShopCommodityRsp, this.on_s2c_BuyDailyShopCommodityRsp, this);\r\n        // 购买固定商品\r\n        EventMgr.onMsg(proto.Ptl.BuyFixedShopCommodityRsp, this.on_s2c_BuyFixedShopCommodityRsp, this);\r\n        // 一键刷新每日奖励\r\n        EventMgr.onMsg(proto.Ptl.RefreshDailyShopRsp, this.on_s2c_RefreshDailyShopRsp, this);\r\n    }\r\n\r\n    onShow(): void {\r\n        this._daily_shop_data = MallDataMgr.ins.getDailyShopData();\r\n        if (this.openData) {\r\n            if (typeof this.openData === 'number') {\r\n                this._view_type = this.openData;\r\n                if (this._view_type === tab.MallTab.MallTab_Tab2 && UIMgr.ins.getView(\"HeroResolvePop\")) {\r\n                    UIMgr.ins.hideView(\"HeroResolvePop\")\r\n                }\r\n            } else if (typeof this.openData === 'object') {\r\n                this._view_type = this.openData[0]\r\n                this._vacation = this.openData[1];\r\n            }\r\n        }\r\n        this.createShopBaseData();\r\n        if (this._vacation > 0) {\r\n            this.refreshView(true, this._vacation);\r\n        } else {\r\n            this.refreshView(true);\r\n        }\r\n    }\r\n    // 刷新每日奖励\r\n    on_s2c_RefreshDailyShopRsp(msg: proto.Msg_RefreshDailyShopRsp) {\r\n        if (msg.error && msg.error.code != proto.CommonErrorCode.Succeed) return;\r\n        MallDataMgr.ins.initDailyShop(msg);\r\n        this._daily_shop_data = MallDataMgr.ins.getDailyShopData();\r\n        this._shop_view.set(MALLNAME.DailyShop, this._daily_shop_data.slots);\r\n        this.refreshView(false);\r\n    }\r\n    // 购买固定商品\r\n    on_s2c_BuyFixedShopCommodityRsp(msg: proto.Msg_BuyFixedShopCommodityRsp) {\r\n        if (msg.error && msg.error.code != proto.CommonErrorCode.Succeed) return;\r\n        this.list_view.Refresh();\r\n    }\r\n    // 一键购买商品\r\n    on_s2c_BuyDailyShopCommodityOneClickRsp(msg: proto.Msg_BuyDailyShopCommodityOneClickRsp) {\r\n        if (msg.error && msg.error.code != proto.CommonErrorCode.Succeed) return;\r\n        UIMgr.ins.show({ viewName: ViewName.CongratulationPop, data: msg.rewards })\r\n        for (let i = 0; i < this._daily_shop_data.slots.length; i++) {\r\n            let slot = this._daily_shop_data.slots[i];\r\n            if (slot.commodityId === 1000) {\r\n                continue;\r\n            }\r\n            slot.isBought = true;\r\n        }\r\n        const groupData = this.groupListData(this._view_type);\r\n        this._list = groupData.data;\r\n        this.list_view.Refresh();\r\n    }\r\n    // 购买每日商品\r\n    on_s2c_BuyDailyShopCommodityRsp(msg: proto.Msg_BuyDailyShopCommodityRsp) {\r\n        if (msg.error && msg.error.code != proto.CommonErrorCode.Succeed) return;\r\n        UIMgr.ins.show({ viewName: ViewName.CongratulationPop, data: msg.rewards })\r\n        for (let i = 0; i < this._daily_shop_data.slots.length; i++) {\r\n            let slot = this._daily_shop_data.slots[i];\r\n            if (slot.index === msg.index) {\r\n                slot.isBought = true;\r\n                break;\r\n            }\r\n        }\r\n        const groupData = this.groupListData(this._view_type);\r\n        this._list = groupData.data;\r\n        this.list_view.Refresh();\r\n    }\r\n    createShopBaseData() {\r\n        // 根据页签类型创建 Toggle和列表数据\r\n        for (let i = 0; i < tab.getData().MallTable.length; i++) {\r\n            const mallTab = tab.getData().MallTable[i];\r\n            const mallName = mallTab.MallId;\r\n            // 创建职业 遣散信息\r\n            for (let k = 0; k < tab.getData().MallItemTabe.length; k++) {\r\n                const itemTab = tab.getData().MallItemTabe[k];\r\n                if (itemTab.MallId === mallName) {\r\n                    if (this._shop_view.has(mallName)) {\r\n                        const arr = this._shop_view.get(mallName);\r\n                        this._shop_view.set(mallName, arr.concat(itemTab))\r\n                    } else {\r\n                        this._shop_view.set(mallName, [itemTab]);\r\n                    }\r\n                }\r\n            }\r\n            // 创建每日商店信息\r\n            if (mallTab.MallTab === tab.MallTab.MallTab_Tab1) {\r\n                this._shop_view.set(mallName, this._daily_shop_data.slots);\r\n            } else if (mallTab.MallTab === tab.MallTab.MallTab_Tab5) {\r\n                this._shop_view.set(mallName, tab.getData().BuyDiamondsTable);\r\n            }\r\n\r\n        }\r\n        // 根据页签显示toggle\r\n        const toggleArr = [];\r\n        Object.keys(tab.MallTab).forEach(key => {\r\n            const _key = Number(key)\r\n            if (!isNaN(_key) && _key && _key !== tab.MallTab.MallTab_SpecialGiftTab1) {\r\n                toggleArr[key] = -1;\r\n                for (let i = 0; i < tab.getData().MallTable.length; i++) {\r\n                    const malltab = tab.getData().MallTable[i];\r\n                    let isOpen = false;\r\n                    if (malltab.Function) {\r\n                        isOpen = OpenFunctionMgr.ins.checkFunctionIsOpen(malltab.Function)\r\n                    }\r\n                    if (isOpen && malltab.MallTab === _key) {\r\n                        toggleArr[key] = _key;\r\n                        break;\r\n                    }\r\n                }\r\n            }\r\n        })\r\n        for (let i = 0; i < toggleArr.length; i++) {\r\n            if (toggleArr[i] >= 0) {\r\n                if (!this.openData) {\r\n                    this._view_type = toggleArr[i];\r\n                }\r\n                break;\r\n            }\r\n        }\r\n        this.node_MallTabItem.initData(toggleArr);\r\n    }\r\n    refreshView(isInit: boolean, mallName?: MALLNAME) {\r\n        const groupData = this.groupListData(this._view_type, mallName);\r\n        this._list = groupData.data;\r\n        this._view_name = groupData.name;\r\n        if (isInit) {\r\n            this.node_MallTabItem.node.getChildByName(\"tab_node\").getChildByName(\"Toggle\" + this._view_type).getComponent(Toggle).isChecked = true;\r\n            this.list_view.Init({\r\n                getCellNumber: this.getCellCount.bind(this),\r\n                getCellSize: this.getCellHeight.bind(this),\r\n                getCellIdentifer: this.getCellIdentifer.bind(this),\r\n                getCellView: this.getCellView.bind(this),\r\n                getCellData: this.GetCellData.bind(this),\r\n            })\r\n        } else {\r\n            this.list_view.Reload(false, true)\r\n        }\r\n        this.node_vocation.active = this._view_type === tab.MallTab.MallTab_Tab3;\r\n        this.node_challenge.active = this._view_type === tab.MallTab.MallTab_Tab4;\r\n        if (this._view_type === tab.MallTab.MallTab_Tab4) {\r\n            this.node_challenge_toggle.getChildByName(\"Toggle2\").active = OpenFunctionMgr.ins.checkFunctionIsOpen(tab.OpenFunctionName.OpenFunctionName_Association);\r\n            if (isInit) {\r\n                if(this._vacation === 11){\r\n                    this.node_challenge_toggle.getChildByName(\"Toggle2\").getComponent(Toggle).isChecked = true;\r\n                }else if(this._vacation === 9){\r\n                    this.node_challenge_toggle.getChildByName(\"Toggle3\").getComponent(Toggle).isChecked = true;\r\n                }\r\n            }\r\n        }\r\n        if (!mallName) {\r\n            if (this.node_vocation.active) {\r\n                this._vacation = 2;\r\n                this.node_vocation_toggle.getChildByName(\"Toggle1\").getComponent(Toggle).isChecked = true;\r\n            }\r\n            if (this.node_challenge.active) {\r\n                this._vacation = 8;\r\n                this.node_challenge_toggle.getChildByName(\"Toggle1\").getComponent(Toggle).isChecked = true;\r\n            }\r\n        }\r\n        // 根据viewName创建资源\r\n        this.setResourceItem();\r\n        this.refreshExtraData();\r\n    }\r\n    getCellCount() {\r\n        return this._list.length;\r\n    }\r\n    getCellHeight() {\r\n        return 250;\r\n    }\r\n    getCellIdentifer() {\r\n        return \"MallLayoutCell\";\r\n    }\r\n    getCellView() {\r\n        return instantiate(this.pfb_item).getComponent(MallLayoutCell);\r\n    }\r\n    GetCellData(idx: number) {\r\n        return { data: this._list[idx], view: this._view_type, viewName: this._view_name }\r\n    }\r\n    groupListData(type: tab.MallTab, mallName?: MALLNAME) {\r\n        const splitCount = this._view_type === tab.MallTab.MallTab_Tab5 ? 3 : 5\r\n        let mallTab: tab.MallTable = null;\r\n        for (let i = 0; i < tab.getData().MallTable.length; i++) {\r\n            const _mallTabData = tab.getData().MallTable[i];\r\n            const _MallTab = _mallTabData.MallTab;\r\n            if (type === _MallTab) {\r\n                mallTab = _mallTabData;\r\n                break;\r\n            }\r\n        }\r\n        const result = [];\r\n        let listData = this.getMallItemTabByType(mallName ? mallName : mallTab.MallId);\r\n        // 如果当前是每日商店 排序买了的排在后面\r\n        if (this._view_type === tab.MallTab.MallTab_Tab1) {\r\n            listData.sort((slot1, slot2) => {\r\n                return slot1.isBought - slot2.isBought\r\n            })\r\n        }\r\n        for (let i = 0; i < listData.length; i += splitCount) {\r\n            if (this._view_type === tab.MallTab.MallTab_Tab5 && listData[i].ViewSpecial && !Global.isReview) {\r\n                continue\r\n            }\r\n            result.push(listData.slice(i, i + splitCount));\r\n        }\r\n        return { data: result, name: mallName ? mallName : mallTab.MallId };\r\n    }\r\n    // 通过type获得表中所有的数据\r\n    getMallItemTabByType(type: MALLNAME) {\r\n        return this._shop_view.get(type);\r\n    }\r\n    clickSwitchShop(e: EventTouch, type: String) {\r\n        if (this._view_type === Number(type)) {\r\n            return;\r\n        }\r\n        this._view_type = Number(type);\r\n        this.refreshView(false);\r\n    }\r\n    clickSwitchVocation(e: EventTouch, type: String) {\r\n        // this._view_type = tab.MallTab.MallTab_Tab2;\r\n        if (this._vacation == Number(type)) {\r\n            return;\r\n        }\r\n        this._vacation = Number(type);\r\n        this.refreshView(false, Number(type));\r\n    }\r\n    protected onDestroy(): void {\r\n        super.onDestroy()\r\n    }\r\n    // 刷新每日商店数据\r\n    refreshExtraData() {\r\n        this.node_daily_refresh.active = this._view_type === tab.MallTab.MallTab_Tab1;\r\n        this.node_free_btn.parent.active = this._view_type === tab.MallTab.MallTab_Tab1;\r\n        this.node_time.active = this._view_type !== tab.MallTab.MallTab_Tab5;\r\n        if (this._view_type === tab.MallTab.MallTab_Tab1) {\r\n            // 上次免费刷新时间\r\n            const freeRefreshTime = this._daily_shop_data.lastFreeRefreshTime;\r\n            // 判断是否有倒计时\r\n            const countData = this.getDailyCountdown();\r\n\r\n            if (freeRefreshTime && countData.isCountDown) {\r\n                // 有免费刷新时间\r\n                this.node_daily_refresh.active = true;\r\n                this._dailyCountDown = countData.count;\r\n                this.updateDailyTime();\r\n                this.unschedule(this.updateDailyTime)\r\n                this.schedule(this.updateDailyTime, 1)\r\n            } else {\r\n                this.node_daily_refresh.active = false;\r\n            }\r\n\r\n            // 判断是否有免费次数\r\n            const data = this.getDailyShopData();\r\n            const freeBtn = this.node_free_btn;\r\n            const noFreeBtn = this.node_nofree_btn;\r\n            freeBtn.active = data.isFree;\r\n            noFreeBtn.active = data.isNoFree;\r\n            if (data.isNoFree) {\r\n                const numTxt = noFreeBtn.getChildByName(\"num_Layout\").getChildByName(\"num_txt\").getComponent(Label);\r\n                numTxt.string = String(data.needDiamond);\r\n            }\r\n\r\n            this._countDown = getTimeUntilNextDay();\r\n            this.updateTime();\r\n            this.unschedule(this.updateTime);\r\n            this.schedule(this.updateTime, 1);\r\n        } else if (this._view_type === tab.MallTab.MallTab_Tab2) {\r\n            this._countDown = getTimeUntilNextWeek();\r\n            this.updateTime();\r\n            this.unschedule(this.updateTime);\r\n            this.schedule(this.updateTime, 1);\r\n        } else if (this._view_type === tab.MallTab.MallTab_Tab3 || this._view_type === tab.MallTab.MallTab_Tab4) {\r\n            this._countDown = getTimeUntilNextMonth();\r\n            this.updateTime();\r\n            this.unschedule(this.updateTime);\r\n            this.schedule(this.updateTime, 1);\r\n        } else if (this._view_type === tab.MallTab.MallTab_Tab5) {\r\n\r\n        }\r\n    }\r\n    updateTime() {\r\n        // 获取刷新周期\r\n        this._countDown--;\r\n        if (this._countDown <= 0) {\r\n            this._countDown = 0;\r\n            this.unschedule(this.updateTime);\r\n        } else {\r\n            this.lbl_count_time.string = setTextTime(this._countDown);\r\n        }\r\n\r\n    }\r\n    updateDailyTime() {\r\n        // 巡逻收益时间\r\n        // const countData = this.getDailyCountdown();\r\n        this._dailyCountDown--\r\n        // 已经达到最大收益\r\n        if (this._dailyCountDown <= 0) {\r\n            console.log(`倒计时结束`);\r\n            this._dailyCountDown = 0;\r\n            this.node_daily_refresh.active = false;\r\n            this.unschedule(this.updateDailyTime);\r\n        } else {\r\n            this.lbl_daily_time.string = setTextTime(this._dailyCountDown);\r\n        }\r\n    }\r\n    // 获取当前每日倒计时，是否有倒计时\r\n    getDailyCountdown() {\r\n        const curTime = RoleData.ins.getServerUtcTime()\r\n        let timeCount = curTime - Number(this._daily_shop_data.lastFreeRefreshTime);\r\n        const maxTime = tab.getData().GetKeyValue_ConfigTable().DailyShopFreeRefreshCD;\r\n        return { count: maxTime - timeCount, isCountDown: maxTime > timeCount };\r\n    }\r\n    clickDailyRefresh() {\r\n        const data = this.getDailyShopData();\r\n        if (this._dailyCountDown && data.isFree) {\r\n            //ShowTips(\"刷新冷却时间未结束\");\r\n            ShowTips(LangMgr.getLab(\"Tips_mall_1\"));\r\n            return;\r\n        }\r\n        const diamond = RoleData.ins.diamond;\r\n        if (data.isFree || data.isNoFree) {\r\n            if (data.needDiamond > diamond) {\r\n                ShowItemNotEnoughTips(1);\r\n                return;\r\n            }\r\n            let msg = new proto.Msg_RefreshDailyShopReq();\r\n            msg.type = data.isFree ? 0 : 1;\r\n            Net.Send(proto.Ptl.RefreshDailyShopReq, msg);\r\n        } else {\r\n            //ShowTips(\"刷新次数使用完\");\r\n            ShowTips(LangMgr.getLab(\"Tips_mall_2\"));\r\n        }\r\n    }\r\n    // 刷新每日商店\r\n    getDailyShopData() {\r\n        // 免费刷新次数\r\n        const freeRefreshTimes = this._daily_shop_data.freeRefreshTimes;\r\n        // 付费刷新次数\r\n        const notFreeRefreshTimes = this._daily_shop_data.notFreeRefreshTimes;\r\n        // 最大免费刷新次数\r\n        const maxFreeRefreshTimes = tab.getData().GetKeyValue_ConfigTable().DailyShopFreeRefreshCount;\r\n        // 最大付费刷新次数\r\n        const maxNoFreeRefreshTimes = tab.getData().GetKeyValue_ConfigTable().DailyShopBuyRefreshCount + RoleData.ins.getPrivilegeValue(tab.VipBonus.VipBonus_DailyShopRefresh);;\r\n        // 每次刷新需要的钻石\r\n        const DailyShopBuyCostDiamonds = tab.getData().GetKeyValue_ConfigTable().DailyShopBuyCostDiamonds;\r\n        const data = {\r\n            isFree: false,\r\n            isNoFree: false,\r\n            needDiamond: 0,\r\n        }\r\n        if (maxFreeRefreshTimes > freeRefreshTimes && this._dailyCountDown == 0) {\r\n            data.isFree = true;\r\n        } else {\r\n            if (notFreeRefreshTimes >= maxNoFreeRefreshTimes) {\r\n\r\n            } else {\r\n                // 显示付费刷新按钮+需要的钻石\r\n                data.isNoFree = true;\r\n                const needDiamond = DailyShopBuyCostDiamonds[notFreeRefreshTimes] ? DailyShopBuyCostDiamonds[notFreeRefreshTimes] : DailyShopBuyCostDiamonds[DailyShopBuyCostDiamonds.length - 1];\r\n                data.needDiamond = needDiamond;\r\n            }\r\n        }\r\n        return data\r\n    }\r\n    // 一键购买每日商店\r\n    onClickBuyDailyShop() {\r\n        // 判断一键购买的钻石是否充足\r\n        let canBuy = false;\r\n        let materialEnough = true;\r\n        let noEnouthItem = 0;\r\n        this._cost_daily.clear();\r\n        for (let i = 0; i < this._daily_shop_data.slots.length; i++) {\r\n            let slot = this._daily_shop_data.slots[i];\r\n            if (slot.commodityId === 1000) {\r\n                continue;\r\n            }\r\n            if (!slot.isBought) {\r\n                canBuy = true;\r\n                const _dailyShopData = tab.getData().DailyShopItemTableById.getValue(slot.commodityId);\r\n                const _CostItemId = _dailyShopData.CostItemId;\r\n                const _CostItemNum = _dailyShopData.CostItemNum;\r\n                if (this._cost_daily.has(_CostItemId)) {\r\n                    this._cost_daily.set(_CostItemId, this._cost_daily.get(_CostItemId) + _CostItemNum)\r\n                } else {\r\n                    this._cost_daily.set(_CostItemId, _CostItemNum)\r\n                }\r\n            }\r\n        }\r\n        this._cost_daily.forEach((value, key) => {\r\n            const itemCount = ItemData.ins.getCount(key);\r\n            if (itemCount < value) {\r\n                noEnouthItem = key;\r\n                materialEnough = false;\r\n            }\r\n        })\r\n        if (!materialEnough) {\r\n            ShowItemNotEnoughTips(noEnouthItem);\r\n            return;\r\n        }\r\n        if (canBuy && materialEnough) {\r\n            let msg = new proto.Msg_BuyDailyShopCommodityOneClickReq();\r\n            Net.Send(proto.Ptl.BuyDailyShopCommodityOneClickReq, msg);\r\n        }\r\n    }\r\n    setResourceItem() {\r\n        const mallName = this._view_name\r\n        switch (mallName) {\r\n            case MALLNAME.AssassinShop:\r\n            case MALLNAME.ArcherShop:\r\n            case MALLNAME.PriestShop:\r\n            case MALLNAME.CasterShop:\r\n            case MALLNAME.WarriorShop:\r\n                this.resource_item.setItemIds([81])\r\n                break;\r\n            case MALLNAME.DailyShop:\r\n                this.resource_item.setItemIds([1])\r\n                break\r\n            case MALLNAME.BossShop:\r\n                this.resource_item.setItemIds([83])\r\n                break\r\n            case MALLNAME.DismissalShop:\r\n                this.resource_item.setItemIds([5])\r\n                break\r\n            case MALLNAME.DiamondShop:\r\n                this.resource_item.setItemIds([])\r\n                break\r\n            case MALLNAME.GuildShop:\r\n                this.resource_item.setItemIds([84])\r\n                break\r\n            case  MALLNAME.PvpShop:\r\n                this.resource_item.setItemIds([86])\r\n                break\r\n            default:\r\n                break;\r\n        }\r\n    }\r\n}\r\n\r\n\r\n"]}