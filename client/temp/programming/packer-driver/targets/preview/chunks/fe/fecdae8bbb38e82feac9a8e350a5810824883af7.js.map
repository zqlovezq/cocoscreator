{"version":3,"sources":["file:///C:/chickenStarClient/client/assets/scripts/logic/fight/animation/FPSAvatar.ts"],"names":["_decorator","Component","Layers","Node","Sprite","UITransform","Vec3","ccclass","property","tempPos","FPSAvatar","spr","_isPlay","sample","nowIndex","duration","step","isComplete","time","totalTime","timeScale","iamges","wrapMode","actionName","cb","get","fps","poolUIs","pop","nn","layer","Enum","DEFAULT","addComponent","put","node","removeFromParent","reset","push","destory","i","length","destroy","createWithSpriteFrames","spriteFrames","updateNowSpr","setFb","fb","setSprite","sp","position","set","scale","addChild","update","dt","addSelf","playComplete","play","spriteFrame","isPlay","v","pause","resume","isLoop","resetTime","stop","recycle","clearSprite","hasImage"],"mappings":"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","sourcesContent":["import { _decorator, Component, Layers, Node, Prefab, Sprite, SpriteFrame, UITransform, v3, Vec3, warn } from \"cc\";\n\nconst { ccclass, property } = _decorator;\nconst tempPos = new Vec3()\n@ccclass('FPSAvatar')\nexport class FPSAvatar extends Component {\n    private static poolUIs: FPSAvatar[] = []\n\n    static get() {\n        let fps = FPSAvatar.poolUIs.pop()\n        if (fps == null) {\n            let nn = new Node(\"FPSAvatar\");\n            nn.layer = Layers.Enum.DEFAULT\n            fps = nn.addComponent(FPSAvatar)\n        }\n        return fps\n    }\n\n    static put(fps: FPSAvatar) {\n        fps.node.removeFromParent()\n        fps.reset()\n        FPSAvatar.poolUIs.push(fps)\n    }\n    /** 销毁 */\n    static destory() {\n        for (let i = 0; i < FPSAvatar.poolUIs.length; i++) {\n            FPSAvatar.poolUIs[i].node.destroy()\n        }\n        FPSAvatar.poolUIs.length = 0\n    }\n\n    spr: Sprite\n    private _isPlay: boolean = false\n\n    private sample: number = 0\n    private nowIndex: number = 0\n    private duration: number = 0\n    private step: number = 0\n    private isComplete: boolean = false\n    private time: number = 0\n    private totalTime: number = 0\n    timeScale: number = 1\n    iamges: SpriteFrame[] = []\n    wrapMode: boolean = false\n    public actionName: string = \"\"\n    createWithSpriteFrames(spriteFrames: SpriteFrame[], sample: number) {\n        this.iamges = spriteFrames\n        this.sample = sample\n        this.duration = spriteFrames.length / sample\n        this.step = 1 / sample\n        this.time = 0\n        this.totalTime = 0\n        this.updateNowSpr()\n    }\n    cb: Function\n    setFb(fb: Function) {\n        this.cb = fb\n    }\n\n    setSprite(sp: Sprite) {\n        this.spr = sp\n        this.spr.node.position = tempPos.set(0, 0, 0)\n        this.spr.node.scale = tempPos.set(1, 1, 1)\n        this.node.addChild(this.spr.node)\n    }\n\n    protected update(dt: number): void {\n        if (!this._isPlay) return\n\n        this.time += dt * this.timeScale\n        this.totalTime += dt* this.timeScale\n        if (this.time >= this.step) {\n            this.time -= this.step\n            this.addSelf()\n        }\n    }\n    addSelf() {\n        this.nowIndex += 1\n        this.updateNowSpr()\n    }\n\n    updateNowSpr() {\n        if (this.iamges == null) {\n            return\n        }\n        if (this.nowIndex >= this.iamges.length) {\n            if (!this.wrapMode) {\n                this.playComplete()\n                return\n            }\n            this.play(this.wrapMode)\n            return\n        }\n        if (this.spr == null) {\n            let nn = new Node(\"spr\")\n            nn.addComponent(UITransform)\n            this.spr = nn.addComponent(Sprite)\n            nn.layer = this.node.layer\n            this.node.addChild(nn)\n        }\n        this.spr.spriteFrame = this.iamges[this.nowIndex]\n\n    }\n\n    get isPlay() {\n        return this._isPlay\n    }\n    set isPlay(v) {\n        this._isPlay = v\n    }\n\n\n    /** 暂停 */\n    pause() {\n        this.isPlay = false\n    }\n    /** 恢复 */\n    resume() {\n        this.isPlay = true\n    }\n    /** 播放 */\n    play(isLoop: boolean) {\n        this.wrapMode = isLoop\n        this.resetTime()\n        this.isComplete = false\n        this.isPlay = true\n        this.updateNowSpr()\n    }\n\n    /** 停止 */\n    stop() {\n        this.resetTime()\n        this.isPlay = false\n    }\n\n    playComplete() {\n        this.isComplete = true\n        this._isPlay = false\n        this.cb && this.cb()\n    }\n\n\n    recycle() {\n        FPSAvatar.put(this)\n    }\n\n    resetTime() {\n        this.time = 0\n        this.nowIndex = 0\n        this.totalTime = 0\n        if (this.spr) {\n            this.spr.spriteFrame = null\n        }\n    }\n    reset() {\n        this.resetTime()\n        this.isComplete = false\n        this.wrapMode = false\n        this.iamges = null\n        this.actionName = \"\"\n        this.clearSprite()\n    }\n\n    clearSprite() {\n        this.spr = null\n    }\n\n    hasImage() {\n        return this.iamges && this.iamges.length > 0\n    }\n\n}"]}