{"version":3,"sources":["file:///C:/chickenStarClient/client/assets/scripts/logic/model/rareBook/RareBookStarUpPop.ts"],"names":["_decorator","instantiate","Label","Node","Prefab","ViewPop","RareBookSmallItem","HeroStar","RareBookData","LangMgr","RareBookStarUpItem","HeroSkillItem","tab","ccclass","property","StarUpPop","info","heroInfo","register","onShow","openData","initBook","initHero","node_hero","active","node_rare_book","rareBookSmallItem","initView","lastTab","ins","getBoolStarTable","itemId","star","effectLab","string","getLab","Description","lastStar","showStar","currStar","attrMap","ratio","levelRatio","lastAttrMap","getAttrMapByLevelRatio","AttrType","AttrValue","forEach","value","key","item","itemPrefab","parent","attributeLayout","getComponent","get","starUpTab","heroStarUpTable","hero_skill_item","initData","DescType","lbl_desc","StarDesc","lastStarUpTab","getData","HeroStarUpTableById","getValue","Id","lbl_last_level","String","MaxLevel","lbl_next_level","node_awake_up","HeroStarDescType","HeroStarDescType_Third","node_star_up","HeroStarDescType_Second"],"mappings":"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","sourcesContent":["import { _decorator, Component, instantiate, Label, Node, Prefab } from 'cc';\r\nimport { ViewPop } from '../../../framework/base/ViewPop';\r\nimport { RareBookSmallItem } from './RareBookSmallItem';\r\nimport { HeroStar } from '../hero/HeroStar';\r\nimport { RareBookInfo } from './RareBookInfo';\r\nimport { RareBookData } from './RareBookData';\r\nimport { LangMgr } from '../../mgr/LangMgr';\r\nimport { RareBookStarUpItem } from './RareBookStarUpItem';\r\nimport { HeroInfo } from '../hero/HeroInfo';\r\nimport { HeroSkillItem } from '../hero/herobag/HeroSkillItem';\r\nimport { tab } from '../../../Table/table_gen';\r\nconst { ccclass, property } = _decorator;\r\n\r\n/**\r\n * \r\n * StarUpPop\r\n * zhudingchao\r\n * Fri May 31 2024 10:34:45 GMT+0800 (中国标准时间)\r\n * db://assets/scripts/logic/model/rareBook/StarUpPop.ts\r\n *\r\n */\r\n\r\n@ccclass('StarUpPop')\r\nexport class StarUpPop extends ViewPop {\r\n    @property(Node)\r\n    attributeLayout: Node = null;\r\n    @property(RareBookSmallItem)\r\n    rareBookSmallItem: RareBookSmallItem = null;\r\n    @property(Label)\r\n    effectLab: Label = null;\r\n    @property(HeroStar)\r\n    lastStar: HeroStar = null;\r\n    @property(HeroStar)\r\n    currStar: HeroStar = null;\r\n    @property(Prefab)\r\n    itemPrefab: Prefab = null;\r\n    @property(Node)\r\n    node_rare_book:Node = null;\r\n    @property(Node)\r\n    node_hero:Node = null;\r\n    @property(HeroSkillItem)\r\n    hero_skill_item:HeroSkillItem = null;\r\n    @property(Label)\r\n    lbl_desc:Label = null;\r\n\r\n    @property(Label)\r\n    lbl_last_level:Label = null;\r\n\r\n    @property(Label)\r\n    lbl_next_level:Label = null;\r\n    @property(Node)\r\n    node_star_up:Node = null;\r\n    @property(Node)\r\n    node_awake_up:Node = null;\r\n\r\n    private info: RareBookInfo;\r\n    private heroInfo:HeroInfo;\r\n    register(): void {\r\n\r\n    }\r\n    onShow(): void {\r\n        this.info = this.openData[\"bookInfo\"];\r\n        this.heroInfo = this.openData[\"heroInfo\"];\r\n        if(this.info){\r\n            this.initBook();\r\n        }\r\n        if(this.heroInfo){\r\n            this.initHero();\r\n        }\r\n    }\r\n    initBook() {\r\n        this.node_hero.active = false;\r\n        this.node_rare_book.active = true;\r\n        this.rareBookSmallItem.initView(this.info, false);\r\n        let lastTab = RareBookData.ins.getBoolStarTable(this.info.itemId, this.info.star - 1);\r\n        this.effectLab.string = LangMgr.ins.getLab(lastTab.Description);\r\n        this.lastStar.showStar(this.info.star - 1);\r\n        this.currStar.showStar(this.info.star);\r\n        let attrMap = this.info.attrMap;\r\n        let ratio = this.info.levelRatio;\r\n        let lastAttrMap = this.info.getAttrMapByLevelRatio(ratio, lastTab.AttrType, lastTab.AttrValue);\r\n        attrMap.forEach((value, key) => {\r\n            let item = instantiate(this.itemPrefab)\r\n            item.parent = this.attributeLayout;\r\n            item.getComponent(RareBookStarUpItem).initView(key, lastAttrMap.get(key), value);\r\n            // item.initView(key, value, nextAttrMap.get(key));\r\n            // index++;\r\n        });\r\n    }\r\n    initHero(){\r\n        this.node_hero.active = true;\r\n        this.node_rare_book.active = false;\r\n        this.lastStar.showStar(this.heroInfo.star - 1);\r\n        this.currStar.showStar(this.heroInfo.star);\r\n        const starUpTab:tab.HeroStarUpTable = this.heroInfo.heroStarUpTable;\r\n        this.hero_skill_item.initData(starUpTab.DescType, this.heroInfo);\r\n        this.lbl_desc.string = LangMgr.ins.getLab(starUpTab.StarDesc);\r\n\r\n        const lastStarUpTab = tab.getData().HeroStarUpTableById.getValue(starUpTab.Id-1);\r\n        this.lbl_last_level.string = String(lastStarUpTab.MaxLevel);\r\n        this.lbl_next_level.string = String(starUpTab.MaxLevel);\r\n        this.node_awake_up.active = starUpTab.DescType===tab.HeroStarDescType.HeroStarDescType_Third\r\n        this.node_star_up.active = starUpTab.DescType===tab.HeroStarDescType.HeroStarDescType_Second\r\n    }\r\n}"]}