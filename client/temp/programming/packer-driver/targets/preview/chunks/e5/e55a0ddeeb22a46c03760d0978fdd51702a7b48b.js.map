{"version":3,"sources":["file:///C:/chickenStarClient/client/assets/scripts/logic/model/jianghu/topWar/TopWarView.ts"],"names":["_decorator","instantiate","Label","Node","Prefab","ScrollView","ViewScreen","ShowTips","UIMgr","ViewName","tab","TopWarDamageItem","TopWarBossSkillItem","proto","Net","EventMgr","TopWarPlayRankHeadiItem","SimpleRoleInfo","RoleData","GameplayViewDataMgr","GameUtil","getTimeUntilNextDay","setTextTime","GameplayControl","OpenFunctionMgr","CommonTipsPop","CommonTipsPopCloseType","LangMgr","ccclass","property","TopWarView","damageItems","rankMsg","endTimer","updateTimer","timerLab","string","unschedule","register","onMsg","Ptl","GetRankRsp","on_s2c_GetRankRsp","WorldBossDataPush","on_s2c_WorldBossDataPush","WorldBossSweepRsp","on_s2c_WorldBossSweepRsp","requestGetRank","msg","Msg_GetHeroRankReq","rankId","RankType","RankType_WorldBoss","Send","GetRankReq","onShow","initDamageReward","initSkills","initMyRank","initEndTimer","schedule","skillIds","getData","GetKeyValue_ConfigTable","WorldBossShowSkillIds","key","item","skillPrefab","parent","skillLayout","getComponent","initSkillId","currScore","ins","worldBossMsg","maxScore","tables","WorldBossRewardTable","len","length","i","damageItemPrefab","damageScroll","content","com","lastScore","Damage","initView","push","ranking","myHerdItem","rankLab","node","active","setRankLab","notRankNode","headFrame","avatarInfo","headIcon","myNode","totalDamageLab","convertNumber","totalScore","maxDamageLab","freeCount","WorldBossDailyCount","num","challengeCount","buyNum","WorldBossDailyBuyCount","lastChallengeNum","sweepBtnNode","checkFunctionIsOpen","OpenFunctionName","OpenFunctionName_WorldBossSweepAll","updateDamageReward","updateView","onClickChallenge","callBack","Msg_StartStageReq","stageId","WorldBossStageId","StartStageReq","buyChallenge","totalNum","isPrivilege","OpenFunctionName_WorldBossFreeBuyCount","tips","spend","getCombineString","buySpends","WorldBossDailyBuyCostDiamonds","currBuyNum","create","closeType","confirm","diamond","getLab","console","log","onClickSweep","requestWorldBossSweep","showFunctionTips","onClickRewardRank","show","viewName","TopWarRankRewardPop","onClickRank","error","code","CommonErrorCode","Succeed","rankHerads","getChildByName","top_player_list","rankList","headItem","info","merge","simple","Number","nameLab","name","onClikhideView","onClose","GameplayView"],"mappings":"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","sourcesContent":["import { _decorator, Component, error, instantiate, Label, Node, Prefab, ScrollView } from 'cc';\r\nimport { ViewScreen } from '../../../../framework/base/ViewScreen';\r\nimport { ShowTips, UIMgr } from '../../../mgr/UIMgr';\r\nimport { ViewName } from '../../../define/ViewDefine';\r\nimport { tab } from '../../../../Table/table_gen';\r\nimport { TopWarDamageItem } from './TopWarDamageItem';\r\nimport { TopWarBossSkillItem } from './topWarBossSkillItem';\r\nimport { proto } from 'client_protocol';\r\nimport { Net } from '../../../net/Net';\r\nimport { EventMgr } from '../../../mgr/EventMgr';\r\nimport { TopWarPlayRankHeadiItem } from './TopWarPlayRankHeadiItem';\r\nimport { SimpleRoleInfo } from '../../friends/SimpleRoleInfo';\r\nimport { Role } from '../../../fight/base/obj/role/role/Role';\r\nimport { RoleData } from '../../role/RoleData';\r\nimport { GameplayViewDataMgr } from '../GameplayViewDataMgr';\r\nimport { GameUtil, getTimeUntilNextDay, setTextTime } from '../../../utils/GameUtil';\r\nimport { GameplayControl } from '../GameplayControl';\r\nimport { OpenFunctionMgr } from '../../../../Common/component/OpenFunctionMgr';\r\nimport { CommonTipsPop, CommonTipsPopCloseType } from '../../common/CommonTipsPop';\r\nimport { ItemData } from '../../item/ItemData';\r\nimport { LangMgr } from '../../../mgr/LangMgr';\r\nconst { ccclass, property } = _decorator;\r\n\r\n/**\r\n * \r\n * TopWarView\r\n * zhudingchao\r\n * Fri Jul 05 2024 11:05:11 GMT+0800 (中国标准时间)\r\n * db://assets/scripts/logic/model/jianghu/topWar/TopWarView.ts\r\n *\r\n */\r\n\r\n@ccclass('TopWarView')\r\nexport class TopWarView extends ViewScreen {\r\n    @property(Label)\r\n    timerLab: Label = null;\r\n    @property(Node)\r\n    skillLayout: Node = null;\r\n\r\n    @property(ScrollView)\r\n    damageScroll: ScrollView = null;\r\n\r\n    @property([Node])\r\n    rankHerads: Array<Node> = [];\r\n    @property(TopWarPlayRankHeadiItem)\r\n    myHerdItem: TopWarPlayRankHeadiItem = null;\r\n    @property(Node)\r\n    notRankNode: Node = null;\r\n    @property(Label)\r\n    totalDamageLab: Label = null;\r\n    @property(Label)\r\n    maxDamageLab: Label = null;\r\n    @property(Node)\r\n    sweepBtnNode:Node=null;\r\n    @property(Label)\r\n    lastChallengeNum:Label=null;\r\n    @property(Prefab)\r\n    damageItemPrefab: Prefab = null;\r\n    @property(Prefab)\r\n    skillPrefab: Prefab = null;\r\n\r\n    private damageItems: Array<TopWarDamageItem>;\r\n    private rankMsg: proto.Msg_GetRankRsp;\r\n    private endTimer: number;\r\n    register(): void {\r\n        EventMgr.onMsg(proto.Ptl.GetRankRsp, this.on_s2c_GetRankRsp, this);\r\n        EventMgr.onMsg(proto.Ptl.WorldBossDataPush, this.on_s2c_WorldBossDataPush, this);\r\n        EventMgr.onMsg(proto.Ptl.WorldBossSweepRsp, this.on_s2c_WorldBossSweepRsp, this);\r\n    }\r\n    requestGetRank() {\r\n        let msg = new proto.Msg_GetHeroRankReq();\r\n        msg.rankId = tab.RankType.RankType_WorldBoss;\r\n        Net.Send(proto.Ptl.GetRankReq, msg);\r\n\r\n    }\r\n    onShow(): void {\r\n        this.requestGetRank();\r\n        this.initDamageReward();\r\n        this.initSkills();\r\n        this.initMyRank();\r\n        this.initEndTimer();\r\n\r\n\r\n    }\r\n    initEndTimer() {\r\n        this.unschedule(this.updateTimer)\r\n        this.endTimer = getTimeUntilNextDay();\r\n        this.timerLab.string = setTextTime(this.endTimer);\r\n        this.schedule(this.updateTimer, 1)\r\n    }\r\n    updateTimer = () => {\r\n        this.endTimer--;\r\n        if (this.endTimer >= 0) {\r\n            this.timerLab.string = setTextTime(this.endTimer);\r\n        } else {\r\n            this.unschedule(this.updateTimer)\r\n        }\r\n    }\r\n    initSkills() {\r\n        let skillIds = tab.getData().GetKeyValue_ConfigTable().WorldBossShowSkillIds;\r\n        for (let key in skillIds) {\r\n            let item = instantiate(this.skillPrefab);\r\n            item.parent = this.skillLayout;\r\n            item.getComponent(TopWarBossSkillItem).initSkillId(skillIds[key]);\r\n        }\r\n\r\n    }\r\n    initDamageReward() {\r\n        this.damageItems = [];\r\n        let currScore = GameplayViewDataMgr.ins.worldBossMsg.maxScore;\r\n        let tables = tab.getData().WorldBossRewardTable;\r\n        let len = tables.length;\r\n        for (let i: number = len - 1; i >= 0; i--) {\r\n            let item = instantiate(this.damageItemPrefab);\r\n            item.parent = this.damageScroll.content;\r\n            let com = item.getComponent(TopWarDamageItem);\r\n            let lastScore = i == 0 ? 0 : tables[i - 1].Damage;\r\n            com.initView(tables[i], lastScore, currScore);\r\n            this.damageItems.push(com);\r\n        }\r\n\r\n    }\r\n    initMyRank() {\r\n        // error(\"头像功能没有做\")\r\n        let msg = GameplayViewDataMgr.ins.worldBossMsg;\r\n        if (msg.ranking > -1) {\r\n            this.myHerdItem.rankLab.node.active = true;\r\n          \r\n            this.myHerdItem.setRankLab(msg.ranking+1);\r\n            this.notRankNode.active = false;\r\n        } else {\r\n            this.myHerdItem.rankLab.node.active = false;\r\n            this.notRankNode.active = true;\r\n        }\r\n        this.myHerdItem.initView({headFrame:RoleData.ins.avatarInfo.headFrame,headIcon:RoleData.ins.avatarInfo.headIcon})\r\n\r\n        this.myHerdItem.myNode.active = true;\r\n        this.totalDamageLab.string = GameUtil.convertNumber(msg.totalScore);\r\n        this.maxDamageLab.string = GameUtil.convertNumber(msg.maxScore);\r\n        let freeCount=tab.getData().GetKeyValue_ConfigTable().WorldBossDailyCount;\r\n        let num=GameplayViewDataMgr.ins.worldBossMsg.challengeCount;\r\n        let buyNum=tab.getData().GetKeyValue_ConfigTable().WorldBossDailyBuyCount;\r\n        if(num<freeCount){\r\n            this.lastChallengeNum.string=\"\"+buyNum;\r\n        }else{\r\n            this.lastChallengeNum.string=\"\"+(freeCount+buyNum-num);\r\n        }\r\n        this.sweepBtnNode.active=msg.totalScore>0&&OpenFunctionMgr.ins.checkFunctionIsOpen(tab.OpenFunctionName.OpenFunctionName_WorldBossSweepAll);\r\n\r\n\r\n        // let herodInfo=RoleData.ins.\r\n    }\r\n    updateDamageReward() {\r\n        let currScore = GameplayViewDataMgr.ins.worldBossMsg.maxScore;\r\n        for (let key in this.damageItems) {\r\n            this.damageItems[key].updateView(currScore);\r\n        }\r\n    }\r\n    onClickChallenge(){\r\n       \r\n        let callBack=()=>{\r\n            let msg = new proto.Msg_StartStageReq();\r\n            msg.stageId = tab.getData().GetKeyValue_ConfigTable().WorldBossStageId;\r\n            Net.Send(proto.Ptl.StartStageReq, msg)\r\n        }\r\n        this.buyChallenge(callBack);\r\n       \r\n       \r\n    }\r\n    private buyChallenge(callBack:Function){\r\n        let freeCount=tab.getData().GetKeyValue_ConfigTable().WorldBossDailyCount;\r\n        let num=GameplayViewDataMgr.ins.worldBossMsg.challengeCount;\r\n        if(num<freeCount){\r\n            callBack();\r\n        }else{\r\n            let buyNum=tab.getData().GetKeyValue_ConfigTable().WorldBossDailyBuyCount;\r\n            let totalNum=buyNum+freeCount;\r\n            if(num<totalNum){\r\n\r\n                let isPrivilege=OpenFunctionMgr.ins.checkFunctionIsOpen(tab.OpenFunctionName.OpenFunctionName_WorldBossFreeBuyCount)\r\n                //弹窗购买框\r\n                let tips=\"\";\r\n                let spend=0;\r\n                if(isPrivilege){\r\n                    //tips=\"特权购买免费次数提示\\n今日剩余购买次数\"+(totalNum-num);\r\n                    tips = LangMgr.getCombineString(\"Tips_worldboss_2\", [totalNum-num]);\r\n                }else{\r\n                    let buySpends=tab.getData().GetKeyValue_ConfigTable().WorldBossDailyBuyCostDiamonds;\r\n                    let currBuyNum=buyNum-(totalNum-num);\r\n                    if(buySpends.length-1>=currBuyNum){\r\n                        // if(currBuyNum<0){\r\n                        //     spend=buySpends[0];\r\n                        // }else{\r\n                            spend=buySpends[currBuyNum];\r\n                        //}\r\n                       \r\n                    }else{\r\n                        spend=buySpends[buySpends.length-1];\r\n                    }\r\n                    //tips=\"是否花费\"+spend+\"钻石购买一次挑战次数 \\n今日剩余购买次数\"+(totalNum-num);\r\n                   tips = LangMgr.getCombineString(\"Tips_worldboss_1\", [spend, totalNum-num]);\r\n                }\r\n                CommonTipsPop.create(tips, (closeType: CommonTipsPopCloseType) => {\r\n                    if(closeType == CommonTipsPopCloseType.confirm) {\r\n                        // console.log(\"ok\")\r\n                     if(isPrivilege){\r\n                        callBack();\r\n                     }else{\r\n                        if(spend<=RoleData.ins.diamond){\r\n                            callBack();\r\n                        }else{\r\n                            //ShowTips(\"钻石不足\")\r\n                            ShowTips(LangMgr.getLab(\"ui_worldboss_6\"))\r\n                        }\r\n                     }\r\n                     \r\n                    } else {\r\n                        console.log(\"cancel\")\r\n                    }\r\n                })\r\n            }else{\r\n                //ShowTips(\"今日挑战次数已用完\")\r\n                ShowTips(LangMgr.getLab(\"ui_worldboss_8\"))\r\n            }\r\n        }\r\n    }\r\n    onClickSweep(){\r\n        if(OpenFunctionMgr.ins.checkFunctionIsOpen(tab.OpenFunctionName.OpenFunctionName_WorldBossSweepAll)){\r\n            this.buyChallenge(()=>{\r\n                GameplayControl.ins.requestWorldBossSweep();\r\n            });\r\n        }else{\r\n            OpenFunctionMgr.ins.showFunctionTips(tab.OpenFunctionName.OpenFunctionName_WorldBossSweepAll)\r\n        }\r\n       \r\n    }\r\n    onClickRewardRank() {\r\n        UIMgr.ins.show({ viewName: ViewName.TopWarRankRewardPop })\r\n    }\r\n    onClickRank() {\r\n        \r\n    }\r\n    on_s2c_GetRankRsp(msg: proto.Msg_GetRankRsp) {\r\n        if (msg.error && msg.error.code != proto.CommonErrorCode.Succeed) return;\r\n        this.rankMsg = msg;\r\n        /*排行榜数据返回 */\r\n        // this._rankId = msg.rankId;\r\n\r\n        // this._ranking = msg.ranking;\r\n        // this._selfSimple = msg.selfSimple;\r\n        for (let key in this.rankHerads) {\r\n            this.rankHerads[key].getChildByName(\"notRank_node\").active = true;\r\n            this.rankHerads[key].getChildByName(\"PlayRankHeadiItem\").active = false;;\r\n            this.rankHerads[key].getChildByName(\"playname_txt\").active=false;\r\n        }\r\n        // let top_player_list = msg.rankList;\r\n        // if (msg.rankList.length > 0) {\r\n        //     top_player_list = msg.rankList.splice(0, 3);\r\n        // }\r\n        let top_player_list = [];\r\n        for (let i = 0; i < msg.rankList.length; i++) {\r\n            if (i < 3) {\r\n                top_player_list.push(msg.rankList[i])\r\n            } \r\n        }\r\n        if (top_player_list.length > 0) {\r\n            for (let key in top_player_list) {\r\n                let node = this.rankHerads[key];\r\n                node.getChildByName(\"notRank_node\").active = false;\r\n                node.getChildByName(\"PlayRankHeadiItem\").active = true;\r\n                let headItem = node.getChildByName(\"PlayRankHeadiItem\").getComponent(TopWarPlayRankHeadiItem);\r\n                let info = new SimpleRoleInfo();\r\n                info.merge(top_player_list[key].simple);\r\n                headItem.initView(info);\r\n                headItem.setRankLab(Number(key) + 1);\r\n                let nameLab=node.getChildByName(\"playname_txt\").getComponent(Label);\r\n                nameLab.node.active=true;\r\n                nameLab.string=top_player_list[key].simple.name;\r\n\r\n\r\n            }\r\n        }\r\n        // this.initStaticView();\r\n        // this.createTopItem();\r\n    }\r\n    on_s2c_WorldBossDataPush(msg: proto.Msg_WorldBossDataPush) {\r\n        this.updateDamageReward();\r\n        this.initMyRank();\r\n        this.requestGetRank();\r\n    }\r\n    on_s2c_WorldBossSweepRsp(msg: proto.Msg_WorldBossSweepRsp) {\r\n        if (!msg.error || msg.error.code == proto.CommonErrorCode.Succeed) {\r\n            this.updateDamageReward();\r\n            this.initMyRank();\r\n            this.requestGetRank();\r\n        }\r\n    }\r\n\r\n    onClikhideView() {\r\n        this.onClose();\r\n        UIMgr.ins.show({ viewName: ViewName.GameplayView })\r\n    }\r\n}"]}