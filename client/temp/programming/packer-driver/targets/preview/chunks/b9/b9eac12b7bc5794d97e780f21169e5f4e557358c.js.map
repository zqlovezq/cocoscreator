{"version":3,"sources":["file:///C:/chickenStarClient/client/assets/scripts/logic/model/fincaFight/FincaFightStageViewHero.ts"],"names":["_decorator","Component","instantiate","Node","Prefab","Toggle","UITransform","Vec2","Vec3","InfiniteList","FincaFightTeamItem","FincaFightTeamToggle","tab","HeroDataControl","FincaFightTeamState","EventMgr","LocalEvent","AmendmentEventLocation","ButtonLock","deepClone","HeroData","Func","FincaBagLayoutCell","FincaFightData","FincaFightControl","ShowTips","LangMgr","ccclass","property","FincaFightStageViewHero","_lineHeroCount","_bagVocationType","HeroClass","HeroClass_Warrior","_touchHeroPos","_bTouch","_list","_curSelectIndex","teamArr","teamPosArr","_moveNode","_tempNode","onLoad","onLocal","Finca_Team_Change","teamHeroChange","node_touch_area","on","EventType","TOUCH_START","onTouchBegan","TOUCH_MOVE","onTouchMoved","TOUCH_END","onTouchEnded","TOUCH_CANCEL","onTouchCancelled","index","teamMembersArray","setData","teamToggleArray","showHeroView","checkEmpty","_emptyIndex","ins","getHeroEmptyIndex","onClickTeamToggle","String","_toggle","node","getComponent","isChecked","HeroToggleIndex","initData","curSelectHero","heroIds","i","length","v","push","getPosition","setVocationToggle","onDestroy","refreshBagData","event","touch_transform","convertToNodeSpaceAR","getUILocation","x","y","boundingBoxArray","areaId","Number","name","heroId","getBoundingBox","contains","console","log","cocosNodeZIndex","touchMovePos","width","height","setPosition","temporaryExchangeHero","endPos","distPos","subtract","dist","emitLocal","cleanTouchInfo","confirmExchangeHero","checkEnterArea","tempNodeIndex","replace","exchangeTeamMember","selectIndex","changeIndex","temp","groupHeroList","result","heroInfo","getById","heroList","getHeroListByVocation","HeroClass_Max","heroClassTable","splice","slice","isInit","list_heros","Init","getCellNumber","getCellCount","bind","getCellSize","getCellHeight","getCellIdentifer","getCellView","getCellData","GetCellData","Refresh","scrollToOffset","pfb_hero_item","idx","switchVocation","vocationType","curIndex","getState","LOCK","vocationToggleNode","children","toggle","vocation","active","getChildByName","clickWarrorBtn","onClickSaveTeam","reqSetFincaBattleHeroIds","getLab"],"mappings":"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","sourcesContent":["import { _decorator, Component, EventTouch, instantiate, Node, Prefab, Sprite, Toggle, UITransform, Vec2, Vec3 } from 'cc';\r\nimport InfiniteList from '../../../Common/InfiniteList/InfiniteList';\r\nimport { FincaFightTeamItem } from './FincaFightTeamItem';\r\nimport { FincaFightTeamToggle } from './FincaFightTeamToggle';\r\nimport { tab } from '../../../Table/table_gen';\r\nimport { HeroDataControl } from '../hero/herobag/HeroDataControl';\r\nimport { FincaFightTeamState } from '../../../Common/script/EnumTypeMgr';\r\nimport { EventMgr } from '../../mgr/EventMgr';\r\nimport { LocalEvent } from '../../define/LocalEvent';\r\nimport { AmendmentEventLocation, ButtonLock, deepClone } from '../../utils/GameUtil';\r\nimport { HeroData } from '../hero/HeroData';\r\nimport { Func } from '../../utils/Func';\r\nimport { FincaBagLayoutCell } from './FincaBagLayoutCell';\r\nimport { FincaFightData } from './FincaFightData';\r\nimport { FincaFightControl } from './FincaFightControl';\r\nimport { ShowTips } from '../../mgr/UIMgr';\r\nimport { LangMgr } from '../../mgr/LangMgr';\r\nconst { ccclass, property } = _decorator;\r\n\r\n@ccclass('FincaFightStageViewHero')\r\nexport class FincaFightStageViewHero extends Component {\r\n    @property(InfiniteList)\r\n    list_heros: InfiniteList = null;\r\n    @property(Prefab)\r\n    pfb_hero_item: Prefab = null;\r\n    @property(Node)\r\n    node_touch_area: Node = null;\r\n    @property(UITransform)\r\n    touch_transform: UITransform = null;\r\n    @property([FincaFightTeamItem])\r\n    teamMembersArray: FincaFightTeamItem[] = [];\r\n    @property([FincaFightTeamToggle])\r\n    teamToggleArray: FincaFightTeamToggle[] = [];\r\n    @property([Node])\r\n    boundingBoxArray: Node[] = [];\r\n    @property(Node)\r\n    vocationToggleNode:Node = null;\r\n\r\n    private _lineHeroCount = 3;\r\n    private _bagVocationType = tab.HeroClass.HeroClass_Warrior;\r\n    private _touchHeroPos: Vec3 = new Vec3();\r\n    private _bTouch: boolean = false;\r\n    private _list = []\r\n    private _curSelectIndex: number = 0;\r\n    private teamArr: number[] = [];\r\n    private teamPosArr: Vec3[] = [];\r\n    private _moveNode: Node = null;\r\n    private _tempNode: Node = null;\r\n    protected onLoad(): void {\r\n        EventMgr.onLocal(LocalEvent.Finca_Team_Change, this.teamHeroChange, this);\r\n        this.node_touch_area.on(Node.EventType.TOUCH_START, this.onTouchBegan, this);\r\n        this.node_touch_area.on(Node.EventType.TOUCH_MOVE, this.onTouchMoved, this);\r\n        this.node_touch_area.on(Node.EventType.TOUCH_END, this.onTouchEnded, this);\r\n        this.node_touch_area.on(Node.EventType.TOUCH_CANCEL, this.onTouchCancelled, this);\r\n    }\r\n    teamHeroChange(index: number) {\r\n        this.teamMembersArray[index - 1].setData(index - 1);\r\n        this.teamToggleArray[index - 1].setData(index - 1);\r\n        this.showHeroView(true);\r\n        // 判断是否还有新的空位自动移到下一个空位\r\n        this.checkEmpty();\r\n    }\r\n    checkEmpty(){\r\n        const _emptyIndex = FincaFightData.ins.getHeroEmptyIndex()\r\n        if (_emptyIndex) {\r\n            this.onClickTeamToggle(null, String(_emptyIndex));\r\n            const _toggle = this.teamToggleArray[_emptyIndex - 1].node.getComponent(Toggle);\r\n            _toggle.isChecked = true;\r\n        }else{\r\n            FincaFightData.ins.HeroToggleIndex = 1;\r\n        }\r\n    }\r\n    initData() {\r\n        this.checkEmpty();\r\n        FincaFightData.ins.curSelectHero = FincaFightData.ins.heroIds[FincaFightData.ins.HeroToggleIndex-1];\r\n        for (let i = 0; i < this.teamMembersArray.length; i++) {\r\n            const v = this.teamMembersArray[i];\r\n            v.setData(i)\r\n            this.teamPosArr.push(v.node.getPosition());\r\n        }\r\n\r\n        for (let i = 0; i < this.teamToggleArray.length; i++) {\r\n            const v = this.teamToggleArray[i];\r\n            v.setData(i)\r\n        }\r\n        this.setVocationToggle();\r\n        this.showHeroView(true);\r\n    }\r\n    protected onDestroy(): void {\r\n        HeroDataControl.ins.refreshBagData(0);\r\n    }\r\n    onTouchBegan(event: EventTouch) {\r\n        this._touchHeroPos = this.touch_transform.convertToNodeSpaceAR(AmendmentEventLocation(new Vec3(event.getUILocation().x, event.getUILocation().y, 0)));\r\n        for (let i = 0; i < this.boundingBoxArray.length; i++) {\r\n            const v = this.boundingBoxArray[i];\r\n            const areaId = Number(v.name);\r\n            const heroId = FincaFightData.ins.heroIds[areaId-1];\r\n            if (heroId && v.getComponent(UITransform).getBoundingBox().contains(new Vec2(this._touchHeroPos.x, this._touchHeroPos.y))) {\r\n                this._bTouch = true;\r\n                this._curSelectIndex = areaId;\r\n                console.log(\"cocos 当前选择的index为=\", this._curSelectIndex);\r\n                this._moveNode = this.teamMembersArray[this._curSelectIndex-1].node;\r\n                Func.cocosNodeZIndex(this._moveNode, 100);\r\n            }\r\n        }\r\n    }\r\n    onTouchMoved(event: EventTouch) {\r\n        if (!this._bTouch) {\r\n            return;\r\n        }\r\n        const touchMovePos = this.touch_transform.convertToNodeSpaceAR(AmendmentEventLocation(new Vec3(event.getUILocation().x, event.getUILocation().y, 0)));\r\n        if (touchMovePos.x > this.touch_transform.width / 2) {\r\n            touchMovePos.x = this.touch_transform.width / 2\r\n        }\r\n        if (touchMovePos.x < -this.touch_transform.width / 2) {\r\n            touchMovePos.x = -this.touch_transform.width / 2\r\n        }\r\n\r\n        if (touchMovePos.y > this.touch_transform.height / 2) {\r\n            touchMovePos.y = this.touch_transform.height / 2\r\n        }\r\n        if (touchMovePos.y < -this.touch_transform.height / 2) {\r\n            touchMovePos.y = -this.touch_transform.height / 2\r\n        }\r\n        this._moveNode.setPosition(touchMovePos);\r\n        this.temporaryExchangeHero();\r\n    }\r\n    onTouchEnded(event: EventTouch) {\r\n        if (!this._bTouch) {\r\n            return;\r\n        }\r\n        console.log(\"cocos 触发 onTouchEnded\")\r\n        const endPos = this.touch_transform.convertToNodeSpaceAR(AmendmentEventLocation(new Vec3(event.getUILocation().x, event.getUILocation().y, 0)));\r\n        // if(this._touchHeroPos.subtract(endPos))\r\n        let distPos = this._touchHeroPos.subtract(endPos)\r\n        let dist = distPos.length();\r\n        console.log(\"cocos向量的长度为-->\",dist);\r\n        this._touchHeroPos = endPos\r\n        if(dist<5){\r\n            // 下阵英雄\r\n            FincaFightData.ins.heroIds[this._curSelectIndex-1] = 0;\r\n            this.teamMembersArray[this._curSelectIndex - 1].node.setPosition(this.teamPosArr[this._curSelectIndex - 1]);\r\n            EventMgr.emitLocal(LocalEvent.Finca_Team_Change,this._curSelectIndex);\r\n            this.cleanTouchInfo();\r\n        }else{\r\n            this.confirmExchangeHero();\r\n        }\r\n    }\r\n    onTouchCancelled(event: EventTouch) {\r\n        console.log(\"cocos 触发 onTouchCancelled\");\r\n        if(this._moveNode){\r\n            this._moveNode.setPosition(this.teamPosArr[this._curSelectIndex - 1]);\r\n        }\r\n        this.cleanTouchInfo();\r\n    }\r\n    // 判断是否进入区域\r\n    checkEnterArea(): number {\r\n        for (let i = 0; i < this.boundingBoxArray.length; i++) {\r\n            const v = this.boundingBoxArray[i];\r\n            const areaId = Number(v.name);\r\n            const heroId = FincaFightData.ins.heroIds[areaId-1];\r\n            if (heroId && areaId !== this._curSelectIndex && v.getComponent(UITransform).getBoundingBox().contains(new Vec2(this._touchHeroPos.x, this._touchHeroPos.y))) {\r\n                return Number(v.name);\r\n            }\r\n        }\r\n        return -1\r\n    }\r\n    // 临时交换英雄的位置\r\n    temporaryExchangeHero() {\r\n        if (this.checkEnterArea() > 0) {\r\n            const v = this.teamMembersArray[this.checkEnterArea() - 1].node;\r\n            if (!this._tempNode) {\r\n                this._tempNode = v;\r\n                this._tempNode.setPosition(this.teamPosArr[this._curSelectIndex - 1])\r\n            }\r\n        }\r\n        else {\r\n            if (this._tempNode) {\r\n                const tempNodeIndex = Number(this._tempNode.name.replace(\"pos_node\", \"\"));\r\n                this._tempNode.setPosition(this.teamPosArr[tempNodeIndex - 1]);\r\n                this._tempNode = null;\r\n            }\r\n        }\r\n    }\r\n    // 最终交换英雄的位置\r\n    confirmExchangeHero() {\r\n        if (this.checkEnterArea() > 0) {\r\n            this.exchangeTeamMember(this._curSelectIndex, this.checkEnterArea());\r\n        } else {\r\n            // 位置没有发生变化\r\n            if (this._tempNode) {\r\n                const tempNodeIndex = Number(this._tempNode.name.replace(\"pos_node\", \"\"));\r\n                this._tempNode.setPosition(this.teamPosArr[tempNodeIndex - 1]);\r\n            }\r\n            this._moveNode.setPosition(this.teamPosArr[this._curSelectIndex - 1]);\r\n        }\r\n        this.cleanTouchInfo();\r\n    }\r\n    /* 最终确认能不能交换 */\r\n    private cleanTouchInfo() {\r\n        this._bTouch = false;\r\n        if (this._moveNode) {\r\n            Func.cocosNodeZIndex(this._moveNode, 0);\r\n        }\r\n        this._curSelectIndex = 0\r\n        this._moveNode = null;\r\n        this._tempNode = null;\r\n    }\r\n    async exchangeTeamMember(selectIndex, changeIndex) {\r\n        console.log(`cocos 当前选择将=${selectIndex}和${changeIndex}互换`);\r\n        let temp = FincaFightData.ins.heroIds[selectIndex - 1];\r\n        FincaFightData.ins.heroIds[selectIndex - 1] = FincaFightData.ins.heroIds[changeIndex - 1];\r\n        FincaFightData.ins.heroIds[changeIndex - 1] = temp;\r\n        console.log(FincaFightData.ins.heroIds);\r\n        this.teamMembersArray[selectIndex - 1].setData(selectIndex - 1);\r\n        this.teamMembersArray[changeIndex - 1].setData(changeIndex - 1);\r\n        this.teamMembersArray[selectIndex - 1].node.setPosition(this.teamPosArr[selectIndex - 1]);\r\n        this.teamMembersArray[changeIndex - 1].node.setPosition(this.teamPosArr[changeIndex - 1]);\r\n    }\r\n    groupHeroList() {\r\n        const result = [];\r\n        let heroInfo = HeroData.ins.getById(HeroDataControl.ins.heroId);\r\n        if (heroInfo) {\r\n            let heroList = deepClone(HeroDataControl.ins.getHeroListByVocation(this._bagVocationType, true));\r\n            if (this._bagVocationType === tab.HeroClass.HeroClass_Max) {\r\n                for (let i = heroList.length - 1; i >= 0; i--) {\r\n                    const heroId = heroList[i];\r\n                    const heroInfo = HeroData.ins.getById(heroId);\r\n                    if (heroInfo.heroClassTable.HeroClass === tab.HeroClass.HeroClass_Warrior) {\r\n                        heroList.splice(i, 1);\r\n                    }\r\n                }\r\n            }\r\n            for (let i = 0; i < heroList.length; i += this._lineHeroCount) {\r\n                result.push(heroList.slice(i, i + this._lineHeroCount));\r\n            }\r\n        }\r\n\r\n        return result;\r\n    }\r\n    showHeroView(isInit: boolean) {\r\n        // 刷新背包列表\r\n        this._list = this.groupHeroList();\r\n        if (isInit) {\r\n            this.list_heros.Init({\r\n                getCellNumber: this.getCellCount.bind(this),\r\n                getCellSize: this.getCellHeight.bind(this),\r\n                getCellIdentifer: this.getCellIdentifer.bind(this),\r\n                getCellView: this.getCellView.bind(this),\r\n                getCellData: this.GetCellData.bind(this),\r\n            });\r\n        } else {\r\n            this.list_heros.Refresh();\r\n        }\r\n        this.list_heros.scrollToOffset(new Vec2(0, 0), 1, true);\r\n    }\r\n    getCellCount() {\r\n        return this._list.length;\r\n    }\r\n    getCellHeight() {\r\n        return 185;\r\n    }\r\n    getCellIdentifer() {\r\n        return \"HeroBagLayoutCell\";\r\n    }\r\n    getCellView() {\r\n        return instantiate(this.pfb_hero_item).getComponent(FincaBagLayoutCell);\r\n    }\r\n    GetCellData(idx: number) {\r\n        return this._list[idx]\r\n    }\r\n    /* 根据职业刷新界面 */\r\n    switchVocation(event: EventTouch, vocationType: string) {\r\n        if (this._bagVocationType == Number(vocationType)) {\r\n            return;\r\n        }\r\n        this._bagVocationType = Number(vocationType);\r\n        let heroList = HeroDataControl.ins.getHeroListByVocation(this._bagVocationType, true);\r\n        HeroDataControl.ins.refreshBagData(heroList[0]);\r\n        this.showHeroView(true);\r\n    }\r\n    onClickTeamToggle(event: EventTouch, curIndex: string) {\r\n        if (FincaFightData.ins.HeroToggleIndex === Number(curIndex)) {\r\n            return\r\n        }\r\n\r\n        if (FincaFightData.ins.getState(Number(curIndex)) === FincaFightTeamState.LOCK) {\r\n            const _toggle = this.teamToggleArray[FincaFightData.ins.HeroToggleIndex - 1].node.getComponent(Toggle);\r\n            _toggle.isChecked = true;\r\n            return;\r\n        }\r\n\r\n        if (Number(curIndex) !== 1) {\r\n            this._bagVocationType = tab.HeroClass.HeroClass_Max;\r\n        } else {\r\n            this._bagVocationType = tab.HeroClass.HeroClass_Warrior\r\n        }\r\n        FincaFightData.ins.HeroToggleIndex = Number(curIndex);\r\n\r\n        this.setVocationToggle();\r\n        this.showHeroView(true);\r\n    }\r\n    // 设置职业toggle\r\n    setVocationToggle() {\r\n        for (let i = 0; i < this.vocationToggleNode.children.length; i++) {\r\n            const toggle = this.vocationToggleNode.children[i];\r\n            const vocation = Number(toggle.name.slice(-1));\r\n            if (this._bagVocationType == tab.HeroClass.HeroClass_Warrior) {\r\n                toggle.active = vocation === tab.HeroClass.HeroClass_Warrior\r\n            } else {\r\n                toggle.active = !(vocation === tab.HeroClass.HeroClass_Warrior);\r\n            }\r\n        }\r\n        const _toggle = this.vocationToggleNode.getChildByName(\"Toggle\" + this._bagVocationType).getComponent(Toggle);\r\n        _toggle.isChecked = true;\r\n    }\r\n    // 点击战士上下阵\r\n    clickWarrorBtn(){\r\n        if(FincaFightData.ins.heroIds[0]){\r\n            FincaFightData.ins.heroIds[0] = 0;\r\n            EventMgr.emitLocal(LocalEvent.Finca_Team_Change,1);\r\n        }else{\r\n            this.onClickTeamToggle(null, String(1));\r\n            const _toggle = this.teamToggleArray[0].node.getComponent(Toggle);\r\n            _toggle.isChecked = true;\r\n        }\r\n    }\r\n    // 请求保存阵容\r\n    @ButtonLock(1, () => { })\r\n    onClickSaveTeam(){\r\n        if (this._bTouch) {\r\n            return;\r\n        }\r\n        if(FincaFightData.ins.heroIds[0]){\r\n            FincaFightControl.ins.reqSetFincaBattleHeroIds(FincaFightData.ins.heroIds);\r\n        }else{\r\n            // 至少上个战士\r\n            ShowTips(LangMgr.getLab(\"Tips_finca_1\"))\r\n        }\r\n    }\r\n}\r\n\r\n\r\n"]}