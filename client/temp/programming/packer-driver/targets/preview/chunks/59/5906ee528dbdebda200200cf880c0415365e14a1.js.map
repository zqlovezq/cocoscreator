{"version":3,"sources":["file:///C:/chickenStarClient/client/assets/scripts/logic/model/association/AssociationMainPop.ts"],"names":["_decorator","Button","instantiate","Label","Node","Prefab","ProgressBar","Sprite","ViewPop","tab","proto","AssociationData","AssociationControl","EventMgr","AssociationPlayerItem","InfiniteList","LangMgr","ccclass","property","AssociationMainPop","guildData","_list","_applyGuide","onShow","openData","rankData","ins","getGuildIsRequest","id","setGuildSimpleInfo","simpleInfo","getAssocitionSimpleInfo","getMemberArr","initList","reqGetGuildDesc","onDestroy","register","onMsg","Ptl","QueryGuildInfoRsp","on_s2c_QueryGuildInfoRsp","unRegister","msg","guild","members","list_view","Init","getCellNumber","getCellCount","bind","getCellSize","getCellHeight","getCellIdentifer","getCellView","getCellData","GetCellData","flagtab","getData","GuildFlagTableById","getValue","flagId","sp_guild_flag","setTexture","IconUrl","lbl_guild_name","string","name","lbl_leader_name","leaderName","lbl_guild_notice","notice","lvData","GuildLevelTableById","level","lbl_guild_member_count","memberCount","MaxCount","nextLvData","lbl_guild_exp","exp","Exp","lbl_guild_lv","String","_progress","bar_guild_exp","progress","node_apply","active","getInGuild","refreshApplyLable","lbl_apply","getLab","getComponent","interactable","grayscale","length","idx","identifer","cell","pfb_item","data","view","onClickEnterGuild","reqJoinGuild"],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAASA,MAAAA,U,OAAAA,U;AAAYC,MAAAA,M,OAAAA,M;AAAmBC,MAAAA,W,OAAAA,W;AAAaC,MAAAA,K,OAAAA,K;AAAOC,MAAAA,I,OAAAA,I;AAAMC,MAAAA,M,OAAAA,M;AAAQC,MAAAA,W,OAAAA,W;AAAaC,MAAAA,M,OAAAA,M;;AAC9EC,MAAAA,O,iBAAAA,O;;AACAC,MAAAA,G,iBAAAA,G;;AACAC,MAAAA,K,oBAAAA,K;;AACAC,MAAAA,e,iBAAAA,e;;AACAC,MAAAA,kB,iBAAAA,kB;;AAEAC,MAAAA,Q,iBAAAA,Q;;AACAC,MAAAA,qB,iBAAAA,qB;;AACFC,MAAAA,Y;;AAEEC,MAAAA,O,iBAAAA,O;;;;;;;;;OACH;AAAEC,QAAAA,OAAF;AAAWC,QAAAA;AAAX,O,GAAwBlB,U;;oCAGjBmB,kB,WADZF,OAAO,CAAC,oBAAD,C,UAEHC,QAAQ,CAACb,MAAD,C,UAERa,QAAQ;AAAA;AAAA,uC,UAGRA,QAAQ,CAACf,KAAD,C,UAERe,QAAQ,CAACf,KAAD,C,UAERe,QAAQ,CAACf,KAAD,C,UAERe,QAAQ,CAACf,KAAD,C,UAERe,QAAQ,CAACf,KAAD,C,UAERe,QAAQ,CAACf,KAAD,C,WAERe,QAAQ,CAACZ,WAAD,C,WAERY,QAAQ,CAACX,MAAD,C,WAERW,QAAQ,CAACd,IAAD,C,WAERc,QAAQ,CAACf,KAAD,C,2BAzBb,MACagB,kBADb;AAAA;AAAA,8BACgD;AAAA;AAAA;;AAAA;;AAAA;;AAAA;;AAOf;AAPe;;AASd;AATc;;AAWb;AAXa;;AAajB;AAbiB;;AAeP;AAfO;;AAiBhB;AAjBgB;;AAAA;;AAqBf;AArBe;;AAAA;;AAAA,eA0BpCC,SA1BoC,GA0BN,IA1BM;AAAA,eA2BpCC,KA3BoC,GA2BN,EA3BM;AAAA,eA4BpCC,WA5BoC,GA4Bd,KA5Bc;AAAA;;AA6B5CC,QAAAA,MAAM,GAAS;AACX,eAAKH,SAAL,GAAiB,KAAKI,QAAL,CAAcC,QAA/B;AACA,eAAKH,WAAL,GAAmB;AAAA;AAAA,kDAAgBI,GAAhB,CAAoBC,iBAApB,CAAsC,KAAKP,SAAL,CAAeQ,EAArD,CAAnB;AACA,eAAKC,kBAAL,GAHW,CAIX;;AAEA,cAAMC,UAAU,GAAG;AAAA;AAAA,kDAAgBJ,GAAhB,CAAoBK,uBAApB,EAAnB;;AACA,cAAGD,UAAU,IAAE,KAAKV,SAAL,CAAeQ,EAAf,KAAoBE,UAAU,CAACF,EAA9C,EAAiD;AAC7C,iBAAKP,KAAL,GAAa;AAAA;AAAA,oDAAgBK,GAAhB,CAAoBM,YAApB,EAAb;AACA,iBAAKC,QAAL;AACH,WAHD,MAGK;AACD;AAAA;AAAA,0DAAmBP,GAAnB,CAAuBQ,eAAvB,CAAuC,KAAKd,SAAL,CAAeQ,EAAtD;AACH;AACJ;;AACSO,QAAAA,SAAS,GAAS;AACxB,gBAAMA,SAAN;AACH;;AACDC,QAAAA,QAAQ,GAAS;AACb;AAAA;AAAA,oCAASC,KAAT,CAAe;AAAA;AAAA,8BAAMC,GAAN,CAAUC,iBAAzB,EAA4C,KAAKC,wBAAjD,EAA2E,IAA3E;AACH;;AACDC,QAAAA,UAAU,GAAS;AACf,gBAAMA,UAAN;AACH;;AACDD,QAAAA,wBAAwB,CAACE,GAAD,EAAkC;AACtD,eAAKrB,KAAL,GAAaqB,GAAG,CAACC,KAAJ,CAAUC,OAAvB;AACA,eAAKX,QAAL;AACH;;AACDA,QAAAA,QAAQ,GAAG;AACP,eAAKY,SAAL,CAAeC,IAAf,CAAoB;AAChBC,YAAAA,aAAa,EAAE,KAAKC,YAAL,CAAkBC,IAAlB,CAAuB,IAAvB,CADC;AAEhBC,YAAAA,WAAW,EAAE,KAAKC,aAAL,CAAmBF,IAAnB,CAAwB,IAAxB,CAFG;AAGhBG,YAAAA,gBAAgB,EAAE,KAAKA,gBAAL,CAAsBH,IAAtB,CAA2B,IAA3B,CAHF;AAIhBI,YAAAA,WAAW,EAAE,KAAKA,WAAL,CAAiBJ,IAAjB,CAAsB,IAAtB,CAJG;AAKhBK,YAAAA,WAAW,EAAE,KAAKC,WAAL,CAAiBN,IAAjB,CAAsB,IAAtB;AALG,WAApB;AAOH;;AACDpB,QAAAA,kBAAkB,GAAG;AACjB,cAAMT,SAAS,GAAG,KAAKA,SAAvB;AACA,cAAMoC,OAAO,GAAG;AAAA;AAAA,0BAAIC,OAAJ,GAAcC,kBAAd,CAAiCC,QAAjC,CAA0CvC,SAAS,CAACwC,MAAV,GAAmBxC,SAAS,CAACwC,MAA7B,GAAsC,CAAhF,CAAhB;AACA,eAAKC,aAAL,CAAmBC,UAAnB,CAA8BN,OAAO,CAACO,OAAtC;AACA,eAAKC,cAAL,CAAoBC,MAApB,GAA6B7C,SAAS,CAAC8C,IAAvC;AACA,eAAKC,eAAL,CAAqBF,MAArB,GAA8B7C,SAAS,CAACgD,UAAxC;AACA,eAAKC,gBAAL,CAAsBJ,MAAtB,GAA+B7C,SAAS,CAACkD,MAAzC;AACA,cAAMC,MAAM,GAAG;AAAA;AAAA,0BAAId,OAAJ,GAAce,mBAAd,CAAkCb,QAAlC,CAA2CvC,SAAS,CAACqD,KAArD,CAAf;AACA,eAAKC,sBAAL,CAA4BT,MAA5B,GAAqC,KAAK7C,SAAL,CAAeuD,WAAf,GAA6B,GAA7B,GAAmCJ,MAAM,CAACK,QAA/E;AACA,cAAMC,UAAU,GAAG;AAAA;AAAA,0BAAIpB,OAAJ,GAAce,mBAAd,CAAkCb,QAAlC,CAA2CvC,SAAS,CAACqD,KAAV,GAAkB,CAA7D,CAAnB;AACA,eAAKK,aAAL,CAAmBb,MAAnB,GAA4B7C,SAAS,CAAC2D,GAAV,GAAgB,GAAhB,IAAuBF,UAAU,GAAGA,UAAU,CAACG,GAAd,GAAoBT,MAAM,CAACS,GAA5D,CAA5B;AACA,eAAKC,YAAL,CAAkBhB,MAAlB,GAA2BiB,MAAM,CAAC9D,SAAS,CAACqD,KAAX,CAAjC;;AACA,cAAMU,SAAS,GAAG/D,SAAS,CAAC2D,GAAV,IAAeF,UAAU,GAAGA,UAAU,CAACG,GAAd,GAAoBT,MAAM,CAACS,GAApD,CAAlB;;AACA,eAAKI,aAAL,CAAmBC,QAAnB,GAA8BF,SAAS,GAAC,CAAV,GAAY,CAAZ,GAAcA,SAA5C;AACA,eAAKG,UAAL,CAAgBC,MAAhB,GAAyB,CAAC;AAAA;AAAA,kDAAgB7D,GAAhB,CAAoB8D,UAApB,EAA1B;AACA,eAAKC,iBAAL;AACH;;AACDA,QAAAA,iBAAiB,GAAE;AACf,eAAKC,SAAL,CAAezB,MAAf,GAAwB,KAAK3C,WAAL,GAAiB;AAAA;AAAA,kCAAQqE,MAAR,CAAe,kBAAf,CAAjB,GAAoD;AAAA;AAAA,kCAAQA,MAAR,CAAe,kBAAf,CAA5E;AACA,eAAKL,UAAL,CAAgBM,YAAhB,CAA6B3F,MAA7B,EAAqC4F,YAArC,GAAoD,CAAC,KAAKvE,WAA1D;AACA,eAAKgE,UAAL,CAAgBM,YAAhB,CAA6BrF,MAA7B,EAAqCuF,SAArC,GAAiD,KAAKxE,WAAtD;AACH;;AACD0B,QAAAA,YAAY,GAAG;AACX,iBAAO,KAAK3B,KAAL,CAAW0E,MAAlB;AACH;;AACD5C,QAAAA,aAAa,CAAC6C,GAAD,EAAc;AACvB,iBAAO,GAAP;AACH;;AACD5C,QAAAA,gBAAgB,CAAC4C,GAAD,EAAc;AAC1B,iBAAO,uBAAP;AACH;;AACD3C,QAAAA,WAAW,CAAC2C,GAAD,EAAcC,SAAd,EAAiC;AACxC,cAAIC,IAAI,GAAGhG,WAAW,CAAC,KAAKiG,QAAN,CAAX,CAA2BP,YAA3B;AAAA;AAAA,6DAAX;AACA,iBAAOM,IAAP;AACH;;AACD3C,QAAAA,WAAW,CAACyC,GAAD,EAAc;AACrB,iBAAO;AAAEI,YAAAA,IAAI,EAAE,KAAK/E,KAAL,CAAW2E,GAAX,CAAR;AAAyBK,YAAAA,IAAI,EAAE,IAA/B;AAAqCjF,YAAAA,SAAS,EAAC,KAAKA;AAApD,WAAP;AACH;AACD;;;AACAkF,QAAAA,iBAAiB,GAAE;AACf;AAAA;AAAA,wDAAmB5E,GAAnB,CAAuB6E,YAAvB,CAAoC,KAAKnF,SAAL,CAAeQ,EAAnD;AACA,eAAKN,WAAL,GAAmB,IAAnB;AACA,eAAKmE,iBAAL;AACH;;AA5G2C,O;;;;;iBAEzB,I;;;;;;;iBAEO,I;;;;;;;iBAGF,I;;;;;;;iBAEC,I;;;;;;;iBAEC,I;;;;;;;iBAEJ,I;;;;;;;iBAEU,I;;;;;;;iBAET,I;;;;;;;iBAEK,I;;;;;;;iBAEJ,I;;;;;;;iBAEN,I;;;;;;;iBAEA,I","sourcesContent":["import { _decorator, Button, Component, instantiate, Label, Node, Prefab, ProgressBar, Sprite } from 'cc';\r\nimport { ViewPop } from '../../../framework/base/ViewPop';\r\nimport { tab } from '../../../Table/table_gen';\r\nimport { proto } from 'client_protocol';\r\nimport { AssociationData } from './AssociationData';\r\nimport { AssociationControl } from './AssociationControl';\r\nimport { RANKING_TYPE } from '../../../Common/script/EnumTypeMgr';\r\nimport { EventMgr } from '../../mgr/EventMgr';\r\nimport { AssociationPlayerItem } from './AssociationPlayerItem';\r\nimport InfiniteList from '../../../Common/InfiniteList/InfiniteList';\r\nimport { RoleData } from '../role/RoleData';\r\nimport { LangMgr } from '../../mgr/LangMgr';\r\nconst { ccclass, property } = _decorator;\r\n\r\n@ccclass('AssociationMainPop')\r\nexport class AssociationMainPop extends ViewPop {\r\n    @property(Prefab)\r\n    pfb_item: Prefab = null;\r\n    @property(InfiniteList)\r\n    list_view: InfiniteList = null;\r\n\r\n    @property(Label)\r\n    lbl_guild_name: Label = null;//公会名字\r\n    @property(Label)\r\n    lbl_leader_name: Label = null;//公会舰长名字\r\n    @property(Label)\r\n    lbl_guild_notice: Label = null;//公会公告\r\n    @property(Label)\r\n    lbl_guild_lv: Label = null;//公会等级\r\n    @property(Label)\r\n    lbl_guild_member_count: Label = null;//公会成员数量\r\n    @property(Label)\r\n    lbl_guild_exp: Label = null;//公会成员数量\r\n    @property(ProgressBar)\r\n    bar_guild_exp:ProgressBar = null;\r\n    @property(Sprite)\r\n    sp_guild_flag: Sprite = null;//公会旗帜\r\n    @property(Node)\r\n    node_apply:Node = null;\r\n    @property(Label)\r\n    lbl_apply:Label = null;\r\n    private guildData:proto.SimpleGuild = null;\r\n    private _list: proto.IGuildMember[] = [];\r\n    private _applyGuide:boolean = false;\r\n    onShow(): void {\r\n        this.guildData = this.openData.rankData;\r\n        this._applyGuide = AssociationData.ins.getGuildIsRequest(this.guildData.id)\r\n        this.setGuildSimpleInfo();\r\n        // 获取公会信息\r\n\r\n        const simpleInfo = AssociationData.ins.getAssocitionSimpleInfo()\r\n        if(simpleInfo&&this.guildData.id===simpleInfo.id){\r\n            this._list = AssociationData.ins.getMemberArr();\r\n            this.initList();\r\n        }else{\r\n            AssociationControl.ins.reqGetGuildDesc(this.guildData.id);\r\n        }\r\n    }\r\n    protected onDestroy(): void {\r\n        super.onDestroy()\r\n    }\r\n    register(): void {\r\n        EventMgr.onMsg(proto.Ptl.QueryGuildInfoRsp, this.on_s2c_QueryGuildInfoRsp, this);\r\n    }\r\n    unRegister(): void {\r\n        super.unRegister();\r\n    }\r\n    on_s2c_QueryGuildInfoRsp(msg: proto.Msg_QueryGuildInfoRsp){\r\n        this._list = msg.guild.members;\r\n        this.initList();\r\n    }\r\n    initList() {\r\n        this.list_view.Init({\r\n            getCellNumber: this.getCellCount.bind(this),\r\n            getCellSize: this.getCellHeight.bind(this),\r\n            getCellIdentifer: this.getCellIdentifer.bind(this),\r\n            getCellView: this.getCellView.bind(this),\r\n            getCellData: this.GetCellData.bind(this),\r\n        });\r\n    }\r\n    setGuildSimpleInfo() {\r\n        const guildData = this.guildData\r\n        const flagtab = tab.getData().GuildFlagTableById.getValue(guildData.flagId ? guildData.flagId : 1);\r\n        this.sp_guild_flag.setTexture(flagtab.IconUrl);\r\n        this.lbl_guild_name.string = guildData.name;\r\n        this.lbl_leader_name.string = guildData.leaderName;\r\n        this.lbl_guild_notice.string = guildData.notice;\r\n        const lvData = tab.getData().GuildLevelTableById.getValue(guildData.level)\r\n        this.lbl_guild_member_count.string = this.guildData.memberCount + \"/\" + lvData.MaxCount;\r\n        const nextLvData = tab.getData().GuildLevelTableById.getValue(guildData.level + 1)\r\n        this.lbl_guild_exp.string = guildData.exp + \"/\" + (nextLvData ? nextLvData.Exp : lvData.Exp);\r\n        this.lbl_guild_lv.string = String(guildData.level);\r\n        const _progress = guildData.exp/(nextLvData ? nextLvData.Exp : lvData.Exp)\r\n        this.bar_guild_exp.progress = _progress>1?1:_progress;\r\n        this.node_apply.active = !AssociationData.ins.getInGuild();\r\n        this.refreshApplyLable();\r\n    }\r\n    refreshApplyLable(){\r\n        this.lbl_apply.string = this._applyGuide?LangMgr.getLab(\"ui_association_8\"):LangMgr.getLab(\"ui_association_7\");\r\n        this.node_apply.getComponent(Button).interactable = !this._applyGuide;\r\n        this.node_apply.getComponent(Sprite).grayscale = this._applyGuide;\r\n    }\r\n    getCellCount() {\r\n        return this._list.length\r\n    }\r\n    getCellHeight(idx: number) {\r\n        return 120\r\n    }\r\n    getCellIdentifer(idx: number) {\r\n        return \"AssociationPlayerItem\";\r\n    }\r\n    getCellView(idx: number, identifer: string) {\r\n        let cell = instantiate(this.pfb_item).getComponent(AssociationPlayerItem);\r\n        return cell;\r\n    }\r\n    GetCellData(idx: number) {\r\n        return { data: this._list[idx], view: this ,guildData:this.guildData};\r\n    }\r\n    /* 申请加入公会 */\r\n    onClickEnterGuild(){\r\n        AssociationControl.ins.reqJoinGuild(this.guildData.id)\r\n        this._applyGuide = true;\r\n        this.refreshApplyLable();\r\n    }\r\n}\r\n\r\n\r\n"]}