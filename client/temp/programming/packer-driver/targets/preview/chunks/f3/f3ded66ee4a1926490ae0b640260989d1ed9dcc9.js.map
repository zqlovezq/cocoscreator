{"version":3,"sources":["file:///C:/chickenStarClient/client/assets/scripts/logic/model/item/ForceUpPop.ts"],"names":["_decorator","Label","tween","Animation","ViewPop","GameUtil","ccclass","property","ForceUpPop","ForceObj","value","tweenAction","onShow","openData","node","active","power","anim_force","play","increaseBattlePower","duration1","duration2","initialPower","finalPower","addPower","increaseAmount1","increaseAmount2","action1","to","progress","start","end","current","ratio","currentValue","updateBattlePower","action2","then","call","delay","lbl_power","string","convertNumber","Math","floor","lab_add","update","dt","onDestroy","stop","register","unRegister"],"mappings":"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","sourcesContent":["import { _decorator, Component, Label, Node, tween, Animation } from 'cc';\r\nimport { ViewPop } from '../../../framework/base/ViewPop';\r\nimport { GameUtil } from '../../utils/GameUtil';\r\nconst { ccclass, property } = _decorator;\r\n\r\n@ccclass('ForceUpPop')\r\nexport class ForceUpPop extends ViewPop {\r\n    @property(Label)\r\n    lab_add: Label = null;\r\n    @property(Label)\r\n    lbl_power: Label = null;\r\n    @property(Animation)\r\n    anim_force: Animation = null;\r\n    private ForceObj = { value: 0 }\r\n    private tweenAction = null;\r\n    onShow(): void {\r\n        if (!this.openData) {\r\n            return;\r\n        }\r\n        this.node.active = true;\r\n        this.ForceObj = {\r\n            value: this.openData.power\r\n        }\r\n        this.anim_force.play();\r\n        this.increaseBattlePower();\r\n    }\r\n    increaseBattlePower() {\r\n        let duration1 = 0.6; // 前1秒\r\n        let duration2 = 1.2; // 后0.6秒\r\n\r\n        let initialPower = this.openData.power;\r\n        let finalPower = this.openData.power + this.openData.addPower;\r\n\r\n        let increaseAmount1 = this.openData.addPower * 0.9; // 提升90%的战斗力\r\n        let increaseAmount2 = this.openData.addPower * 0.1; // 提升10%的战斗力\r\n        // 第一个动作，1秒内提升90%的战斗力\r\n        let action1 = tween().to(duration1, { value: initialPower + increaseAmount1 }, {\r\n            progress: (start, end, current, ratio) => {\r\n                const currentValue = start + ratio * (end - start);\r\n                this.updateBattlePower(currentValue);\r\n                return current;\r\n            }\r\n        });\r\n        // // 第二个动作，0.6秒内提升剩余的10%的战斗力\r\n        let action2 = tween().to(duration2, { value: finalPower }, {\r\n            progress: (start, end, current, ratio) => {\r\n                const currentValue = start + ratio * (end - start);\r\n                this.updateBattlePower(currentValue);\r\n                return current;\r\n            }\r\n        });\r\n\r\n        // // 序列动作\r\n        this.tweenAction = tween(this.ForceObj)\r\n            .then(action1)\r\n            .call(() => {\r\n                this.ForceObj.value = initialPower + increaseAmount1\r\n            })\r\n            .then(action2)\r\n            .delay(1)\r\n            .call(() => {\r\n                this.node.active = false;\r\n            })\r\n            .start();\r\n    }\r\n    updateBattlePower(value) {\r\n        let finalPower = this.openData.power + this.openData.addPower;\r\n        this.lbl_power.string = GameUtil.convertNumber(Math.floor(value));\r\n        this.lab_add.string = GameUtil.convertNumber(Math.floor(finalPower - value));\r\n    }\r\n    protected update(dt: number): void {\r\n\r\n\r\n    }\r\n    protected onDestroy(): void {\r\n        super.onDestroy()\r\n        this.tweenAction.stop();\r\n    }\r\n    register(): void {\r\n\r\n    }\r\n    unRegister(): void {\r\n        super.unRegister();\r\n    }\r\n}\r\n\r\n\r\n"]}