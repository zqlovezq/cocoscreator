{"version":3,"sources":["file:///C:/chickenStarClient/client/assets/scripts/logic/model/mutation/PaintingLvupPop.ts"],"names":["_decorator","Button","Label","Node","sp","Sprite","ViewPop","tab","HeroDataControl","EventMgr","proto","HeroTeamControl","Net","HeroStar","LangMgr","createAnimation","ccclass","property","PaintingLvupPop","Skeleton","_heroTab","register","onMsg","Ptl","UpgradeScrollPaintingStarRsp","on_s2c_UpgradeScrollPaintingStarRsp","msg","refreshView","onShow","heroId","openData","getData","HeroTableById","getValue","itemTab","ItemTableById","lbl_name","string","getLab","Name","ske_hero","node","Idle","aptitude","Aptitude","activeStar","ins","paintingActive","get","Id","star","nextStar","curData","nextData","getPaintingAttr","values","nextPainting","lbl_atk_cur","String","lbl_hp_cur","lbl_def_cur","maxStar","getMaxPaintingStar","btn_star_up","interactable","getComponent","grayscale","node_cur_star","showStar","node_max","active","node_lv_up","lbl_atk_next","lbl_hp_next","lbl_def_next","node_next_star","lbl_atk_max","lbl_hp_max","lbl_def_max","node_max_star","onDisable","clickLevelUp","Msg_UpgradeScrollPaintingStarReq","heroItemId","Send","UpgradeScrollPaintingStarReq"],"mappings":"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","sourcesContent":["import { _decorator, Button, Component, Label, log, Node, sp, Sprite } from 'cc';\r\nimport { ViewPop } from '../../../framework/base/ViewPop';\r\nimport { tab } from '../../../Table/table_gen';\r\nimport { HeroDataControl } from '../hero/herobag/HeroDataControl';\r\nimport { EventMgr } from '../../mgr/EventMgr';\r\nimport { proto } from 'client_protocol';\r\nimport { HeroTeamControl } from '../hero/HeroTeamControl';\r\nimport { Net } from '../../net/Net';\r\nimport { HeroStar } from '../hero/HeroStar';\r\nimport { LangMgr } from '../../mgr/LangMgr';\r\nimport { createAnimation } from '../../utils/GameUtil';\r\nconst { ccclass, property } = _decorator;\r\n\r\n@ccclass('PaintingLvupPop')\r\nexport class PaintingLvupPop extends ViewPop {\r\n    @property(Label)\r\n    lbl_atk_cur: Label = null;\r\n    @property(Label)\r\n    lbl_hp_cur: Label = null;\r\n    @property(Label)\r\n    lbl_def_cur: Label = null;\r\n\r\n    @property(Label)\r\n    lbl_atk_next: Label = null;\r\n    @property(Label)\r\n    lbl_hp_next: Label = null;\r\n    @property(Label)\r\n    lbl_def_next: Label = null;\r\n\r\n    @property(Label)\r\n    lbl_atk_max: Label = null;\r\n    @property(Label)\r\n    lbl_hp_max: Label = null;\r\n    @property(Label)\r\n    lbl_def_max: Label = null;\r\n\r\n    @property(Node)\r\n    node_lv_up:Node = null;\r\n    @property(Node)\r\n    node_max:Node = null;\r\n\r\n    @property(Button)\r\n    btn_star_up: Button = null;\r\n\r\n    @property(sp.Skeleton)\r\n    ske_hero: sp.Skeleton = null;\r\n    \r\n    @property(Label)\r\n    lbl_name = null;\r\n    @property(Node)\r\n    node_cur_star:Node = null;\r\n    @property(Node)\r\n    node_next_star:Node = null;\r\n    @property(Node)\r\n    node_max_star:Node = null;\r\n    private _heroTab: tab.HeroTable = null;\r\n    register(): void {\r\n        EventMgr.onMsg(proto.Ptl.UpgradeScrollPaintingStarRsp, this.on_s2c_UpgradeScrollPaintingStarRsp, this);\r\n    }\r\n    on_s2c_UpgradeScrollPaintingStarRsp(msg: proto.Msg_UpgradeScrollPaintingStarRsp) {\r\n        this.refreshView();\r\n    }\r\n    onShow(): void {\r\n        const heroId = this.openData.heroId;\r\n        this._heroTab = tab.getData().HeroTableById.getValue(heroId);\r\n        let itemTab = tab.getData().ItemTableById.getValue(heroId);\r\n        // this.sp_icon.setTexture(itemTab.Icon);\r\n        this.lbl_name.string = LangMgr.getLab(itemTab.Name);\r\n        this.refreshView();\r\n        createAnimation(this.ske_hero.node,this._heroTab.Idle);\r\n    }\r\n    refreshView() {\r\n        const aptitude = this._heroTab.Aptitude;\r\n        const activeStar = HeroDataControl.ins.paintingActive.get(this._heroTab.Id);\r\n        let star = activeStar ? activeStar : 0\r\n        let nextStar = 5;\r\n        let curData = null;\r\n        let nextData = null;\r\n        if (activeStar) {\r\n            // 升级\r\n            star = activeStar;\r\n            nextStar = activeStar+1;\r\n            curData = HeroTeamControl.ins.getPaintingAttr(aptitude, star).values\r\n            const nextPainting = HeroTeamControl.ins.getPaintingAttr(aptitude, star + 1)\r\n            if(nextPainting){\r\n                nextData = nextPainting.values\r\n            }\r\n        } else {\r\n            // 激活\r\n            curData = [0, 0, 0]\r\n            nextData = HeroTeamControl.ins.getPaintingAttr(aptitude, 5).values\r\n        }\r\n        this.lbl_atk_cur.string = String(curData[0]);\r\n        this.lbl_hp_cur.string = String(curData[1]);\r\n        this.lbl_def_cur.string = String(curData[2]);\r\n\r\n        const maxStar = HeroDataControl.ins.getMaxPaintingStar(this._heroTab.Id);\r\n        this.btn_star_up.interactable = maxStar && maxStar > star;\r\n        this.btn_star_up.node.getComponent(Sprite).grayscale = !this.btn_star_up.interactable;\r\n        this.node_cur_star.getComponent(HeroStar).showStar(star==0?5:star);\r\n\r\n        if(nextData){\r\n            this.node_max.active = false;\r\n            this.node_lv_up.active = true;\r\n            this.lbl_atk_next.string = String(nextData[0]);\r\n            this.lbl_hp_next.string = String(nextData[1]);\r\n            this.lbl_def_next.string = String(nextData[2]);\r\n            this.node_next_star.getComponent(HeroStar).showStar(nextStar);\r\n        }else{\r\n            this.node_max.active = true;\r\n            this.node_lv_up.active = false;\r\n            this.lbl_atk_max.string = String(curData[0]);\r\n            this.lbl_hp_max.string = String(curData[1]);\r\n            this.lbl_def_max.string = String(curData[2]);\r\n            this.node_max_star.getComponent(HeroStar).showStar(star==0?5:star);\r\n        }\r\n    }\r\n    protected onDisable(): void {\r\n        this.node_cur_star.getComponent(HeroStar).onDisable();\r\n        this.node_next_star.getComponent(HeroStar).onDisable();\r\n        this.node_max_star.getComponent(HeroStar).onDisable();\r\n    }\r\n    clickLevelUp() {\r\n        let msg = new proto.Msg_UpgradeScrollPaintingStarReq();\r\n        msg.heroItemId = this._heroTab.Id;\r\n        Net.Send(proto.Ptl.UpgradeScrollPaintingStarReq, msg)\r\n    }\r\n}\r\n\r\n\r\n"]}