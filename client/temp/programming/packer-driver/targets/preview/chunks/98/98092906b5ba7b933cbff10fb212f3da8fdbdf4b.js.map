{"version":3,"sources":["file:///C:/chickenStarClient/client/assets/scripts/logic/model/rareBook/StarUpPop.ts"],"names":["_decorator","instantiate","Label","Node","Prefab","ViewPop","RareBookSmallItem","HeroStar","RareBookData","LangMgr","RareBookStarUpItem","HeroSkillItem","tab","ccclass","property","StarUpPop","info","heroInfo","register","onShow","openData","initBook","initHero","node_hero","active","node_rare_book","node_awake_up","rareBookSmallItem","initView","lastTab","ins","getBoolStarTable","itemId","star","effectLab","string","getLab","bookStarTable","Description","lastStar","showStar","currStar","attrMap","ratio","levelRatio","lastAttrMap","getAttrMapByLevelRatio","AttrType","AttrValue","forEach","value","key","item","itemPrefab","parent","attributeLayout","getComponent","get","starUpTab","heroStarUpTable","itemList","hero_skill_item","hero_skill_item1","index","node","DescType","length","_type","initData","getChildByPath","StarName","StarDesc","lastStarUpTab","getData","HeroStarUpTableById","getValue","Id","lbl_last_level","String","MaxLevel","lbl_next_level","HeroStarDescType","HeroStarDescType_Third","node_star_up","HeroStarDescType_Second","onDisable"],"mappings":"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","sourcesContent":["import { _decorator, Component, instantiate, Label, Node, Prefab } from 'cc';\r\nimport { ViewPop } from '../../../framework/base/ViewPop';\r\nimport { RareBookSmallItem } from './RareBookSmallItem';\r\nimport { HeroStar } from '../hero/HeroStar';\r\nimport { RareBookInfo } from './RareBookInfo';\r\nimport { RareBookData } from './RareBookData';\r\nimport { LangMgr } from '../../mgr/LangMgr';\r\nimport { RareBookStarUpItem } from './RareBookStarUpItem';\r\nimport { HeroInfo } from '../hero/HeroInfo';\r\nimport { HeroSkillItem } from '../hero/herobag/HeroSkillItem';\r\nimport { tab } from '../../../Table/table_gen';\r\nconst { ccclass, property } = _decorator;\r\n\r\n/**\r\n * \r\n * StarUpPop\r\n * zhudingchao\r\n * Fri May 31 2024 10:34:45 GMT+0800 (中国标准时间)\r\n * db://assets/scripts/logic/model/rareBook/StarUpPop.ts\r\n *\r\n */\r\n\r\n@ccclass('StarUpPop')\r\nexport class StarUpPop extends ViewPop {\r\n    @property(Node)\r\n    attributeLayout: Node = null;\r\n    @property(RareBookSmallItem)\r\n    rareBookSmallItem: RareBookSmallItem = null;\r\n    @property(Label)\r\n    effectLab: Label = null;\r\n    @property(HeroStar)\r\n    lastStar: HeroStar = null;\r\n    @property(HeroStar)\r\n    currStar: HeroStar = null;\r\n    @property(Prefab)\r\n    itemPrefab: Prefab = null;\r\n    @property(Node)\r\n    node_rare_book:Node = null;\r\n    @property(Node)\r\n    node_hero:Node = null;\r\n    @property(HeroSkillItem)\r\n    hero_skill_item:HeroSkillItem = null;\r\n    @property(HeroSkillItem)\r\n    hero_skill_item1:HeroSkillItem = null;\r\n    @property(Label)\r\n    lbl_desc:Label = null;\r\n\r\n    @property(Label)\r\n    lbl_last_level:Label = null;\r\n\r\n    @property(Label)\r\n    lbl_next_level:Label = null;\r\n    @property(Node)\r\n    node_star_up:Node = null;\r\n    @property(Node)\r\n    node_awake_up:Node = null;\r\n\r\n    private info: RareBookInfo;\r\n    private heroInfo:HeroInfo;\r\n    register(): void {\r\n\r\n    }\r\n    onShow(): void {\r\n        this.info = this.openData[\"bookInfo\"];\r\n        this.heroInfo = this.openData[\"heroInfo\"];\r\n        if(this.info){\r\n            this.initBook();\r\n        }\r\n        if(this.heroInfo){\r\n            this.initHero();\r\n        }\r\n    }\r\n    initBook() {\r\n        this.node_hero.active = false;\r\n        this.node_rare_book.active = true;\r\n        this.node_awake_up.active = false;\r\n        this.rareBookSmallItem.initView(this.info, false);\r\n        let lastTab = RareBookData.ins.getBoolStarTable(this.info.itemId, this.info.star-1);\r\n        this.effectLab.string = LangMgr.getLab(this.info.bookStarTable.Description);\r\n        this.lastStar.showStar(this.info.star - 1);\r\n        this.currStar.showStar(this.info.star);\r\n        let attrMap = this.info.attrMap;\r\n        let ratio = this.info.levelRatio;\r\n        let lastAttrMap = this.info.getAttrMapByLevelRatio(ratio, lastTab.AttrType, lastTab.AttrValue);\r\n        attrMap.forEach((value, key) => {\r\n            let item = instantiate(this.itemPrefab)\r\n            item.parent = this.attributeLayout;\r\n            item.getComponent(RareBookStarUpItem).initView(key, lastAttrMap.get(key), value);\r\n            // item.initView(key, value, nextAttrMap.get(key));\r\n            // index++;\r\n        });\r\n    }\r\n    initHero(){\r\n        this.node_hero.active = true;\r\n        this.node_rare_book.active = false;\r\n        this.lastStar.showStar(this.heroInfo.star - 1);\r\n        this.currStar.showStar(this.heroInfo.star);\r\n        const starUpTab:tab.HeroStarUpTable = this.heroInfo.heroStarUpTable;\r\n\r\n        let itemList = [this.hero_skill_item,this.hero_skill_item1]\r\n        itemList.forEach((item,index) => {\r\n            item.node.parent.active = false\r\n        })\r\n\r\n        for (let index = 0; index < starUpTab.DescType.length; index++) {\r\n            const _type = starUpTab.DescType[index];\r\n            let item = itemList[index]\r\n            item.node.parent.active = true\r\n            item.initData(_type,this.heroInfo)\r\n\r\n            item.node.parent.getChildByPath(\"show_node/Label\").getComponent(Label).string = LangMgr.getLab(starUpTab.StarName[index]);\r\n            item.node.parent.getChildByPath(\"show_node/effect_txt\").getComponent(Label).string = LangMgr.getLab(starUpTab.StarDesc[index]);\r\n        }\r\n\r\n        // this.hero_skill_item.initData(starUpTab.DescType[starUpTab.HeroStar], this.heroInfo);\r\n        // this.lbl_desc.string = LangMgr.getLab(starUpTab.StarDesc[starUpTab.HeroStar]);\r\n\r\n        const lastStarUpTab = tab.getData().HeroStarUpTableById.getValue(starUpTab.Id-1);\r\n        this.lbl_last_level.string = String(lastStarUpTab.MaxLevel);\r\n        this.lbl_next_level.string = String(starUpTab.MaxLevel);\r\n        this.node_awake_up.active = starUpTab.DescType[0]===tab.HeroStarDescType.HeroStarDescType_Third\r\n        this.node_star_up.active = starUpTab.DescType[0]===tab.HeroStarDescType.HeroStarDescType_Second\r\n    }\r\n    protected onDisable(): void {\r\n        this.lastStar.onDisable();\r\n        this.currStar.onDisable();\r\n    }\r\n}"]}