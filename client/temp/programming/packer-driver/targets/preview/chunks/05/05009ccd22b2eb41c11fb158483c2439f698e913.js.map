{"version":3,"sources":["file:///C:/chickenStarClient/client/assets/scripts/logic/model/activity/rookieTask/RookieShopItem.ts"],"names":["_decorator","Component","Label","Node","Sprite","Vec3","dailyBuyShop","tab","ItemInfo","ItemPoolMgr","PayControl","proto","Net","MallDataMgr","ChannelMgr","ccclass","property","RookieShopItem","_CostItemId","_CostItemNum","_trialId","_mallData","_rechargeId","boughtCount","initData","data","id","node_content","destroyAllChildren","node_diamonds","active","node_free","node_RMB","ins","getFixedShopData","MallId","get","Id","lbl_limit","string","String","LimitCount","node_got","awards","GetItemIds","awardNums","GetItemNum","firstAward","firstAwardNum","otherAward","otherAwardNums","i","length","push","firstInfo","itemId","num","createRewadItem","node_first_item","setPosition","awardInfo","CostType","MallCostType","MallCostType_CostItem","CostItemIds","CostItemNum","lbl_diamond","MallCostType_Recharge","RechargeId","rechargeTab","getData","RechargeTableById","getValue","lbl_price","getSdkRechargeShowPrice","IconUrl","sp_chaozhi","node","setTexture","clickBuy","console","log","sendMsg","msg","Msg_BuyFixedShopCommodityReq","commodityId","Send","Ptl","BuyFixedShopCommodityReq","clickRMB","self","requestPay","set"],"mappings":"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","sourcesContent":["import { _decorator, Component, Label, Node, Sprite, Vec3 } from 'cc';\r\nimport InfiniteCell from '../../../../Common/InfiniteList/InfiniteCell';\r\nimport { dailyBuyShop } from '../../../utils/GameUtil';\r\nimport { tab } from '../../../../Table/table_gen';\r\nimport { ItemInfo } from '../../item/ItemInfo';\r\nimport { ItemPoolMgr } from '../../item/ItemPoolMgr';\r\nimport { PayControl } from '../../pay/PayControl';\r\nimport { proto } from 'client_protocol';\r\nimport { Net } from '../../../net/Net';\r\nimport { MallDataMgr } from '../../shop/MallDataMgr';\r\nimport { LangMgr } from '../../../mgr/LangMgr';\r\nimport { ChannelMgr } from '../../../../channel/ChannelMgr';\r\nconst { ccclass, property } = _decorator;\r\n\r\n@ccclass('RookieShopItem')\r\nexport class RookieShopItem extends Component {\r\n    @property(Node)\r\n    node_first_item: Node = null;\r\n    @property(Node)\r\n    node_content:Node = null;\r\n    @property(Node)\r\n    node_diamonds:Node = null;\r\n    @property(Node)\r\n    node_free:Node = null;\r\n    @property(Node)\r\n    node_RMB:Node = null;\r\n    @property(Node)\r\n    node_got:Node = null;\r\n    @property(Label)\r\n    lbl_price:Label = null;\r\n    @property(Label)\r\n    lbl_limit:Label = null;\r\n    @property(Label)\r\n    lbl_diamond:Label = null;\r\n    @property(Sprite)\r\n    sp_chaozhi: Sprite = null;\r\n    private _CostItemId:number = 0;\r\n    private _CostItemNum:number = 0;\r\n    // private _GetItemId:number = 0;\r\n    // private _GetItemNum:number = 0;\r\n    private _trialId: number = 0;\r\n    private _mallData:tab.MallItemTabe = null;\r\n    private _rechargeId:number = 0;\r\n    private boughtCount:number = 0;\r\n    initData(data: tab.MallItemTabe,id:number): void {\r\n        this._trialId = id;\r\n        this._mallData = data;\r\n        this.node_content.destroyAllChildren();\r\n        this.node_diamonds.active = false;\r\n        this.node_free.active = false;\r\n        this.node_RMB.active = false;\r\n        this.boughtCount = MallDataMgr.ins.getFixedShopData(this._mallData.MallId).get(this._mallData.Id);\r\n        this.lbl_limit.string = String(this._mallData.LimitCount-this.boughtCount);\r\n        this.node_got.active = this.boughtCount>=this._mallData.LimitCount;\r\n\r\n        const awards = this._mallData.GetItemIds;\r\n        const awardNums = this._mallData.GetItemNum;\r\n        const firstAward = awards[0];\r\n        const firstAwardNum = awardNums[0];\r\n        const otherAward = [];\r\n        const otherAwardNums = [];\r\n        for (let i = 1; i < awards.length; i++) {\r\n            otherAward.push(awards[i]);\r\n            otherAwardNums.push(awardNums[i]);\r\n        }\r\n        const firstInfo = new ItemInfo();\r\n        firstInfo.itemId = firstAward;\r\n        firstInfo.num = firstAwardNum;\r\n        ItemPoolMgr.ins.createRewadItem(firstInfo, this.node_first_item);\r\n        if (otherAward.length === 0) {\r\n            this.node_first_item.setPosition(new Vec3(0, -100, 0));\r\n        }\r\n        this.node_content.destroyAllChildren();\r\n        for (let i = 0; i < otherAward.length; i++) {\r\n            const awardInfo = new ItemInfo();\r\n            awardInfo.itemId = otherAward[i];\r\n            awardInfo.num = otherAwardNums[i];\r\n            ItemPoolMgr.ins.createRewadItem(awardInfo, this.node_content);\r\n        }\r\n\r\n        if(this._mallData.CostType==tab.MallCostType.MallCostType_CostItem){\r\n            // 钻石购买\r\n            if(this._mallData.CostItemIds[0]){\r\n                this.node_diamonds.active = true;\r\n                this._CostItemId = this._mallData.CostItemIds[0];\r\n                this._CostItemNum = this._mallData.CostItemNum[0];\r\n                this.lbl_diamond.string = String(this._CostItemNum);\r\n            }else{\r\n                this.node_free.active = true;\r\n                this._CostItemId = 0;\r\n                this._CostItemNum = 0;\r\n            }\r\n        }else if(this._mallData.CostType==tab.MallCostType.MallCostType_Recharge){\r\n            // 充值购买\r\n            this.node_RMB.active = true;\r\n            this._rechargeId = this._mallData.RechargeId;\r\n            const rechargeTab = tab.getData().RechargeTableById.getValue(this._rechargeId);\r\n            this.lbl_price.string = ChannelMgr.getSdkRechargeShowPrice(rechargeTab);\r\n        }\r\n\r\n        if (this._mallData.IconUrl) {\r\n            this.sp_chaozhi.node.active = true;\r\n            this.sp_chaozhi.setTexture(this._mallData.IconUrl)\r\n        } else {\r\n            this.sp_chaozhi.node.active = false;\r\n        }\r\n    }\r\n    // 购买商品\r\n    clickBuy(){\r\n        if(this.boughtCount >= this._mallData.LimitCount){\r\n            console.log(\"没有次数了\")\r\n            return\r\n        }\r\n        const sendMsg = ()=>{\r\n            let msg = new proto.Msg_BuyFixedShopCommodityReq();\r\n            msg.commodityId = this._mallData.Id;\r\n            msg.num = 1;\r\n            Net.Send(proto.Ptl.BuyFixedShopCommodityReq, msg);\r\n        }\r\n        if(this._CostItemId){\r\n            // 花钻石\r\n            dailyBuyShop(this._CostItemId, this._CostItemNum, -1, \"Tips_common_buy\", () => {\r\n                sendMsg();\r\n            })\r\n        }else{\r\n            //免费 判断是否有广告次数\r\n            sendMsg();\r\n        }\r\n    }\r\n    clickRMB(){\r\n        var self = this;\r\n        if(this.boughtCount >= this._mallData.LimitCount){\r\n            console.log(\"没有次数了\")\r\n            return\r\n        }\r\n        PayControl.ins.requestPay( this._rechargeId, () => {\r\n            // 刷新界面 数据\r\n            MallDataMgr.ins.getFixedShopData(this._mallData.MallId).set(this._mallData.Id, self.boughtCount + 1);\r\n            this.initData(self._mallData,self._trialId)\r\n        })\r\n    }\r\n}\r\n\r\n\r\n"]}