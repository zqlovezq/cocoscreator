{"version":3,"sources":["file:///C:/chickenStarClient/client/assets/scripts/logic/model/rareBook/RareBookItem.ts"],"names":["_decorator","Label","Node","ProgressBar","Sprite","HeroStar","LangMgr","tab","ItemData","ComponentBase","EventMgr","LocalEvent","GameUtil","ccclass","property","RareBookItem","info","touchCallBack","isShowFragment","isShowScore","isShowRed","start","register","onLocal","updateBookRedPoint","updateRed","initData","isTouch","callBack","bigLockNode","active","rareBookNode","emptyNode","bookNameLab","string","getLab","itemTable","Name","bookSpr","setTexture","Icon","atpTab","getData","HeroAptitudeTableByHeroAptitude","getValue","bookTable","Aptitude","qualitySpr","qualityBgSpr","BookBg","heroclass","HeroClassTableByHeroClass","Class","vocationTypeSpr","bookPlaystyleSpr","node","PlaystyleName","equipNode","isWear","updateView","redDotNode","isRedPoint","initLockView","tips","unlockLab","initEmptyView","isLock","starItem","showStar","star","fragmentNode","level","levelLv","lockNode","scoreNode","scoreLab","convertNumber","powerScore","table","fragmentTable","curr","ins","getCount","Id","fragmentNumLab","Count","fragmentBar","progress","onClickItem","onDisable"],"mappings":"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","sourcesContent":["import { _decorator, Component, Label, Node, ProgressBar, Sprite } from 'cc';\r\nimport { HeroStar } from '../hero/HeroStar';\r\nimport { RareBookInfo } from './RareBookInfo';\r\nimport { LangMgr } from '../../mgr/LangMgr';\r\nimport { tab } from '../../../Table/table_gen';\r\nimport { ItemData } from '../item/ItemData';\r\nimport { UIMgr } from '../../mgr/UIMgr';\r\nimport { ViewName } from '../../define/ViewDefine';\r\nimport { ComponentBase } from '../../../framework/base/ComponentBase';\r\nimport { EventMgr } from '../../mgr/EventMgr';\r\nimport { LocalEvent } from '../../define/LocalEvent';\r\nimport { GameUtil } from '../../utils/GameUtil';\r\nconst { ccclass, property } = _decorator;\r\n\r\n/**\r\n * \r\n * RareBookItem\r\n * zhudingchao\r\n * Wed May 22 2024 11:30:22 GMT+0800 (中国标准时间)\r\n * db://assets/scripts/logic/model/rareBook/RareBookItem.ts\r\n *\r\n */\r\n\r\n@ccclass('RareBookItem')\r\nexport class RareBookItem extends ComponentBase {\r\n    @property(Node)\r\n    emptyNode: Node = null;\r\n    @property(Node)\r\n    bigLockNode: Node = null;\r\n    @property(Node)\r\n    lockNode: Node = null;\r\n    @property(Node)\r\n    rareBookNode: Node = null;\r\n\r\n\r\n    @property(Sprite)\r\n    bookSpr: Sprite = null;\r\n    @property(Label)\r\n    bookNameLab: Label = null;\r\n    @property(Sprite)\r\n    qualitySpr: Sprite = null;\r\n    @property(Sprite)\r\n    qualityBgSpr: Sprite = null;\r\n    @property(Sprite)\r\n    bookPlaystyleSpr: Sprite = null;\r\n\r\n    @property(Sprite)\r\n    vocationTypeSpr: Sprite = null;\r\n    @property(Label)\r\n    levelLv: Label = null;\r\n    @property(Node)\r\n    equipNode: Node = null;\r\n    @property(HeroStar)\r\n    starItem: HeroStar = null;\r\n    @property(Node)\r\n    fragmentNode: Node = null;\r\n    @property(Label)\r\n    fragmentNumLab: Label = null;\r\n    @property(Node)\r\n    scoreNode: Node = null;\r\n    @property(Label)\r\n    scoreLab: Label = null;\r\n    @property(Node)\r\n    redDotNode: Node = null;\r\n    @property(Label)\r\n    unlockLab: Label = null;\r\n    @property(ProgressBar)\r\n    fragmentBar: ProgressBar = null;\r\n    public info: RareBookInfo;\r\n    private touchCallBack: Function;\r\n    private isShowFragment: boolean;\r\n    private isShowScore: boolean;\r\n    private isShowRed: boolean;\r\n    start() {\r\n\r\n    }\r\n    register(): void {\r\n        EventMgr.onLocal(LocalEvent.updateBookRedPoint, this.updateRed, this)\r\n    }\r\n    initData(info: RareBookInfo, isTouch = true, callBack: Function = null, isShowFragment: boolean = true, isShowScore = false, isShowRed: boolean = false) {\r\n        this.info = info;\r\n        this.isShowFragment = isShowFragment;\r\n        this.bigLockNode.active = false;\r\n        this.isShowScore = isShowScore;\r\n        this.isShowRed = isShowRed;\r\n        if (this.info) {\r\n            // this.lockNode.active=false;\r\n            this.rareBookNode.active = true;\r\n            this.emptyNode.active = false;\r\n            this.bookNameLab.string = LangMgr.getLab(this.info.itemTable.Name);\r\n            this.bookSpr.setTexture(this.info.itemTable.Icon);\r\n            let atpTab = tab.getData().HeroAptitudeTableByHeroAptitude.getValue(this.info.bookTable.Aptitude);\r\n            this.qualitySpr.setTexture(atpTab.Icon);\r\n            this.qualityBgSpr.setTexture(atpTab.BookBg);\r\n            let heroclass = tab.getData().HeroClassTableByHeroClass.getValue(this.info.bookTable.Class);\r\n            this.vocationTypeSpr.setTexture(heroclass.Icon);\r\n            this.bookPlaystyleSpr.node.active = this.info.bookTable.PlaystyleName != \"\";\r\n            if (this.info.bookTable.PlaystyleName != \"\") {\r\n                this.bookPlaystyleSpr.setTexture(this.info.bookTable.PlaystyleName);\r\n            }\r\n            // this.bookPlaystyleLab.string = LangMgr.getLab(tab.Playstyle[this.info.bookTable.PlaystyleName]);\r\n            this.equipNode.active = this.info.isWear;\r\n            this.updateView();\r\n            // this.qualityFrameSpr.setTexture()\r\n\r\n        } else {\r\n            this.rareBookNode.active = false;\r\n            this.emptyNode.active = true;\r\n        }\r\n        if (isTouch) {\r\n            // this.addTouchEvent();\r\n        }\r\n        this.touchCallBack = callBack;\r\n        this.redDotNode.active = this.isShowRed && this.info.isRedPoint;\r\n\r\n    }\r\n    initLockView(tips: string) {\r\n        this.bigLockNode.active = true;\r\n        this.emptyNode.active = false;\r\n        this.rareBookNode.active = false;\r\n        this.unlockLab.string = tips;\r\n\r\n    }\r\n    initEmptyView() {\r\n        this.bigLockNode.active = false;\r\n        this.emptyNode.active = true;\r\n        this.rareBookNode.active = false;\r\n    }\r\n\r\n    updateView() {\r\n        if (this.info.isLock) {\r\n            this.starItem.showStar(this.info.star);\r\n            this.starItem.node.active = true;\r\n            this.fragmentNode.active = false;\r\n            if (this.info.level > 0) {\r\n                this.levelLv.node.active = true;\r\n                this.levelLv.string = \"+\" + this.info.level;\r\n            } else {\r\n                this.levelLv.node.active = false;\r\n            }\r\n\r\n            this.lockNode.active = false;\r\n            this.scoreNode.active = this.isShowScore;\r\n            this.scoreLab.string = GameUtil.convertNumber(this.info.powerScore) + \"\";\r\n        } else {\r\n            this.scoreNode.active = false;\r\n            this.starItem.node.active = false;\r\n            if (this.isShowFragment) {\r\n                this.fragmentNode.active = true;\r\n                let table = this.info.fragmentTable;\r\n                let curr = ItemData.ins.getCount(table.Id);\r\n                this.fragmentNumLab.string = curr + \"/\" + table.Count;\r\n                this.fragmentBar.progress = curr / table.Count;\r\n            } else {\r\n                this.fragmentNode.active = false;\r\n            }\r\n\r\n\r\n\r\n\r\n            this.levelLv.node.active = false;\r\n\r\n            this.lockNode.active = false;\r\n            this.lockNode.active = true;\r\n           \r\n        }\r\n        this.redDotNode.active = this.isShowRed && this.info.isRedPoint;\r\n    }\r\n    onClickItem() {\r\n        if (this.touchCallBack) {\r\n            this.touchCallBack(this.info);\r\n            // if (this.isShowRed && this.info.isRedPoint) {\r\n            //     // this.info.isRedPoint = false;\r\n            //     // this.redDotNode.active = this.info.isRedPoint;\r\n            // }\r\n        }\r\n    }\r\n    updateRed() {\r\n        if (this.isShowRed) {\r\n            this.redDotNode.active = this.info.isRedPoint;\r\n        }\r\n    }\r\n\r\n    protected onDisable(): void {\r\n        this.starItem.onDisable();\r\n    }\r\n\r\n\r\n}"]}