{"version":3,"sources":["file:///C:/chickenStarClient/client/assets/scripts/logic/model/jianghu/climbingTower/ClimbingTowerTowerEveryDayRewardPop.ts"],"names":["_decorator","Label","Node","ViewPop","ClimbingTowerTowerEveryDayRewardItem","GameplayViewDataMgr","GameplayControl","proto","EventMgr","UIMgr","ViewName","getTimeUntilNextDay","setTextTime","LangMgr","ccclass","property","ClimbingTowerTowerEveryDayRewardPop","currStateId","endTimer","updateTimer","timerLab","string","getCombineString","unschedule","register","onMsg","Ptl","ReceiveClimbTowerDailyRewardsRsp","on_s2c_ReceiveClimbTowerDailyRewardsRsp","onShow","msg","ins","climbTowerInfoMsg","clearedStageIds","length","items","initView","id","isReceivedDailyRewards","node","active","updateBtn","initEndTimer","reachNode","receivedNode","schedule","onClickReachBtn","requestReceiveClimbTowerDailyRewards","error","code","CommonErrorCode","Succeed","show","viewName","CongratulationPop","data","rewards"],"mappings":"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","sourcesContent":["import { _decorator, Component, Label, Node } from 'cc';\r\nimport { ViewPop } from '../../../../framework/base/ViewPop';\r\nimport { ClimbingTowerTowerEveryDayRewardItem } from './ClimbingTowerTowerEveryDayRewardItem';\r\nimport { GameplayViewDataMgr } from '../GameplayViewDataMgr';\r\nimport { GameplayControl } from '../GameplayControl';\r\nimport { proto } from 'client_protocol';\r\nimport { EventMgr } from '../../../mgr/EventMgr';\r\nimport { UIMgr } from '../../../mgr/UIMgr';\r\nimport { ViewName } from '../../../define/ViewDefine';\r\nimport {getTimeUntilNextDay, setTextTime } from '../../../utils/GameUtil';\r\nimport { LangMgr } from '../../../mgr/LangMgr';\r\nconst { ccclass, property } = _decorator;\r\n\r\n/**\r\n * \r\n * ClimbingTowerTowerEveryDayRewardPop\r\n * zhudingchao\r\n * Thu Jul 11 2024 17:13:54 GMT+0800 (中国标准时间)\r\n * db://assets/scripts/logic/model/jianghu/climbingTower/ClimbingTowerTowerEveryDayRewardPop.ts\r\n *\r\n */\r\n\r\n@ccclass('ClimbingTowerTowerEveryDayRewardPop')\r\nexport class ClimbingTowerTowerEveryDayRewardPop extends ViewPop {\r\n   @property(Label)\r\n   canReceivedLab: Label = null;\r\n   @property(Node)\r\n   receivedNode: Node = null;\r\n   @property(Node)\r\n   reachNode: Node = null;\r\n   @property(Label)\r\n   timerLab: Label = null;\r\n   @property([ClimbingTowerTowerEveryDayRewardItem])\r\n   items: Array<ClimbingTowerTowerEveryDayRewardItem> = []\r\n   private currStateId: number;\r\n   register(): void {\r\n      EventMgr.onMsg(proto.Ptl.ReceiveClimbTowerDailyRewardsRsp, this.on_s2c_ReceiveClimbTowerDailyRewardsRsp, this);\r\n   }\r\n   onShow(): void {\r\n      let msg = GameplayViewDataMgr.ins.climbTowerInfoMsg;\r\n      if (msg.clearedStageIds.length == 0) {\r\n         this.items[0].initView(null, false);\r\n         this.items[1].initView(30101, true);\r\n         this.currStateId = 0;\r\n      } else {\r\n         let id = msg.clearedStageIds[msg.clearedStageIds.length - 1]\r\n         this.items[0].initView(id, false);\r\n         this.items[1].initView(id + 1, true);\r\n         this.currStateId = id;\r\n      }\r\n      if (msg.isReceivedDailyRewards) {\r\n         this.timerLab.node.active = true;\r\n      } else {\r\n         this.timerLab.node.active = false;\r\n      }\r\n      this.updateBtn();\r\n\r\n\r\n\r\n   }\r\n   updateBtn() {\r\n      let msg = GameplayViewDataMgr.ins.climbTowerInfoMsg;\r\n      if (msg.isReceivedDailyRewards) {\r\n         this.timerLab.node.active = true;\r\n         this.initEndTimer();\r\n      } else {\r\n         this.timerLab.node.active = false;\r\n      }\r\n      if (msg.clearedStageIds.length == 0) {\r\n         this.reachNode.active = false;\r\n         this.receivedNode.active = false;\r\n      } else {\r\n         this.reachNode.active = !msg.isReceivedDailyRewards;\r\n         this.receivedNode.active = msg.isReceivedDailyRewards;\r\n      }\r\n\r\n   }\r\n   endTimer: number;\r\n   initEndTimer() {\r\n      this.unschedule(this.updateTimer)\r\n      this.endTimer = getTimeUntilNextDay();\r\n      //let tips = \"{0}後可再次領取\"\r\n      this.timerLab.string = LangMgr.getCombineString(\"ui_climbingtower_13\", [setTextTime(this.endTimer)]);\r\n      this.schedule(this.updateTimer, 1)\r\n   }\r\n   updateTimer = () => {\r\n      this.endTimer--;\r\n      if (this.endTimer >= 0) {\r\n         //let tips = \"{0}後可再次領取\"\r\n         this.timerLab.string = LangMgr.getCombineString(\"ui_climbingtower_13\", [setTextTime(this.endTimer)]);\r\n      } else {\r\n         this.unschedule(this.updateTimer)\r\n      }\r\n   }\r\n\r\n   onClickReachBtn() {\r\n      if (this.currStateId > 0) {\r\n         GameplayControl.ins.requestReceiveClimbTowerDailyRewards();\r\n      }\r\n\r\n   }\r\n   on_s2c_ReceiveClimbTowerDailyRewardsRsp(msg: proto.Msg_ReceiveClimbTowerDailyRewardsRsp) {\r\n      if (!msg.error || msg.error.code == proto.CommonErrorCode.Succeed) {\r\n         this.updateBtn();\r\n         UIMgr.ins.show({ viewName: ViewName.CongratulationPop, data: msg.rewards })\r\n      }\r\n   }\r\n}"]}