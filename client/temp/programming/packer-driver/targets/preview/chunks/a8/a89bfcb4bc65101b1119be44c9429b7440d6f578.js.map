{"version":3,"sources":["file:///C:/chickenStarClient/client/assets/scripts/logic/model/association/AssociationView.ts"],"names":["_decorator","Node","ViewPop","ASSOCIATION","AssociationMainView","AssociationApplyView","AssociationData","proto","Net","EventMgr","ccclass","property","AssociationView","currNode","view_type","NONE","register","onMsg","Ptl","GetGuildInfoRsp","on_s2c_GetGuildInfoRsp","JoinGuildRequestReplyPush","on_s2c_JoinGuildRequestReplyPush","KickedOutGuildPush","on_s2c_KickedOutGuildPush","GuildMemberChangedPush","on_s2c_GuildMemberChangedPush","msg","refreshGuildData","unRegister","onDestroy","guildId","ins","subGuildRequests","agree","error","code","CommonErrorCode","Succeed","switchView","onShow","guild_msg","Msg_GetGuildInfoReq","Send","GetGuildInfoReq","active","getInGuild","INASSOCIATION","assocition_apply_view","getComponent","assocition_main_view","openData"],"mappings":"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","sourcesContent":["/*\r\n * @Date: 2024-08-28 10:44:28\r\n * @LastEditors: wzq\r\n * @LastEditTime: 2024-11-01 14:37:52\r\n */\r\n\r\nimport { _decorator, Component, error, instantiate, log, Node, Prefab } from 'cc';\r\nimport { ViewPop } from '../../../framework/base/ViewPop';\r\nimport { ASSOCIATION } from '../../../Common/script/EnumTypeMgr';\r\nimport { AssociationMainView } from './AssociationMainView';\r\nimport { AssociationApplyView } from './AssociationApplyView';\r\nimport { AssociationData } from './AssociationData';\r\nimport { proto } from 'client_protocol';\r\nimport { Net } from '../../net/Net';\r\nimport { EventMgr } from '../../mgr/EventMgr';\r\nconst { ccclass, property } = _decorator;\r\n\r\n@ccclass('AssociationView')\r\nexport class AssociationView extends ViewPop {\r\n    @property(Node)\r\n    assocition_main_view: Node = null;\r\n\r\n    @property(Node)\r\n    assocition_apply_view: Node = null;\r\n\r\n    private currNode: Node = null;\r\n    private view_type: ASSOCIATION = ASSOCIATION.NONE;\r\n    register(): void {\r\n        /* 公会数据 */\r\n        EventMgr.onMsg(proto.Ptl.GetGuildInfoRsp, this.on_s2c_GetGuildInfoRsp, this);\r\n        /* 创建公会 */\r\n        EventMgr.onMsg(proto.Ptl.JoinGuildRequestReplyPush, this.on_s2c_JoinGuildRequestReplyPush, this);\r\n        // 被踢出公会\r\n        EventMgr.onMsg(proto.Ptl.KickedOutGuildPush, this.on_s2c_KickedOutGuildPush, this);\r\n        EventMgr.onMsg(proto.Ptl.GuildMemberChangedPush, this.on_s2c_GuildMemberChangedPush, this);\r\n    }\r\n    on_s2c_GuildMemberChangedPush(msg: proto.Msg_GuildMemberChangedPush) {\r\n        this.refreshGuildData();\r\n    }\r\n    unRegister(): void {\r\n        super.unRegister();\r\n    }\r\n    protected onDestroy(): void {\r\n        super.onDestroy();\r\n    }\r\n    on_s2c_KickedOutGuildPush(msg: proto.Msg_KickedOutGuildPush) {\r\n        if (msg.guildId) {\r\n            AssociationData.ins.subGuildRequests(msg.guildId);\r\n            this.refreshGuildData();\r\n        }\r\n    }\r\n    on_s2c_JoinGuildRequestReplyPush(msg: proto.Msg_JoinGuildRequestReplyPush) {\r\n        if (msg.guildId && msg.agree) {\r\n            AssociationData.ins.subGuildRequests(msg.guildId);\r\n        }\r\n    }\r\n    on_s2c_GetGuildInfoRsp(msg: proto.Msg_GetGuildInfoRsp) {\r\n        if (msg.error && msg.error.code != proto.CommonErrorCode.Succeed) return;\r\n        this.switchView();\r\n    }\r\n    onShow(): void {\r\n        this.refreshGuildData();\r\n    }\r\n    // 刷新公会信息\r\n    refreshGuildData() {\r\n        let guild_msg = new proto.Msg_GetGuildInfoReq();\r\n        Net.Send(proto.Ptl.GetGuildInfoReq, guild_msg);\r\n    }\r\n    async switchView() {\r\n        if (this.currNode) {\r\n            this.currNode.active = false;\r\n        }\r\n        this.view_type = AssociationData.ins.getInGuild() ? ASSOCIATION.INASSOCIATION : ASSOCIATION.NONE;\r\n        switch (this.view_type) {\r\n            case ASSOCIATION.NONE:\r\n                this.assocition_apply_view.active = true;\r\n                this.currNode = this.assocition_apply_view;\r\n                this.assocition_apply_view.getComponent(AssociationApplyView).onShow();\r\n                break\r\n            case ASSOCIATION.INASSOCIATION:\r\n                this.assocition_main_view.active = true;\r\n                this.currNode = this.assocition_main_view;\r\n                if(this.openData){\r\n                    this.assocition_main_view.getComponent(AssociationMainView).onShow(this.openData);\r\n                    this.openData = null;\r\n                }else{\r\n                    this.assocition_main_view.getComponent(AssociationMainView).onShow(null);\r\n                }\r\n                break\r\n            default:\r\n                break;\r\n        }\r\n    }\r\n}\r\n\r\n\r\n"]}