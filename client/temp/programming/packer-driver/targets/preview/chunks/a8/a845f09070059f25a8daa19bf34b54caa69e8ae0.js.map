{"version":3,"sources":["file:///C:/chickenStarClient/client/assets/scripts/logic/fight/base/ai/LockEnemy.ts"],"names":["LockEnemy","AbsStateType","LockEnemyState","constructor","state","default","owner","enemy","setEnemys","enemys","stateMachine","isState","roleIdle","length","setEnemy","setOnwer","node","off","onEnemyDead","on","setState","preLock","isPreLock","changeState","roleMove","isLock","roleAttack","lock","isDead","e"],"mappings":";;;6FAiBaA,S;;;;;;;;;;;;;;;;;;;;;;;;AAdJC,MAAAA,Y,iBAAAA,Y;;;;;;;;;gCAEGC,c,0BAAAA,c;AAAAA,QAAAA,c,CAAAA,c;AAAAA,QAAAA,c,CAAAA,c;AAAAA,QAAAA,c,CAAAA,c;eAAAA,c;;AAQZ;AACA;AACA;AACA;;;2BACaF,S,GAAN,MAAMA,SAAN,CAAgB;AAKnBG,QAAAA,WAAW,GAAG;AAAA,eAJdC,KAIc,GAJUF,cAAc,CAACG,OAIzB;AAAA,eAHdC,KAGc;AAAA,eADdC,KACc;AAEb;;AAGDC,QAAAA,SAAS,CAACC,MAAD,EAAmB;AACxB,cAAI,CAAC,KAAKH,KAAL,CAAWI,YAAX,CAAwBC,OAAxB,CAAgC;AAAA;AAAA,4CAAaC,QAA7C,CAAL,EAA6D;AACzD;AACH;;AACD,cAAIH,MAAM,CAACI,MAAP,GAAgB,CAApB,EAAuB;AACnB,iBAAKC,QAAL,CAAcL,MAAM,CAAC,CAAD,CAApB;AACH;AACJ;;AAEDM,QAAAA,QAAQ,CAACT,KAAD,EAAgB;AACpB,eAAKA,KAAL,GAAaA,KAAb;AACH;;AAEDQ,QAAAA,QAAQ,CAACP,KAAD,EAAa;AACjB,cAAI,KAAKA,KAAT,EAAgB;AACZ,iBAAKA,KAAL,CAAWS,IAAX,CAAgBC,GAAhB,CAAoB,cAApB,EAAoC,KAAKC,WAAzC,EAAsD,IAAtD;AACH;;AACD,eAAKX,KAAL,GAAaA,KAAb;;AACA,cAAIA,KAAJ,EAAW;AACP,iBAAKA,KAAL,CAAWS,IAAX,CAAgBG,EAAhB,CAAmB,cAAnB,EAAmC,KAAKD,WAAxC,EAAqD,IAArD;AACA,iBAAKE,QAAL,CAAclB,cAAc,CAACmB,OAA7B;AACH,WAHD,MAGO;AACH,iBAAKD,QAAL,CAAclB,cAAc,CAACG,OAA7B;AACH;AACJ;;AAEDe,QAAAA,QAAQ,CAAChB,KAAD,EAAwB;AAC5B,eAAKA,KAAL,GAAaA,KAAb;;AACA,cAAI,KAAKkB,SAAL,EAAJ,EAAsB;AAClB,iBAAKhB,KAAL,IAAc,KAAKA,KAAL,CAAWiB,WAAX,CAAuB;AAAA;AAAA,8CAAaC,QAApC,CAAd;AACH,WAFD,MAEO,IAAI,KAAKC,MAAL,EAAJ,EAAmB;AACtB,iBAAKnB,KAAL,IAAc,KAAKA,KAAL,CAAWiB,WAAX,CAAuB;AAAA;AAAA,8CAAaG,UAApC,CAAd;AACH,WAFM,MAEA,CACH;AACH;AACJ;AAGD;;;AACAD,QAAAA,MAAM,GAAG;AACL,iBAAO,KAAKrB,KAAL,IAAcF,cAAc,CAACyB,IAApC;AACH;AAED;;;AACAL,QAAAA,SAAS,GAAG;AACR,iBAAO,KAAKlB,KAAL,IAAcF,cAAc,CAACmB,OAApC;AACH;AAED;;;AACAO,QAAAA,MAAM,GAAG;AACL,iBAAO,KAAKxB,KAAL,IAAcF,cAAc,CAACG,OAA7B,IAAyC,KAAKE,KAAL,IAAc,IAAd,IAAsB,KAAKA,KAAL,CAAWqB,MAAjF;AACH;;AAEDV,QAAAA,WAAW,CAACW,CAAD,EAAa;AACpB,eAAKf,QAAL,CAAc,IAAd;AACH;;AAjEkB,O","sourcesContent":["import { Vec3, View, game, size, v2, view } from \"cc\";\nimport { AbsRole } from \"../obj/role/AbsRole\";\nimport { AbsObj } from \"../obj/AbsObj\";\nimport { AbsStateType } from \"../obj/state/AbsState\";\n\nexport enum LockEnemyState {\n    default = 0,\n    /** 预锁定 */\n    preLock = 1,\n    /** 锁定 */\n    lock = 2\n}\n\n/** \n * 锁定敌人 \n * 预锁定敌人 （在警戒范围内最近的敌人）角色移动到攻击范围内更改为锁定状态\n */\nexport class LockEnemy {\n    state: LockEnemyState = LockEnemyState.default;\n    owner: AbsObj;\n\n    enemy: AbsObj\n    constructor() {\n\n    }\n\n\n    setEnemys(enemys: AbsObj[]) {\n        if (!this.owner.stateMachine.isState(AbsStateType.roleIdle)) {\n            return\n        }\n        if (enemys.length > 0) {\n            this.setEnemy(enemys[0])\n        }\n    }\n\n    setOnwer(owner: AbsObj) {\n        this.owner = owner\n    }\n\n    setEnemy(enemy: any) {\n        if (this.enemy) {\n            this.enemy.node.off(\"AbsRole_dead\", this.onEnemyDead, this)\n        }\n        this.enemy = enemy;\n        if (enemy) {\n            this.enemy.node.on(\"AbsRole_dead\", this.onEnemyDead, this)\n            this.setState(LockEnemyState.preLock)\n        } else {\n            this.setState(LockEnemyState.default)\n        }\n    }\n\n    setState(state: LockEnemyState) {\n        this.state = state\n        if (this.isPreLock()) {\n            this.owner && this.owner.changeState(AbsStateType.roleMove)\n        } else if (this.isLock()) {\n            this.owner && this.owner.changeState(AbsStateType.roleAttack)\n        } else {\n            // this.owner && this.owner.changeState(AbsStateType.roleIdle)\n        }\n    }\n\n\n    /** 是否为锁敌状态 */\n    isLock() {\n        return this.state == LockEnemyState.lock\n    }\n\n    /** 是否为预锁定状态 */\n    isPreLock() {\n        return this.state == LockEnemyState.preLock\n    }\n\n    /** 是否为死亡（default）状态 */\n    isDead() {\n        return this.state == LockEnemyState.default || (this.enemy == null || this.enemy.isDead)\n    }\n\n    onEnemyDead(e: AbsRole) {\n        this.setEnemy(null)\n    }\n}"]}