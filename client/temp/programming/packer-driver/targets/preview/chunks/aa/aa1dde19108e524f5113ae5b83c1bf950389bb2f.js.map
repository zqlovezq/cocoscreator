{"version":3,"sources":["file:///C:/chickenStarClient/client/assets/scripts/logic/model/activity/combine/CombieActivityMainView.ts"],"names":["_decorator","error","instantiate","Node","Prefab","ViewPop","ViewName","ClientView","LoadResAsync","tab","CombineStarUpItem","CombineToggleItem","ccclass","property","CombieActivityMainView","currNode","view_type","onShow","_tab","getData","ActivityTableByActivityId","getValue","openData","tabList","ActivityIds","splice","createToggle","switchView","activityId","active","activityInfo","Type","OpenFunctionName","OpenFunctionName_ActivityHeroGrow","_hero_grow_layer","createView","CycleGiftView","getComponent","node","viewName","viewTab","ins","getViewTab","pfb","Path","view","parent","activityNode","node_toggle_content","destroyAllChildren","i","length","_key","item","itemTs","pfb_toggle_item","name","String","setData"],"mappings":"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","sourcesContent":["import { _decorator, Component, error, instantiate, Node, Prefab } from 'cc';\r\nimport { ViewPop } from '../../../../framework/base/ViewPop';\r\nimport { ViewName } from '../../../define/ViewDefine';\r\nimport { ClientView } from '../../../mgr/ClientView';\r\nimport { LoadResAsync } from '../../../mgr/ResMgr';\r\nimport { tab } from '../../../../Table/table_gen';\r\nimport { CombineStarUpItem } from './CombineStarUpItem';\r\nimport { CombineToggleItem } from './CombineToggleItem';\r\nconst { ccclass, property } = _decorator;\r\n\r\n@ccclass('CombieActivityMainView')\r\nexport class CombieActivityMainView extends ViewPop {\r\n    @property(Node)\r\n    activityNode: Node = null;\r\n    @property(Prefab)\r\n    pfb_toggle_item: Prefab = null;\r\n    @property(Node)\r\n    node_toggle_content:Node = null;\r\n\r\n    private currNode: Node = null;\r\n    public view_type:tab.OpenFunctionName = null;\r\n    onShow(): void {\r\n        // 获取活动分组\r\n        const _tab = tab.getData().ActivityTableByActivityId.getValue(this.openData);\r\n        const tabList = _tab.ActivityIds.splice(0,1);\r\n        // 通过tabList创建toggle\r\n        this.createToggle(tabList);\r\n        this.switchView(tabList[2]);\r\n    }\r\n    async switchView(activityId:number) {\r\n        if (this.currNode) {\r\n            this.currNode.active = false;\r\n        }\r\n        const activityInfo = tab.getData().ActivityTableByActivityId.getValue(activityId);\r\n        this.view_type = activityInfo.Type;\r\n        switch (this.view_type) {\r\n            // 养成活动\r\n            case tab.OpenFunctionName.OpenFunctionName_ActivityHeroGrow:\r\n                if (!this[\"view\"+activityId]) {\r\n                    const _hero_grow_layer = await this.createView(ViewName.CycleGiftView);\r\n                    if (_hero_grow_layer) {\r\n                        this[\"view\"+activityId] = _hero_grow_layer.getComponent(CombineStarUpItem);\r\n                        this.currNode = _hero_grow_layer;\r\n                        this[\"view\"+activityId].onShow(activityId);\r\n                    }\r\n                } else {\r\n                    this[\"view\"+activityId].node.active = true;\r\n                    this.currNode = this[\"view\"+activityId];\r\n                    this[\"view\"+activityId].onShow(activityId);\r\n                }\r\n                break;\r\n            default:\r\n                break;\r\n        }\r\n    }\r\n    async createView(viewName: ViewName) {\r\n        let viewTab = ClientView.ins.getViewTab(viewName);\r\n        if (viewTab) {\r\n            let pfb: Prefab = await LoadResAsync(viewTab.Path, Prefab)\r\n            let view = instantiate(pfb);\r\n            view.parent = this.activityNode;\r\n            return view;\r\n        } else {\r\n            error(\"view路径没有配置\", viewName)\r\n        }\r\n        return null;\r\n    }\r\n    createToggle(tabList:number[]){\r\n        this.node_toggle_content.destroyAllChildren();\r\n        for (let i = 0; i < tabList.length; i++) {\r\n            const _key = tabList[i];\r\n            let item = null;\r\n            let itemTs: CombineToggleItem = null;\r\n            item = instantiate(this.pfb_toggle_item);\r\n            item.parent = this.node_toggle_content;\r\n            item.name = String(_key);\r\n            itemTs = item.getComponent(CombineToggleItem);\r\n            itemTs.setData(_key,this);\r\n            this[\"view\"+_key] = null;\r\n        }\r\n    }\r\n}\r\n\r\n\r\n"]}