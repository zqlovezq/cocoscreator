{"version":3,"sources":["file:///C:/chickenStarClient/client/assets/scripts/logic/model/activity/wonderfulActivity/CycleGiftView.ts"],"names":["_decorator","instantiate","Node","Prefab","Toggle","tab","InfiniteList","MallLayoutCell","proto","EventMgr","ComponentBase","OpenFunctionMgr","MALLNAME","ccclass","property","CycleGiftView","_view_type","MallTab","MallTab_SpecialGiftTab1","_view_name","DailyGift","_shop_view","Map","_list","_args","register","onMsg","Ptl","BuyFixedShopCommodityRsp","on_s2c_BuyFixedShopCommodityRsp","onShow","args","clear","i","getData","MallTable","length","_mallTab","mallId","MallId","MallType","MallType_SpecialGift","k","MallItemTabe","mallTab","OpenFunction","isOpen","ins","checkFunctionIsOpen","has","arr","get","set","concat","Array","isArray","node_toggles","getChildByName","getComponent","isChecked","initView","isInit","groupData","groupListData","data","name","list_view","Init","getCellNumber","getCellCount","bind","getCellSize","getCellHeight","getCellIdentifer","getCellView","getCellData","GetCellData","Reload","onDestroy","pfb_item","idx","view","viewName","msg","error","code","CommonErrorCode","Succeed","Refresh","splitCount","result","listData","push","slice","clickSwitchView","e","view_type","Number"],"mappings":"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","sourcesContent":["import { _decorator, Component, EventTouch, instantiate, log, Node, Prefab, Toggle } from 'cc';\r\nimport { ViewPop } from '../../../../framework/base/ViewPop';\r\nimport { tab } from '../../../../Table/table_gen';\r\nimport InfiniteList from '../../../../Common/InfiniteList/InfiniteList';\r\nimport { MallLayoutCell } from '../../shop/MallLayoutCell';\r\nimport { proto } from 'client_protocol';\r\nimport { UIMgr } from '../../../mgr/UIMgr';\r\nimport { MallDataMgr } from '../../shop/MallDataMgr';\r\nimport { ViewName } from '../../../define/ViewDefine';\r\nimport { EventMgr } from '../../../mgr/EventMgr';\r\nimport { ComponentBase } from '../../../../framework/base/ComponentBase';\r\nimport { OpenFunctionMgr } from '../../../../Common/component/OpenFunctionMgr';\r\nimport { MALLNAME } from '../../../../Common/script/EnumTypeMgr';\r\nconst { ccclass, property } = _decorator;\r\n\r\n@ccclass('CycleGiftView')\r\nexport class CycleGiftView extends ComponentBase {\r\n    @property(Prefab)\r\n    pfb_item: Prefab = null;\r\n    @property(InfiniteList)\r\n    list_view: InfiniteList = null;\r\n    @property(Node)\r\n    node_toggles: Node = null;\r\n    private _view_type: tab.MallTab = tab.MallTab.MallTab_SpecialGiftTab1;\r\n    private _view_name: MALLNAME = MALLNAME.DailyGift;\r\n    private _shop_view: Map<MALLNAME, tab.MallItemTabe[]> = new Map();\r\n    private _list = [];\r\n    private _args: any = null;\r\n    register(): void {\r\n        // 购买固定商品\r\n        EventMgr.onMsg(proto.Ptl.BuyFixedShopCommodityRsp, this.on_s2c_BuyFixedShopCommodityRsp, this);\r\n    }\r\n\r\n    onShow(args): void {\r\n        this._args = args;\r\n        this._shop_view.clear();\r\n        for (let i = 0; i < tab.getData().MallTable.length; i++) {\r\n            const _mallTab = tab.getData().MallTable[i];\r\n            const mallId = _mallTab.MallId;\r\n            if (_mallTab.MallType == tab.MallType.MallType_SpecialGift) {\r\n                // 特惠礼包\r\n                for (let k = 0; k < tab.getData().MallItemTabe.length; k++) {\r\n                    const mallTab = tab.getData().MallItemTabe[k];\r\n                    if (mallTab.MallId === mallId) {\r\n                        // 判定开启条件\r\n                        if (mallTab.OpenFunction) {\r\n                            const isOpen = OpenFunctionMgr.ins.checkFunctionIsOpen(mallTab.OpenFunction);\r\n                            if (!isOpen) {\r\n                                continue;\r\n                            }\r\n                        }\r\n                        if (this._shop_view.has(mallId)) {\r\n                            const arr = this._shop_view.get(mallId);\r\n                            this._shop_view.set(mallId, arr.concat(mallTab))\r\n                        } else {\r\n                            this._shop_view.set(mallId, [mallTab]);\r\n                        }\r\n                    }\r\n                }\r\n            }\r\n        }\r\n        this._view_type = tab.MallTab.MallTab_SpecialGiftTab1;\r\n        this._view_name = MALLNAME.DailyGift;\r\n\r\n        if (Array.isArray(this._args)) {\r\n            if (this._args.length > 1) {\r\n                this.node_toggles.getChildByName(\"Toggle\" + this._args[1]).getComponent(Toggle).isChecked = true;\r\n                this._view_name = 50 + this._args[1];\r\n            } else {\r\n                this.node_toggles.getChildByName(\"Toggle1\").getComponent(Toggle).isChecked = true;\r\n            }\r\n        }\r\n\r\n        this.initView(true);\r\n    }\r\n    initView(isInit: boolean) {\r\n        const groupData = this.groupListData();\r\n        this._list = groupData.data;\r\n        this._view_name = groupData.name;\r\n        if (isInit) {\r\n            this.list_view.Init({\r\n                getCellNumber: this.getCellCount.bind(this),\r\n                getCellSize: this.getCellHeight.bind(this),\r\n                getCellIdentifer: this.getCellIdentifer.bind(this),\r\n                getCellView: this.getCellView.bind(this),\r\n                getCellData: this.GetCellData.bind(this),\r\n            })\r\n        } else {\r\n            this.list_view.Reload(false, true)\r\n        }\r\n    }\r\n    protected onDestroy(): void {\r\n        super.onDestroy();\r\n    }\r\n    getCellCount() {\r\n        return this._list.length;\r\n    }\r\n    getCellHeight() {\r\n        return 330;\r\n    }\r\n    getCellIdentifer() {\r\n        return \"MallLayoutCell\";\r\n    }\r\n    getCellView() {\r\n        return instantiate(this.pfb_item).getComponent(MallLayoutCell);\r\n    }\r\n    GetCellData(idx: number) {\r\n        return { data: this._list[idx], view: this._view_type, viewName: this._view_name }\r\n    }\r\n    on_s2c_BuyFixedShopCommodityRsp(msg: proto.Msg_BuyFixedShopCommodityRsp) {\r\n        if (msg.error && msg.error.code != proto.CommonErrorCode.Succeed) return;\r\n        this.list_view.Refresh();\r\n    }\r\n    groupListData() {\r\n        const splitCount = 4;\r\n        const result = [];\r\n        let listData = this._shop_view.get(this._view_name);\r\n        for (let i = 0; i < listData.length; i += splitCount) {\r\n            result.push(listData.slice(i, i + splitCount));\r\n        }\r\n        return { data: result, name: this._view_name };\r\n    }\r\n    clickSwitchView(e: EventTouch, view_type: String) {\r\n        if (Number(view_type) == this._view_name) {\r\n            return;\r\n        }\r\n        this._view_name = Number(view_type);\r\n        this.initView(false);\r\n    }\r\n}\r\n\r\n\r\n"]}