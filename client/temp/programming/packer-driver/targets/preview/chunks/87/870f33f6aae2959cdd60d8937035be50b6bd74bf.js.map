{"version":3,"sources":["file:///C:/chickenStarClient/client/assets/scripts/logic/model/item/HeroItem.ts"],"names":["_decorator","Component","Label","log","Node","Sprite","tab","HeroStar","HeroDataControl","UIMgr","ViewName","RoleData","ccclass","property","HeroItem","data","heroInfo","touchCallBack","isSelect","setLevel","lv","numLab","string","String","node","active","setSelect","select","node_select","setHeroProbablity","iconImg","grayscale","sp_sign","starNode","getSelect","setHeroActive","srr","UpdateContent","initView","node_piece","node_common","notNode","itemNode","heronumLab","itemTab","itemTable","itemQualityTab","ins","getItemQualityTableByStar","star","heroClassTab","heroClassTable","heroAptitudeTab","heroAptitudeTable","qualityImg","setTexture","Quality","Icon","sp_vocation","sp_quality_bg","QualityFrame","sp_quality_star_bg","HeroStarBg","level","getHeroLevel","maxLevel","heroStarUpTable","MaxLevel","getComponent","showStar","addTouchEvent","setGrayScale","map","getBookReceivedIds","itemData","get","itemId","setTouchCallBack","callBack","on","EventType","TOUCH_END","onTouchItem","showHeroNum","num","Type","ItemType","ItemType_Equip","refreshBookData","Id","show","viewName","HeroBagView","viewType","zIndex","onDisable","onDestroy","targetOff","setPiece","getChildByName","setAutoDisband","isN","node_auto_disband","autoDisband","setHeroStar"],"mappings":"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","sourcesContent":["import { _decorator, Color, Component, Label, log, Node, ProgressBar, Sprite } from 'cc';\r\nimport { tab } from '../../../Table/table_gen';\r\nimport { HeroInfo } from '../hero/HeroInfo';\r\nimport { HeroStar } from '../hero/HeroStar';\r\nimport { HeroData } from '../hero/HeroData';\r\nimport { HeroDataControl } from '../hero/herobag/HeroDataControl';\r\nimport { HeroTeamControl } from '../hero/HeroTeamControl';\r\nimport { UIMgr } from '../../mgr/UIMgr';\r\nimport { ViewName } from '../../define/ViewDefine';\r\nimport { RoleData } from '../role/RoleData';\r\nconst { ccclass, property } = _decorator;\r\n\r\n@ccclass('HeroItem')\r\nexport class HeroItem extends Component {\r\n    @property(Sprite)\r\n    qualityImg: Sprite = null;\r\n    @property(Sprite)\r\n    iconImg: Sprite = null;\r\n    @property(Sprite)\r\n    sp_sign: Sprite = null;//品质 优良精卓\r\n    @property(Sprite)\r\n    sp_vocation: Sprite = null;//职业\r\n    @property(Sprite)\r\n    sp_quality: Sprite = null;//品质\r\n\r\n    @property(Node)\r\n    starNode: Node = null;\r\n    @property(Node)\r\n    node_select: Node = null;\r\n\r\n    @property(Label)\r\n    numLab: Label = null;\r\n\r\n    @property(Node)\r\n    notNode: Node = null;\r\n    @property(Node)\r\n    itemNode: Node = null;\r\n\r\n    @property(Sprite)\r\n    sp_quality_bg: Sprite = null;//品质框\r\n    @property(Sprite)\r\n    sp_quality_star_bg: Sprite = null;//装备星级职业底\r\n\r\n    @property(Label)\r\n    heronumLab: Label = null;\r\n\r\n    @property(Node)\r\n    node_piece: Node = null;\r\n    @property(Node)\r\n    node_common: Node = null;\r\n    @property(Node)\r\n    node_auto_disband:Node = null;\r\n\r\n    private data: HeroInfo;\r\n    public heroInfo: HeroInfo;\r\n    private touchCallBack: Function;\r\n    private isSelect: boolean;\r\n    setLevel(lv: number) {\r\n        this.numLab.string = String(lv);\r\n        this.numLab.node.active = lv !== 0;\r\n    }\r\n    setSelect(select: boolean) {\r\n        this.isSelect = select;\r\n        this.node_select.active = select;\r\n    }\r\n    setHeroProbablity() {\r\n        this.node_select.active = false;\r\n        this.iconImg.grayscale = false;\r\n        this.sp_sign.node.active = true;\r\n        this.starNode.active = true;\r\n        this.numLab.node.active = false;\r\n        //this.numLab.string = \"x1\";\r\n    }\r\n    getSelect() {\r\n        return this.isSelect;\r\n    }\r\n    /* 是否显示SRR品质 */\r\n    setHeroActive(srr: boolean) {\r\n        this.sp_sign.node.active = srr;\r\n        // this.starNode.active = star;\r\n        // this.numLab.node.active = !star;\r\n    }\r\n    UpdateContent(data: HeroInfo) {\r\n        this.data = data;\r\n        this.initView();\r\n    }\r\n    initView() {\r\n        if (this.data) {\r\n            this.node_piece.active = false;\r\n            this.node_common.active = true;\r\n            this.notNode.active = false;\r\n            this.itemNode.active = true;\r\n            this.heronumLab.node.active = false;\r\n            this.starNode.active = true;\r\n            this.numLab.node.active = true;\r\n\r\n            this.heroInfo = this.data\r\n            const data: HeroInfo = this.data\r\n\r\n            const itemTab = this.data.itemTable;\r\n            const itemQualityTab = HeroDataControl.ins.getItemQualityTableByStar(this.heroInfo.star);\r\n            const heroClassTab = data.heroClassTable;\r\n            const heroAptitudeTab = data.heroAptitudeTable;\r\n\r\n\r\n            // setTexture\r\n            this.qualityImg.setTexture(\"textrue/quality/qualityBg_\" + itemTab.Quality);\r\n            this.iconImg.setTexture(itemTab.Icon);\r\n            this.sp_vocation.setTexture(heroClassTab.Icon);\r\n            this.sp_sign.setTexture(heroAptitudeTab.Icon);\r\n            this.sp_quality_bg.setTexture(itemQualityTab.QualityFrame);\r\n            this.sp_quality_star_bg.setTexture(itemQualityTab.HeroStarBg);\r\n            // if (!itemData) {\r\n            //     this.iconImg.grayscale = true;\r\n            // } else {\r\n            //     this.iconImg.grayscale = false;\r\n            // }\r\n            // Label\r\n            let level = 0;\r\n            if (this.data.level) {\r\n                level = this.data.level;\r\n            } else {\r\n                level = data.getHeroLevel();\r\n                let maxLevel = data.heroStarUpTable.MaxLevel;\r\n                if (maxLevel < data.getHeroLevel()) {\r\n                    level = maxLevel;\r\n                }\r\n            }\r\n            this.numLab.string = level ? String(level) : \"\";\r\n\r\n            // 星级\r\n            this.starNode.getComponent(HeroStar).showStar(this.heroInfo.star);\r\n            this.setSelect(false);\r\n\r\n        } else {\r\n            this.notNode.active = true;\r\n            this.itemNode.active = false;\r\n        }\r\n\r\n        this.addTouchEvent();\r\n\r\n    }\r\n    setGrayScale() {\r\n        const map = HeroDataControl.ins.getBookReceivedIds();\r\n        const itemData = map.get(this.data.itemId);\r\n        if (!itemData) {\r\n            this.iconImg.grayscale = true;\r\n        } else {\r\n            this.iconImg.grayscale = false;\r\n        }\r\n    }\r\n    setTouchCallBack(callBack: Function) {\r\n        this.touchCallBack = callBack;\r\n\r\n    }\r\n    private addTouchEvent() {\r\n        this.node.on(Node.EventType.TOUCH_END, this.onTouchItem, this)\r\n    }\r\n    public showHeroNum(num: number) {\r\n        this.heronumLab.node.active = true;\r\n        this.heronumLab.string =\"x\" + num + \"\";\r\n    }\r\n    private onTouchItem() {\r\n        if (this.touchCallBack) {\r\n            this.touchCallBack();\r\n        } else {\r\n            log(\"点击了item\");\r\n            let itemTab = this.data.itemTable;\r\n            if (itemTab.Type !== tab.ItemType.ItemType_Equip) {\r\n                HeroDataControl.ins.refreshBookData(itemTab.Id);\r\n                UIMgr.ins.show({ viewName: ViewName.HeroBagView, data: { viewType: 2 }, zIndex: 300 })\r\n            }\r\n        }\r\n    }\r\n    protected onDisable(): void {\r\n        // this.node.targetOff(this);\r\n        // ItemPoolMgr.ins.putHeroItem(this.node);\r\n        this.starNode.getComponent(HeroStar).onDisable();\r\n    }\r\n\r\n    protected onDestroy(): void {\r\n        this.node.targetOff(this);\r\n    }\r\n    setPiece(num: number) {\r\n        this.node_piece.active = true;\r\n        this.node_common.active = false;\r\n        this.node_piece.getChildByName(\"piece_bar\").active = false;\r\n        this.showHeroNum(num);\r\n        this.setLevel(0)\r\n    }\r\n    setAutoDisband(isN:boolean){\r\n        this.node_auto_disband.active = RoleData.ins.autoDisband&&isN;\r\n    }\r\n    setHeroStar(star:number){\r\n        this.starNode.getComponent(HeroStar).showStar(star);\r\n    }\r\n}\r\n\r\n\r\n"]}