{"version":3,"sources":["file:///C:/chickenStarClient/client/assets/scripts/logic/model/equip/EquipInfo.ts"],"names":["EquipInfo","_decorator","proto","tab","EquipAttrInfo","EquipData","ccclass","property","constructor","_itemTable","_equipTable","_isWear","_totalAttr","_slotInfo","_baseAttrInfos","_extraAttrInfos","_enhanceUpgradeTable","_refineUpgradeTable","_jadeHeroClass","merge","equip","key","createDefaultData","itemId","id","score","updateData","initBaseAttrInfos","initExtraAttrInfos","updateTotalAttr","baseAttr","info","initAttrId","push","baseAttrInfos","extraAttr","extraAttrInfos","itemTable","getData","ItemTableById","getValue","heroClass","equipTable","Type","EquipType","EquipType_Feather","Class","num","EquipTableById","isWear","b","quality","Quality","type","getEquipTypeNameKey","totalAttr","clear","attrType","attrTable","AttrType","addValue","getAddValueByLevel","enhanceLv","has","value","get","set","Base","refineLv","Map","slotInfo","EnhanceLimit","isEnhanceLimit","isRefineLimit","RefineLimit","refreshEquipUpgradeTable","level","ins","getEquipUpgradeTab","EquipUpgradeType","EquipUpgradeType_Enhance","enhanceUpgradeTable","refreshRefineEquipUpgradeTable","EquipUpgradeType_Refine","refineUpgradeTable"],"mappings":"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","sourcesContent":["import { Node, Prefab, _decorator } from \"cc\";\nimport { proto } from \"client_protocol\";\nimport { tab } from \"../../../Table/table_gen\";\nimport { EquipAttrInfo } from \"./EquipAttrInfo\";\nimport { EquipData } from \"./EquipData\";\n\nconst { ccclass, property } = _decorator;\n\n/** 装备数据 */\nexport class EquipInfo extends proto.EquipData {\n    private _itemTable: tab.ItemTable;\n\n\n    private _equipTable: tab.EquipTable;\n\n    private _isWear: boolean = false;\n    /**装备 总的属性map */\n    private _totalAttr: Map<number, number>;\n\n    private _slotInfo: proto.EquipSlotData;\n\n    private _baseAttrInfos: Array<EquipAttrInfo>;\n    private _extraAttrInfos: Array<EquipAttrInfo>;\n    private _enhanceUpgradeTable: tab.EquipUpgradeTable;\n    private _refineUpgradeTable: tab.EquipUpgradeTable;\n\n    //因为玉佩只有穿戴上才会有heroClass\n    private _jadeHeroClass: number = 0;\n\n    constructor() {\n        super()\n    }\n\n    merge(equip: any) {\n        for (const key in equip) {\n            this[key] = equip[key]\n        }\n\n    }\n   public createDefaultData(itemId: number) {\n        this.id = 0;\n        this.score = 0;\n        this.itemId = itemId;\n\n    }\n\n    updateData(equip: any) {\n        this.merge(equip);\n        this.initBaseAttrInfos();\n        this.initExtraAttrInfos();\n        this.updateTotalAttr();\n\n    }\n    private initBaseAttrInfos() {\n        this._baseAttrInfos = [];\n        for (let key in this.baseAttr) {\n            let info = new EquipAttrInfo();\n            info.initAttrId(this.baseAttr[key]);\n            this._baseAttrInfos.push(info);\n        }\n    }\n    get baseAttrInfos() {\n        if (!this._baseAttrInfos) {\n            this.initBaseAttrInfos();\n        }\n        return this._baseAttrInfos;\n    }\n\n    private initExtraAttrInfos() {\n        this._extraAttrInfos = [];\n        for (let key in this.extraAttr) {\n            let info = new EquipAttrInfo();\n            info.initAttrId(this.extraAttr[key]);\n            this._extraAttrInfos.push(info);\n        }\n    }\n    get extraAttrInfos() {\n        if (!this._extraAttrInfos) {\n            this.initExtraAttrInfos();\n        }\n        return this._extraAttrInfos;\n    }\n    /**\n   * 道具表数据\n   */\n    get itemTable() {\n        if (!this._itemTable) {\n            this._itemTable = tab.getData().ItemTableById.getValue(this[\"itemId\"]);\n        }\n        return this._itemTable;\n    }\n\n    get heroClass() {\n        if (this.equipTable.Type == tab.EquipType.EquipType_Feather) {\n            return this._jadeHeroClass;\n        }\n        return this.equipTable.Class;\n    }\n    set heroClass(num: number) {\n        if (this.equipTable.Type == tab.EquipType.EquipType_Feather) {\n            this._jadeHeroClass = num;\n        }\n    }\n    get equipTable() {\n        if (!this._equipTable) {\n            this._equipTable = tab.getData().EquipTableById.getValue(this[\"itemId\"]);\n        }\n        return this._equipTable;\n    }\n    /**是否穿戴 */\n    get isWear() {\n        return this._isWear;\n    }\n    set isWear(b: boolean) {\n        this._isWear = b;\n    }\n    get quality() {\n        return this.itemTable.Quality;\n    }\n    get type() {\n        return this.equipTable.Type;\n    }\n\n\n    /**\n     * 获取装备类型world表里的key\n     * @returns \n     */\n    getEquipTypeNameKey() {\n        return tab.EquipType[this.equipTable.Type];\n    }\n    updateTotalAttr() {\n        this.totalAttr.clear();\n        for (let key in this.baseAttrInfos) {\n            // let table = tab.getData().EquipAttrTableById.getValue(this.baseAttr[key]);\n            // let addValue=\n            let info = this.baseAttrInfos[key];\n            let attrType = info.attrTable.AttrType;\n            let addValue = info.getAddValueByLevel(this.enhanceLv);\n            if (this.totalAttr.has(attrType)) {\n                let value = this.totalAttr.get(attrType);\n                this.totalAttr.set(attrType, value + info.attrTable.Base + addValue);\n            } else {\n                this.totalAttr.set(attrType, info.attrTable.Base + addValue);\n            }\n        }\n        for (let key in this.extraAttrInfos) {\n            let info = this.extraAttrInfos[key];\n            let attrType = info.attrTable.AttrType;\n            let addValue = info.getAddValueByLevel(this.refineLv);\n            if (this.totalAttr.has(attrType)) {\n                let value = this.totalAttr.get(attrType);\n                this.totalAttr.set(attrType, value + info.attrTable.Base + addValue);\n            } else {\n                this.totalAttr.set(attrType, info.attrTable.Base + addValue);\n            }\n        }\n\n    }\n    /**\n     * 总属性\n     */\n    get totalAttr() {\n        if (!this._totalAttr) {\n            this._totalAttr = new Map();\n            this.updateTotalAttr();\n        }\n        return this._totalAttr;\n    }\n\n    set slotInfo(info: proto.IEquipSlotData) {\n        this._slotInfo = (info) as proto.EquipSlotData;\n\n    }\n    get slotInfo() {\n        return this._slotInfo;\n    }\n    get enhanceLv() {\n        if (this.slotInfo&&this.slotInfo.enhanceLv <= this.equipTable.EnhanceLimit) {\n            return this.slotInfo.enhanceLv;\n        }\n        return this.equipTable.EnhanceLimit;\n    }\n    isEnhanceLimit() {\n        return this.enhanceLv >= this.equipTable.EnhanceLimit;\n    }\n    isRefineLimit() {\n        return this.refineLv >= this.equipTable.RefineLimit;\n    }\n    get refineLv() {\n        if (this.slotInfo&&this.slotInfo.refineLv <= this.equipTable.RefineLimit) {\n            return this.slotInfo.refineLv;\n        }\n        return this.equipTable.RefineLimit;\n    }\n    refreshEquipUpgradeTable() {\n        // let tabs=tab.getData().EquipUpgradeTable;\n        let level = this.enhanceLv + 1;\n        this._enhanceUpgradeTable = EquipData.ins.getEquipUpgradeTab(tab.EquipUpgradeType.EquipUpgradeType_Enhance, level);\n    }\n    get enhanceUpgradeTable() {\n        if (!this._enhanceUpgradeTable) {\n            this.refreshEquipUpgradeTable();\n        }\n        return this._enhanceUpgradeTable;\n    }\n    refreshRefineEquipUpgradeTable() {\n        // let tabs=tab.getData().EquipUpgradeTable;\n        let level = this.refineLv + 1;\n        this._refineUpgradeTable = EquipData.ins.getEquipUpgradeTab(tab.EquipUpgradeType.EquipUpgradeType_Refine, level);\n        // this._refineUpgradeTable=tabs.find(a=>a.Level==level&&tab.EquipUpgradeType.EquipUpgradeType_Refine);\n    }\n    get refineUpgradeTable() {\n        if (!this._refineUpgradeTable) {\n            this.refreshRefineEquipUpgradeTable();\n        }\n        return this._refineUpgradeTable;\n    }\n}"]}