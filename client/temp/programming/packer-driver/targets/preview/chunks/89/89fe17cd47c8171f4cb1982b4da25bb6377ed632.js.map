{"version":3,"sources":["file:///C:/chickenStarClient/client/assets/scripts/logic/model/home/Community_list.ts"],"names":["_decorator","Node","EventMgr","LocalEvent","Global","Func","RoleData","BattleMainDataControl","ComponentBase","ChannelMgr","proto","UIMgr","ViewName","ccclass","property","Jp37PopBtnType","jp37RedKey","Community_list","onLoad","community_layout","children","forEach","item","active","start","isReview","isP8","communityBtnNode","isJp37","isDevChannel","twitter_btnNode","refresh37Btn","updateInspireBtn","register","onLocal","onMsg","Ptl","Mobile37PopupsPush","s2c_Mobile37PopupsPush","msg","unscheduleAllCallbacks","btn_15","btn_2","btn_1","pops","getChannel","popBtns","iterator","v","btn","type","checkBtnRed","schedule","inspireBtnNode","ins","getIsPasstStageByStageId","isComment","Number","getItem","id","onClickCommunity","console","log","channelTab","openURL","FaceBookUrl","onTwitterClick","show","viewName","CommunityPop","onClickSojump","onOpenWebView","sojump","onClickEvent","eventPop","onClickClient","gsPop","get","openActionWebView","url","setItem","dd","getChildByName","red","checkInt"],"mappings":"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","sourcesContent":["import { _decorator, Component, Label, Node } from 'cc';\nimport { EventMgr } from '../../mgr/EventMgr';\nimport { LocalEvent } from '../../define/LocalEvent';\nimport { ItemData } from '../item/ItemData';\nimport { Global } from '../../../Global';\nimport { Func } from '../../utils/Func';\nimport { RoleData } from '../role/RoleData';\nimport { BattleMainDataControl } from './battle/BattleMainDataControl';\nimport { ComponentBase } from '../../../framework/base/ComponentBase';\nimport { ChannelMgr } from '../../../channel/ChannelMgr';\nimport { proto } from 'client_protocol';\nimport { JP37Channel } from '../../../channel/jp37/JP37Channel';\nimport { UIMgr } from '../../mgr/UIMgr';\nimport { ViewName } from '../../define/ViewDefine';\n// import { JP37Channel } from '../../../channel/jp37/JP37Channel';\nconst { ccclass, property } = _decorator;\n\n//弹窗类型：1-GS弹窗；2-精彩事件；12-新手福利；13-周一福利;14-社媒弹窗；15-问卷星\nenum Jp37PopBtnType {\n    gsPop = 1,\n    eventPop = 2,\n    sojump = 15\n}\n\nconst jp37RedKey = \"jp37btn_red_\"\n\n/**\n * 主界面sdk公共按钮\n */\n@ccclass('Community_list')\nexport class Community_list extends ComponentBase {\n    @property(Node)\n    community_layout: Node = null\n\n    @property(Node)\n    communityBtnNode: Node = null;\n    @property(Node)\n    inspireBtnNode: Node = null;\n    @property(Node)\n    twitter_btnNode: Node = null;\n    @property(Node)\n    discord_btnNode: Node = null;\n\n    @property(Node)\n    btn_15: Node = null //问卷星\n    @property(Node)\n    btn_2: Node = null //精彩事件\n    @property(Node)\n    btn_1: Node = null//大客户\n\n    protected onLoad(): void {\n        super.onLoad()\n        this.community_layout.children.forEach((item: Node) => {\n            item.active = false\n        })\n    }\n\n    protected start(): void {\n        if (!Global.isReview) {\n            if (ChannelMgr.isP8) {\n                this.communityBtnNode.active = true;\n            }\n\n            if (ChannelMgr.isJp37 || ChannelMgr.isDevChannel) {\n                this.twitter_btnNode.active = true;\n                this.refresh37Btn()\n            }\n            this.updateInspireBtn();\n            \n        }\n    }\n\n    register(): void {\n        EventMgr.onLocal(LocalEvent.updateInspireBtn, this.updateInspireBtn, this)\n        EventMgr.onMsg(proto.Ptl.Mobile37PopupsPush, this.s2c_Mobile37PopupsPush, this)\n    }\n\n    s2c_Mobile37PopupsPush(msg: proto.Msg_Mobile37PopupsPush) {\n        //更新3个按钮\n        this.refresh37Btn()\n    }\n\n    refresh37Btn(){\n        this.unscheduleAllCallbacks()\n        if (Global.isReview){\n            return\n        }\n        this.btn_15.active = this.btn_2.active = this.btn_1.active = false\n        let pops = (ChannelMgr.getChannel() as JP37Channel).popBtns\n        if (pops) {\n            for (const iterator of pops) {\n                let v = iterator[1]\n                let btn = this[\"btn_\" + v.type]\n                if (btn) {\n                    btn.active = true\n                    this.checkBtnRed(v)\n                }\n            }\n        }\n\n        this.schedule(() => { //5分钟刷新一次\n            this.refresh37Btn()\n        },60*5)\n    }\n\n    updateInspireBtn() {\n        if (Global.isReview){\n            this.inspireBtnNode.active = false;\n            return\n        }\n        if (BattleMainDataControl.ins.getIsPasstStageByStageId(503)) {\n            let isComment = Number(Func.getItem(\"isComment_\" + RoleData.ins.id));\n            if (!isComment) {\n                this.inspireBtnNode.active = true;\n            } else {\n                this.inspireBtnNode.active = false;\n            }\n        } else {\n            this.inspireBtnNode.active = false;\n        }\n    }\n\n    onClickCommunity() {\n        console.log(\"js调用打开网页\")\n        if (ChannelMgr.channelTab) {\n            ChannelMgr.openURL(ChannelMgr.channelTab.FaceBookUrl);\n        } else {\n            ChannelMgr.openURL(\"https://www.facebook.com/cjxd.re.tw/\")\n        }\n    }\n\n    onTwitterClick() {\n        // ChannelMgr.openURL(\"https://x.com/pipiyuusya/\")\n        UIMgr.ins.show({ viewName:ViewName.CommunityPop})\n    }\n\n    onClickSojump() {\n        this.onOpenWebView(Jp37PopBtnType.sojump)\n    }\n\n    onClickEvent() {\n        this.onOpenWebView(Jp37PopBtnType.eventPop)\n    }\n\n    onClickClient() {\n        this.onOpenWebView(Jp37PopBtnType.gsPop)\n    }\n\n    onOpenWebView(type: number) {\n        let pops = (ChannelMgr.getChannel() as JP37Channel).popBtns\n        if (pops) {\n            let v = pops.get(type)\n            if (v) {\n                ChannelMgr.openActionWebView(v.url)\n                Func.setItem(jp37RedKey + v.type, 1)\n                this.checkBtnRed(v)\n            }\n        }\n    }\n\n    checkBtnRed(dd: proto.IMobile37PopupInfo) {\n        let btn = this[\"btn_\" + dd.type]\n        if (btn) {\n            btn.getChildByName(\"redNode\").active = dd.red && Func.checkInt(Func.getItem(jp37RedKey + dd.type)) == 0\n        }\n    }\n}\n\n\n"]}