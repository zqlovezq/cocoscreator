{"version":3,"sources":["file:///C:/chickenStarClient/client/assets/scripts/logic/model/association/AssociationBossView.ts"],"names":["_decorator","instantiate","Label","Node","Prefab","ViewPop","proto","Net","tab","AssociationControl","EventMgr","SimpleRoleInfo","TopWarPlayRankHeadiItem","AssociationData","createAnimation","GameUtil","getTimeUntilNextDay","setTextTime","RoleData","TopWarBossSkillItem","LangMgr","CommonTipsPop","CommonTipsPopCloseType","ShowTips","UIMgr","ViewName","ccclass","property","AssociationBossView","rankMsg","endTimer","updateTimer","timerLab","string","unschedule","onShow","ins","reqGetGuildBossRank","onDestroy","register","onMsg","Ptl","GetGuildBossRankRsp","on_s2c_GetGuildBossRankRsp","GuildBossDataPush","on_s2c_GuildBossDataPush","msg","refreshSelfRoleRankScore","maxScore","initMyRank","unRegister","initSkills","initEndTimer","setGuildHerosSpine","roleRank","key","rankHerads","getChildByName","active","top_player_list","i","length","push","node","headItem","getComponent","info","merge","simple","initView","roleInfo","setRankLab","Number","nameLab","name","selfSimple","getSelfRoleRankInfo","_ranking","getRoleRankSelfRanking","myHerdItem","headFrame","avatarInfo","headIcon","myNode","totalDamageLab","convertNumber","score","node_not_rank_self","freeCount","getData","GetKeyValue_ConfigTable","GuildBossDailyCount","num","GuildBossMsg","challengeCount","buyNum","GuildBossDailyBuyCount","lastChallengeNum","sweepBtnNode","checkFunctionIsOpen","GuildOFName","GuildOFName_GuildBoss","skillIds","GuildBossShowSkillIds","item","skillPrefab","parent","skillLayout","initSkillId","schedule","onClickChallenge","isOpen","callBack","Msg_StartStageReq","stageId","Send","StartStageReq","buyChallenge","showFunctionTips","totalNum","isPrivilege","tips","spend","getCombineString","buySpends","GuildBossDailyBuyCostDiamonds","currBuyNum","create","closeType","confirm","diamond","getLab","console","log","onClickSweep","reqQuickSweepBoss","membersArr","getGuildMemberArr","player","node_player","lbl","highestHeroItemId","heroTab","HeroTableById","getValue","Idle","showAllRank","show","viewName","AssociationRankPop","showAwards","e","type","AssociationRankRewardPop","data"],"mappings":"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","sourcesContent":["/*\r\n * @Date: 2024-09-18 14:50:45\r\n * @LastEditors: wzq\r\n * @pragram:公会boss\r\n * @LastEditTime: 2024-11-05 10:09:21\r\n */\r\n\r\nimport { _decorator, Component, EventTouch, instantiate, Label, Node, Prefab } from 'cc';\r\nimport { ViewPop } from '../../../framework/base/ViewPop';\r\nimport { proto } from 'client_protocol';\r\nimport { Net } from '../../net/Net';\r\nimport { tab } from '../../../Table/table_gen';\r\nimport { AssociationControl } from './AssociationControl';\r\nimport { EventMgr } from '../../mgr/EventMgr';\r\nimport { SimpleRoleInfo } from '../friends/SimpleRoleInfo';\r\nimport { TopWarPlayRankHeadiItem } from '../jianghu/topWar/TopWarPlayRankHeadiItem';\r\nimport { AssociationData } from './AssociationData';\r\nimport { createAnimation, GameUtil, getTimeUntilNextDay, setTextTime } from '../../utils/GameUtil';\r\nimport { RoleData } from '../role/RoleData';\r\nimport { OpenFunctionMgr } from '../../../Common/component/OpenFunctionMgr';\r\nimport { TopWarBossSkillItem } from '../jianghu/topWar/topWarBossSkillItem';\r\nimport { LangMgr } from '../../mgr/LangMgr';\r\nimport { CommonTipsPop, CommonTipsPopCloseType } from '../common/CommonTipsPop';\r\nimport { ShowTips, UIMgr } from '../../mgr/UIMgr';\r\nimport { ViewName } from '../../define/ViewDefine';\r\nconst { ccclass, property } = _decorator;\r\n\r\n@ccclass('AssociationBossView')\r\nexport class AssociationBossView extends ViewPop {\r\n    @property([Node])\r\n    rankHerads: Array<Node> = [];\r\n    @property(TopWarPlayRankHeadiItem)\r\n    myHerdItem: TopWarPlayRankHeadiItem = null;\r\n    @property(Label)\r\n    totalDamageLab: Label = null;\r\n    @property(Label)\r\n    lastChallengeNum: Label = null;\r\n    @property(Node)\r\n    sweepBtnNode: Node = null;\r\n    @property(Prefab)\r\n    skillPrefab: Prefab = null;\r\n    @property(Node)\r\n    skillLayout: Node = null;\r\n    @property(Label)\r\n    timerLab: Label = null;\r\n    @property(Node)\r\n    node_player: Node = null;\r\n    @property(Node)\r\n    node_not_rank_self:Node = null;\r\n    private rankMsg: proto.ISimpleRank[];\r\n    private endTimer: number;\r\n    onShow(): void {\r\n        AssociationControl.ins.reqGetGuildBossRank();\r\n    }\r\n    protected onDestroy(): void {\r\n        super.onDestroy();\r\n    }\r\n    register(): void {\r\n        EventMgr.onMsg(proto.Ptl.GetGuildBossRankRsp, this.on_s2c_GetGuildBossRankRsp, this);\r\n        EventMgr.onMsg(proto.Ptl.GuildBossDataPush, this.on_s2c_GuildBossDataPush, this);\r\n    }\r\n    on_s2c_GuildBossDataPush(msg: proto.Msg_GuildBossDataPush) {\r\n        AssociationData.ins.refreshSelfRoleRankScore(msg.maxScore);\r\n        this.initMyRank();\r\n    }\r\n    unRegister(): void {\r\n        super.unRegister();\r\n    }\r\n    on_s2c_GetGuildBossRankRsp(msg: proto.Msg_GetGuildBossRankRsp) {\r\n\r\n        this.initSkills();\r\n        this.initMyRank();\r\n        this.initEndTimer();\r\n        this.setGuildHerosSpine();\r\n        this.rankMsg = msg.roleRank;\r\n        for (let key in this.rankHerads) {\r\n            this.rankHerads[key].getChildByName(\"notRank_node\").active = true;\r\n            this.rankHerads[key].getChildByName(\"PlayRankHeadiItem\").active = false;;\r\n            this.rankHerads[key].getChildByName(\"playname_txt\").active = false;\r\n        }\r\n        let top_player_list = [];\r\n        for (let i = 0; i < this.rankMsg.length; i++) {\r\n            if (i < 3) {\r\n                top_player_list.push(this.rankMsg[i])\r\n            }\r\n        }\r\n        if (top_player_list.length > 0) {\r\n            for (let key in top_player_list) {\r\n                let node = this.rankHerads[key];\r\n                node.getChildByName(\"notRank_node\").active = false;\r\n                node.getChildByName(\"PlayRankHeadiItem\").active = true;\r\n                let headItem = node.getChildByName(\"PlayRankHeadiItem\").getComponent(TopWarPlayRankHeadiItem);\r\n                let info = new SimpleRoleInfo();\r\n                info.merge(top_player_list[key].simple);\r\n                headItem.initView({ roleInfo: info });\r\n                headItem.setRankLab(Number(key) + 1);\r\n                let nameLab = node.getChildByName(\"playname_txt\").getComponent(Label);\r\n                nameLab.node.active = true;\r\n                nameLab.string = top_player_list[key].simple.name;\r\n            }\r\n        }\r\n    }\r\n    initMyRank() {\r\n        // error(\"头像功能没有做\")\r\n        const selfSimple = AssociationData.ins.getSelfRoleRankInfo()\r\n        // const ranking = AssociationData.ins.getSelfRoleRankCount();\r\n        const _ranking = AssociationData.ins.getRoleRankSelfRanking();\r\n        this.myHerdItem.setRankLab(_ranking);\r\n        this.myHerdItem.initView({ headFrame: RoleData.ins.avatarInfo.headFrame, headIcon: RoleData.ins.avatarInfo.headIcon })\r\n\r\n        this.myHerdItem.myNode.active = true;\r\n        if(selfSimple){\r\n            this.totalDamageLab.string = GameUtil.convertNumber(selfSimple.score);\r\n        }\r\n        this.node_not_rank_self.active = _ranking===-1\r\n        let freeCount = tab.getData().GetKeyValue_ConfigTable().GuildBossDailyCount;\r\n        let num = AssociationData.ins.GuildBossMsg.challengeCount;\r\n        let buyNum = tab.getData().GetKeyValue_ConfigTable().GuildBossDailyBuyCount;\r\n        if (num < freeCount) {\r\n            this.lastChallengeNum.string = \"\" + buyNum;\r\n        } else {\r\n            this.lastChallengeNum.string = \"\" + (freeCount + buyNum - num);\r\n        }\r\n        this.sweepBtnNode.active = AssociationData.ins.GuildBossMsg.maxScore > 0 && AssociationData.ins.checkFunctionIsOpen(tab.GuildOFName.GuildOFName_GuildBoss);\r\n\r\n\r\n        // let herodInfo=RoleData.ins.\r\n    }\r\n    initSkills() {\r\n        let skillIds = tab.getData().GetKeyValue_ConfigTable().GuildBossShowSkillIds;\r\n        for (let key in skillIds) {\r\n            let item = instantiate(this.skillPrefab);\r\n            item.parent = this.skillLayout;\r\n            item.getComponent(TopWarBossSkillItem).initSkillId(skillIds[key]);\r\n        }\r\n    }\r\n    initEndTimer() {\r\n        this.unschedule(this.updateTimer)\r\n        this.endTimer = getTimeUntilNextDay();\r\n        this.timerLab.string = setTextTime(this.endTimer);\r\n        this.schedule(this.updateTimer, 1)\r\n    }\r\n    updateTimer = () => {\r\n        this.endTimer--;\r\n        if (this.endTimer >= 0) {\r\n            this.timerLab.string = setTextTime(this.endTimer);\r\n        } else {\r\n            this.unschedule(this.updateTimer)\r\n        }\r\n    }\r\n    onClickChallenge() {\r\n        const isOpen = AssociationData.ins.checkFunctionIsOpen(tab.GuildOFName.GuildOFName_GuildBoss);\r\n        if(isOpen){\r\n            let callBack = () => {\r\n                let msg = new proto.Msg_StartStageReq();\r\n                msg.stageId = AssociationData.ins.GuildBossMsg.stageId;\r\n                Net.Send(proto.Ptl.StartStageReq, msg)\r\n            }\r\n            this.buyChallenge(callBack);\r\n        }else{\r\n            AssociationData.ins.showFunctionTips(tab.GuildOFName.GuildOFName_GuildBoss);\r\n        }\r\n    }\r\n    private buyChallenge(callBack: Function) {\r\n        let freeCount = tab.getData().GetKeyValue_ConfigTable().GuildBossDailyCount;\r\n        let num = AssociationData.ins.GuildBossMsg.challengeCount;\r\n        if (num < freeCount) {\r\n            callBack();\r\n        } else {\r\n            let buyNum = tab.getData().GetKeyValue_ConfigTable().GuildBossDailyBuyCount;\r\n            let totalNum = buyNum + freeCount;\r\n            if (num < totalNum) {\r\n\r\n                let isPrivilege = AssociationData.ins.checkFunctionIsOpen(tab.GuildOFName.GuildOFName_GuildBoss)\r\n                //弹窗购买框\r\n                let tips = \"\";\r\n                let spend = 0;\r\n                if (isPrivilege) {\r\n                    //tips=\"特权购买免费次数提示\\n今日剩余购买次数\"+(totalNum-num);\r\n                    tips = LangMgr.getCombineString(\"Tips_worldboss_2\", [totalNum - num]);\r\n                } else {\r\n                    let buySpends = tab.getData().GetKeyValue_ConfigTable().GuildBossDailyBuyCostDiamonds;\r\n                    let currBuyNum = buyNum - (totalNum - num);\r\n                    if (buySpends.length - 1 >= currBuyNum) {\r\n                        // if(currBuyNum<0){\r\n                        //     spend=buySpends[0];\r\n                        // }else{\r\n                        spend = buySpends[currBuyNum];\r\n                        //}\r\n\r\n                    } else {\r\n                        spend = buySpends[buySpends.length - 1];\r\n                    }\r\n                    //tips=\"是否花费\"+spend+\"钻石购买一次挑战次数 \\n今日剩余购买次数\"+(totalNum-num);\r\n                    tips = LangMgr.getCombineString(\"Tips_worldboss_1\", [spend, totalNum - num]);\r\n                }\r\n                CommonTipsPop.create(tips, (closeType: CommonTipsPopCloseType) => {\r\n                    if (closeType == CommonTipsPopCloseType.confirm) {\r\n                        // console.log(\"ok\")\r\n                        if (isPrivilege) {\r\n                            callBack();\r\n                        } else {\r\n                            if (spend <= RoleData.ins.diamond) {\r\n                                callBack();\r\n                            } else {\r\n                                //ShowTips(\"钻石不足\")\r\n                                ShowTips(LangMgr.getLab(\"ui_worldboss_6\"))\r\n                            }\r\n                        }\r\n\r\n                    } else {\r\n                        console.log(\"cancel\")\r\n                    }\r\n                })\r\n            } else {\r\n                //ShowTips(\"今日挑战次数已用完\")\r\n                ShowTips(LangMgr.getLab(\"ui_worldboss_8\"))\r\n            }\r\n        }\r\n    }\r\n    onClickSweep() {\r\n        if (AssociationData.ins.checkFunctionIsOpen(tab.GuildOFName.GuildOFName_GuildBoss)) {\r\n            this.buyChallenge(() => {\r\n                AssociationControl.ins.reqQuickSweepBoss();\r\n            });\r\n        } else {\r\n            AssociationData.ins.showFunctionTips(tab.GuildOFName.GuildOFName_GuildBoss)\r\n        }\r\n\r\n    }\r\n    // 获取公会中战斗力最强的英雄id\r\n    setGuildHerosSpine(){\r\n        const membersArr = AssociationData.ins.getGuildMemberArr();\r\n        for(let i=1;i<=15;i++){\r\n            const player = this.node_player.getChildByName(\"player\"+i);\r\n            if(membersArr[i-1]){\r\n                const lbl = player.getChildByName(\"name_txt\").getComponent(Label);\r\n                lbl.string = membersArr[i-1].name;\r\n                player.active = true;\r\n                if(membersArr[i-1].highestHeroItemId){\r\n                    const heroTab = tab.getData().HeroTableById.getValue(membersArr[i-1].highestHeroItemId);\r\n                    createAnimation(player, heroTab.Idle)\r\n                }\r\n            }else{\r\n                player.active = false;\r\n            }\r\n        }\r\n    }\r\n    showAllRank(){\r\n        UIMgr.ins.show({ viewName: ViewName.AssociationRankPop })\r\n    }\r\n    showAwards(e: EventTouch, type: string){\r\n        UIMgr.ins.show({ viewName: ViewName.AssociationRankRewardPop ,data:type})\r\n    }\r\n}\r\n\r\n\r\n"]}