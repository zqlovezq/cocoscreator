{"version":3,"sources":["file:///C:/chickenStarClient/client/assets/scripts/logic/model/mail/MailPop.ts"],"names":["_decorator","instantiate","Label","Node","Prefab","ScrollView","ViewPop","MailData","MailListItem","TimeUtil","ItemInfo","proto","ItemPoolMgr","EventMgr","MailControl","ShowTips","UIMgr","ViewName","CommonTipsPop","CommonTipsPopCloseType","LangMgr","ccclass","property","MailPop","mailItems","currSelectItem","rewardItems","mailInfos","onTouchTitleItem","item","setSelectState","updateMailContent","register","onMsg","Ptl","GetMailsRsp","on_s2c_GetMailsRsp","ReceiveMailsRewardRsp","on_s2c_ReceiveMailsRewardRsp","DeleteMailsRsp","on_s2c_DeleteMailsRsp","ins","requestGetMails","onShow","initView","getMails","sort","a","b","CreatedAt","length","scrollView","scrollToTop","noMailNode","active","mailNode","key","node","creatorItem","Number","initData","info","Type","SysMailType","Gm","titleNameLab","string","Title","wordLab","Content","senderLab","Sender","getLab","strs","split","valeu","slice","getCombineString","timeLab","timestampToTime","rewardNode","removeAllChildren","rews","Rewards","rewInfo","merge","createRewadItem","getBtnNode","isCanReceived","deleteBtnNode","isRead","setShowState","index","itemPrefab","parent","titleContent","push","getComponent","removeRewardItems","onClickGetBtn","requestReceiveMailsReward","id","onClickDeleteBtn","requestDeleteMails","onClickOneKeyGetBtn","ids","onClickOneKeyDeleteBtn","create","closeType","confirm","console","log","msg","show","viewName","CongratulationPop","data","rewards","find"],"mappings":"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","sourcesContent":["import { _decorator, Component, instantiate, Label, Node, Prefab, ScrollView } from 'cc';\r\nimport { ViewPop } from '../../../framework/base/ViewPop';\r\nimport { MailData } from './MailData';\r\nimport { MailListItem } from './MailListItem';\r\nimport { TimeUtil } from '../../utils/TimeUtil';\r\nimport { CommonItem } from '../item/CommonItem';\r\nimport { ItemInfo } from '../item/ItemInfo';\r\nimport { proto } from 'client_protocol';\r\nimport { ItemPoolMgr } from '../item/ItemPoolMgr';\r\nimport { EventMgr } from '../../mgr/EventMgr';\r\nimport { MailControl } from './MailControl';\r\nimport { ShowTips, UIMgr } from '../../mgr/UIMgr';\r\nimport { ViewName } from '../../define/ViewDefine';\r\nimport { MailInfo } from './MailInfo';\r\nimport { CommonTipsPop, CommonTipsPopCloseType } from '../common/CommonTipsPop';\r\nimport { LangMgr } from '../../mgr/LangMgr';\r\nimport { tab } from '../../../Table/table_gen';\r\nimport { HeroInfo } from '../hero/HeroInfo';\r\nimport { HeroItem } from '../item/HeroItem';\r\nimport { EquipInfo } from '../equip/EquipInfo';\r\nconst { ccclass, property } = _decorator;\r\n\r\n/**\r\n * \r\n * MailPop\r\n * zhudingchao\r\n * Mon Jun 03 2024 10:34:28 GMT+0800 (中国标准时间)\r\n * db://assets/scripts/logic/model/mail/MailPop.ts\r\n *\r\n */\r\n\r\n@ccclass('MailPop')\r\nexport class MailPop extends ViewPop {\r\n    @property(Node)\r\n    mailNode: Node = null;\r\n    @property(Node)\r\n    noMailNode: Node = null;\r\n    @property(Node)\r\n    titleContent: Node = null;\r\n    @property(Label)\r\n    titleNameLab: Label = null;\r\n    @property(Label)\r\n    wordLab: Label = null;\r\n    @property(Label)\r\n    senderLab: Label = null;\r\n    @property(Label)\r\n    timeLab: Label = null;\r\n    @property(Node)\r\n    rewardNode: Node = null;\r\n    @property(Node)\r\n    getBtnNode: Node = null;\r\n    @property(Node)\r\n    deleteBtnNode: Node = null;\r\n    @property(Node)\r\n    oneKeyNode: Node = null;\r\n    @property(Prefab)\r\n    itemPrefab: Prefab = null;\r\n    @property(ScrollView)\r\n    scrollView: ScrollView = null;\r\n\r\n\r\n    private mailItems: Array<MailListItem>;\r\n\r\n    private currSelectItem: MailListItem = null;\r\n    private rewardItems: Array<Node> = [];\r\n    private mailInfos: Array<MailInfo>;\r\n    register(): void {\r\n        EventMgr.onMsg(proto.Ptl.GetMailsRsp, this.on_s2c_GetMailsRsp, this);\r\n        EventMgr.onMsg(proto.Ptl.ReceiveMailsRewardRsp, this.on_s2c_ReceiveMailsRewardRsp, this);\r\n        EventMgr.onMsg(proto.Ptl.DeleteMailsRsp, this.on_s2c_DeleteMailsRsp, this);\r\n         MailControl.ins.requestGetMails();\r\n    }\r\n    onShow(): void {\r\n    //    this.initView();\r\n\r\n\r\n    }\r\n\r\n    initView() {\r\n        let mailInfos = MailData.ins.getMails();\r\n        mailInfos.sort((a,b)=>{\r\n            return b.CreatedAt-a.CreatedAt;\r\n        })\r\n        this.mailInfos = mailInfos;\r\n\r\n        if (mailInfos.length > 0) {\r\n            this.scrollView.scrollToTop();\r\n            this.noMailNode.active = false;\r\n            this.mailNode.active = true;\r\n            for (let key in this.mailItems) {\r\n                this.mailItems[key].node.active = false;\r\n            }\r\n            for (let key in mailInfos) {\r\n                let item = this.creatorItem(Number(key));\r\n                item.initData(mailInfos[key], this.onTouchTitleItem);\r\n            }\r\n            this.currSelectItem = this.mailItems[0];\r\n            this.currSelectItem.setSelectState(true);\r\n            this.updateMailContent();\r\n        } else {\r\n            this.noMailNode.active = true;\r\n            this.mailNode.active = false;\r\n        }\r\n    }\r\n\r\n    updateMailContent() {\r\n        if (this.currSelectItem) {\r\n            let info = this.currSelectItem.info;\r\n            if(info.Type==proto.SysMailType.Gm){\r\n                this.titleNameLab.string = info.Title;\r\n                this.wordLab.string = info.Content;\r\n                this.senderLab.string = info.Sender;\r\n            }else{\r\n                this.titleNameLab.string =LangMgr.getLab(info.Title);\r\n                let strs=info.Content.split(\"|\");\r\n                let key=strs[0];\r\n                let valeu=strs.length>1?strs.slice(1,strs.length):[];\r\n                this.wordLab.string = LangMgr.getCombineString(key,valeu);\r\n                this.senderLab.string = LangMgr.getLab(info.Sender);\r\n            }\r\n           \r\n            this.timeLab.string = TimeUtil.timestampToTime(Number(info.CreatedAt));\r\n            this.rewardNode.removeAllChildren();\r\n            let rews = info.Rewards;\r\n            for (let key in rews) {\r\n                let rewInfo = new ItemInfo();\r\n                rewInfo.merge(rews[key]);\r\n                ItemPoolMgr.ins.createRewadItem(rewInfo,this.rewardNode);\r\n                // if(rewInfo.itemTable.Type==tab.ItemType.ItemType_Hero){\r\n                //     let heroInfo=new HeroInfo();\r\n                //     heroInfo.initHeroItemId(rewInfo.itemId);\r\n                //     let itemNode = ItemPoolMgr.ins.createHeroItem(heroInfo,this.rewardNode);\r\n                //     itemNode.getComponent(HeroItem).showHeroNum(rewInfo.num);\r\n                //     this.rewardItems.push(itemNode)\r\n                // }else if(rewInfo.itemTable.Type==tab.ItemType.ItemType_Equip){\r\n                //     let equipInfo=new EquipInfo();\r\n                //     equipInfo.createDefaultData(rewInfo.itemId)\r\n                //     let itemNode = ItemPoolMgr.ins.createItem(equipInfo,this.rewardNode,false);\r\n                //     this.rewardItems.push(itemNode)\r\n                // }\r\n                // else{\r\n                //     let itemNode = ItemPoolMgr.ins.createItem(rewInfo,this.rewardNode);\r\n                //     this.rewardItems.push(itemNode)\r\n                // }\r\n             \r\n            }\r\n\r\n            this.getBtnNode.active =info.isCanReceived;\r\n            this.deleteBtnNode.active = !info.isCanReceived;\r\n            if (!info.isRead) {\r\n                info.isRead = true;\r\n                this.currSelectItem.setShowState();\r\n            }\r\n\r\n        }\r\n    }\r\n    private creatorItem(index: number) {\r\n        if (!this.mailItems) {\r\n            this.mailItems = [];\r\n        }\r\n        if (!this.mailItems[index]) {\r\n            let node = instantiate(this.itemPrefab);\r\n            node.parent = this.titleContent;\r\n            this.mailItems.push(node.getComponent(MailListItem))\r\n        }\r\n        this.mailItems[index].node.active = true;\r\n        return this.mailItems[index];\r\n\r\n    }\r\n    private removeRewardItems() {\r\n        if (this.rewardItems) {\r\n            // for (let key in this.rewardItems) {\r\n            //     let com=this.rewardItems[key].getComponent(CommonItem);\r\n            //     if(com){\r\n            //         ItemPoolMgr.ins.putCommonItem(this.rewardItems[key]);\r\n            //     }else{\r\n            //         let hero=this.rewardItems[key].getComponent(HeroItem);\r\n            //         if(hero){\r\n            //             ItemPoolMgr.ins.putHeroItem(this.rewardItems[key]);\r\n            //         }else{\r\n            //             this.rewardItems[key].removeFromParent();\r\n            //         }\r\n            //     }\r\n               \r\n            // }\r\n            // this.rewardItems = [];\r\n        }\r\n    }\r\n    onTouchTitleItem = (item: MailListItem) => {\r\n        if (item != this.currSelectItem) {\r\n            if (this.currSelectItem) {\r\n                this.currSelectItem.setSelectState(false);\r\n            }\r\n            item.setSelectState(true);\r\n            this.currSelectItem = item;\r\n            this.updateMailContent();\r\n        }\r\n    }\r\n\r\n    onClickGetBtn() {\r\n        MailControl.ins.requestReceiveMailsReward([this.currSelectItem.info.id]);\r\n\r\n    }\r\n    onClickDeleteBtn() {\r\n        MailControl.ins.requestDeleteMails([this.currSelectItem.info.id]);\r\n    }\r\n    onClickOneKeyGetBtn() {\r\n        let ids = [];\r\n        for (let key in this.mailInfos) {\r\n            if (this.mailInfos[key].isCanReceived) {\r\n                ids.push(this.mailInfos[key].id);\r\n            }\r\n        }\r\n        if (ids.length > 0) {\r\n            MailControl.ins.requestReceiveMailsReward(ids);\r\n        } else {\r\n            ShowTips(LangMgr.getLab(\"ui_mail_5\"));\r\n            //ShowTips(\"没有可领取的奖励\");\r\n        }\r\n\r\n    }\r\n    onClickOneKeyDeleteBtn() {\r\n        let ids = [];\r\n        for (let key in this.mailInfos) {\r\n            if (!this.mailInfos[key].isCanReceived && this.mailInfos[key].isRead) {\r\n                ids.push(this.mailInfos[key].id);\r\n            }\r\n        }\r\n        if (ids.length > 0) {\r\n            CommonTipsPop.create(LangMgr.getLab(\"Tips_mail_1\"), (closeType: CommonTipsPopCloseType) => {\r\n                if (closeType == CommonTipsPopCloseType.confirm) {\r\n                    // console.log(\"ok\")\r\n                    MailControl.ins.requestDeleteMails(ids);\r\n                } else {\r\n                    console.log(\"cancel\")\r\n                }\r\n            })\r\n           \r\n        } else {\r\n            ShowTips(LangMgr.getLab(\"ui_mail_6\"));\r\n            //ShowTips(\"没有可删除的邮件\");\r\n        }\r\n    }\r\n\r\n    /**\r\n  * 请求邮件\r\n  * @param msg \r\n  */\r\n    on_s2c_GetMailsRsp(msg: proto.Msg_GetMailsRsp) {\r\n        this.initView();\r\n    }\r\n    /**\r\n    * 请求领取\r\n    * @param msg \r\n    */\r\n    on_s2c_ReceiveMailsRewardRsp(msg: proto.Msg_ReceiveMailsRewardRsp) {\r\n        if (msg.ids && msg.ids.length > 0) {\r\n            // MailData.ins.receiveMailsRewardSucc(msg.ids);\r\n            UIMgr.ins.show({ viewName: ViewName.CongratulationPop, data: msg.rewards })\r\n            if (this.currSelectItem) {\r\n                this.getBtnNode.active = this.currSelectItem.info.isCanReceived;\r\n                this.deleteBtnNode.active = !this.currSelectItem.info.isCanReceived;\r\n            }\r\n            for (let key in msg.ids) {\r\n                let id = Number(msg.ids[key]);\r\n                let item = this.mailItems.find(a => Number(a.info.id) == id);\r\n                if (item) {\r\n                    item.setShowState();\r\n                }\r\n            }\r\n\r\n        }\r\n\r\n    }\r\n    /**\r\n   * 请求删除邮件成功\r\n   * @param msg \r\n   */\r\n    on_s2c_DeleteMailsRsp(msg: proto.Msg_DeleteMailsRsp) {\r\n        if (msg.ids && msg.ids.length > 0) {\r\n            this.initView();\r\n        }\r\n\r\n    }\r\n}"]}