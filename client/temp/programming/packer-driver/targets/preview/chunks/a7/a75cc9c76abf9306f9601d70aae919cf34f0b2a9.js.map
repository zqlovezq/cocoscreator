{"version":3,"sources":["file:///C:/chickenStarClient/client/assets/scripts/logic/model/role/RoleData.ts"],"names":["RoleData","_decorator","proto","BattleMainDataControl","Net","HeroData","LoginData","FightData","getPassDaysByZero","ccclass","property","Role","_staminaInfo","_privilegeMap","_levelUpAwardMap","m_clientToServerTimeOffset","_guildRequests","_gold","_diamond","_capacityLevel","_oldLevel","_curClearStageId","_serverTimer","setTimeoutId","ins","_instance","setData","role","key","v","diamond","gold","purge","oldLevel","level","curClearStageId","stageId","guildRequests","data","serverTimer","staminaInfo","msg","capacityLevel","addPrivilege","maps","Map","set","Number","getPrivilegeValue","type","has","get","addLevelUpAward","awards","i","length","award","itemId","num","getLevelUpAward","size","setGuideStep","IsGuideFinished","clientData","guideTrunk","IsInTeam","setClientData","String","IsGotNewHero","getStageClearIds","IsLevelUp","isNaN","heroStar","heroBag","heroes","hero","star","teamSlots","slot","_star","getById","heroId","value","Msg_SetClientDataReq","Send","Ptl","SetClientDataReq","sdkRole","t_obj","roleID","id","roleName","name","roleLevel","vipLevel","serverID","default_area","serverName","default_area_name","createRoleTime","createTime","levelUpTime","getServerUtcTime","partyName","getCreateTimeDay","t_dayNum","Math","floor","initServerTimer","timer","clearTimeout","getClientToServerTimeOffset","setTimeout","console","log","newOffset","getClientUtcTime","offsetTime","date","Date","round","getTime","getGoldHistory","goldType","buyGoldHistory","info","count","refreshGoldHistory","history"],"mappings":"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","sourcesContent":["import { Node, Prefab, _decorator } from \"cc\";\nimport { tab } from \"../../../Table/table_gen\";\nimport { PREVIEW } from \"cc/env\";\nimport { IClear } from \"../../../framework/base/IAbs\";\nimport { proto } from \"client_protocol\";\nimport { ItemControl } from \"../item/ItemControl\";\nimport { ItemData } from \"../item/ItemData\";\nimport { BattleMainDataControl } from \"../home/battle/BattleMainDataControl\";\nimport { Net } from \"../../net/Net\";\nimport { EventMgr } from \"../../mgr/EventMgr\";\nimport { LocalEvent } from \"../../define/LocalEvent\";\nimport { HeroData } from \"../hero/HeroData\";\nimport { LoginData } from \"../login/LoginData\";\nimport { FightData } from \"../../fight/data/FightData\";\nimport { getPassDaysByZero } from \"../../utils/GameUtil\";\nimport { Role } from \"../../fight/base/obj/role/role/Role\";\n\n\nconst { ccclass, property } = _decorator;\n\n\n\nexport class RoleData extends proto.Role implements IClear {\n    private static _instance: RoleData;\n    private _staminaInfo: proto.Msg_GetStaminaInfoRsp;\n    /**\n     * 特权加成\n     */\n    private _privilegeMap: Map<tab.VipBonus, number>;\n    /**  \n     * 等级提升奖励\n     */\n    private _levelUpAwardMap: Map<number, number>;\n    private m_clientToServerTimeOffset: number = 0;\n    private _guildRequests: proto.IJoinGuildRequest[] = [];\n    public static get ins() {\n        if (null == this._instance) {\n            this._instance = new RoleData();\n        }\n        return this._instance;\n    }\n\n    setData(role: proto.IRole) {\n        for (const key in role) {\n            const v = role[key];\n            this[key] = role[key]\n        }\n        this.diamond = this.gold = 0\n    }\n\n    purge(): void {\n    }\n\n    private _gold: number = 0\n    private _diamond: number = 0\n    private _capacityLevel: number = 0;\n    private _oldLevel: number = 0;\n    private _curClearStageId: number = 0;\n    private _serverTimer:number=0;\n    get oldLevel() {\n        return this._oldLevel\n    }\n    set oldLevel(level) {\n        this._oldLevel = level;\n    }\n    get curClearStageId() {\n        return this._curClearStageId\n    }\n    set curClearStageId(stageId) {\n        this._curClearStageId = stageId;\n    }\n    /** 金币 */\n    get gold() {\n        return this._gold\n    }\n\n    set gold(v: number) {\n        this._gold = v\n    }\n\n    /** 钻石 */\n    get diamond() {\n        return this._diamond\n    }\n\n    set diamond(v: number) {\n        this._diamond = v\n    }\n    /** 自己的公会申请列表 */\n    get guildRequests() {\n        return this._guildRequests\n    }\n\n    set guildRequests(data: proto.IJoinGuildRequest[]) {\n        this._guildRequests = data\n    }\n    /**服务器时间 目前没有 先暂时获取本地时间 */\n    get serverTimer() {\n        return this._serverTimer;\n      //  return new Date().getTime();\n    }\n    /**\n     * 体力相关信息\n     */\n    get staminaInfo() {\n        return this._staminaInfo;\n    }\n\n    set staminaInfo(msg: proto.Msg_GetStaminaInfoRsp) {\n        this._staminaInfo = msg;\n    }\n\n    get capacityLevel() {\n        return this._capacityLevel\n    }\n\n    set capacityLevel(v: number) {\n        this._capacityLevel = v\n    }\n    /**\n     * 增加特权\n     */\n    addPrivilege(maps: any) {\n        if (!this._privilegeMap) {\n            this._privilegeMap = new Map();\n        }\n        for (let key in maps) {\n            this._privilegeMap.set(Number(key), maps[key]);\n        }\n    }\n    /**\n     * 获得特权加成\n     * @param type \n     * @returns \n     */\n    getPrivilegeValue(type: tab.VipBonus) {\n        if (this._privilegeMap) {\n            if (this._privilegeMap.has(type)) {\n                return this._privilegeMap.get(type);\n            } else {\n                return 0;\n            }\n\n        }\n        return 0;\n    }\n    /**\n     * 增加奖励\n     */\n    addLevelUpAward(awards: proto.IItem[]) {\n        if (!this._levelUpAwardMap) {\n            this._levelUpAwardMap = new Map();\n        }\n        for (let i = 0; i < awards.length; i++) {\n            const award = awards[i];\n            if (this._levelUpAwardMap.has(award.itemId)) {\n                this._levelUpAwardMap.set(award.itemId, Number(award.num) + this._levelUpAwardMap.get(award.itemId))\n            } else {\n                this._levelUpAwardMap.set(award.itemId, Number(award.num))\n            }\n        }\n    }\n    /**\n     * 获取升级奖励\n     */\n    getLevelUpAward() {\n        if (this._levelUpAwardMap.size > 0) {\n            return this._levelUpAwardMap\n        }\n        return null;\n    }\n    /* 兼容一下引导到多少步了 */\n    public setGuideStep() {\n        // // 如果基因点过则引导结束\n        if (this.IsGuideFinished()) {\n            return;\n        }\n        if (Number(RoleData.ins.clientData.guideTrunk) >= 500) {\n            return\n        }\n        if(this.IsInTeam()){\n            this.setClientData(\"guideTrunk\", String(500));\n        }else{\n            if (this.IsGotNewHero()){\n                this.setClientData(\"guideTrunk\", String(400));\n            }else{\n                if(BattleMainDataControl.ins.getStageClearIds().length >=1){\n                    this.setClientData(\"guideTrunk\", String(300));\n                }else{\n                    if (this.IsLevelUp()){\n                        this.setClientData(\"guideTrunk\", String(200));\n                    }else{\n                        const guideTrunk = Number(RoleData.ins.clientData.guideTrunk)\n                        if(!guideTrunk&&!isNaN(guideTrunk)){\n                            this.setClientData(\"guideTrunk\", String(100));\n                        }\n                    }\n                }\n            }\n        }\n    }\n    // 判断是否领取法师鸡\n    private IsGotNewHero() {\n        let heroStar = 3;\n        for (let i = 0; i < this.heroBag.heroes.length; i++) {\n            const hero = this.heroBag.heroes[i];\n            if (hero.star > heroStar) {\n                heroStar = hero.star\n            }\n        }\n        return heroStar > 3;\n    }\n    // 判断是否升级过\n    private IsLevelUp() {\n        let level = 1;\n        for (let i = 0; i < this.heroBag.teamSlots.length; i++) {\n            const slot = this.heroBag.teamSlots[i];\n            if (slot.level > level) {\n                level = slot.level;\n            }\n        }\n        return level > 1;\n    }\n    // 判断是否有4星以上的英雄上阵\n    private IsInTeam() {\n        let star = 3;\n        for (let i = 0; i < this.heroBag.teamSlots.length; i++) {\n            const slot = this.heroBag.teamSlots[i];\n            const _star = HeroData.ins.getById(slot.heroId).star\n            if (_star > star) {\n                star = _star\n            }\n        }\n        return star > 3;\n    }\n    /* 引导是否结束 */\n    public IsGuideFinished() {\n        if(RoleData.ins.clientData.guideTrunk&&Number(RoleData.ins.clientData.guideTrunk)){\n            return Number(RoleData.ins.clientData.guideTrunk)>=500;\n        }else{\n            if(BattleMainDataControl.ins.getStageClearIds().length === 0){\n                if(FightData.ins.stageId){\n                    if(FightData.ins.stageId===1){\n                        if(Number(RoleData.ins.clientData.guideTrunk)!==0){\n                            this.setClientData(\"guideTrunk\", String(0));\n                        }\n                        return false;\n                    }else if(FightData.ins.stageId===101){\n                        return false;\n                    }else{\n                        return true;\n                    }   \n                }else{\n                    return false;\n                }\n            }else{\n                return false;\n            }\n        }\n    }\n    // 设置客户端数据\n    public setClientData(key: string, value: string) {\n        let msg = new proto.Msg_SetClientDataReq();\n        msg.key = key;\n        msg.data = value;\n        Net.Send(proto.Ptl.SetClientDataReq, msg);\n        RoleData.ins.clientData[key] = value;\n    }\n\n\n    sdkRole() {\n        let t_obj: any = {}\n\n        t_obj.diamond = RoleData.ins.diamond\n        t_obj.gold = RoleData.ins.gold\n\n        t_obj.roleID = RoleData.ins.id\n        t_obj.roleName = RoleData.ins.name\n        t_obj.roleLevel = RoleData.ins.level\n        t_obj.vipLevel = RoleData.ins.vipLevel\n        t_obj.serverID = LoginData.ins.default_area //sdk需要是逻辑服id\n        t_obj.serverName = LoginData.ins.default_area_name //sdk需要是逻辑服名字\n        t_obj.createRoleTime=RoleData.ins.createTime;\n        t_obj.levelUpTime = RoleData.ins.getServerUtcTime();\n        t_obj.partyName = \"无\"\n        return t_obj\n    }\n     /**获取创角天数 */\n     public getCreateTimeDay(): number {\n        var t_dayNum: number = Math.floor(getPassDaysByZero(this.createTime) + 1);\n        return t_dayNum;\n    }\n    private setTimeoutId:number=-1;\n    \n    initServerTimer(timer:number){\n        if(this.setTimeoutId>-1){\n            clearTimeout(this.setTimeoutId);\n        }\n        this._serverTimer=timer;\n        this.getClientToServerTimeOffset()\n        this.setTimeoutId=setTimeout(() => {\n            console.log(\"cocos timer\",this._serverTimer);\n            this._serverTimer++;\n        }, 1000);\n    \n    }\n    getClientToServerTimeOffset(){\n        let newOffset = this._serverTimer - this.getClientUtcTime();\n        if (0 == this.m_clientToServerTimeOffset) {\n            this.m_clientToServerTimeOffset = newOffset;\n        } else {\n            // 偏离越大，说明网络延迟越小\n            this.m_clientToServerTimeOffset =\n                this.m_clientToServerTimeOffset > newOffset ? this.m_clientToServerTimeOffset : newOffset;\n        }\n        return this.m_clientToServerTimeOffset;\n    }\n    getServerUtcTime(): number {\n        const offsetTime = this.m_clientToServerTimeOffset;\n        return this.getClientUtcTime() + offsetTime\n    }\n    getClientUtcTime(): number {\n        let date = new Date();\n        return Math.round(date.getTime() / 1000);\n    }\n    // 获取购买金币历史记录\n    getGoldHistory(goldType:tab.BuyGoldType){\n        for(let i=0;i<this.buyGoldHistory.length;i++){\n            const info = this.buyGoldHistory[i];\n            if(info.type===goldType){\n                return {\n                    type: goldType, count: info.count\n                }\n            }\n        }\n        return {\n            type: goldType, count: 0\n        }\n    }\n    // 刷新购买金币的数据\n    refreshGoldHistory(history:proto.BuyGoldHistory){\n\n        if(this.buyGoldHistory.length===0){\n            // 初始化buyGoldHistrory\n            this.buyGoldHistory = [\n                {type:0,count:0},\n                {type:1,count:0},\n                {type:2,count:0}\n            ]\n        }\n\n        for(let i=0;i<this.buyGoldHistory.length;i++){\n            const info = this.buyGoldHistory[i];\n            if(info.type===history.type){\n                this.buyGoldHistory[i] = history;\n            }\n        }\n    }\n}"]}