{"version":3,"sources":["file:///C:/chickenStarClient/client/assets/scripts/logic/model/mutation/PaintingView.ts"],"names":["_decorator","instantiate","Node","Prefab","ViewPop","tab","HeroDataControl","PaintingHeroItem","EventMgr","proto","UIMgr","ViewName","RedMgr","RedDotType","HeroTeamControl","ccclass","property","PaintingView","_heroClass","register","onMsg","Ptl","UpgradeScrollPaintingStarRsp","on_s2c_UpgradeScrollPaintingStarRsp","msg","error","code","CommonErrorCode","Succeed","ins","paintingActive","set","heroItemId","star","addAttr","getPaintingAttrGap","addPaintingAttr","refreshEvent","HeroPainting","firstActive","hideView","PaintingLvupPop","refreshListByVocation","onShow","HeroClass","HeroClass_Assassin","heroClass","isActive","heroId","list","getPaintingListByVocation","i","length","itemId","item","node_content","children","pfb_item","parent","active","itemTs","getComponent","initData","j","node","clickChangeList","event","type","Number","clickGetPaintingAttr","show","viewName","PaintingAttributePop","onDestroy"],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAOSA,MAAAA,U,OAAAA,U;AAAmCC,MAAAA,W,OAAAA,W;AAAaC,MAAAA,I,OAAAA,I;AAAMC,MAAAA,M,OAAAA,M;;AACtDC,MAAAA,O,iBAAAA,O;;AACAC,MAAAA,G,iBAAAA,G;;AACAC,MAAAA,e,iBAAAA,e;;AACAC,MAAAA,gB,iBAAAA,gB;;AACAC,MAAAA,Q,iBAAAA,Q;;AACAC,MAAAA,K,oBAAAA,K;;AACAC,MAAAA,K,iBAAAA,K;;AACAC,MAAAA,Q,iBAAAA,Q;;AACAC,MAAAA,M,iBAAAA,M;;AACAC,MAAAA,U,kBAAAA,U;;AACAC,MAAAA,e,kBAAAA,e;;;;;;AAlBT;AACA;AACA;AACA;AACA;AACA;AACA;;;;;OAaM;AAAEC,QAAAA,OAAF;AAAWC,QAAAA;AAAX,O,GAAwBhB,U;;8BAGjBiB,Y,WADZF,OAAO,CAAC,cAAD,C,UAEHC,QAAQ,CAACd,IAAD,C,UAERc,QAAQ,CAACb,MAAD,C,2BAJb,MACac,YADb;AAAA;AAAA,8BAC0C;AAAA;AAAA;;AAAA;;AAAA;;AAAA,eAK9BC,UAL8B,GAKF,IALE;AAAA;;AAMtCC,QAAAA,QAAQ,GAAS;AACb;AAAA;AAAA,oCAASC,KAAT,CAAe;AAAA;AAAA,8BAAMC,GAAN,CAAUC,4BAAzB,EAAuD,KAAKC,mCAA5D,EAAiG,IAAjG;AACH;;AAEDA,QAAAA,mCAAmC,CAACC,GAAD,EAA8C;AAC7E,cAAIA,GAAG,CAACC,KAAJ,IAAaD,GAAG,CAACC,KAAJ,CAAUC,IAAV,IAAkB;AAAA;AAAA,8BAAMC,eAAN,CAAsBC,OAAzD,EAAkE;AAClE;AAAA;AAAA,kDAAgBC,GAAhB,CAAoBC,cAApB,CAAmCC,GAAnC,CAAuCP,GAAG,CAACQ,UAA3C,EAAuDR,GAAG,CAACS,IAA3D;;AACA,cAAGT,GAAG,CAACS,IAAJ,GAAS,CAAZ,EAAc;AACV,gBAAMC,OAAO,GAAG;AAAA;AAAA,oDAAgBL,GAAhB,CAAoBM,kBAApB,CAAuCX,GAAG,CAACQ,UAA3C,EAAuDR,GAAG,CAACS,IAA3D,CAAhB;AACA;AAAA;AAAA,oDAAgBJ,GAAhB,CAAoBO,eAApB,CAAoCZ,GAAG,CAACQ,UAAxC,EAAoDR,GAAG,CAACS,IAAxD,EAA6DC,OAA7D;AACH,WAHD,MAGK;AACD;AAAA;AAAA,oDAAgBL,GAAhB,CAAoBO,eAApB,CAAoCZ,GAAG,CAACQ,UAAxC,EAAoDR,GAAG,CAACS,IAAxD;AACH;;AACD;AAAA;AAAA,gCAAOI,YAAP,CAAoB;AAAA;AAAA,wCAAWC,YAA/B;AACA,cAAIC,WAAW,GAAGf,GAAG,CAACS,IAAJ,KAAa,CAA/B;;AACA,cAAIM,WAAJ,EAAiB;AACb;AAAA;AAAA,gCAAMV,GAAN,CAAUW,QAAV,CAAmB;AAAA;AAAA,sCAASC,eAA5B;AACH;;AACD,eAAKC,qBAAL,CAA2B,KAAKxB,UAAhC,EAA4CqB,WAA5C,EAAyDf,GAAG,CAACQ,UAA7D;AACH;;AACDW,QAAAA,MAAM,GAAS;AACX;AACA,eAAKzB,UAAL,GAAkB;AAAA;AAAA,0BAAI0B,SAAJ,CAAcC,kBAAhC;AACA,eAAKH,qBAAL,CAA2B,KAAKxB,UAAhC;AACH;;AACDwB,QAAAA,qBAAqB,CAACI,SAAD,EAA2BC,QAA3B,EAA+CC,MAA/C,EAAgE;AACjF,cAAIC,IAAI,GAAG;AAAA;AAAA,kDAAgBpB,GAAhB,CAAoBqB,yBAApB,CAA8CJ,SAA9C,CAAX;;AACA,eAAK,IAAIK,CAAC,GAAG,CAAb,EAAgBA,CAAC,GAAGF,IAAI,CAACG,MAAzB,EAAiCD,CAAC,EAAlC,EAAsC;AAClC,gBAAME,MAAM,GAAGJ,IAAI,CAACE,CAAD,CAAnB;AACA,gBAAIG,IAAI,GAAG,KAAKC,YAAL,CAAkBC,QAAlB,CAA2BL,CAA3B,CAAX;;AACA,gBAAI,CAACG,IAAL,EAAW;AACPA,cAAAA,IAAI,GAAGrD,WAAW,CAAC,KAAKwD,QAAN,CAAlB;AACAH,cAAAA,IAAI,CAACI,MAAL,GAAc,KAAKH,YAAnB;AACH;;AACDD,YAAAA,IAAI,CAACK,MAAL,GAAc,IAAd;AACA,gBAAMC,MAAwB,GAAGN,IAAI,CAACO,YAAL;AAAA;AAAA,qDAAjC;;AACA,gBAAId,QAAQ,IAAIC,MAAM,KAAKK,MAA3B,EAAmC;AAC/BO,cAAAA,MAAM,CAACE,QAAP,CAAgBT,MAAhB,EAAwBN,QAAxB;AACH,aAFD,MAEO;AACHa,cAAAA,MAAM,CAACE,QAAP,CAAgBT,MAAhB;AACH;AACJ;;AACD,cAAI,KAAKE,YAAL,CAAkBC,QAAlB,CAA2BJ,MAA3B,GAAoCH,IAAI,CAACG,MAA7C,EAAqD;AACjD,iBAAK,IAAIW,CAAC,GAAGd,IAAI,CAACG,MAAlB,EAA0BW,CAAC,GAAG,KAAKR,YAAL,CAAkBC,QAAlB,CAA2BJ,MAAzD,EAAiEW,CAAC,EAAlE,EAAsE;AAClE,kBAAIC,IAAI,GAAG,KAAKT,YAAL,CAAkBC,QAAlB,CAA2BO,CAA3B,CAAX;AACAC,cAAAA,IAAI,CAACL,MAAL,GAAc,KAAd;AACH;AACJ;AACJ,SAtDqC,CAuDtC;;;AACAM,QAAAA,eAAe,CAACC,KAAD,EAAoBC,IAApB,EAAkC;AAC7C,eAAKjD,UAAL,GAAkBkD,MAAM,CAACD,IAAD,CAAxB;AACA,eAAKzB,qBAAL,CAA2B,KAAKxB,UAAhC;AACH,SA3DqC,CA4DtC;;;AACAmD,QAAAA,oBAAoB,GAAG;AACnB;AAAA;AAAA,8BAAMxC,GAAN,CAAUyC,IAAV,CAAe;AAAEC,YAAAA,QAAQ,EAAE;AAAA;AAAA,sCAASC;AAArB,WAAf;AACH;;AACDC,QAAAA,SAAS,GAAS;AACd,gBAAMA,SAAN;AACH;;AAlEqC,O;;;;;iBAEjB,I;;;;;;;iBAEF,I","sourcesContent":["/*\r\n * @Date: 2024-05-24 10:51:28\r\n * @Func:绘卷界面\r\n * @LastEditors: wzq\r\n * @LastEditTime: 2024-08-05 18:52:22\r\n * @Data Structure 只有SR跟SRR的会有绘卷功能\r\n */\r\nimport { _decorator, Component, EventTouch, instantiate, Node, Prefab } from 'cc';\r\nimport { ViewPop } from '../../../framework/base/ViewPop';\r\nimport { tab } from '../../../Table/table_gen';\r\nimport { HeroDataControl } from '../hero/herobag/HeroDataControl';\r\nimport { PaintingHeroItem } from './PaintingHeroItem';\r\nimport { EventMgr } from '../../mgr/EventMgr';\r\nimport { proto } from 'client_protocol';\r\nimport { UIMgr } from '../../mgr/UIMgr';\r\nimport { ViewName } from '../../define/ViewDefine';\r\nimport { RedMgr } from '../../mgr/RedMgr';\r\nimport { RedDotType } from '../../red/RedDotType';\r\nimport { HeroTeamControl } from '../hero/HeroTeamControl';\r\nconst { ccclass, property } = _decorator;\r\n\r\n@ccclass('PaintingView')\r\nexport class PaintingView extends ViewPop {\r\n    @property(Node)\r\n    node_content: Node = null;\r\n    @property(Prefab)\r\n    pfb_item: Prefab = null;\r\n    private _heroClass: tab.HeroClass = null;\r\n    register(): void {\r\n        EventMgr.onMsg(proto.Ptl.UpgradeScrollPaintingStarRsp, this.on_s2c_UpgradeScrollPaintingStarRsp, this);\r\n    }\r\n\r\n    on_s2c_UpgradeScrollPaintingStarRsp(msg: proto.Msg_UpgradeScrollPaintingStarRsp) {\r\n        if (msg.error && msg.error.code != proto.CommonErrorCode.Succeed) return;\r\n        HeroDataControl.ins.paintingActive.set(msg.heroItemId, msg.star);\r\n        if(msg.star>5){\r\n            const addAttr = HeroTeamControl.ins.getPaintingAttrGap(msg.heroItemId, msg.star);\r\n            HeroTeamControl.ins.addPaintingAttr(msg.heroItemId, msg.star,addAttr);\r\n        }else{\r\n            HeroTeamControl.ins.addPaintingAttr(msg.heroItemId, msg.star);\r\n        }\r\n        RedMgr.refreshEvent(RedDotType.HeroPainting);\r\n        let firstActive = msg.star === 5;\r\n        if (firstActive) {\r\n            UIMgr.ins.hideView(ViewName.PaintingLvupPop)\r\n        }\r\n        this.refreshListByVocation(this._heroClass, firstActive, msg.heroItemId)\r\n    }\r\n    onShow(): void {\r\n        // 上来默认是猎手\r\n        this._heroClass = tab.HeroClass.HeroClass_Assassin\r\n        this.refreshListByVocation(this._heroClass)\r\n    }\r\n    refreshListByVocation(heroClass: tab.HeroClass, isActive?: boolean, heroId?: number) {\r\n        let list = HeroDataControl.ins.getPaintingListByVocation(heroClass);\r\n        for (let i = 0; i < list.length; i++) {\r\n            const itemId = list[i];\r\n            let item = this.node_content.children[i];\r\n            if (!item) {\r\n                item = instantiate(this.pfb_item);\r\n                item.parent = this.node_content;\r\n            }\r\n            item.active = true;\r\n            const itemTs: PaintingHeroItem = item.getComponent(PaintingHeroItem);\r\n            if (isActive && heroId === itemId) {\r\n                itemTs.initData(itemId, isActive);\r\n            } else {\r\n                itemTs.initData(itemId);\r\n            }\r\n        }\r\n        if (this.node_content.children.length > list.length) {\r\n            for (let j = list.length; j < this.node_content.children.length; j++) {\r\n                let node = this.node_content.children[j];\r\n                node.active = false;\r\n            }\r\n        }\r\n    }\r\n    // 点击切换页签\r\n    clickChangeList(event: EventTouch, type: string) {\r\n        this._heroClass = Number(type);\r\n        this.refreshListByVocation(this._heroClass);\r\n    }\r\n    // 点击获取绘卷属性\r\n    clickGetPaintingAttr() {\r\n        UIMgr.ins.show({ viewName: ViewName.PaintingAttributePop })\r\n    }\r\n    onDestroy(): void {\r\n        super.onDestroy();\r\n    }\r\n}\r\n\r\n\r\n"]}