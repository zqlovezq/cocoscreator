{"version":3,"sources":["file:///C:/chickenStarClient/client/assets/scripts/logic/model/award/CongratulationPop.ts"],"names":["_decorator","instantiate","Node","Prefab","ScrollView","tween","Vec3","ViewPop","tab","CongratulationItem","EventMgr","LocalEvent","GuideController","ccclass","property","CongratulationPop","mClosedCallBack","_awardrMap","Map","_rewards","_list","_lineHeroCount","_itemCount","register","onShow","i","openData","length","itemId","num","push","sort","item1","item2","itemTab1","getData","ItemTableById","getValue","itemTab2","Sort","getRewardList","node_content","setPosition","getPosition","y","initData","clear","destroyAllChildren","createItem","schedule","popAnim","posY","to","position","x","start","count","item","pfb_item","parent","itemTs","getComponent","setData","setCloseCallBack","closeFunc","onDisable","unschedule","onDestroy","ins","isGuiding","emitLocal","hidePop","result","slice"],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAASA,MAAAA,U,OAAAA,U;AAAYC,MAAAA,W,OAAAA,W;AAAaC,MAAAA,I,OAAAA,I;AAAMC,MAAAA,M,OAAAA,M;AAAQC,MAAAA,U,OAAAA,U;AAAYC,MAAAA,K,OAAAA,K;AAAaC,MAAAA,I,OAAAA,I;;AAChEC,MAAAA,O,iBAAAA,O;;AAEAC,MAAAA,G,iBAAAA,G;;AACAC,MAAAA,kB,iBAAAA,kB;;AACAC,MAAAA,Q,iBAAAA,Q;;AACAC,MAAAA,U,iBAAAA,U;;AACAC,MAAAA,e,iBAAAA,e;;;;;;;;;OACH;AAAEC,QAAAA,OAAF;AAAWC,QAAAA;AAAX,O,GAAwBd,U;;mCAGjBe,iB,WADZF,OAAO,CAAC,mBAAD,C,UAEHC,QAAQ,CAACZ,IAAD,C,UAERY,QAAQ,CAACX,MAAD,C,UAERW,QAAQ,CAACV,UAAD,C,2BANb,MACaW,iBADb;AAAA;AAAA,8BAC+C;AAAA;AAAA;;AAAA;;AAEhB;AAFgB;;AAAA;;AAAA,eAOnCC,eAPmC,GAOP,IAPO;AAAA,eAQnCC,UARmC,GAQD,IAAIC,GAAJ,EARC;AAAA,eASnCC,QATmC,GASV,EATU;AAAA,eAUnCC,KAVmC,GAU3B,EAV2B;AAAA,eAWnCC,cAXmC,GAWV,CAXU;AAAA,eAYnCC,UAZmC,GAYf,CAZe;AAAA;;AAa3CC,QAAAA,QAAQ,GAAS,CAEhB;;AACDC,QAAAA,MAAM,GAAG;AACL,eAAKL,QAAL,GAAgB,EAAhB;;AACA,eAAI,IAAIM,CAAC,GAAC,CAAV,EAAYA,CAAC,GAAC,KAAKC,QAAL,CAAcC,MAA5B,EAAmCF,CAAC,EAApC,EAAuC;AACnC,gBAAG,KAAKC,QAAL,CAAcD,CAAd,EAAiBG,MAAjB,IAAyB,KAAKF,QAAL,CAAcD,CAAd,EAAiBI,GAA7C,EAAiD;AAC7C,mBAAKV,QAAL,CAAcW,IAAd,CAAmB,KAAKJ,QAAL,CAAcD,CAAd,CAAnB;AACH;AACJ;;AACD,eAAKN,QAAL,CAAcY,IAAd,CAAmB,CAACC,KAAD,EAAOC,KAAP,KAAe;AAC9B,gBAAIC,QAAQ,GAAG;AAAA;AAAA,4BAAIC,OAAJ,GAAcC,aAAd,CAA4BC,QAA5B,CAAqCL,KAAK,CAACJ,MAA3C,CAAf;AACA,gBAAIU,QAAQ,GAAG;AAAA;AAAA,4BAAIH,OAAJ,GAAcC,aAAd,CAA4BC,QAA5B,CAAqCJ,KAAK,CAACL,MAA3C,CAAf;AACA,mBAAOU,QAAQ,CAACC,IAAT,GAAgBL,QAAQ,CAACK,IAAhC;AACH,WAJD;;AAKA,eAAKnB,KAAL,GAAa,KAAKoB,aAAL,EAAb;;AACA,cAAG,KAAKpB,KAAL,CAAWO,MAAX,GAAkB,CAArB,EAAuB;AACnB,iBAAKc,YAAL,CAAkBC,WAAlB,CAA8B,IAAIpC,IAAJ,CAAS,CAAT,EAAW,KAAKmC,YAAL,CAAkBE,WAAlB,GAAgCC,CAAhC,GAAkC,EAA7C,EAAgD,CAAhD,CAA9B;AACH;;AACD,eAAKC,QAAL;AACH;;AACa,cAARA,QAAQ,GAAG;AACb,eAAK5B,UAAL,CAAgB6B,KAAhB;;AACA,eAAKL,YAAL,CAAkBM,kBAAlB;AACA,gBAAMlB,GAAG,GAAG,KAAKT,KAAL,CAAWO,MAAvB;AACA,eAAKL,UAAL,GAAkB,CAAlB;AACA,eAAK0B,UAAL,CAAgB,KAAK1B,UAArB;;AACA,cAAGO,GAAG,GAAC,CAAP,EAAS;AACL,iBAAKoB,QAAL,CAAc,KAAKC,OAAnB,EAA2B,GAA3B,EAA+BrB,GAAG,GAAC,CAAnC;AACH;AACJ;;AACDqB,QAAAA,OAAO,GAAE;AACL,eAAK5B,UAAL;AACA,gBAAM6B,IAAI,GAAG,KAAKV,YAAL,CAAkBE,WAAlB,GAAgCC,CAA7C;AACAvC,UAAAA,KAAK,CAAC,KAAKoC,YAAN,CAAL,CAAyBW,EAAzB,CAA4B,GAA5B,EAAgC;AAACC,YAAAA,QAAQ,EAAC,IAAI/C,IAAJ,CAAS,KAAKmC,YAAL,CAAkBE,WAAlB,GAAgCW,CAAzC,EAA2CH,IAAI,GAAC,GAAhD,EAAoD,CAApD;AAAV,WAAhC,EAAmGI,KAAnG;AACA,eAAKP,UAAL,CAAgB,KAAK1B,UAArB;AACH;;AACD0B,QAAAA,UAAU,CAACQ,KAAD,EAAc;AACpB,gBAAMC,IAAI,GAAGxD,WAAW,CAAC,KAAKyD,QAAN,CAAxB;AACAD,UAAAA,IAAI,CAACE,MAAL,GAAc,KAAKlB,YAAnB;AACA,gBAAMmB,MAAM,GAAGH,IAAI,CAACI,YAAL;AAAA;AAAA,uDAAf;AACAD,UAAAA,MAAM,CAACE,OAAP,CAAe,KAAK1C,KAAL,CAAWoC,KAAX,CAAf;AACH;;AACDO,QAAAA,gBAAgB,CAACC,SAAD,EAAsB;AAClC,eAAKhD,eAAL,GAAuBgD,SAAvB;AACH;;AACSC,QAAAA,SAAS,GAAS;AACxB,eAAKC,UAAL,CAAgB,KAAKhB,OAArB;AACH;;AACDiB,QAAAA,SAAS,GAAG;AACR,gBAAMA,SAAN;;AACA,cAAG;AAAA;AAAA,kDAAgBC,GAAhB,CAAoBC,SAApB,EAAH,EAAmC;AAC/B;AAAA;AAAA,sCAASC,SAAT,CAAmB;AAAA;AAAA,0CAAWC,OAA9B;AACH;;AACD,cAAI,KAAKvD,eAAL,IAAwB,OAAO,KAAKA,eAAZ,IAA+B,UAA3D,EAAuE;AACnE,iBAAKA,eAAL;AACA,iBAAKA,eAAL,GAAuB,IAAvB;AACH;AACJ;AACD;;;AACAwB,QAAAA,aAAa,GAAG;AACZ,gBAAMgC,MAAM,GAAG,EAAf;;AACA,eAAK,IAAI/C,CAAC,GAAG,CAAb,EAAgBA,CAAC,GAAG,KAAKN,QAAL,CAAcQ,MAAlC,EAA0CF,CAAC,IAAI,KAAKJ,cAApD,EAAoE;AAChEmD,YAAAA,MAAM,CAAC1C,IAAP,CAAY,KAAKX,QAAL,CAAcsD,KAAd,CAAoBhD,CAApB,EAAuBA,CAAC,GAAG,KAAKJ,cAAhC,CAAZ;AACH;;AACD,iBAAOmD,MAAP;AACH;;AA/E0C,O;;;;;iBAEtB,I;;;;;;;iBAEL,I;;;;;;;iBAES,I","sourcesContent":["import { _decorator, instantiate, Node, Prefab, ScrollView, tween, Vec2, Vec3 } from 'cc';\r\nimport { ViewPop } from '../../../framework/base/ViewPop';\r\nimport { proto } from 'client_protocol';\r\nimport { tab } from '../../../Table/table_gen';\r\nimport { CongratulationItem } from './CongratulationItem';\r\nimport { EventMgr } from '../../mgr/EventMgr';\r\nimport { LocalEvent } from '../../define/LocalEvent';\r\nimport { GuideController } from '../../guide/GuideController';\r\nconst { ccclass, property } = _decorator;\r\n\r\n@ccclass('CongratulationPop')\r\nexport class CongratulationPop extends ViewPop {\r\n    @property(Node)\r\n    node_content: Node = null; /*  */\r\n    @property(Prefab)\r\n    pfb_item:Node = null;\r\n    @property(ScrollView)\r\n    scroll_view:ScrollView = null;\r\n    private mClosedCallBack: Function = null;\r\n    private _awardrMap: Map<number, number> = new Map()\r\n    private _rewards: proto.Item[] = [];\r\n    private _list = [];\r\n    private _lineHeroCount: number = 6;\r\n    private _itemCount:number = 0;\r\n    register(): void {\r\n\r\n    }\r\n    onShow() {\r\n        this._rewards = [];\r\n        for(let i=0;i<this.openData.length;i++){\r\n            if(this.openData[i].itemId&&this.openData[i].num){\r\n                this._rewards.push(this.openData[i]);\r\n            }\r\n        }\r\n        this._rewards.sort((item1,item2)=>{\r\n            let itemTab1 = tab.getData().ItemTableById.getValue(item1.itemId);\r\n            let itemTab2 = tab.getData().ItemTableById.getValue(item2.itemId);\r\n            return itemTab2.Sort - itemTab1.Sort;\r\n        });\r\n        this._list = this.getRewardList();\r\n        if(this._list.length>2){\r\n            this.node_content.setPosition(new Vec3(0,this.node_content.getPosition().y+75,0))\r\n        }\r\n        this.initData();\r\n    }\r\n    async initData() {\r\n        this._awardrMap.clear();\r\n        this.node_content.destroyAllChildren();\r\n        const num = this._list.length;\r\n        this._itemCount = 0;\r\n        this.createItem(this._itemCount)\r\n        if(num>1){\r\n            this.schedule(this.popAnim,1.5,num-2)\r\n        }\r\n    }\r\n    popAnim(){\r\n        this._itemCount++;\r\n        const posY = this.node_content.getPosition().y;\r\n        tween(this.node_content).to(0.5,{position:new Vec3(this.node_content.getPosition().x,posY+150,0)}).start();\r\n        this.createItem(this._itemCount);\r\n    }\r\n    createItem(count:number){\r\n        const item = instantiate(this.pfb_item);\r\n        item.parent = this.node_content;\r\n        const itemTs = item.getComponent(CongratulationItem);\r\n        itemTs.setData(this._list[count]);\r\n    }\r\n    setCloseCallBack(closeFunc: Function) {\r\n        this.mClosedCallBack = closeFunc;\r\n    }\r\n    protected onDisable(): void {\r\n        this.unschedule(this.popAnim);\r\n    }\r\n    onDestroy() {\r\n        super.onDestroy();\r\n        if(GuideController.ins.isGuiding()){\r\n            EventMgr.emitLocal(LocalEvent.hidePop);\r\n        }\r\n        if (this.mClosedCallBack && typeof this.mClosedCallBack == 'function') {\r\n            this.mClosedCallBack();\r\n            this.mClosedCallBack = null;\r\n        }\r\n    }\r\n    /* 将数据6个分组 */\r\n    getRewardList() {\r\n        const result = [];\r\n        for (let i = 0; i < this._rewards.length; i += this._lineHeroCount) {\r\n            result.push(this._rewards.slice(i, i + this._lineHeroCount));\r\n        }\r\n        return result;\r\n    }\r\n}\r\n\r\n"]}