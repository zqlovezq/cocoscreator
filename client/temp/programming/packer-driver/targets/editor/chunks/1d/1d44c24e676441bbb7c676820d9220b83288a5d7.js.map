{"version":3,"sources":["file:///C:/chickenStarClient/client/assets/scripts/logic/model/fengyunRanking/FengyunRankingView.ts"],"names":["_decorator","instantiate","Label","Node","Prefab","ProgressBar","ViewScreen","tab","LangMgr","GameUtil","setTextTime","FengyunRankingStageItem","proto","ItemPoolMgr","PlayerHeadItem","SimpleRoleInfo","FengyunRankData","TaskInfo","UIMgr","FengyunRankControl","ItemInfo","EventMgr","ViewName","RoleData","RedMgr","RedDotType","ccclass","property","FengyunRankingView","rewardTab","rankMsg","taskIds","currTaskInfo","isAccount","lastEndTimer","lastTimerCallBack","tiemNumLab","string","getLab","unschedule","initTaskInfo","register","onMsg","Ptl","ReceiveHonorRollTasksRewardsRsp","on_s2c_ReceiveHonorRollTasksRewardsRsp","onShow","openData","id","table","getData","ActivityRankTableById","getValue","titleLab","WordKey","RankRewardTableById","RankId","TaskIds","settleTime","ins","getServerUtcTime","schedule","initReward","initRank","refreshRed","ranking","myRankLab","list","rankList","i","setRankInfo","index","msg","node","rankNodes","active","headItem","getChildByName","nameLab","getComponent","infoLab","not","sinfo","simple","initHeadInfo","roleInfo","name","QuestLogTableByLevel","reputation","Name","ranks","Ranking","myRewards","key","strs","split","rewards","getRewardsByDropId","DropId","item","rankRewardItemPrefab","parent","rankRewardNode","min","Number","max","initView","myRewaedNode","removeAllChildren","createRewadItem","getHonorRollInfoByActId","currTask","task","tasks","find","a","isReceived","taskBgNodes","length","taskInfo","isCanReceived","taskDecLab","taskTable","Describe","progress","FinishParam1","taskBar","taskNumLab","taskRewardNode","RewardItemIds","info","initItemData","RewardItemNum","onClickReceived","reqReceiveHonorRollTasksRewards","onClickGoto","JumpUI","jumpLayer","JumpParam","error","code","CommonErrorCode","Succeed","show","viewName","CongratulationPop","data","red_node","isRed","Feng_Yun_Rank","String"],"mappings":"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","sourcesContent":["import { _decorator, Component, instantiate, Label, Node, Prefab, ProgressBar } from 'cc';\r\nimport { ViewScreen } from '../../../framework/base/ViewScreen';\r\nimport { tab } from '../../../Table/table_gen';\r\nimport { LangMgr } from '../../mgr/LangMgr';\r\nimport { GameUtil, setTextTime } from '../../utils/GameUtil';\r\nimport { FengyunRankingStageItem } from './FengyunRankingStageItem';\r\nimport { proto } from 'client_protocol';\r\nimport { ItemPoolMgr } from '../item/ItemPoolMgr';\r\nimport { PlayerHeadItem } from '../common/PlayerHeadItem';\r\nimport { SimpleRoleInfo } from '../friends/SimpleRoleInfo';\r\nimport { FengyunRankData } from './FengyunRankData';\r\nimport { TaskInfo } from '../task/TaskInfo';\r\nimport { UIMgr } from '../../mgr/UIMgr';\r\nimport { FengyunRankControl } from './FengyunRankControl';\r\nimport { ItemInfo } from '../item/ItemInfo';\r\nimport { EventMgr } from '../../mgr/EventMgr';\r\nimport { ViewName } from '../../define/ViewDefine';\r\nimport { RoleData } from '../role/RoleData';\r\nimport { RedMgr } from '../../mgr/RedMgr';\r\nimport { RedDotType } from '../../red/RedDotType';\r\nconst { ccclass, property } = _decorator;\r\n\r\n/**\r\n * \r\n * FengyunRankingView\r\n * zhudingchao\r\n * Wed Jul 17 2024 15:28:28 GMT+0800 (中国标准时间)\r\n * db://assets/scripts/logic/model/fengyunRanking/FengyunRankingView.ts\r\n *\r\n */\r\n\r\n@ccclass('FengyunRankingView')\r\nexport class FengyunRankingView extends ViewScreen {\r\n    @property(Label)\r\n    titleLab: Label = null;\r\n    @property(Label)\r\n    tiemNumLab: Label = null;\r\n    @property([Node])\r\n    rankNodes: Node[] = [];\r\n    @property(Node)\r\n    myRewaedNode: Node = null;\r\n    @property(Label)\r\n    myRankLab: Label = null;\r\n\r\n    @property(Node)\r\n    rankRewardNode: Node = null;\r\n    @property(Prefab)\r\n    rankRewardItemPrefab: Prefab = null;\r\n\r\n    @property(Label)\r\n    taskDecLab: Label = null;\r\n    @property(Node)\r\n    taskRewardNode: Node = null;\r\n    @property(ProgressBar)\r\n    taskBar: ProgressBar = null;\r\n    @property(Label)\r\n    taskNumLab: Label = null;\r\n    @property([Node])\r\n    taskBgNodes: Node[] = [];\r\n    @property(Node)\r\n    red_node:Node = null;\r\n\r\n    private rewardTab: tab.RankRewardTable;\r\n    private rankMsg: proto.Msg_GetRankRsp;\r\n    private taskIds: Array<number>;\r\n    private currTaskInfo: TaskInfo;\r\n    private isAccount:boolean;\r\n    private lastEndTimer:number;\r\n    register(): void {\r\n        EventMgr.onMsg(proto.Ptl.ReceiveHonorRollTasksRewardsRsp, this.on_s2c_ReceiveHonorRollTasksRewardsRsp, this)\r\n    }\r\n    onShow(): void {\r\n        if (this.openData[\"rankMsg\"] && this.openData[\"id\"]) {\r\n            let id = this.openData[\"id\"];\r\n            this.rankMsg = this.openData[\"rankMsg\"];\r\n            let table = tab.getData().ActivityRankTableById.getValue(id);\r\n            this.titleLab.string = LangMgr.getLab(table.WordKey);\r\n            this.rewardTab = tab.getData().RankRewardTableById.getValue(table.RankId);\r\n            this.taskIds = table.TaskIds;\r\n            this.lastEndTimer=this.rankMsg.settleTime-RoleData.ins.getServerUtcTime();\r\n            if(this.lastEndTimer<0){\r\n                this.isAccount=true;\r\n                //this.tiemNumLab.string=\"已结算\"\r\n                this.tiemNumLab.string = LangMgr.getLab(\"ui_commondesc_116\")\r\n            }else{\r\n                this.isAccount=false;\r\n                this.tiemNumLab.string= setTextTime(this.lastEndTimer);\r\n                this.schedule(this.lastTimerCallBack,1)\r\n              \r\n            }\r\n            this.initReward();\r\n            this.initRank();\r\n            this.initTaskInfo();\r\n            this.refreshRed();\r\n        }\r\n    }\r\n    lastTimerCallBack=()=>{\r\n        this.lastEndTimer--;\r\n        if(this.lastEndTimer>=0){\r\n           this.tiemNumLab.string= setTextTime(this.lastEndTimer);\r\n        }else{\r\n            //this.tiemNumLab.string=\"已结算\"\r\n            this.tiemNumLab.string = LangMgr.getLab(\"ui_commondesc_116\")\r\n            this.isAccount=false;\r\n            this.unschedule(this.lastTimerCallBack);\r\n            this.initTaskInfo();\r\n        }\r\n    }\r\n    initRank() {\r\n        if (this.rankMsg.ranking>=0) {\r\n            this.myRankLab.string = \"\" + (this.rankMsg.ranking+1);\r\n        } else {\r\n            this.myRankLab.string = LangMgr.getLab(\"ui_rank_1\");\r\n        }\r\n        let list = this.rankMsg.rankList;\r\n        for(let i=0;i<3;i++){\r\n            if(list[i]){\r\n                this.setRankInfo(i, list[i])\r\n            }\r\n            else{\r\n                this.setRankInfo(i, null)\r\n            }\r\n        }\r\n    }\r\n    setRankInfo(index: number, msg: proto.ISimpleRank) {\r\n        let node = this.rankNodes[index];\r\n        if(msg===null){\r\n            node.active = false;\r\n            return;\r\n        }\r\n        let headItem = node.getChildByName(\"PlayerHeadItem\");\r\n        let nameLab = node.getChildByName(\"name_txt\").getComponent(Label);\r\n        let infoLab = node.getChildByName(\"info_txt\").getComponent(Label);\r\n        let not = node.getChildByName(\"nobody_txt\");\r\n        if (msg) {\r\n            // let herad=new \r\n            let sinfo = new SimpleRoleInfo(msg.simple);\r\n            headItem.getComponent(PlayerHeadItem).initHeadInfo({ roleInfo: sinfo });\r\n            not.active = false;\r\n            nameLab.string = msg.simple.name;\r\n            let table = tab.getData().QuestLogTableByLevel.getValue(sinfo.reputation);\r\n            if (table) {\r\n                infoLab.string = LangMgr.getLab(table.Name);\r\n            } else {\r\n                infoLab.string = \"\";\r\n            }\r\n\r\n        } else {\r\n            not.active = true;\r\n            nameLab.node.active = false;\r\n            headItem.active = false;\r\n            infoLab.node.active = false;\r\n        }\r\n\r\n    }\r\n    initReward() {\r\n        let ranks = this.rewardTab.Ranking;\r\n        let myRewards = [];\r\n        for (let key in ranks) {\r\n            if (ranks[key] != \"\") {\r\n                let strs = ranks[key].split(\";\");\r\n                let rewards = GameUtil.getRewardsByDropId(this.rewardTab.DropId[key]);\r\n                let item = instantiate(this.rankRewardItemPrefab);\r\n                item.parent = this.rankRewardNode;\r\n                let min = Number(strs[0]);\r\n                let max = Number(strs[1]);\r\n                item.getComponent(FengyunRankingStageItem).initView(min, max, rewards);\r\n                if (this.rankMsg.ranking > -1) {\r\n                    if (this.rankMsg.ranking + 1 <= min && this.rankMsg.ranking + 1 <= max) {\r\n                        myRewards = rewards;\r\n                    }\r\n                }\r\n            }\r\n\r\n        }\r\n        this.myRewaedNode.removeAllChildren();\r\n        for (let key in myRewards) {\r\n            ItemPoolMgr.ins.createRewadItem(myRewards[key], this.myRewaedNode);\r\n        }\r\n    }\r\n    initTaskInfo() {\r\n        let isAccount = this.isAccount;\r\n        let msg = FengyunRankData.ins.getHonorRollInfoByActId(101);\r\n        let currTask = null;\r\n        for (let key in this.taskIds) {\r\n            let task = msg.tasks.find(a => a.id == this.taskIds[key]);\r\n            if (task) {\r\n                if (!task.isReceived&&!currTask) {\r\n                    currTask = task;\r\n                }\r\n            }\r\n        }\r\n        for (let key in this.taskBgNodes) {\r\n            this.taskBgNodes[key].active = false;\r\n        }\r\n        if (!currTask) {\r\n            currTask = msg.tasks.find(a => a.id == this.taskIds[this.taskIds.length - 1]);\r\n        }\r\n        if (currTask) {\r\n            let taskInfo = new TaskInfo(currTask);\r\n            if (isAccount) {\r\n                this.taskBgNodes[3].active = true;\r\n            } else {\r\n                if (taskInfo.isReceived) {\r\n                    this.taskBgNodes[2].active = true;\r\n                } else if (taskInfo.isCanReceived) {\r\n                    this.taskBgNodes[0].active = true;\r\n                } else {\r\n                    this.taskBgNodes[1].active = true;\r\n                }\r\n            }\r\n            this.taskDecLab.node.parent.active = true;\r\n            this.taskDecLab.string = LangMgr.getLab(taskInfo.taskTable.Describe);\r\n            if (taskInfo.progress >= taskInfo.taskTable.FinishParam1) {\r\n                this.taskBar.progress = 1;\r\n                this.taskNumLab.string = taskInfo.progress + \"/\" + taskInfo.progress\r\n            } else {\r\n                this.taskBar.progress = taskInfo.progress / taskInfo.taskTable.FinishParam1;\r\n                this.taskNumLab.string = taskInfo.progress + \"/\" + taskInfo.taskTable.FinishParam1;\r\n            }\r\n            this.currTaskInfo = taskInfo;\r\n            this.taskRewardNode.removeAllChildren();\r\n            for (let key in this.currTaskInfo.taskTable.RewardItemIds) {\r\n                let info = new ItemInfo();\r\n                info.initItemData(this.currTaskInfo.taskTable.RewardItemIds[key], this.currTaskInfo.taskTable.RewardItemNum[key]);\r\n                ItemPoolMgr.ins.createRewadItem(info, this.taskRewardNode);\r\n            }\r\n        }else{\r\n            this.taskDecLab.node.parent.active = false;\r\n        }\r\n    }\r\n    onClickReceived() {\r\n        if (this.currTaskInfo && this.currTaskInfo.isCanReceived) {\r\n            FengyunRankControl.ins.reqReceiveHonorRollTasksRewards(101, [this.currTaskInfo.id]);\r\n        }\r\n\r\n    }\r\n    onClickGoto() {\r\n        if (this.currTaskInfo && this.currTaskInfo.taskTable.JumpUI) {\r\n            UIMgr.ins.jumpLayer(this.currTaskInfo.taskTable.JumpUI,this.currTaskInfo.taskTable.JumpParam[0]);\r\n        }\r\n    }\r\n\r\n    on_s2c_ReceiveHonorRollTasksRewardsRsp(msg: proto.Msg_ReceiveHonorRollTasksRewardsRsp) {\r\n        if (!msg.error || msg.error.code == proto.CommonErrorCode.Succeed) {\r\n            if(msg.rewards&&msg.rewards.length>0){\r\n                UIMgr.ins.show({ viewName: ViewName.CongratulationPop, data: msg.rewards })\r\n            }\r\n            this.initTaskInfo();\r\n            this.refreshRed();\r\n        }\r\n\r\n    }\r\n    refreshRed(){\r\n        this.red_node.active = RedMgr.ins.isRed(RedDotType.Feng_Yun_Rank, String(101),String(this.currTaskInfo.id));\r\n    }\r\n}"]}