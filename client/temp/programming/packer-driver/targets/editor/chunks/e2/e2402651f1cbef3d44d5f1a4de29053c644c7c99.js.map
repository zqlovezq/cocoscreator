{"version":3,"sources":["file:///C:/chickenStarClient/client/assets/scripts/logic/fight/data/FightAttrCalculate.ts"],"names":["FightAttrCalculate","_decorator","tab","FightMacro","ccclass","property","tmpData","base","parm1","parm2","parm3","parm4","result","clear","attrChange","attrData","attrType","value","isAttack","attack","isDefanse","defanse","isMaxHp","maxHp","AttrType","AttrType_Attack","AttrType_DamagePer1","AttrType_DamagePer2","AttrType_DamagePer3","getAttr","MAX_CHANCE","Math","max","setAttr","AttrType_TotalAttack","floor","AttrType_Defence","AttrType_DefencePer1","AttrType_DefencePer2","AttrType_DefencePer3","AttrType_TotalDefence","AttrType_Hp","AttrType_HpPer","AttrType_HpPer2","PERCENT","AttrType_TotalHp","bulletCoefficient","damage","attackRole","defanseRole"],"mappings":"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","sourcesContent":["import { _decorator, math } from \"cc\";\nimport { AbsRoleInfo } from \"../base/obj/role/AbsRoleInfo\";\nimport { tab } from \"../../../Table/table_gen\";\nimport { FightMacro } from \"../define/FightDefine\";\nimport { FightAttrData } from \"./FightAttrData\";\n\nconst { ccclass, property } = _decorator;\n\nconst tmpData: { base: number, parm1: number, parm2: number, parm3: number, parm4: number, result: number, clear: Function } = {\n    base: 0,\n    parm1: 0,\n    parm2: 0,\n    parm3: 0,\n    parm4: 0,\n    result: 0,\n    clear() {\n        this.base = 0\n        this.parm1 = 0\n        this.parm2 = 0\n        this.parm3 = 0\n        this.parm4 = 0\n        this.result = 0\n    }\n}\n/** 战斗属性计算 */\nexport class FightAttrCalculate {\n    //-------------------角色属性计算， 攻击、防御、生命（最大血量）--------------\n    /** 属性变更 */\n    static attrChange(attrData: FightAttrData, attrType: tab.AttrType, value: number) {\n        if (this.isAttack(attrType)) {\n            this.attack(attrData, attrType)\n        } else if (this.isDefanse(attrType)) {\n            this.defanse(attrData, attrType)\n        } else if (this.isMaxHp(attrType)) {\n            this.maxHp(attrData, attrType)\n        }\n\n    }\n\n    static isAttack(attrType: tab.AttrType) {\n        if (attrType == tab.AttrType.AttrType_Attack\n            || attrType == tab.AttrType.AttrType_DamagePer1\n            || attrType == tab.AttrType.AttrType_DamagePer2\n            || attrType == tab.AttrType.AttrType_DamagePer3\n        ) {\n            return true\n        }\n        return false\n    }\n    /** 攻击 */\n    static attack(attrData: FightAttrData, attrType: tab.AttrType) {\n        tmpData.clear()\n        tmpData.base = attrData.getAttr(tab.AttrType.AttrType_Attack)\n        tmpData.parm1 = FightMacro.MAX_CHANCE + attrData.getAttr(tab.AttrType.AttrType_DamagePer1)\n        tmpData.parm2 = FightMacro.MAX_CHANCE + attrData.getAttr(tab.AttrType.AttrType_DamagePer2)\n        tmpData.parm3 = FightMacro.MAX_CHANCE + attrData.getAttr(tab.AttrType.AttrType_DamagePer3)\n\n\n        tmpData.result = tmpData.base\n            * (tmpData.parm1) / FightMacro.MAX_CHANCE\n            * (tmpData.parm2) / FightMacro.MAX_CHANCE\n            * (tmpData.parm3) / FightMacro.MAX_CHANCE\n\n        tmpData.result = Math.max(tmpData.result, 1)\n        attrData.setAttr(tab.AttrType.AttrType_TotalAttack, Math.floor(tmpData.result))\n\n        // console.log(\"计算: 攻击 原因：\", tab.AttrType[attrType], JSON.stringify(tmpData))\n    }\n\n    static isDefanse(attrType: tab.AttrType) {\n        if (attrType == tab.AttrType.AttrType_Defence\n            || attrType == tab.AttrType.AttrType_DefencePer1\n            || attrType == tab.AttrType.AttrType_DefencePer2\n            || attrType == tab.AttrType.AttrType_DefencePer3\n        ) {\n            return true\n        }\n        return false\n    }\n    /** 防御计算 */\n    static defanse(attrData: FightAttrData, attrType: tab.AttrType) {\n        tmpData.clear()\n        tmpData.base = attrData.getAttr(tab.AttrType.AttrType_Defence)\n        tmpData.parm1 = FightMacro.MAX_CHANCE + attrData.getAttr(tab.AttrType.AttrType_DefencePer1)\n        tmpData.parm2 = FightMacro.MAX_CHANCE + attrData.getAttr(tab.AttrType.AttrType_DefencePer2)\n        tmpData.parm3 = FightMacro.MAX_CHANCE + attrData.getAttr(tab.AttrType.AttrType_DefencePer3)\n\n        tmpData.result = tmpData.base\n            * (tmpData.parm1) / FightMacro.MAX_CHANCE\n            * (tmpData.parm2) / FightMacro.MAX_CHANCE\n            * (tmpData.parm3) / FightMacro.MAX_CHANCE\n\n        tmpData.result = Math.max(tmpData.result, 0)\n        attrData.setAttr(tab.AttrType.AttrType_TotalDefence, Math.floor(tmpData.result))\n        // console.log(\"计算: 防御 原因：\", tab.AttrType[attrType], JSON.stringify(tmpData))\n    }\n\n    static isMaxHp(attrType: tab.AttrType) {\n        if (attrType == tab.AttrType.AttrType_Hp\n            || attrType == tab.AttrType.AttrType_HpPer || attrType == tab.AttrType.AttrType_HpPer2\n        ) {\n            return true\n        }\n        return false\n    }\n\n    /** 最大生命值计算 */\n    static maxHp(attrData: FightAttrData, attrType: tab.AttrType) {\n        tmpData.clear()\n        tmpData.base = attrData.getAttr(tab.AttrType.AttrType_Hp)\n        tmpData.parm1 = FightMacro.MAX_CHANCE + attrData.getAttr(tab.AttrType.AttrType_HpPer) * (FightMacro.PERCENT + attrData.getAttr(tab.AttrType.AttrType_HpPer2)) / FightMacro.PERCENT\n\n        tmpData.result = Math.max(tmpData.base * (tmpData.parm1) / FightMacro.MAX_CHANCE, 0)\n\n        attrData.setAttr(tab.AttrType.AttrType_TotalHp, Math.floor(tmpData.result))\n        // console.log(\"计算: HP  原因：\", tab.AttrType[attrType], JSON.stringify(tmpData))\n    }\n\n\n    //-------------------子弹属性计算，子弹系数--------------\n    /** 子弹系数 */\n    static bulletCoefficient(attrData: FightAttrData, attrType: tab.AttrType) {\n\n    }\n\n\n    //-------------------伤害计算--------------\n    /** 伤害计算 */\n    static damage(attackRole: AbsRoleInfo, defanseRole: AbsRoleInfo) {\n\n    }\n}"]}