{"version":3,"sources":["file:///C:/chickenStarClient/client/assets/scripts/logic/model/equip/EquipmentDetailPop.ts"],"names":["_decorator","instantiate","Label","log","Node","Prefab","Sprite","ViewPop","ItemPoolMgr","LangMgr","tab","UIMgr","ViewName","EquipControl","ccclass","property","EquipmentDetailPop","euqipInfo","register","onLoad","start","initData","initView","openData","item","ins","createEquipItem","itemNode","nameLab","string","getLab","itemTable","Name","typeLab","getEquipTypeNameKey","scoreLab","score","desLab","Desc","quality","getData","HeroAptitudeTableByHeroAptitude","getValue","Number","Quality","SkillBg","sp_bg","setTexture","initAttrItme","equipBtn","active","isWear","growthBtn","resolveBtn","exchangeBtn","baseAttr","baseAttrInfos","enhanceLv","refineLv","key","addNum","getAddValueByLevel","createAttrItem","parent","baseAttrNode","addAttr","extraAttrInfos","additionNode","length","addAttrNode","attr","detailItemPrefab","getChildByName","getComponent","AttrType","attrTable","Base","onClickEquip","getView","EquipmentView","reqChangEquips","equipTable","Class","id","hideView","BagPop","show","viewName","data","onClose","onClickResolve","EquipResolvePop","onClickExchange","onClickGrowth","onDisable","onDestroy"],"mappings":"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","sourcesContent":["import { _decorator, Component, instantiate, Label, labelAssembler, log, Node, Prefab, SpringJoint2D, Sprite, UI, View, view } from 'cc';\r\nimport { ViewPop } from '../../../framework/base/ViewPop';\r\nimport { EquipInfo } from './EquipInfo';\r\nimport { ItemPoolMgr } from '../item/ItemPoolMgr';\r\nimport { LangMgr } from '../../mgr/LangMgr';\r\nimport { tab } from '../../../Table/table_gen';\r\nimport { CommonItem } from '../item/CommonItem';\r\nimport { UIMgr } from '../../mgr/UIMgr';\r\nimport { ViewName } from '../../define/ViewDefine';\r\nimport { EquipControl } from './EquipControl';\r\nimport { EquipAttrInfo } from './EquipAttrInfo';\r\nconst { ccclass, property } = _decorator;\r\n\r\n@ccclass('EquipmentDetailPop')\r\nexport class EquipmentDetailPop extends ViewPop {\r\n    @property(Node)\r\n    itemNode:Node=null;\r\n    @property(Label)\r\n    nameLab:Label=null;\r\n    @property(Label)\r\n    typeLab:Label=null;\r\n    @property(Label)\r\n    scoreLab:Label=null;\r\n    @property(Node)\r\n    baseAttrNode:Node=null;\r\n    @property(Node)\r\n    addAttrNode:Node=null;\r\n    @property(Node)\r\n    additionNode:Node=null;\r\n    @property(Label)\r\n    desLab:Label=null;\r\n    @property(Sprite)\r\n    sp_bg:Sprite = null;\r\n\r\n    @property(Node)\r\n    resolveBtn:Node=null;\r\n    @property(Node)\r\n    equipBtn:Node=null;\r\n    @property(Node)\r\n    exchangeBtn:Node=null;\r\n    @property(Node)\r\n    growthBtn:Node=null;\r\n    @property(Prefab)\r\n    detailItemPrefab:Prefab=null;\r\n    public euqipInfo:EquipInfo=null;\r\n    register(){\r\n\r\n\r\n    }\r\n    onLoad (){\r\n\r\n    }\r\n    start() {\r\n        this.initData();\r\n        this.initView();\r\n    }\r\n    initData(){\r\n        this.euqipInfo=this.openData;\r\n       \r\n    }\r\n    initView(){\r\n        let item=ItemPoolMgr.ins.createEquipItem(this.euqipInfo,this.itemNode,false);\r\n        // item.getComponent(CommonItem).setIsTouchItem(false);\r\n        this.nameLab.string=LangMgr.getLab(this.euqipInfo.itemTable.Name);\r\n        this.typeLab.string=LangMgr.getLab(this.euqipInfo.getEquipTypeNameKey());\r\n        this.scoreLab.string=this.euqipInfo.score+\"\";\r\n        this.desLab.string=LangMgr.getLab(this.euqipInfo.itemTable.Desc);\r\n\r\n        const quality = tab.getData().HeroAptitudeTableByHeroAptitude.getValue(Number(this.euqipInfo.itemTable.Quality-1));\r\n        if(quality&&quality.SkillBg){\r\n            this.sp_bg.setTexture(quality.SkillBg)\r\n        }\r\n\r\n        this.initAttrItme();\r\n        this.equipBtn.active=!this.euqipInfo.isWear;\r\n        this.growthBtn.active=this.euqipInfo.isWear;\r\n        this.resolveBtn.active=!this.euqipInfo.isWear;\r\n        this.exchangeBtn.active=this.euqipInfo.isWear;\r\n\r\n    }\r\n    initAttrItme(){\r\n        let baseAttr=this.euqipInfo.baseAttrInfos;\r\n        let enhanceLv=this.euqipInfo.isWear?this.euqipInfo.enhanceLv:0\r\n        let refineLv=this.euqipInfo.isWear?this.euqipInfo.refineLv:0;\r\n        // let equipAttrInfo=this.euqipInfo.isWear?\r\n        for(let key in baseAttr){\r\n          let addNum=baseAttr[key].getAddValueByLevel(enhanceLv);\r\n          let item=this.createAttrItem(baseAttr[key],addNum);\r\n          item.parent=this.baseAttrNode;\r\n        }\r\n\r\n        let addAttr=this.euqipInfo.extraAttrInfos;\r\n        this.additionNode.active=addAttr.length>0;\r\n        for(let key in addAttr){\r\n          let addNum=addAttr[key].getAddValueByLevel(refineLv);\r\n          let item=this.createAttrItem(addAttr[key],addNum);\r\n          item.parent=this.addAttrNode;\r\n        }\r\n    }\r\n    private createAttrItem(attr:EquipAttrInfo,addNum:number=0){\r\n        // let table=tab.getData().EquipAttrTableById.getValue(attrId);\r\n        let item=instantiate(this.detailItemPrefab);\r\n      \r\n        item.getChildByName(\"name_txt\").getComponent(Label).string=LangMgr.getLab(tab.AttrType[attr.attrTable.AttrType]);\r\n        item.getChildByName(\"now_txt\").getComponent(Label).string=attr.attrTable.Base+(addNum>0?\"(+\"+addNum+\")\":\"\");\r\n        return item;\r\n    }\r\n\r\n    onClickEquip(){\r\n        if(UIMgr.ins.getView(ViewName.EquipmentView)){\r\n             log(\"穿戴-------------\")\r\n             EquipControl.ins.reqChangEquips(this.euqipInfo.equipTable.Class,[this.euqipInfo.id])\r\n        }else{\r\n            UIMgr.ins.hideView(ViewName.BagPop);\r\n            UIMgr.ins.show({viewName:ViewName.EquipmentView,data:{\"type\":3,\"equipInfo\":this.euqipInfo}});\r\n        }\r\n    \r\n       this.onClose();\r\n    }\r\n    onClickResolve(){\r\n        UIMgr.ins.hideView(ViewName.BagPop);\r\n        UIMgr.ins.show({ viewName: ViewName.EquipResolvePop })\r\n        this.onClose();\r\n    }\r\n    onClickExchange(){\r\n        UIMgr.ins.show({viewName:ViewName.EquipmentView,data:{\"type\":3,\"equipInfo\":this.euqipInfo}});\r\n        this.onClose();\r\n\r\n    }\r\n    onClickGrowth(){\r\n        UIMgr.ins.show({viewName:ViewName.EquipmentView,data:{\"type\":1,\"equipInfo\":this.euqipInfo}});\r\n        this.onClose();\r\n    }\r\n    protected onDisable(): void {\r\n        // ItemPoolMgr.ins.putCommonItem( this.itemNode.children[0])\r\n       \r\n    }\r\n     public onDestroy(): void {\r\n        super.onDestroy();\r\n        // ItemPoolMgr.ins.putEquipItem( this.itemNode.children[0])\r\n    }\r\n}\r\n\r\n\r\n"]}