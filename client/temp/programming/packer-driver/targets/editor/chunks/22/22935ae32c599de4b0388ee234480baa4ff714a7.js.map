{"version":3,"sources":["file:///C:/chickenStarClient/client/assets/scripts/logic/model/common/ItemInfoPop.ts"],"names":["_decorator","Label","log","Node","ViewPop","CommonItem","tab","ItemInfo","LangMgr","HeroDataControl","ItemPoolMgr","HeroInfo","ShowTips","UIMgr","ItemData","proto","Net","EventMgr","ViewName","HeroItem","GameUtil","EquipData","ccclass","property","ItemInfoPop","_itemId","_itemUseCount","_isBag","_itemCount","_selectHeroId","equipComItems","heroComItems","comItems","bookComItems","judgeIsBagView","BagPop","ins","getView","register","onMsg","Ptl","UseItemRsp","on_s2c_UseItemRsp","msg","error","code","CommonErrorCode","Succeed","rewards","length","show","viewName","CongratulationPop","data","message","onClose","onShow","openData","itemId","node_top","active","node_list","node_num","node_btn","itemData","getData","ItemTableById","getValue","Type","ItemType","ItemType_Piece","Quality","ItemQuality","ItemQuality_Purple","ItemType_ChoiceBox","count","getCount","updatePieceLbl","ItemType_Elixir","ItemType_Head","ItemType_HeadFrame","ItemType_ChatBubble","ItemType_MainScene","ItemType_Material","showMaterialTip","ItemType_Box","ItemType_IdleReward","node_compound_btn","node_use_btn","itemInfo","num","item","initData","setSelectState","lbl_name","string","getLab","Name","lbl_desc","Desc","node_hava_item_count","jumpTab","ItemClientJumpTableByItemId","node_way","AcquireWay","arr","i","opName","str","OpenFunctionName","push","lbl_way","join","BagType","BagType_Fragment","createRdmPiece","DropId","HeroTableById","BagType_Goods","boxTab","ChoiceBoxTableByChoiceBoxId","isAutoBoxDropId","isSelfSelectBox","self","node_list_content","destroyAllChildren","key","putHeroItem","heroList","boxList","ChoiceItemIds","ChoiceItemNum","list","getRewardsByDropId","itemTab","itemTs","info","id","star","DefaultStar","itemNode","createHeroItem","getComponent","setLevel","createItem","setTouchCallBack","setAllHerosSelect","children","ts","setSelect","heroInfo","onDestroy","onDisable","putEquipItem","putCommonItem","putBookItme","clickAddPiece","max","Math","floor","clickSubPiece","clickMaxPiece","useBtn","console","choiceIndex","indexOf","ItemType_Gift","heroCount","totalEquip","totalhero","equipCount","items","k","itemTable","ItemType_Hero","BagType_Equip","getHeroBagFull","getEquipBagFull","Msg_UseItemReq","itemCount","extra","UseItemExtra","choiceIndexes","Send","UseItemReq","compoundBtn","lbl_num","String"],"mappings":"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","sourcesContent":["import { _decorator, Component, director, Label, log, Node } from 'cc';\r\nimport { ViewPop } from '../../../framework/base/ViewPop';\r\nimport { CommonItem } from '../item/CommonItem';\r\nimport { tab } from '../../../Table/table_gen';\r\nimport { ItemInfo } from '../item/ItemInfo';\r\nimport { LangMgr } from '../../mgr/LangMgr';\r\nimport { HeroDataControl } from '../hero/herobag/HeroDataControl';\r\nimport { ItemPoolMgr } from '../item/ItemPoolMgr';\r\nimport { HeroInfo } from '../hero/HeroInfo';\r\nimport { ShowTips, UIMgr } from '../../mgr/UIMgr';\r\nimport { ItemData } from '../item/ItemData';\r\nimport { proto } from 'client_protocol';\r\nimport { Net } from '../../net/Net';\r\nimport { EventMgr } from '../../mgr/EventMgr';\r\nimport { ViewName } from '../../define/ViewDefine';\r\nimport { HeroItem } from '../item/HeroItem';\r\nimport { GameUtil } from '../../utils/GameUtil';\r\nimport { EquipData } from '../equip/EquipData';\r\nconst { ccclass, property } = _decorator;\r\n\r\n@ccclass('ItemInfoPop')\r\nexport class ItemInfoPop extends ViewPop {\r\n    @property(Node)\r\n    node_top: Node = null;\r\n    @property(Node)\r\n    node_list: Node = null;\r\n    @property(Node)\r\n    node_num: Node = null;\r\n    @property(Node)\r\n    node_btn: Node = null;\r\n    @property(CommonItem)\r\n    item: CommonItem = null;\r\n    @property(Label)\r\n    lbl_name: Label = null;\r\n    @property(Label)\r\n    lbl_desc: Label = null;\r\n    @property(Node)\r\n    node_list_content: Node = null;\r\n    @property(Label)\r\n    lbl_num: Label = null;\r\n    @property(Node)\r\n    node_use_btn: Node = null;\r\n    @property(Node)\r\n    node_compound_btn: Node = null;\r\n\r\n    @property(Node)\r\n    node_hava_item_count: Node = null;\r\n    @property(Node)\r\n    node_way: Node = null;\r\n    @property(Label)\r\n    lbl_way: Label = null;\r\n\r\n    private _itemId: number = 0;\r\n    private _itemUseCount: number = 0;\r\n    private _isBag: boolean = false;\r\n    private _itemCount: number = 0;\r\n    private _selectHeroId: number = 0;\r\n    private equipComItems: Array<Node> = [];\r\n    private heroComItems: Array<Node> = [];\r\n    private comItems: Array<Node> = [];\r\n    private bookComItems: Array<Node> = [];\r\n    // 判断当前是否是背包界面\r\n    judgeIsBagView() {\r\n        const BagPop = UIMgr.ins.getView('BagPop');\r\n        if (BagPop) {\r\n            return true;\r\n        }\r\n        return false;\r\n    }\r\n    register(): void {\r\n        EventMgr.onMsg(proto.Ptl.UseItemRsp, this.on_s2c_UseItemRsp, this)\r\n    }\r\n    on_s2c_UseItemRsp(msg: proto.Msg_UseItemRsp) {\r\n        if (!msg.error || msg.error.code == proto.CommonErrorCode.Succeed) {\r\n            if (msg.rewards && msg.rewards.length > 0) {\r\n                UIMgr.ins.show({ viewName: ViewName.CongratulationPop, data: msg.rewards })\r\n            } else {\r\n                log(\"奖励是空的\")\r\n                //ShowTips(\"背包已满,去邮箱领取英雄\");\r\n                // ShowTips(LangMgr.getLab(\"Tips_herobag_2\"));\r\n            }\r\n        } else if (msg.error) {\r\n            ShowTips(msg.error.message);\r\n        }\r\n\r\n        this.onClose();\r\n    }\r\n    onShow(): void {\r\n        this._isBag = this.judgeIsBagView();\r\n        this._itemId = this.openData.itemId;\r\n        this.node_top.active = true;\r\n        this.node_list.active = false;\r\n        this.node_num.active = false;\r\n        this.node_btn.active = false;\r\n        const itemData = tab.getData().ItemTableById.getValue(this._itemId)\r\n        if (itemData.Type === tab.ItemType.ItemType_Piece) {\r\n            this._itemUseCount = itemData.Quality === tab.ItemQuality.ItemQuality_Purple ? 30 : 50;\r\n        } else if (itemData.Type === tab.ItemType.ItemType_ChoiceBox) {\r\n            this._itemUseCount = 1;\r\n        }\r\n        const count = ItemData.ins.getCount(this._itemId);\r\n        if (count >= this._itemUseCount) {\r\n            this._itemCount = 1;\r\n        }\r\n        this.updatePieceLbl();\r\n        switch (itemData.Type) {\r\n            case tab.ItemType.ItemType_Elixir:\r\n            case tab.ItemType.ItemType_Head:\r\n            case tab.ItemType.ItemType_HeadFrame:\r\n            case tab.ItemType.ItemType_ChatBubble:\r\n            case tab.ItemType.ItemType_MainScene:\r\n                break;\r\n            case tab.ItemType.ItemType_Piece:\r\n            case tab.ItemType.ItemType_Material:\r\n            case tab.ItemType.ItemType_ChoiceBox:\r\n                this.showMaterialTip()\r\n                break\r\n            case tab.ItemType.ItemType_Box:\r\n            case tab.ItemType.ItemType_IdleReward:\r\n                this._itemUseCount = 1;\r\n                this.node_compound_btn.active = false;\r\n                this.node_use_btn.active = true;\r\n                this.node_num.active = true;\r\n                this.node_btn.active = true;\r\n                break;\r\n            default:\r\n                break;\r\n        }\r\n        let itemInfo = new ItemInfo();\r\n        itemInfo.itemId = this._itemId;\r\n        itemInfo.num = ItemData.ins.getCount(this._itemId);\r\n        this.item.initData(itemInfo);\r\n        this.item.setSelectState(false);\r\n        this.lbl_name.string = LangMgr.getLab(itemData.Name);\r\n        this.lbl_desc.string = LangMgr.getLab(itemData.Desc);\r\n        /* 是否在玩家背包内 如果不是不显示 num_node  btn_node*/\r\n        if (!this._isBag) {\r\n            this.node_num.active = false;\r\n            this.node_btn.active = false;\r\n            this.node_hava_item_count.active = false;\r\n        }\r\n        /* 是否存在跳转路径 */\r\n        const jumpTab = tab.getData().ItemClientJumpTableByItemId.getValue(this._itemId);\r\n        this.node_way.active = jumpTab ? true : false;\r\n        if (itemData.AcquireWay.length > 0) {\r\n            const arr = [];\r\n            for (let i = 0; i < itemData.AcquireWay.length; i++) {\r\n                const opName = itemData.AcquireWay[i];\r\n                const str = LangMgr.getLab(tab.OpenFunctionName[opName]);\r\n                arr.push(str);\r\n            }\r\n            this.lbl_way.string = arr.join(\", \");\r\n            this.node_way.active = true;\r\n        }\r\n    }\r\n    /* 材料点击 */\r\n    showMaterialTip() {\r\n        const itemData = tab.getData().ItemTableById.getValue(this._itemId);\r\n        this.node_use_btn.active = itemData.BagType !== tab.BagType.BagType_Fragment;\r\n        this.node_compound_btn.active = itemData.BagType === tab.BagType.BagType_Fragment\r\n        if (itemData.BagType === tab.BagType.BagType_Fragment) {\r\n            // 碎片\r\n            if (this._itemId >= 6001 && this._itemId <= 6003) {\r\n                // 随机英雄品质碎片\r\n                this.createRdmPiece(itemData.DropId[1] ? itemData.DropId[1] : itemData.DropId[0])\r\n            } else if (this._itemId >= 6004 && this._itemId <= 6008) {\r\n                // 随机英雄职业碎片\r\n                this.createRdmPiece(itemData.DropId[1] ? itemData.DropId[1] : itemData.DropId[0])\r\n            } else {\r\n                if (tab.getData().HeroTableById.getValue(this._itemId - 4000)) {\r\n                    // 单英雄碎片\r\n                    this.node_num.active = true;\r\n                    this.node_btn.active = true;\r\n                }\r\n            }\r\n        } else if (itemData.BagType === tab.BagType.BagType_Goods) {\r\n            const boxTab = tab.getData().ChoiceBoxTableByChoiceBoxId.getValue(itemData.DropId[0]);\r\n            if (boxTab) {\r\n                this.createRdmPiece(0, true)\r\n            } \r\n            // else {\r\n            //     if (itemData.Type === tab.ItemType.ItemType_Box) {\r\n            //         this.createRdmPiece(itemData.DropId[0], false)\r\n            //     }\r\n            // }\r\n        }\r\n    }\r\n    /* 随机碎片、随机宝箱：显示top_node list_node num_node btn_node，滑动列表道具不可选中 */\r\n    createRdmPiece(isAutoBoxDropId: number, isSelfSelectBox?: boolean) {\r\n        var self = this;\r\n        this.node_list.active = true;\r\n        this.node_btn.active = true;\r\n        this.node_num.active = true;\r\n        this.node_list_content.destroyAllChildren();\r\n        const itemData = tab.getData().ItemTableById.getValue(this._itemId);\r\n        // const heroId = this._itemId;\r\n        if (this.heroComItems) {\r\n            for (let key in this.heroComItems) {\r\n                ItemPoolMgr.ins.putHeroItem(this.heroComItems[key]);\r\n            }\r\n        }\r\n        let heroList = [];\r\n        let boxList = [];\r\n        // if (isVocation) {\r\n        //     heroList = HeroDataControl.ins.getBookHeroListByVocation(6009 - heroId, false);\r\n        // } else {\r\n        //     heroList = HeroDataControl.ins.getHeroListByAptitude(heroId - 5999)\r\n        // }\r\n        // 如果是自选宝箱 数据为自选宝箱表\r\n        if (isSelfSelectBox) {\r\n            const boxTab = tab.getData().ChoiceBoxTableByChoiceBoxId.getValue(itemData.DropId[0]);\r\n            heroList = boxTab.ChoiceItemIds;\r\n            boxList = boxTab.ChoiceItemNum;\r\n        }\r\n        if (isAutoBoxDropId) {\r\n            heroList = [];\r\n            // 如果是随机宝箱\r\n            const list = GameUtil.getRewardsByDropId(isAutoBoxDropId);\r\n            for (let i = 0; i < list.length; i++) {\r\n                heroList.push(list[i].itemId);\r\n            }\r\n        }\r\n        for (let i = 0; i < heroList.length; i++) {\r\n            const itemTab = tab.getData().HeroTableById.getValue(heroList[i])\r\n            let itemTs = null;\r\n            if (itemTab) {\r\n                const info = new HeroInfo();\r\n                info.itemId = heroList[i]\r\n                info.id = 0;\r\n                info.star = itemTab.DefaultStar;\r\n                const itemNode = ItemPoolMgr.ins.createHeroItem(info, this.node_list_content);\r\n                itemTs = itemNode.getComponent(HeroItem);\r\n                itemTs.setLevel(0);\r\n            } else {\r\n                const info = new ItemInfo();\r\n                info.itemId = heroList[i]\r\n                info.num = 1;\r\n                const itemNode = ItemPoolMgr.ins.createItem(info, this.node_list_content);\r\n                itemTs = itemNode.getComponent(CommonItem);\r\n            }\r\n            if (this._isBag && itemData.Type === tab.ItemType.ItemType_ChoiceBox) {\r\n                itemTs.setTouchCallBack(() => {\r\n                    self._selectHeroId = heroList[i];\r\n                    if (boxList.length > 0) {\r\n                        self._itemUseCount = boxList[i];\r\n                    }\r\n                    this.setAllHerosSelect();\r\n                })\r\n            }\r\n        }\r\n    }\r\n    setAllHerosSelect() {\r\n        for (let i = 0; i < this.node_list_content.children.length; i++) {\r\n            let item = this.node_list_content.children[i];\r\n            let ts = null;\r\n            if (item.getComponent(HeroItem)) {\r\n                ts = item.getComponent(HeroItem)\r\n                ts.setSelect(this._selectHeroId === ts.heroInfo.itemId ? true : false);\r\n            } else if (item.getComponent(CommonItem)) {\r\n                ts = item.getComponent(CommonItem)\r\n                ts.setSelectState(this._selectHeroId === ts.data.itemId ? true : false);\r\n            }\r\n        }\r\n    }\r\n    protected onDestroy(): void {\r\n        super.onDestroy()\r\n    }\r\n    protected onDisable(): void {\r\n        if (this.equipComItems) {\r\n            for (let key in this.equipComItems) {\r\n                ItemPoolMgr.ins.putEquipItem(this.equipComItems[key]);\r\n            }\r\n        }\r\n        if (this.heroComItems) {\r\n            for (let key in this.heroComItems) {\r\n                ItemPoolMgr.ins.putHeroItem(this.heroComItems[key]);\r\n            }\r\n        }\r\n        if (this.comItems) {\r\n            for (let key in this.comItems) {\r\n                ItemPoolMgr.ins.putCommonItem(this.comItems[key]);\r\n            }\r\n        }\r\n        if (this.bookComItems) {\r\n            for (let key in this.bookComItems) {\r\n                ItemPoolMgr.ins.putBookItme(this.bookComItems[key]);\r\n            }\r\n        }\r\n    }\r\n    // add碎片\r\n    private clickAddPiece() {\r\n        this._itemCount++;\r\n        const count = ItemData.ins.getCount(this._itemId);\r\n        const max = Math.floor(count / this._itemUseCount);\r\n        if (this._itemCount > max) {\r\n            this._itemCount = max;\r\n        }\r\n        this.updatePieceLbl();\r\n    }\r\n    // sub碎片\r\n    private clickSubPiece() {\r\n        this._itemCount--;\r\n        const count = ItemData.ins.getCount(this._itemId);\r\n        const max = Math.floor(count / this._itemUseCount);\r\n        if (max >= 1 && this._itemCount < 1) {\r\n            this._itemCount = 1;\r\n        }\r\n        if (this._itemCount < 0) {\r\n            this._itemCount = 0;\r\n        }\r\n        this.updatePieceLbl();\r\n    }\r\n    // max碎片\r\n    private clickMaxPiece() {\r\n        const count = ItemData.ins.getCount(this._itemId);\r\n        const max = Math.floor(count / this._itemUseCount);\r\n        this._itemCount = max;\r\n        this.updatePieceLbl();\r\n    }\r\n    private useBtn() {\r\n        console.log(\"cocos 点击使用道具\");\r\n        const itemData = tab.getData().ItemTableById.getValue(this._itemId)\r\n        let choiceIndex = -1;\r\n        if (itemData.Type === tab.ItemType.ItemType_ChoiceBox) {\r\n            const boxTab = tab.getData().ChoiceBoxTableByChoiceBoxId.getValue(itemData.DropId[0]);\r\n            const heroList = boxTab.ChoiceItemIds;\r\n            choiceIndex = heroList.indexOf(this._selectHeroId);\r\n            if (choiceIndex < 0) {\r\n                //ShowTips(\"请选择物品\");\r\n                ShowTips(LangMgr.getLab(\"Tips_iteminfo_1\"));\r\n                return;\r\n            }\r\n        }else{\r\n            if (itemData.DropId&&(itemData.Type === tab.ItemType.ItemType_Gift||itemData.Type === tab.ItemType.ItemType_Box)) {\r\n                let heroCount = 0;\r\n                let totalEquip = 0;\r\n                let totalhero = 0;\r\n                let equipCount = 0;\r\n                for (let key in itemData.DropId) {\r\n                    let items = GameUtil.getRewardsByDropId(itemData.DropId[key]);\r\n                    for (let k in items) {\r\n                        if (items[k].itemTable.Type == tab.ItemType.ItemType_Hero) {\r\n                            if (heroCount < items[k].num) {\r\n                                heroCount = items[k].num;\r\n                            }\r\n                        } else if (items[k].itemTable.BagType == tab.BagType.BagType_Equip) {\r\n    \r\n                            if (equipCount < items[k].num) {\r\n                                equipCount = items[k].num;\r\n                            }\r\n                        }\r\n                    }\r\n                    totalEquip += equipCount;\r\n                    totalhero += heroCount;\r\n                    log(\"使用宝箱最大数量 ---装备--\" + totalEquip + \"-----英雄-----\" + totalhero, '---掉落id---', itemData.DropId[key])\r\n                }\r\n    \r\n                if (totalhero > 0) {\r\n                    if (HeroDataControl.ins.getHeroBagFull(totalhero * this._itemCount)) {\r\n                        ShowTips(LangMgr.getLab(\"Tips_herobag_1\"))\r\n                        return\r\n                    }\r\n                }\r\n                if (totalEquip > 0) {\r\n                    if (EquipData.ins.getEquipBagFull(totalEquip * this._itemCount)) {\r\n                        ShowTips(LangMgr.getLab(\"Tips_bag_1\"))\r\n                        return;\r\n                    }\r\n                }\r\n    \r\n            }\r\n        }\r\n\r\n        if (this._itemCount > 0) {\r\n            let msg = new proto.Msg_UseItemReq();\r\n            msg.itemId = this._itemId;\r\n            msg.itemCount = this._itemUseCount * this._itemCount;\r\n            if (choiceIndex >= 0) {\r\n                msg.extra = new proto.UseItemExtra();\r\n                msg.extra.choiceIndexes = [];\r\n                for (let i = 0; i < this._itemCount; i++) {\r\n                    msg.extra.choiceIndexes.push(choiceIndex);\r\n                }\r\n            }\r\n            Net.Send(proto.Ptl.UseItemReq, msg)\r\n        }\r\n    }\r\n    private compoundBtn() {\r\n        console.log(\"cocos 点击合成碎片\");\r\n        if (HeroDataControl.ins.getHeroBagFull(this._itemCount)) {\r\n            ShowTips(LangMgr.getLab(\"Tips_herobag_1\"))\r\n            return\r\n        }\r\n        if (this._itemCount > 0) {\r\n            let msg = new proto.Msg_UseItemReq();\r\n            msg.itemId = this._itemId;\r\n            msg.itemCount = this._itemUseCount * this._itemCount;\r\n            Net.Send(proto.Ptl.UseItemReq, msg)\r\n        }\r\n    }\r\n    // use碎片\r\n    updatePieceLbl() {\r\n        this.lbl_num.string = String(this._itemCount);\r\n    }\r\n}\r\n\r\n\r\n"]}