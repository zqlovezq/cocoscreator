{"version":3,"sources":["file:///C:/chickenStarClient/client/assets/scripts/logic/model/rareBook/RareBookView.ts"],"names":["_decorator","instantiate","Node","Prefab","ScrollView","Toggle","Vec2","ViewBase","RareBookHandBookNode","tab","RareBookData","RareBookGroupItem","UIMgr","ViewName","RareBookEquipNode","proto","EventMgr","RareBookGacha","Func","RedMgr","RedDotType","SettingRedManager","ccclass","property","RareBookView","currTag","groupItems","register","onMsg","Ptl","CombineBookFragmentRsp","on_s2c_CombineBookFragmentRsp","UpgradeBookLevelRsp","on_s2c_UpgradeBookLevelRsp","UpgradeBookStarRsp","on_s2c_UpgradeBookStarRsp","UpdateBookSeriesData","on_s2c_Msg_UpdateBookSeriesData","TakeBookRsp","on_s2c_Msg_TakeBookRsp","DropBookRsp","on_s2c_Msg_DropBookRsp","UpdateBookPowerScore","on_s2c_Msg_UpdateBookPowerScore","onShow","openData","setShowState","initView","onClickToggle","event","tag","Number","handbookNode","node","active","drawbookNode","groupNode","equipNode","toggleNode","getChildByName","getComponent","isChecked","unscheduleAllCallbacks","initHandBook","initGroupView","initEquipView","initBookGachaView","gachaBookNode","rareItemPrefab","groupMap","Map","groupTabs","getData","BookSeriesTable","key","id","GroupId","list","get","set","push","forEach","value","item","rareGroupItemPrefab","parent","groupContentNode","com","initData","updateView","redKey","ins","bookCollectRedPointId","groupId","split","pos","position","redPoint","scheduleOnce","groupScrollview","scrollToOffset","y","playAnim","setItem","updateBookCollectRedPoint","refreshEvent","Book_collect","onClickExchang","show","viewName","RareBookExchangePop","msg","error","code","CommonErrorCode","Succeed","info","getBookInfoById","bookId","bookTable","Aptitude","HeroAptitude","HeroAptitude_SR","updateItem","book","itemId","updateGropView","length","getBookInfoByItemId","updateScore","onDestroy","unTarget","getSetting","setSetting"],"mappings":"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","sourcesContent":["import { _decorator, Component, instantiate, Node, Prefab, ScrollView, sp, Toggle, UI, Vec2 } from 'cc';\r\nimport { ViewBase } from '../../../framework/base/ViewBase';\r\nimport { RareBookHandBookNode } from './RareBookHandBookNode';\r\nimport { RareBookInfo } from './RareBookInfo';\r\nimport { tab } from '../../../Table/table_gen';\r\nimport { RareBookData } from './RareBookData';\r\nimport { RareBookItem } from './RareBookItem';\r\nimport { RareBookGroupItem } from './RareBookGroupItem';\r\nimport { UIMgr } from '../../mgr/UIMgr';\r\nimport { ViewName } from '../../define/ViewDefine';\r\nimport { RareBookEquipNode } from './RareBookEquipNode';\r\nimport { proto } from 'client_protocol';\r\nimport { EventMgr } from '../../mgr/EventMgr';\r\nimport { RareBookGacha } from './RareBookGacha';\r\nimport { Func } from '../../utils/Func';\r\nimport { RedMgr } from '../../mgr/RedMgr';\r\nimport { RedDotType } from '../../red/RedDotType';\r\nimport { SettingRedManager } from '../role/SettingRedManager';\r\nconst { ccclass, property } = _decorator;\r\n\r\n/**\r\n * \r\n * RareBookView\r\n * zhudingchao\r\n * Wed May 22 2024 10:20:35 GMT+0800 (中国标准时间)\r\n * db://assets/scripts/logic/model/rareBook/RareBookView.ts\r\n *\r\n */\r\n\r\n@ccclass('RareBookView')\r\nexport class RareBookView extends ViewBase {\r\n    @property(RareBookHandBookNode)\r\n    handbookNode: RareBookHandBookNode = null;\r\n    @property(Node)\r\n    drawbookNode: Node = null;\r\n    @property(Node)\r\n    groupNode: Node = null;\r\n    @property(RareBookEquipNode)\r\n    equipNode: RareBookEquipNode = null;\r\n    @property(Prefab)\r\n    rareItemPrefab: Prefab = null;\r\n    @property(Node)\r\n    groupContentNode:Node = null;\r\n    @property(Prefab)\r\n    rareGroupItemPrefab: Prefab = null;\r\n    @property(RareBookGacha)\r\n    gachaBookNode: RareBookGacha = null;\r\n    @property(Node)\r\n    toggleNode: Node = null;\r\n    @property(ScrollView)\r\n    groupScrollview:ScrollView = null;\r\n\r\n    private currTag: number = 1;\r\n    private groupItems: Array<RareBookGroupItem>;\r\n\r\n\r\n    register(): void {\r\n        EventMgr.onMsg(proto.Ptl.CombineBookFragmentRsp, this.on_s2c_CombineBookFragmentRsp, this);\r\n        EventMgr.onMsg(proto.Ptl.UpgradeBookLevelRsp, this.on_s2c_UpgradeBookLevelRsp, this);\r\n        EventMgr.onMsg(proto.Ptl.UpgradeBookStarRsp, this.on_s2c_UpgradeBookStarRsp, this);\r\n        EventMgr.onMsg(proto.Ptl.UpdateBookSeriesData, this.on_s2c_Msg_UpdateBookSeriesData, this);\r\n        EventMgr.onMsg(proto.Ptl.TakeBookRsp, this.on_s2c_Msg_TakeBookRsp, this);\r\n        EventMgr.onMsg(proto.Ptl.DropBookRsp, this.on_s2c_Msg_DropBookRsp, this);\r\n        EventMgr.onMsg(proto.Ptl.UpdateBookPowerScore, this.on_s2c_Msg_UpdateBookPowerScore, this);\r\n    }\r\n    onShow(): void {\r\n        if (this.openData) {\r\n            this.currTag = this.openData;\r\n        }\r\n        this.setShowState();\r\n        this.initView();\r\n    }\r\n    // start() {\r\n    //     this.setShowState();\r\n    //     this.initView();\r\n    // }\r\n    onClickToggle(event, tag) {\r\n        tag = Number(tag);\r\n        if (this.currTag != tag) {\r\n            this.currTag = tag;\r\n            this.setShowState();\r\n            this.initView();\r\n        }\r\n    }\r\n    setShowState() {\r\n        this.handbookNode.node.active = this.currTag == 1;\r\n        this.drawbookNode.active = this.currTag == 2;\r\n        this.groupNode.active = this.currTag == 3;\r\n        this.equipNode.node.active = this.currTag == 4;\r\n        this.toggleNode.getChildByName(\"Toggle\" + this.currTag).getComponent(Toggle).isChecked = true;\r\n    }\r\n    initView() {\r\n        this.unscheduleAllCallbacks()\r\n        if (this.currTag == 1) {\r\n            this.initHandBook();\r\n        } else if (this.currTag == 3) {\r\n            this.initGroupView();\r\n        } else if (this.currTag == 4) {\r\n            this.initEquipView();\r\n        } else if (this.currTag === 2) {\r\n            this.initBookGachaView();\r\n        }\r\n    }\r\n    initBookGachaView() {\r\n        this.gachaBookNode.initView();\r\n    }\r\n    initHandBook() {\r\n        this.handbookNode.initView(this.rareItemPrefab);\r\n\r\n    }\r\n    initGroupView() {\r\n        if (!this.groupItems) {\r\n            this.groupItems = [];\r\n            let groupMap: Map<number, Array<tab.BookSeriesTable>> = new Map();\r\n            let groupTabs = tab.getData().BookSeriesTable;\r\n            for (let key in groupTabs) {\r\n                let id = groupTabs[key].GroupId;\r\n                let list = groupMap.get(id);\r\n                if (!list) {\r\n                    list = [];\r\n                    groupMap.set(id, list);\r\n                }\r\n                list.push(groupTabs[key]);\r\n            }\r\n            groupMap.forEach((value) => {\r\n                let item = instantiate(this.rareGroupItemPrefab);\r\n                item.parent = this.groupContentNode;\r\n                let com = item.getComponent(RareBookGroupItem);\r\n                com.initData(value);\r\n                this.groupItems.push(com);\r\n            })\r\n            // let tabs = tab.getData().BookSeriesTable;\r\n            // for (let key in tabs) {\r\n\r\n            // }\r\n        } else {\r\n            for (let key in this.groupItems) {\r\n                this.groupItems[key].updateView();\r\n            }\r\n        }\r\n        //红点效果\r\n        if(this.groupNode.active){\r\n            let redKey=RareBookData.ins.bookCollectRedPointId;\r\n            if(redKey!=\"\"){\r\n                let groupId=Number(redKey.split(\"_\")[0])\r\n               for(let key in this.groupItems){\r\n                   if(this.groupItems[key].groupId==groupId){\r\n                       let pos=this.groupItems[key].node.position;\r\n                       this.groupItems[key].redPoint.active=true;\r\n                       this.scheduleOnce(()=>{\r\n                           this.groupScrollview.scrollToOffset(new Vec2(0, -pos.y+100), 0.1);\r\n                           this.scheduleOnce(()=>{\r\n                               this.groupItems[key].playAnim();\r\n                               Func.setItem(\"RareBook_CollectRed_\" + redKey,1);\r\n                                RareBookData.ins.updateBookCollectRedPoint();\r\n                                RedMgr.refreshEvent(RedDotType.Book_collect);\r\n                           },0.5)\r\n                       })\r\n                       break;\r\n                   }\r\n               }\r\n           }\r\n         }\r\n      \r\n           \r\n        //  }\r\n        // let pos=this.groupItems[4].node.position;\r\n        // this.groupItems[4].redPoint.active=true;\r\n        // this.scheduleOnce(()=>{\r\n        //     this.groupScrollview.scrollToOffset(new Vec2(0, -pos.y-270), 0.1);\r\n        //     this.scheduleOnce(()=>{\r\n        //         this.groupItems[4].playAnim();\r\n        //         // Func.setItem(\"RareBook_CollectRed_\" + redKey,1);\r\n        //         // RareBookData.ins.updateBookCollectRedPoint();\r\n        //         // RedMgr.refreshEvent(RedDotType.Book_collect);\r\n        //     },0.5)\r\n        // })\r\n     \r\n    }\r\n    initEquipView() {\r\n        this.equipNode.initView(this.rareItemPrefab);\r\n    }\r\n\r\n    onClickExchang() {\r\n        UIMgr.ins.show({ viewName: ViewName.RareBookExchangePop })\r\n    }\r\n\r\n    on_s2c_CombineBookFragmentRsp(msg: proto.Msg_CombineBookFragmentRsp) {\r\n        if (msg.error.code == proto.CommonErrorCode.Succeed) {\r\n            this.handbookNode.initView();\r\n            // this.updateGropView(msg.bookId);\r\n            let info = RareBookData.ins.getBookInfoById(msg.bookId);\r\n            if (info && info.bookTable.Aptitude >= tab.HeroAptitude.HeroAptitude_SR) {\r\n                this.initGroupView();\r\n            }\r\n        }\r\n    }\r\n    on_s2c_UpgradeBookLevelRsp(msg: proto.Msg_UpgradeBookLevelRsp) {\r\n        if (msg.error.code == proto.CommonErrorCode.Succeed) {\r\n            this.handbookNode.updateItem(msg.book.itemId);\r\n            this.updateGropView(msg.book.itemId);\r\n        }\r\n    }\r\n    on_s2c_UpgradeBookStarRsp(msg: proto.Msg_UpgradeBookStarRsp) {\r\n        if (msg.error.code == proto.CommonErrorCode.Succeed) {\r\n            this.handbookNode.updateItem(msg.book.itemId);\r\n            this.updateGropView(msg.book.itemId);\r\n\r\n        }\r\n    }\r\n    on_s2c_Msg_UpdateBookSeriesData(msg: proto.Msg_UpdateBookSeriesData) {\r\n\r\n        this.initGroupView();\r\n    }\r\n    on_s2c_Msg_TakeBookRsp(msg: proto.Msg_TakeBookRsp) {\r\n        if (msg.error.code == proto.CommonErrorCode.Succeed) {\r\n            this.equipNode.initView();\r\n\r\n        }\r\n    }\r\n    on_s2c_Msg_DropBookRsp(msg: proto.Msg_DropBookRsp) {\r\n        if (msg.error.code == proto.CommonErrorCode.Succeed) {\r\n            this.equipNode.initView();\r\n        }\r\n    }\r\n    updateGropView(itemId: number) {\r\n        if (this.groupItems && this.groupItems.length > 0) {\r\n            let info = RareBookData.ins.getBookInfoByItemId(itemId);\r\n            if (info.bookTable.Aptitude >= tab.HeroAptitude.HeroAptitude_SR) {\r\n                this.initGroupView();\r\n            }\r\n        }\r\n\r\n\r\n    }\r\n    on_s2c_Msg_UpdateBookPowerScore(msg: proto.Msg_UpdateBookPowerScore) {\r\n\r\n        this.handbookNode.updateScore();\r\n        // RareBookData.ins.updateBook(msg.book as proto.BookData)\r\n\r\n    }\r\n   \r\n\r\n\r\n\r\n    protected onDestroy(): void {\r\n        super.onDestroy();\r\n        EventMgr.unTarget(this);\r\n        if (!SettingRedManager.ins.getSetting(\"TenBookGacha\")) {\r\n            SettingRedManager.ins.setSetting(\"TenBookGacha\", true);\r\n        }\r\n    }\r\n}"]}