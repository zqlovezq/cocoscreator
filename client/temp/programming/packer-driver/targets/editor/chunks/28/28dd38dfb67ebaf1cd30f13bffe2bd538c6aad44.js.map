{"version":3,"sources":["file:///C:/chickenStarClient/client/assets/scripts/logic/model/association/AssociationPlayerItem.ts"],"names":["_decorator","Color","Label","Node","InfiniteCell","SimpleRoleInfo","PlayerHeadItem","GameUtil","getTimeGuildTXT","AssociationData","RoleData","AssociationControl","tab","LangMgr","UIMgr","ViewName","CommonTipsPop","ccclass","property","AssociationPlayerItem","_data","_view","_guildPositionTab","onLoad","UpdateContent","data","view","guildData","getData","GuildPositionTableByPosition","getValue","job","ins","getAssocitionSimpleInfo","memberInfo","getMemberData","id","playerInfo","merge","palyerHerdItem","initHeadInfo","roleInfo","setCloseCallBack","show","viewName","CheckRoleInfoPop","roleId","lbl_name","string","name","lbl_power","convertNumber","powerScore","offLineTime","getMemberOffLineTime","node_leader","active","node_accuse","node_exit","roleMemberData","leaderId","getMemberArr","length","lbl_time","getCombineString","color","fromHEX","getLab","node_me","node_president_img","GuildPosition","GuildPosition_President","node_vicePresident_img","GuildPosition_VicePresident","node_elite_img","GuildPosition_Elite","node_member_img","GuildPosition_Member","clickSmallBtn","event","idx","showSmallTips","target","clickExit","tipsStr","create","val","reqQuitGuild","reqImpeachGuildLeader"],"mappings":"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","sourcesContent":["import { _decorator, Color, Component, EventTouch, Label, Node, NodeEventType } from 'cc';\r\nimport InfiniteCell from '../../../Common/InfiniteList/InfiniteCell';\r\nimport { proto } from 'client_protocol';\r\nimport { SimpleRoleInfo } from '../friends/SimpleRoleInfo';\r\nimport { PlayerHeadItem } from '../common/PlayerHeadItem';\r\nimport { GameUtil, getTimeGuildTXT } from '../../utils/GameUtil';\r\nimport { AssociationData } from './AssociationData';\r\nimport { RoleData } from '../role/RoleData';\r\nimport { AssociationView } from './AssociationView';\r\nimport { AssociationMainView } from './AssociationMainView';\r\nimport { AssociationControl } from './AssociationControl';\r\nimport { tab } from '../../../Table/table_gen';\r\nimport { LangMgr } from '../../mgr/LangMgr';\r\nimport { UIMgr } from '../../mgr/UIMgr';\r\nimport { ViewName } from '../../define/ViewDefine';\r\nimport { CommonTipsPop } from '../common/CommonTipsPop';\r\nconst { ccclass, property } = _decorator;\r\n\r\n@ccclass('AssociationPlayerItem')\r\nexport class AssociationPlayerItem extends InfiniteCell {\r\n    @property(PlayerHeadItem)\r\n    palyerHerdItem: PlayerHeadItem = null;\r\n    @property(Label)\r\n    lbl_name: Label = null;\r\n    @property(Label)\r\n    lbl_power: Label = null;\r\n    @property(Label)\r\n    lbl_time: Label = null;\r\n    @property(Node)\r\n    node_exit: Node = null;\r\n    @property(Node)\r\n    node_leader: Node = null;\r\n    @property(Node)\r\n    node_accuse: Node = null;//弹劾按钮\r\n    @property(Node)\r\n    node_me: Node = null;\r\n    @property(Node)\r\n    node_president_img: Node = null;\r\n    @property(Node)\r\n    node_vicePresident_img: Node = null;\r\n    @property(Node)\r\n    node_elite_img: Node = null;\r\n    @property(Node)\r\n    node_member_img: Node = null;\r\n    private _data: proto.IGuildMember = null;\r\n    private _view: AssociationMainView = null;\r\n    private _guildPositionTab: tab.GuildPositionTable = null;\r\n    protected onLoad(): void {\r\n        // this.node.on(NodeEventType.TOUCH_START,this.clickItem,this);\r\n    }\r\n    UpdateContent(data): void {\r\n        this._data = data.data;\r\n        this._view = data.view;\r\n        let guildData: proto.SimpleGuild = null;\r\n        if (data.guildData) {\r\n            guildData = data.guildData;\r\n            this._guildPositionTab = tab.getData().GuildPositionTableByPosition.getValue(this._data.job);\r\n        } else {\r\n            guildData = AssociationData.ins.getAssocitionSimpleInfo();\r\n            const memberInfo = AssociationData.ins.getMemberData(RoleData.ins.id);\r\n            if (memberInfo) {\r\n                this._guildPositionTab = tab.getData().GuildPositionTableByPosition.getValue(memberInfo.job);\r\n            }\r\n        }\r\n\r\n        const playerInfo = new SimpleRoleInfo();\r\n        playerInfo.merge(this._data);\r\n\r\n        this.palyerHerdItem.initHeadInfo({ roleInfo: playerInfo });\r\n        this.palyerHerdItem.setCloseCallBack(() => {\r\n            UIMgr.ins.show({ viewName: ViewName.CheckRoleInfoPop, data: { \"roleId\": this._data.roleId } })\r\n        })\r\n\r\n        this.lbl_name.string = this._data.name;\r\n        this.lbl_power.string = GameUtil.convertNumber(this._data.powerScore);\r\n\r\n        let offLineTime = -1;\r\n        if(this._data.roleId !== RoleData.ins.id){\r\n            offLineTime = AssociationData.ins.getMemberOffLineTime(this._data);\r\n        }\r\n        if (data.guildData) {\r\n            this.node_leader.active = false;\r\n            this.node_accuse.active = false;\r\n            this.node_exit.active = false;\r\n        } else {       \r\n            const roleMemberData = AssociationData.ins.getMemberData(RoleData.ins.id);                           \r\n            this.node_leader.active = this._data.roleId !== RoleData.ins.id &&//不是自己\r\n                                      this._data.roleId !== guildData.leaderId && //不是会长   \r\n                                      this._guildPositionTab && \r\n                                    //   this._guildPositionTab.Appoint&&//有任职能力\r\n                                      roleMemberData.job<this._data.job;//自己的职位要大于列表职位\r\n            this.node_accuse.active = this._data.roleId == guildData.leaderId && RoleData.ins.id !== guildData.leaderId && offLineTime > 86400 * 7;\r\n            this.node_exit.active = (RoleData.ins.id === this._data.roleId && this._data.roleId !== guildData.leaderId && RoleData.ins.id !== guildData.leaderId) || AssociationData.ins.getMemberArr().length === 1;\r\n        }\r\n        if (offLineTime > 0) {\r\n            //this.lbl_time.string = getTimeGuildTXT(offLineTime)+\"前\";\r\n            this.lbl_time.string = LangMgr.getCombineString(\"ui_association_51\", [getTimeGuildTXT(offLineTime)]);\r\n            this.lbl_time.color = new Color().fromHEX(\"#F71315\");\r\n        } else {\r\n            this.lbl_time.string = LangMgr.getLab(\"ui_association_2\");\r\n            this.lbl_time.color = new Color().fromHEX(\"#3A9830\");\r\n        }\r\n        this.node_me.active = this._data.roleId === RoleData.ins.id;\r\n        this.node_president_img.active = this._data.job === tab.GuildPosition.GuildPosition_President;\r\n        this.node_vicePresident_img.active = this._data.job === tab.GuildPosition.GuildPosition_VicePresident;\r\n        this.node_elite_img.active = this._data.job === tab.GuildPosition.GuildPosition_Elite;\r\n        this.node_member_img.active = this._data.job === tab.GuildPosition.GuildPosition_Member;\r\n    }\r\n    clickSmallBtn(event: EventTouch, idx: string) {\r\n        this._view.showSmallTips(event.target, this._data);\r\n    }\r\n    // 退出公会\r\n    clickExit() {\r\n        // 加一个确认弹窗\r\n        const tipsStr = LangMgr.getLab(\"ui_association_69\");\r\n        CommonTipsPop.create(tipsStr, ((val) => {\r\n            if (val) {\r\n                AssociationControl.ins.reqQuitGuild();\r\n            }\r\n        }))\r\n    }\r\n    /* 弹劾会长 */\r\n    reqImpeachGuildLeader() {\r\n        AssociationControl.ins.reqImpeachGuildLeader();\r\n    }\r\n}\r\n\r\n\r\n"]}