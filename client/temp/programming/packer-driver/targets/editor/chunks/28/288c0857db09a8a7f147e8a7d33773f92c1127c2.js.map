{"version":3,"sources":["file:///C:/chickenStarClient/client/assets/scripts/logic/model/fengyunRanking/FengyunRankingMainView.ts"],"names":["_decorator","Label","ViewScreen","FengyunBtnItem","tab","FengyunRankControl","proto","EventMgr","FengyunRankData","RoleData","setTextTime","ccclass","property","FengyunRankingMainView","lastTimer","lastTimerCallBack","timerLab","string","unschedule","register","ins","reqGetHonorRollMap","onMsg","Ptl","GetHonorRollMapRsp","on_s2c_GetHonorRollMapRsp","ReceiveHonorRollTasksRewardsRsp","on_s2c_ReceiveHonorRollTasksRewardsRsp","onShow","initView","tables","getData","ActivityRankTable","i","key","ActivityId","btnItems","msg","getHonorRollInfoByActId","Number","activityEndTime","getServerUtcTime","schedule","error","code","CommonErrorCode","Succeed","scheduleOnce","length","btnItem","refreshRed"],"mappings":"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","sourcesContent":["import { _decorator, Label } from 'cc';\r\nimport { ViewScreen } from '../../../framework/base/ViewScreen';\r\nimport { FengyunBtnItem } from './FengyunBtnItem';\r\nimport { tab } from '../../../Table/table_gen';\r\nimport { FengyunRankControl } from './FengyunRankControl';\r\nimport { proto } from 'client_protocol';\r\nimport { EventMgr } from '../../mgr/EventMgr';\r\nimport { FengyunRankData } from './FengyunRankData';\r\nimport { RoleData } from '../role/RoleData';\r\nimport {  setTextTime } from '../../utils/GameUtil';\r\nconst { ccclass, property } = _decorator;\r\n\r\n/**\r\n * \r\n * FengyunRankingMainView\r\n * zhudingchao\r\n * Wed Jul 17 2024 14:40:44 GMT+0800 (中国标准时间)\r\n * db://assets/scripts/logic/model/fengyunRanking/FengyunRankingMainView.ts\r\n *\r\n */\r\n\r\n@ccclass('FengyunRankingMainView')\r\nexport class FengyunRankingMainView extends ViewScreen {\r\n    @property(Label)\r\n    timerLab:Label=null;\r\n    @property([FengyunBtnItem])\r\n    btnItems:FengyunBtnItem[]=[];\r\n    private lastTimer:number=0;\r\n    register(): void {\r\n        FengyunRankControl.ins.reqGetHonorRollMap();\r\n        EventMgr.onMsg(proto.Ptl.GetHonorRollMapRsp, this.on_s2c_GetHonorRollMapRsp, this)\r\n\r\n        EventMgr.onMsg(proto.Ptl.ReceiveHonorRollTasksRewardsRsp, this.on_s2c_ReceiveHonorRollTasksRewardsRsp, this)\r\n\r\n    }\r\n    onShow(): void {\r\n        \r\n    }\r\n    initView(){\r\n        let tables=tab.getData().ActivityRankTable;\r\n        let i:number=0;\r\n        for(let key in tables){\r\n            if(tables[key].ActivityId==101){\r\n                this.btnItems[i].initView(tables[key]);\r\n                i++;\r\n            }\r\n        }\r\n        let msg=FengyunRankData.ins.getHonorRollInfoByActId(101);\r\n        this.lastTimer=Number(msg.activityEndTime)-RoleData.ins.getServerUtcTime()\r\n        if(this.lastTimer>0){\r\n            this.schedule(this.lastTimerCallBack,1);\r\n            this.timerLab.string=  setTextTime(this.lastTimer);\r\n        }else{\r\n             this.timerLab.string=\"0\"\r\n        }\r\n        \r\n    }\r\n    lastTimerCallBack=()=>{\r\n        this.lastTimer--;\r\n        if(this.lastTimer>0){\r\n           this.timerLab.string= setTextTime(this.lastTimer);\r\n        }else{\r\n            this.timerLab.string=\"0\"\r\n            this.unschedule(this.lastTimerCallBack);\r\n        }\r\n    }\r\n\r\n    on_s2c_GetHonorRollMapRsp(){\r\n        this.initView();\r\n    }\r\n    on_s2c_ReceiveHonorRollTasksRewardsRsp(msg: proto.Msg_ReceiveHonorRollTasksRewardsRsp) {\r\n        if (!msg.error || msg.error.code == proto.CommonErrorCode.Succeed) {\r\n            this.scheduleOnce(()=>{\r\n                for(let i=0;i<this.btnItems.length;i++){\r\n                    const btnItem = this.btnItems[i];\r\n                    btnItem.refreshRed();\r\n                }\r\n            },0.1)\r\n        }\r\n    }\r\n}"]}