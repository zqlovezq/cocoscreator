{"version":3,"sources":["file:///C:/chickenStarClient/client/assets/scripts/logic/model/hero/herobag/HeroRecommendPopItem.ts"],"names":["_decorator","Component","Label","Layout","Node","Prefab","Sprite","UITransform","tab","ItemPoolMgr","HeroItem","HeroDataControl","EventMgr","LocalEvent","HeroInfo","LangMgr","proto","Net","ccclass","property","HeroRecommendPopItem","_showDetail","_haveCount","_tabData","_canRecive","_parentScroll","UpdateContent","data","tabData","scrollView","node_desc","active","node_content","removeAllChildren","i","HeroIdList","length","itemId","createItem","map","ins","getBookReceivedIds","itemData","get","lbl_progress_now","string","String","lbl_progress_total","lbl_recommend_name","getLab","Name","lbl_recommend_desc","Desc","ItemId","itemCount","ItemNum","getData","ItemTableById","getValue","sp_reward_icon","setTexture","Icon","lbl_reward_count","getRecommendTeamIds","countEnough","isGot","Id","grayscale","sp_reward_icon_bg","node_got_award_img","node_arrow_up","node_arrow_down","showDetail","getComponent","updateLayout","node","offset","getScrollOffset","updateRenderData","y","contentSize","height","scrollToOffset","heroInfo","heroTab","HeroTableById","id","level","star","DefaultStar","item","createHeroItem","ts","setLevel","setSelect","setGrayScale","setHeroStar","setTouchCallBack","refreshBookData","emitLocal","Click_Recommend_Hero","sendMsg","msg","Msg_ReceiveRecommendTeamRewardReq","recommendTeamId","Send","Ptl","ReceiveRecommendTeamRewardReq"],"mappings":"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","sourcesContent":["/*\r\n * @Date: 2024-05-11 14:19:03\r\n * @LastEditors: wzq\r\n * @LastEditTime: 2024-11-22 14:52:22\r\n */\r\n\r\nimport { _decorator, Component, Label, Layout, Node, Prefab, ScrollView, Sprite, UITransform } from 'cc';\r\nimport { tab } from '../../../../Table/table_gen';\r\nimport { HeroData } from '../HeroData';\r\nimport { ItemPoolMgr } from '../../item/ItemPoolMgr';\r\nimport { HeroItem } from '../../item/HeroItem';\r\nimport { HeroDataControl } from './HeroDataControl';\r\nimport { EventMgr } from '../../../mgr/EventMgr';\r\nimport { LocalEvent } from '../../../define/LocalEvent';\r\nimport { HeroInfo } from '../HeroInfo';\r\nimport { LangMgr } from '../../../mgr/LangMgr';\r\nimport { proto } from 'client_protocol';\r\nimport { Net } from '../../../net/Net';\r\nconst { ccclass, property } = _decorator;\r\n\r\n@ccclass('HeroRecommendPopItem')\r\nexport class HeroRecommendPopItem extends Component {\r\n    @property(Node)\r\n    node_desc: Node = null;\r\n    @property(Node)\r\n    node_content: Node = null;\r\n    @property(Node)\r\n    node_arrow_up: Node = null;\r\n    @property(Node)\r\n    node_arrow_down: Node = null;\r\n    @property(Node)\r\n    node_got_award_img:Node = null;\r\n\r\n    @property(Prefab)\r\n    node_hero: Node = null;\r\n\r\n    @property(Label)\r\n    lbl_progress_now: Label = null;\r\n    @property(Label)\r\n    lbl_progress_total: Label = null;\r\n    @property(Label)\r\n    lbl_recommend_name: Label = null;\r\n    @property(Label)\r\n    lbl_recommend_desc: Label = null;\r\n\r\n    @property(Sprite)\r\n    sp_reward_icon_bg: Sprite = null;\r\n    @property(Sprite)\r\n    sp_reward_icon: Sprite = null;\r\n    @property(Label)\r\n    lbl_reward_count: Label = null;\r\n\r\n    private _showDetail: boolean = false;\r\n    private _haveCount: number = 0;\r\n    private _tabData: tab.RecommendTeamTable = null;\r\n    private _canRecive: boolean = false;\r\n    private _parentScroll:ScrollView = null;\r\n    UpdateContent(data: any): void {\r\n        this._haveCount = 0;\r\n        this._tabData = data.tabData;\r\n        this._parentScroll = data.scrollView;\r\n        this.node_desc.active = this._tabData[\"extend\"] === 1;\r\n        this.node_content.removeAllChildren();\r\n        for (let i = 0; i < this._tabData.HeroIdList.length; i++) {\r\n            let itemId = this._tabData.HeroIdList[i];\r\n            this.createItem(itemId);\r\n\r\n            const map = HeroDataControl.ins.getBookReceivedIds();\r\n            const itemData = map.get(itemId);\r\n            if (itemData) {\r\n                this._haveCount++;\r\n            }\r\n        }\r\n        this.lbl_progress_now.string = String(this._haveCount);\r\n        this.lbl_progress_total.string = \"/\" + this._tabData.HeroIdList.length;\r\n        this.lbl_recommend_name.string = LangMgr.getLab(this._tabData.Name);\r\n        this.lbl_recommend_desc.string = LangMgr.getLab(this._tabData.Desc);\r\n        /* 创建奖励 */\r\n        let itemId = this._tabData.ItemId;\r\n        let itemCount = this._tabData.ItemNum;\r\n        let itemData = tab.getData().ItemTableById.getValue(itemId);\r\n        this.sp_reward_icon.setTexture(itemData.Icon);\r\n        this.lbl_reward_count.string = String(itemCount);\r\n        let map = HeroDataControl.ins.getRecommendTeamIds();\r\n        let countEnough = this._haveCount >= this._tabData.HeroIdList.length;\r\n        let isGot =  map.get(this._tabData.Id)\r\n        this._canRecive = countEnough&& !isGot;\r\n        this.sp_reward_icon.grayscale = !countEnough;\r\n        this.sp_reward_icon_bg.grayscale = !countEnough;\r\n        this.node_got_award_img.active = isGot;\r\n\r\n        this.node_arrow_up.active = this._tabData[\"extend\"]===1;\r\n        this.node_arrow_down.active = this._tabData[\"extend\"]===0;\r\n    }\r\n    private showDetail() {\r\n        let tabData = this._tabData\r\n        if (!tabData[\"extend\"]) {\r\n            tabData[\"extend\"] = 1;\r\n        } else {\r\n            tabData[\"extend\"] = 0;\r\n        }\r\n        this.node_arrow_up.active = tabData[\"extend\"]===1;\r\n        this.node_arrow_down.active = tabData[\"extend\"]===0;\r\n        this.node_desc.active = this._tabData[\"extend\"] === 1;\r\n        this.node_desc.getComponent(Layout).updateLayout();\r\n        this.node.getComponent(Layout).updateLayout();\r\n        let offset = this._parentScroll.getScrollOffset();\r\n        this.lbl_recommend_desc.updateRenderData();\r\n        if(this._tabData[\"extend\"] === 1){\r\n            offset.y+=this.lbl_recommend_desc.node.getComponent(UITransform).contentSize.height;\r\n        }else{\r\n            offset.y-=this.lbl_recommend_desc.node.getComponent(UITransform).contentSize.height;\r\n        }\r\n        this._parentScroll.scrollToOffset(offset,1)\r\n    }\r\n    createItem(itemId: number) {\r\n        let heroInfo = null;\r\n        let heroTab = tab.getData().HeroTableById.getValue(itemId);\r\n        if (!heroInfo) {\r\n            heroInfo = new HeroInfo();\r\n            heroInfo.itemId = itemId;\r\n            heroInfo.id = 0;\r\n            heroInfo.level = 1;\r\n            heroInfo.star = heroTab.DefaultStar;\r\n        }\r\n        let item = null;\r\n        if (heroInfo) {\r\n            item = ItemPoolMgr.ins.createHeroItem(heroInfo,this.node_content);\r\n            // item.parent = this.node_content;\r\n        }\r\n        if (item) {\r\n            let ts = item.getComponent(HeroItem)\r\n            ts.setLevel(0);\r\n            ts.setSelect(false);\r\n            ts.setGrayScale()\r\n            ts.setHeroStar(heroTab.DefaultStar);\r\n            ts.setTouchCallBack(() => {\r\n                HeroDataControl.ins.refreshBookData(heroInfo.itemId);\r\n                EventMgr.emitLocal(LocalEvent.Click_Recommend_Hero);\r\n            })\r\n        }\r\n    }\r\n    /* 领取奖励 */\r\n    sendMsg(){\r\n        if(!this._canRecive){\r\n            return;\r\n        }\r\n        let msg = new proto.Msg_ReceiveRecommendTeamRewardReq ();\r\n        msg.recommendTeamId = this._tabData.Id;\r\n        Net.Send(proto.Ptl.ReceiveRecommendTeamRewardReq , msg)\r\n    }\r\n}\r\n\r\n\r\n"]}