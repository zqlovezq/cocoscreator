{"version":3,"sources":["file:///C:/chickenStarClient/client/assets/scripts/logic/model/hero/herobag/HeroAutoAscendPop.ts"],"names":["_decorator","instantiate","Node","Prefab","ViewPop","proto","Net","HeroAutoAscendPopItem","EventMgr","LocalEvent","HeroData","tab","HeroDataControl","ccclass","property","HeroAutoAscendPop","herosMap","deleteMap","Map","register","onLocal","Delete_Star_Up_Hero","changeMap","heroId","isDelete","set","get","delete","onShow","ins","getOneClickList","node_ascend","active","size","node_kong","node_content","removeAllChildren","forEach","value","key","item","pfb_item","parent","ts","getComponent","initData","onDestroy","onClickUpHeros","msg","Msg_UpHeroStarOneClickReq","upStarCosts","data","heroInfo","getById","sameHeroNameCount","getHerosByType","HeroStarUpType","HeroStarUpType_SameNameHero","needCount","objSameName","costType","costHeroIds","objSameClass","HeroStarUpType_SameClassHero","i","length","id","push","Send","Ptl","UpHeroStarOneClickReq"],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAASA,MAAAA,U,OAAAA,U;AAAuBC,MAAAA,W,OAAAA,W;AAAaC,MAAAA,I,OAAAA,I;AAAMC,MAAAA,M,OAAAA,M;;AAC1CC,MAAAA,O,iBAAAA,O;;AACAC,MAAAA,K,oBAAAA,K;;AACAC,MAAAA,G,iBAAAA,G;;AACAC,MAAAA,qB,iBAAAA,qB;;AACAC,MAAAA,Q,iBAAAA,Q;;AACAC,MAAAA,U,iBAAAA,U;;AAEAC,MAAAA,Q,iBAAAA,Q;;AACAC,MAAAA,G,iBAAAA,G;;AACAC,MAAAA,e,iBAAAA,e;;;;;;;;;OACH;AAAEC,QAAAA,OAAF;AAAWC,QAAAA;AAAX,O,GAAwBd,U;;mCAGjBe,iB,WADZF,OAAO,CAAC,mBAAD,C,UAEHC,QAAQ,CAACX,MAAD,C,UAGRW,QAAQ,CAACZ,IAAD,C,UAGRY,QAAQ,CAACZ,IAAD,C,UAERY,QAAQ,CAACZ,IAAD,C,2BAVb,MACaa,iBADb;AAAA;AAAA,8BAC+C;AAAA;AAAA;;AAAA;;AAAA;;AAAA;;AAAA;;AAAA,eAYnCC,QAZmC,GAYxB,IAZwB;AAAA,eAanCC,SAbmC,GAaE,IAAIC,GAAJ,EAbF;AAAA;;AAc3CC,QAAAA,QAAQ,GAAS;AACb;;AACA;AACA;AAAA;AAAA,oCAASC,OAAT,CAAiB;AAAA;AAAA,wCAAWC,mBAA5B,EAAiD,KAAKC,SAAtD,EAAiE,IAAjE;AACH;;AAEOA,QAAAA,SAAS,CAACC,MAAD,EAAiBC,QAAjB,EAAoC;AACjD,cAAIA,QAAJ,EAAc;AACV,iBAAKP,SAAL,CAAeQ,GAAf,CAAmBF,MAAnB,EAA0B,KAAKP,QAAL,CAAcU,GAAd,CAAkBH,MAAlB,CAA1B;AACA,iBAAKP,QAAL,CAAcW,MAAd,CAAqBJ,MAArB;AACH,WAHD,MAGO;AACH,iBAAKP,QAAL,CAAcS,GAAd,CAAkBF,MAAlB,EAA0B,KAAKN,SAAL,CAAeS,GAAf,CAAmBH,MAAnB,CAA1B;AACH;AACJ;;AACDK,QAAAA,MAAM,GAAS;AACX;AACA,eAAKZ,QAAL,GAAgB;AAAA;AAAA,kDAAgBa,GAAhB,CAAoBC,eAApB,EAAhB;AACA,eAAKC,WAAL,CAAiBC,MAAjB,GAA0B,KAAKhB,QAAL,CAAciB,IAAd,GAAmB,CAA7C;AACA,eAAKC,SAAL,CAAeF,MAAf,GAAwB,EAAE,KAAKhB,QAAL,CAAciB,IAAd,GAAmB,CAArB,CAAxB;AACA,eAAKE,YAAL,CAAkBC,iBAAlB;AACA,eAAKpB,QAAL,CAAcqB,OAAd,CAAsB,CAACC,KAAD,EAAQC,GAAR,KAAgB;AAClC,gBAAIC,IAAI,GAAGvC,WAAW,CAAC,KAAKwC,QAAN,CAAtB;AACAD,YAAAA,IAAI,CAACE,MAAL,GAAc,KAAKP,YAAnB;AACA,gBAAIQ,EAAE,GAAGH,IAAI,CAACI,YAAL;AAAA;AAAA,+DAAT;AACAD,YAAAA,EAAE,CAACE,QAAH,CAAYP,KAAZ,EAAmBC,GAAnB;AACH,WALD;AAMH;;AACDO,QAAAA,SAAS,GAAS;AACd,gBAAMA,SAAN;AACH;;AACDC,QAAAA,cAAc,GAAG;AACb,cAAG,KAAK/B,QAAL,CAAciB,IAAd,KAAqB,CAAxB,EAA0B;AACtB;AACH;;AACD,cAAIe,GAAG,GAAG,IAAI;AAAA;AAAA,8BAAMC,yBAAV,EAAV;AACA,cAAIC,WAAuC,GAAG,EAA9C;AACA,eAAKlC,QAAL,CAAcqB,OAAd,CAAsB,CAACC,KAAD,EAAQC,GAAR,KAAgB;AAClC,gBAAIY,IAA8B,GAAG,EAArC;AACAA,YAAAA,IAAI,CAAC5B,MAAL,GAAcgB,GAAd;AACAY,YAAAA,IAAI,CAACD,WAAL,GAAmB,EAAnB,CAHkC,CAIlC;;AACA,gBAAIE,QAAQ,GAAG;AAAA;AAAA,sCAASvB,GAAT,CAAawB,OAAb,CAAqBd,GAArB,CAAf;AACA,gBAAIe,iBAAiB,GAAGF,QAAQ,CAACG,cAAT,CAAwB;AAAA;AAAA,4BAAIC,cAAJ,CAAmBC,2BAA3C,EAAwEC,SAAhG;AAEA,gBAAIC,WAAkC,GAAG,EAAzC;AACAA,YAAAA,WAAW,CAACC,QAAZ,GAAuB;AAAA;AAAA,4BAAIJ,cAAJ,CAAmBC,2BAA1C;AACAE,YAAAA,WAAW,CAACE,WAAZ,GAA0B,EAA1B,CAVkC,CAWlC;;AACA,gBAAIC,YAAmC,GAAG,EAA1C;AACAA,YAAAA,YAAY,CAACF,QAAb,GAAwB;AAAA;AAAA,4BAAIJ,cAAJ,CAAmBO,4BAA3C;AACAD,YAAAA,YAAY,CAACD,WAAb,GAA2B,EAA3B;;AAEA,iBAAK,IAAIG,CAAC,GAAG,CAAb,EAAgBA,CAAC,GAAG1B,KAAK,CAAC2B,MAA1B,EAAkCD,CAAC,EAAnC,EAAuC;AACnC,kBAAIA,CAAC,GAAGV,iBAAR,EAA2B;AACvB,oBAAI/B,MAAM,GAAGe,KAAK,CAAC0B,CAAD,CAAL,CAASE,EAAtB;AACAP,gBAAAA,WAAW,CAACE,WAAZ,CAAwBM,IAAxB,CAA6B5C,MAA7B;AACH,eAHD,MAGK;AACD,oBAAIA,MAAM,GAAGe,KAAK,CAAC0B,CAAD,CAAL,CAASE,EAAtB;AACAJ,gBAAAA,YAAY,CAACD,WAAb,CAAyBM,IAAzB,CAA8B5C,MAA9B;AACH;AACJ;;AAED4B,YAAAA,IAAI,CAACD,WAAL,CAAiBiB,IAAjB,CAAsBR,WAAtB;AACAR,YAAAA,IAAI,CAACD,WAAL,CAAiBiB,IAAjB,CAAsBL,YAAtB;AACAZ,YAAAA,WAAW,CAACiB,IAAZ,CAAiBhB,IAAjB;AACH,WA7BD;AA8BAH,UAAAA,GAAG,CAACE,WAAJ,GAAkBA,WAAlB;AACA;AAAA;AAAA,0BAAIkB,IAAJ,CAAS;AAAA;AAAA,8BAAMC,GAAN,CAAUC,qBAAnB,EAA0CtB,GAA1C;AACH;;AAlF0C,O;;;;;;;;;;iBAKtB,I;;;;;;;iBAGJ,I;;;;;;;iBAEE,I","sourcesContent":["import { _decorator, Component, instantiate, Node, Prefab } from 'cc';\r\nimport { ViewPop } from '../../../../framework/base/ViewPop';\r\nimport { proto } from 'client_protocol';\r\nimport { Net } from '../../../net/Net';\r\nimport { HeroAutoAscendPopItem } from './HeroAutoAscendPopItem';\r\nimport { EventMgr } from '../../../mgr/EventMgr';\r\nimport { LocalEvent } from '../../../define/LocalEvent';\r\nimport { HeroInfo } from '../HeroInfo';\r\nimport { HeroData } from '../HeroData';\r\nimport { tab } from '../../../../Table/table_gen';\r\nimport { HeroDataControl } from './HeroDataControl';\r\nconst { ccclass, property } = _decorator;\r\n\r\n@ccclass('HeroAutoAscendPop')\r\nexport class HeroAutoAscendPop extends ViewPop {\r\n    @property(Prefab)\r\n    pfb_item: Prefab;\r\n\r\n    @property(Node)\r\n    node_content: Node = null;\r\n\r\n    @property(Node)\r\n    node_kong:Node = null;\r\n    @property(Node)\r\n    node_ascend:Node = null;\r\n\r\n    private herosMap = null;\r\n    private deleteMap: Map<number, HeroInfo[]> = new Map();\r\n    register(): void {\r\n        /* 取消选择升星单位 */\r\n        /* 当前切换英雄的时候 */\r\n        EventMgr.onLocal(LocalEvent.Delete_Star_Up_Hero, this.changeMap, this);\r\n    }\r\n  \r\n    private changeMap(heroId: number, isDelete: boolean) {\r\n        if (isDelete) {\r\n            this.deleteMap.set(heroId,this.herosMap.get(heroId))\r\n            this.herosMap.delete(heroId);\r\n        } else {\r\n            this.herosMap.set(heroId, this.deleteMap.get(heroId));\r\n        }\r\n    }\r\n    onShow(): void {\r\n        /* 获取所有可以一键升星的数据 */\r\n        this.herosMap = HeroDataControl.ins.getOneClickList();\r\n        this.node_ascend.active = this.herosMap.size>0;\r\n        this.node_kong.active = !(this.herosMap.size>0);\r\n        this.node_content.removeAllChildren();\r\n        this.herosMap.forEach((value, key) => {\r\n            let item = instantiate(this.pfb_item);\r\n            item.parent = this.node_content;\r\n            let ts = item.getComponent(HeroAutoAscendPopItem);\r\n            ts.initData(value, key);\r\n        })\r\n    }\r\n    onDestroy(): void {\r\n        super.onDestroy();\r\n    }\r\n    onClickUpHeros() {\r\n        if(this.herosMap.size===0){\r\n            return;\r\n        }\r\n        let msg = new proto.Msg_UpHeroStarOneClickReq()\r\n        let upStarCosts: proto.IMsg_UpHeroStarReq[] = [];\r\n        this.herosMap.forEach((value, key) => {\r\n            let data: proto.IMsg_UpHeroStarReq = {};\r\n            data.heroId = key;\r\n            data.upStarCosts = [];\r\n            //同名\r\n            let heroInfo = HeroData.ins.getById(key);\r\n            let sameHeroNameCount = heroInfo.getHerosByType(tab.HeroStarUpType.HeroStarUpType_SameNameHero).needCount;\r\n\r\n            let objSameName: proto.IUpHeroStarCost = {};\r\n            objSameName.costType = tab.HeroStarUpType.HeroStarUpType_SameNameHero;\r\n            objSameName.costHeroIds = [];\r\n            // 同职业\r\n            let objSameClass: proto.IUpHeroStarCost = {};\r\n            objSameClass.costType = tab.HeroStarUpType.HeroStarUpType_SameClassHero;\r\n            objSameClass.costHeroIds = [];\r\n\r\n            for (let i = 0; i < value.length; i++) {\r\n                if (i < sameHeroNameCount) {\r\n                    let heroId = value[i].id;\r\n                    objSameName.costHeroIds.push(heroId);\r\n                }else{\r\n                    let heroId = value[i].id;\r\n                    objSameClass.costHeroIds.push(heroId);\r\n                }\r\n            }\r\n\r\n            data.upStarCosts.push(objSameName);\r\n            data.upStarCosts.push(objSameClass);\r\n            upStarCosts.push(data);\r\n        })\r\n        msg.upStarCosts = upStarCosts;\r\n        Net.Send(proto.Ptl.UpHeroStarOneClickReq, msg)\r\n    }\r\n}\r\n\r\n\r\n"]}