{"version":3,"sources":["file:///C:/chickenStarClient/client/assets/scripts/logic/model/recruit/RecruitProbabilityItem.ts"],"names":["_decorator","Component","instantiate","Node","Prefab","RichText","tab","ItemPoolMgr","LangMgr","HeroInfo","HeroItem","WeaponItem","UIMgr","ViewName","RecruitType","ccclass","property","RecruitProbabilityItem","_heroAptitudeTable","onLoad","setHeroData","dataArr","Aptitude","type","extra","getData","HeroAptitudeTableByHeroAptitude","getValue","TipsStr","TipsStrArr","Senior","rich_text_aptitude","string","getLab","Friend","SeniorGuarantee","Book","BookGuarantee","heroTab","HeroTableById","_heroClass","HeroClass","Class","getCombineString","node_content","destroyAllChildren","i","length","HeroAptitude","HeroAptitude_SR","createHero","createHeroPiece","HeroAptitude_R","createBook","itemId","_bookItem","pfb_rare_book","parent","itemTs","getComponent","initBookItemId","ins","show","viewName","RareBookInfoItemPop","data","info","_itemId","heroId","heroInfo","id","star","DefaultStar","heroItem","createHeroItem","heroItemTs","setHeroProbablity","count","_heroItem","pfb_hero_item","UpdateContent","setSelect","setLevel","setPiece"],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAASA,MAAAA,U,OAAAA,U;AAAYC,MAAAA,S,OAAAA,S;AAAWC,MAAAA,W,OAAAA,W;AAAaC,MAAAA,I,OAAAA,I;AAAMC,MAAAA,M,OAAAA,M;AAAQC,MAAAA,Q,OAAAA,Q;;AAClDC,MAAAA,G,iBAAAA,G;;AAEAC,MAAAA,W,iBAAAA,W;;AACAC,MAAAA,O,iBAAAA,O;;AACAC,MAAAA,Q,iBAAAA,Q;;AACAC,MAAAA,Q,iBAAAA,Q;;AAEAC,MAAAA,U,iBAAAA,U;;AACAC,MAAAA,K,iBAAAA,K;;AACAC,MAAAA,Q,iBAAAA,Q;;AACAC,MAAAA,W,kBAAAA,W;;;;;;;;;OACH;AAAEC,QAAAA,OAAF;AAAWC,QAAAA;AAAX,O,GAAwBhB,U;;wCAGjBiB,sB,WADZF,OAAO,CAAC,wBAAD,C,UAEHC,QAAQ,CAACZ,MAAD,C,UAERY,QAAQ,CAACZ,MAAD,C,UAERY,QAAQ,CAACb,IAAD,C,UAERa,QAAQ,CAACX,QAAD,C,2BARb,MACaY,sBADb,SAC4ChB,SAD5C,CACsD;AAAA;AAAA;;AAAA;;AAAA;;AAAA;;AAAA;;AAAA,eAS1CiB,kBAT0C,GASC,IATD;AAAA;;AAUxCC,QAAAA,MAAM,GAAS,CAExB;;AACDC,QAAAA,WAAW,CAACC,OAAD,EAAkBC,QAAlB,EAA4CC,IAA5C,EAA6DC,KAA7D,EAA2E;AAClF,eAAKN,kBAAL,GAA0B;AAAA;AAAA,0BAAIO,OAAJ,GAAcC,+BAAd,CAA8CC,QAA9C,CAAuDL,QAAvD,CAA1B;AAEA,cAAIM,OAAO,GAAG,EAAd;AACA,cAAIC,UAAU,GAAG,EAAjB;;AACA,cAAGN,IAAI,IAAE;AAAA;AAAA,0CAAYO,MAArB,EAA4B;AACxBF,YAAAA,OAAO,GAAG,eAAV;AACA,iBAAKG,kBAAL,CAAwBC,MAAxB,GAAiC;AAAA;AAAA,oCAAQC,MAAR,CAAeL,OAAO,GAACN,QAAvB,CAAjC;AACH,WAHD,MAGM,IAAGC,IAAI,IAAE;AAAA;AAAA,0CAAYW,MAArB,EAA4B;AAC9BN,YAAAA,OAAO,GAAG,sBAAV;AACA,iBAAKG,kBAAL,CAAwBC,MAAxB,GAAiC;AAAA;AAAA,oCAAQC,MAAR,CAAeL,OAAO,GAACN,QAAvB,CAAjC;AACH,WAHK,MAGA,IAAGC,IAAI,IAAE;AAAA;AAAA,0CAAYY,eAArB,EAAqC;AACvCP,YAAAA,OAAO,GAAG,qBAAV;AACA,iBAAKG,kBAAL,CAAwBC,MAAxB,GAAiC;AAAA;AAAA,oCAAQC,MAAR,CAAeL,OAAf,CAAjC;AACH,WAHK,MAGA,IAAGL,IAAI,KAAG;AAAA;AAAA,0CAAYa,IAAtB,EAA2B;AAC7BR,YAAAA,OAAO,GAAG,gBAAV;AACA,iBAAKG,kBAAL,CAAwBC,MAAxB,GAAiC;AAAA;AAAA,oCAAQC,MAAR,CAAeL,OAAO,GAACN,QAAvB,CAAjC;AACH,WAHK,MAGA,IAAGC,IAAI,KAAG;AAAA;AAAA,0CAAYc,aAAtB,EAAoC;AACtCT,YAAAA,OAAO,GAAG,sBAAV;AACA,iBAAKG,kBAAL,CAAwBC,MAAxB,GAAiC;AAAA;AAAA,oCAAQC,MAAR,CAAeL,OAAf,CAAjC;AACH,WAHK,MAGD;AACDA,YAAAA,OAAO,GAAGJ,KAAV;AACA,gBAAIc,OAAO,GAAG;AAAA;AAAA,4BAAIb,OAAJ,GAAcc,aAAd,CAA4BZ,QAA5B,CAAqCN,OAAO,CAAC,CAAD,CAA5C,CAAd;;AACA,gBAAImB,UAAU,GAAG;AAAA;AAAA,oCAAQP,MAAR,CAAe;AAAA;AAAA,4BAAIQ,SAAJ,CAAcH,OAAO,CAACI,KAAtB,CAAf,CAAjB;;AACA,iBAAKX,kBAAL,CAAwBC,MAAxB,GAAkC;AAAA;AAAA,oCAAQW,gBAAR,CAAyBf,OAAzB,EAAkC,CAACY,UAAD,CAAlC,CAAlC;AACH;;AACD,eAAKI,YAAL,CAAkBC,kBAAlB;;AACA,cAAGrB,KAAH,EAAS;AACL,gBAAGA,KAAK,IAAE,qBAAV,EAAgC;AAC5B;AACA,mBAAI,IAAIsB,CAAC,GAAC,CAAV,EAAYA,CAAC,GAACzB,OAAO,CAAC0B,MAAtB,EAA6BD,CAAC,EAA9B,EAAiC;AAC7B,oBAAIR,OAAO,GAAG;AAAA;AAAA,gCAAIb,OAAJ,GAAcc,aAAd,CAA4BZ,QAA5B,CAAqCN,OAAO,CAACyB,CAAD,CAA5C,CAAd;;AACA,oBAAGR,OAAO,CAAChB,QAAR,GAAiB;AAAA;AAAA,gCAAI0B,YAAJ,CAAiBC,eAArC,EAAqD;AACjD;AACH;;AACD,qBAAKC,UAAL,CAAgB7B,OAAO,CAACyB,CAAD,CAAvB;AACF;AACL,aATD,MASM,IAAGtB,KAAK,IAAE,0BAAV,EAAqC;AACvC;AACA,mBAAI,IAAIsB,CAAC,GAAC,CAAV,EAAYA,CAAC,GAACzB,OAAO,CAAC0B,MAAtB,EAA6BD,CAAC,EAA9B,EAAiC;AAC7B,oBAAIR,OAAO,GAAG;AAAA;AAAA,gCAAIb,OAAJ,GAAcc,aAAd,CAA4BZ,QAA5B,CAAqCN,OAAO,CAACyB,CAAD,CAA5C,CAAd;;AACA,oBAAGR,OAAO,CAAChB,QAAR,GAAiB;AAAA;AAAA,gCAAI0B,YAAJ,CAAiBC,eAArC,EAAqD;AACjD;AACH;;AACD,qBAAKE,eAAL,CAAqB9B,OAAO,CAACyB,CAAD,CAA5B,EAAgC,EAAhC;AACF;AACL,aATK,MASD;AACD;AACA,mBAAI,IAAIA,CAAC,GAAC,CAAV,EAAYA,CAAC,GAACzB,OAAO,CAAC0B,MAAtB,EAA6BD,CAAC,EAA9B,EAAiC;AAC7B,oBAAIR,OAAO,GAAG;AAAA;AAAA,gCAAIb,OAAJ,GAAcc,aAAd,CAA4BZ,QAA5B,CAAqCN,OAAO,CAACyB,CAAD,CAA5C,CAAd;;AACA,oBAAGR,OAAO,CAAChB,QAAR,KAAmB;AAAA;AAAA,gCAAI0B,YAAJ,CAAiBI,cAAvC,EAAsD;AAClD;AACH;;AACD,qBAAKF,UAAL,CAAgB7B,OAAO,CAACyB,CAAD,CAAvB;AACF;AACL;AACJ,WA7BD,MA6BK;AACD,gBAAGvB,IAAI,KAAG;AAAA;AAAA,4CAAYa,IAAnB,IAAyBb,IAAI,KAAG;AAAA;AAAA,4CAAYc,aAA/C,EAA6D;AACzD,mBAAI,IAAIS,CAAC,GAAC,CAAV,EAAYA,CAAC,GAACzB,OAAO,CAAC0B,MAAtB,EAA6BD,CAAC,EAA9B,EAAiC;AAC7B,qBAAKO,UAAL,CAAgBhC,OAAO,CAACyB,CAAD,CAAvB;AACF;AACL,aAJD,MAIK;AACD,mBAAI,IAAIA,CAAC,GAAC,CAAV,EAAYA,CAAC,GAACzB,OAAO,CAAC0B,MAAtB,EAA6BD,CAAC,EAA9B,EAAiC;AAC7B,qBAAKI,UAAL,CAAgB7B,OAAO,CAACyB,CAAD,CAAvB;AACF;AACL;AACJ;AACJ;;AACDO,QAAAA,UAAU,CAACC,MAAD,EAAe;AACrB,gBAAMC,SAAS,GAAGrD,WAAW,CAAC,KAAKsD,aAAN,CAA7B;;AACAD,UAAAA,SAAS,CAACE,MAAV,GAAmB,KAAKb,YAAxB;;AACA,gBAAMc,MAAM,GAAGH,SAAS,CAACI,YAAV;AAAA;AAAA,uCAAf;;AACAD,UAAAA,MAAM,CAACE,cAAP,CAAsBN,MAAtB,EAA6B,IAA7B,EAAkC,IAAlC,EAAuC,KAAvC,EAA6C,MAAI;AAC7C;AAAA;AAAA,gCAAMO,GAAN,CAAUC,IAAV,CAAe;AAAEC,cAAAA,QAAQ,EAAE;AAAA;AAAA,wCAASC,mBAArB;AAA0CC,cAAAA,IAAI,EAAE;AAAE,4BAAYP,MAAM,CAACQ;AAArB;AAAhD,aAAf;AACH,WAFD;AAGH;;AACDhB,QAAAA,UAAU,CAACiB,OAAD,EAAgB;AACtB,gBAAMC,MAAM,GAAGD,OAAf;AACA,gBAAME,QAAQ,GAAG;AAAA;AAAA,qCAAjB;AACA,gBAAM/B,OAAO,GAAG;AAAA;AAAA,0BAAIb,OAAJ,GAAcc,aAAd,CAA4BZ,QAA5B,CAAqCyC,MAArC,CAAhB;AACAC,UAAAA,QAAQ,CAACC,EAAT,GAAc,CAAd;AACAD,UAAAA,QAAQ,CAACf,MAAT,GAAkBc,MAAlB;AACAC,UAAAA,QAAQ,CAACE,IAAT,GAAgBjC,OAAO,CAACkC,WAAxB;AACA,gBAAMC,QAAQ,GAAG;AAAA;AAAA,0CAAYZ,GAAZ,CAAgBa,cAAhB,CAA+BL,QAA/B,EAAwC,KAAKzB,YAA7C,CAAjB;AACA,gBAAM+B,UAAU,GAAGF,QAAQ,CAACd,YAAT;AAAA;AAAA,mCAAnB;AACAgB,UAAAA,UAAU,CAACC,iBAAX;AACH;;AACDzB,QAAAA,eAAe,CAACgB,OAAD,EAAgBU,KAAhB,EAA6B;AACxC,gBAAMC,SAAS,GAAG5E,WAAW,CAAC,KAAK6E,aAAN,CAA7B;;AACAD,UAAAA,SAAS,CAACrB,MAAV,GAAmB,KAAKb,YAAxB;;AACA,gBAAMc,MAAM,GAAGoB,SAAS,CAACnB,YAAV;AAAA;AAAA,mCAAf;;AACA,gBAAMrB,OAAO,GAAG;AAAA;AAAA,0BAAIb,OAAJ,GAAcc,aAAd,CAA4BZ,QAA5B,CAAqCwC,OAArC,CAAhB;AACA,gBAAME,QAAQ,GAAG;AAAA;AAAA,qCAAjB;AACAA,UAAAA,QAAQ,CAACf,MAAT,GAAkBa,OAAlB;AACAE,UAAAA,QAAQ,CAACE,IAAT,GAAgBjC,OAAO,CAACkC,WAAxB;AACAd,UAAAA,MAAM,CAACsB,aAAP,CAAqBX,QAArB;AACAX,UAAAA,MAAM,CAACuB,SAAP,CAAiB,KAAjB;AACAvB,UAAAA,MAAM,CAACwB,QAAP,CAAgB,CAAhB;AACAxB,UAAAA,MAAM,CAACyB,QAAP,CAAgBN,KAAhB;AACH;;AAhHiD,O;;;;;iBAE3B,I;;;;;;;iBAEA,I;;;;;;;iBAEH,I;;;;;;;iBAEU,I","sourcesContent":["import { _decorator, Component, instantiate, Node, Prefab, RichText, Sprite } from 'cc';\r\nimport { tab } from '../../../Table/table_gen';\r\nimport { ItemInfo } from '../item/ItemInfo';\r\nimport { ItemPoolMgr } from '../item/ItemPoolMgr';\r\nimport { LangMgr } from '../../mgr/LangMgr';\r\nimport { HeroInfo } from '../hero/HeroInfo';\r\nimport { HeroItem } from '../item/HeroItem';\r\nimport { CommonItem } from '../item/CommonItem';\r\nimport { WeaponItem } from '../common/WeaponItem';\r\nimport { UIMgr } from '../../mgr/UIMgr';\r\nimport { ViewName } from '../../define/ViewDefine';\r\nimport { RecruitType } from '../../../Common/script/EnumTypeMgr';\r\nconst { ccclass, property } = _decorator;\r\n\r\n@ccclass('RecruitProbabilityItem')\r\nexport class RecruitProbabilityItem extends Component {\r\n    @property(Prefab)\r\n    pfb_hero_item:Prefab = null;\r\n    @property(Prefab)\r\n    pfb_rare_book:Prefab = null;\r\n    @property(Node)\r\n    node_content:Node = null;\r\n    @property(RichText)\r\n    rich_text_aptitude:RichText = null;\r\n    private _heroAptitudeTable:tab.HeroAptitudeTable = null;\r\n    protected onLoad(): void {\r\n       \r\n    }\r\n    setHeroData(dataArr:number[],Aptitude:tab.HeroAptitude,type:RecruitType,extra?:string){\r\n        this._heroAptitudeTable = tab.getData().HeroAptitudeTableByHeroAptitude.getValue(Aptitude);\r\n\r\n        let TipsStr = \"\";\r\n        let TipsStrArr = [];\r\n        if(type==RecruitType.Senior){\r\n            TipsStr = \"Tips_recruit_\"\r\n            this.rich_text_aptitude.string = LangMgr.getLab(TipsStr+Aptitude);\r\n        }else if(type==RecruitType.Friend){\r\n            TipsStr = \"Tips_recruit_friend_\"\r\n            this.rich_text_aptitude.string = LangMgr.getLab(TipsStr+Aptitude);\r\n        }else if(type==RecruitType.SeniorGuarantee){\r\n            TipsStr = \"Tips_recruit_must_1\";\r\n            this.rich_text_aptitude.string = LangMgr.getLab(TipsStr);\r\n        }else if(type===RecruitType.Book){\r\n            TipsStr = \"Tips_bookprob_\"\r\n            this.rich_text_aptitude.string = LangMgr.getLab(TipsStr+Aptitude);\r\n        }else if(type===RecruitType.BookGuarantee){\r\n            TipsStr = \"Tips_bookprob_must_1\"\r\n            this.rich_text_aptitude.string = LangMgr.getLab(TipsStr);\r\n        }else{\r\n            TipsStr = extra;\r\n            let heroTab = tab.getData().HeroTableById.getValue(dataArr[0])\r\n            let _heroClass = LangMgr.getLab(tab.HeroClass[heroTab.Class]);\r\n            this.rich_text_aptitude.string =  LangMgr.getCombineString(TipsStr, [_heroClass]);\r\n        }\r\n        this.node_content.destroyAllChildren();\r\n        if(extra){\r\n            if(extra==\"Tips_recruit_hero_5\"){\r\n                // 5星英雄\r\n                for(let i=0;i<dataArr.length;i++){\r\n                    let heroTab = tab.getData().HeroTableById.getValue(dataArr[i]);\r\n                    if(heroTab.Aptitude<tab.HeroAptitude.HeroAptitude_SR){\r\n                        continue\r\n                    }\r\n                    this.createHero(dataArr[i]);\r\n                 }\r\n            }else if(extra==\"Tips_recruit_heropiece_5\"){\r\n                // 5星英雄碎片\r\n                for(let i=0;i<dataArr.length;i++){\r\n                    let heroTab = tab.getData().HeroTableById.getValue(dataArr[i]);\r\n                    if(heroTab.Aptitude<tab.HeroAptitude.HeroAptitude_SR){\r\n                        continue\r\n                    }\r\n                    this.createHeroPiece(dataArr[i],50);\r\n                 }\r\n            }else{\r\n                // 4星英雄\r\n                for(let i=0;i<dataArr.length;i++){\r\n                    let heroTab = tab.getData().HeroTableById.getValue(dataArr[i]);\r\n                    if(heroTab.Aptitude!==tab.HeroAptitude.HeroAptitude_R){\r\n                        continue\r\n                    }\r\n                    this.createHero(dataArr[i]);\r\n                 }\r\n            }\r\n        }else{\r\n            if(type===RecruitType.Book||type===RecruitType.BookGuarantee){\r\n                for(let i=0;i<dataArr.length;i++){\r\n                    this.createBook(dataArr[i]);\r\n                 }\r\n            }else{\r\n                for(let i=0;i<dataArr.length;i++){\r\n                    this.createHero(dataArr[i]);\r\n                 }\r\n            }\r\n        }\r\n    }\r\n    createBook(itemId:number){\r\n        const _bookItem = instantiate(this.pfb_rare_book);\r\n        _bookItem.parent = this.node_content;\r\n        const itemTs = _bookItem.getComponent(WeaponItem);\r\n        itemTs.initBookItemId(itemId,true,true,false,()=>{\r\n            UIMgr.ins.show({ viewName: ViewName.RareBookInfoItemPop, data: { \"bookInfo\": itemTs.info } });\r\n        });\r\n    }\r\n    createHero(_itemId:number){\r\n        const heroId = _itemId;\r\n        const heroInfo = new HeroInfo();\r\n        const heroTab = tab.getData().HeroTableById.getValue(heroId);\r\n        heroInfo.id = 0;\r\n        heroInfo.itemId = heroId;\r\n        heroInfo.star = heroTab.DefaultStar\r\n        const heroItem = ItemPoolMgr.ins.createHeroItem(heroInfo,this.node_content);\r\n        const heroItemTs = heroItem.getComponent(HeroItem);\r\n        heroItemTs.setHeroProbablity();\r\n    }\r\n    createHeroPiece(_itemId:number,count:number){\r\n        const _heroItem = instantiate(this.pfb_hero_item);\r\n        _heroItem.parent = this.node_content;\r\n        const itemTs = _heroItem.getComponent(HeroItem);\r\n        const heroTab = tab.getData().HeroTableById.getValue(_itemId);\r\n        const heroInfo = new HeroInfo();\r\n        heroInfo.itemId = _itemId;\r\n        heroInfo.star = heroTab.DefaultStar;\r\n        itemTs.UpdateContent(heroInfo);\r\n        itemTs.setSelect(false);\r\n        itemTs.setLevel(0);\r\n        itemTs.setPiece(count);\r\n    }\r\n}\r\n\r\n\r\n"]}