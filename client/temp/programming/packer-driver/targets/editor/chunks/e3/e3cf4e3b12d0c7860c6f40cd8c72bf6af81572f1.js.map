{"version":3,"sources":["file:///C:/chickenStarClient/client/assets/scripts/logic/model/activity/wonderfulActivity/NewHandGiftItem.ts"],"names":["_decorator","Component","Label","Node","Sprite","Vec3","ItemInfo","ItemPoolMgr","tab","ChannelMgr","MallDataMgr","MALLNAME","AdMgr","ShowTips","proto","Net","LangMgr","PayControl","ccclass","property","NewHandGiftItem","mallItemTab","_view_name","NONE","boughtCount","initData","viewData","viewName","setStaticView","setAsyncView","awards","GetItemIds","awardNums","GetItemNum","firstAward","firstAwardNum","otherAward","otherAwardNums","i","length","push","firstInfo","itemId","num","ins","createRewadItem","node_first_item","setPosition","node_layout","destroyAllChildren","awardInfo","RechargeId","rechargeTab","getData","RechargeTableById","getValue","lbl_price","node_price_btn","getChildByName","getComponent","string","getSdkRechargeShowPrice","getFixedShopData","get","Id","node_ads_btn","active","CostType","MallCostType","MallCostType_Advert","MallCostType_Recharge","node_diamond_btn","MallCostType_CostItem","maxAdTimes","getAdCountMaxByType","AdType","curAdTimes","getAdCountByType","lbl_limit_time","String","node_nothing","LimitCount","lbl_diamond_count","getLab","fontSize","outlineWidth","IconUrl","sp_chaozhi","node","setTexture","clickFreeAdBuyItem","msg","Msg_BuyFixedShopCommodityReq","commodityId","Send","Ptl","BuyFixedShopCommodityReq","clickFreeBuyItem","self","clicRMBkBuy","requestPay","set"],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAASA,MAAAA,U,OAAAA,U;AAAYC,MAAAA,S,OAAAA,S;AAAWC,MAAAA,K,OAAAA,K;AAAOC,MAAAA,I,OAAAA,I;AAAMC,MAAAA,M,OAAAA,M;AAAQC,MAAAA,I,OAAAA,I;;AAC5CC,MAAAA,Q,iBAAAA,Q;;AACAC,MAAAA,W,iBAAAA,W;;AACAC,MAAAA,G,iBAAAA,G;;AACAC,MAAAA,U,iBAAAA,U;;AACAC,MAAAA,W,iBAAAA,W;;AACAC,MAAAA,Q,iBAAAA,Q;;AACAC,MAAAA,K,iBAAAA,K;;AACAC,MAAAA,Q,iBAAAA,Q;;AACAC,MAAAA,K,oBAAAA,K;;AACAC,MAAAA,G,kBAAAA,G;;AACAC,MAAAA,O,kBAAAA,O;;AACAC,MAAAA,U,kBAAAA,U;;;;;;;;;OACH;AAAEC,QAAAA,OAAF;AAAWC,QAAAA;AAAX,O,GAAwBnB,U;;iCAGjBoB,e,WADZF,OAAO,CAAC,iBAAD,C,UAEHC,QAAQ,CAAChB,IAAD,C,UAERgB,QAAQ,CAAChB,IAAD,C,UAERgB,QAAQ,CAAChB,IAAD,C,UAERgB,QAAQ,CAAChB,IAAD,C,UAERgB,QAAQ,CAAChB,IAAD,C,UAERgB,QAAQ,CAACjB,KAAD,C,UAERiB,QAAQ,CAAChB,IAAD,C,UAERgB,QAAQ,CAACjB,KAAD,C,WAERiB,QAAQ,CAACf,MAAD,C,2BAlBb,MACagB,eADb,SACqCnB,SADrC,CAC+C;AAAA;AAAA;;AAAA;;AAAA;;AAAA;;AAAA;;AAAA;;AAAA;;AAAA;;AAAA;;AAAA;;AAAA,eAmBnCoB,WAnBmC,GAmBH,IAnBG;AAAA,eAoBnCC,UApBmC,GAoBZ;AAAA;AAAA,oCAASC,IApBG;AAAA,eAqBnCC,WArBmC,GAqBb,CArBa;AAAA;;AAsB3CC,QAAAA,QAAQ,CAACC,QAAD,EAAWC,QAAX,EAA+B;AACnC;AACA,eAAKL,UAAL,GAAkBK,QAAlB;AACA,eAAKN,WAAL,GAAmBK,QAAnB,CAHmC,CAInC;;AACA,eAAKE,aAAL;AACA,eAAKC,YAAL;AACH;;AACDD,QAAAA,aAAa,GAAG;AACZ,gBAAME,MAAM,GAAG,KAAKT,WAAL,CAAiBU,UAAhC;AACA,gBAAMC,SAAS,GAAG,KAAKX,WAAL,CAAiBY,UAAnC;AACA,gBAAMC,UAAU,GAAGJ,MAAM,CAAC,CAAD,CAAzB;AACA,gBAAMK,aAAa,GAAGH,SAAS,CAAC,CAAD,CAA/B;AACA,gBAAMI,UAAU,GAAG,EAAnB;AACA,gBAAMC,cAAc,GAAG,EAAvB;;AACA,eAAK,IAAIC,CAAC,GAAG,CAAb,EAAgBA,CAAC,GAAGR,MAAM,CAACS,MAA3B,EAAmCD,CAAC,EAApC,EAAwC;AACpCF,YAAAA,UAAU,CAACI,IAAX,CAAgBV,MAAM,CAACQ,CAAD,CAAtB;AACAD,YAAAA,cAAc,CAACG,IAAf,CAAoBR,SAAS,CAACM,CAAD,CAA7B;AACH;;AACD,gBAAMG,SAAS,GAAG;AAAA;AAAA,qCAAlB;AACAA,UAAAA,SAAS,CAACC,MAAV,GAAmBR,UAAnB;AACAO,UAAAA,SAAS,CAACE,GAAV,GAAgBR,aAAhB;AACA;AAAA;AAAA,0CAAYS,GAAZ,CAAgBC,eAAhB,CAAgCJ,SAAhC,EAA2C,KAAKK,eAAhD;;AACA,cAAIV,UAAU,CAACG,MAAX,KAAsB,CAA1B,EAA6B;AACzB,iBAAKO,eAAL,CAAqBC,WAArB,CAAiC,IAAI1C,IAAJ,CAAS,CAAT,EAAY,CAAC,GAAb,EAAkB,CAAlB,CAAjC;AACH;;AACD,eAAK2C,WAAL,CAAiBC,kBAAjB;;AACA,eAAK,IAAIX,CAAC,GAAG,CAAb,EAAgBA,CAAC,GAAGF,UAAU,CAACG,MAA/B,EAAuCD,CAAC,EAAxC,EAA4C;AACxC,kBAAMY,SAAS,GAAG;AAAA;AAAA,uCAAlB;AACAA,YAAAA,SAAS,CAACR,MAAV,GAAmBN,UAAU,CAACE,CAAD,CAA7B;AACAY,YAAAA,SAAS,CAACP,GAAV,GAAgBN,cAAc,CAACC,CAAD,CAA9B;AACA;AAAA;AAAA,4CAAYM,GAAZ,CAAgBC,eAAhB,CAAgCK,SAAhC,EAA2C,KAAKF,WAAhD;AACH,WAxBW,CAyBZ;;;AACA,cAAG,KAAK3B,WAAL,CAAiB8B,UAApB,EAA+B;AAC3B,kBAAMC,WAAW,GAAG;AAAA;AAAA,4BAAIC,OAAJ,GAAcC,iBAAd,CAAgCC,QAAhC,CAAyC,KAAKlC,WAAL,CAAiB8B,UAA1D,CAApB;AACA,kBAAMK,SAAS,GAAG,KAAKC,cAAL,CAAoBC,cAApB,CAAmC,WAAnC,EAAgDC,YAAhD,CAA6DzD,KAA7D,CAAlB;AACAsD,YAAAA,SAAS,CAACI,MAAV,GAAmB;AAAA;AAAA,0CAAWC,uBAAX,CAAmCT,WAAnC,CAAnB;AACH;AACJ;;AACDvB,QAAAA,YAAY,GAAG;AACX,eAAKL,WAAL,GAAmB;AAAA;AAAA,0CAAYoB,GAAZ,CAAgBkB,gBAAhB,CAAiC,KAAKxC,UAAtC,EAAkDyC,GAAlD,CAAsD,KAAK1C,WAAL,CAAiB2C,EAAvE,CAAnB;AACA,eAAKC,YAAL,CAAkBC,MAAlB,GAA2B,KAAK7C,WAAL,CAAiB8C,QAAjB,KAA8B;AAAA;AAAA,0BAAIC,YAAJ,CAAiBC,mBAA1E;AACA,eAAKZ,cAAL,CAAoBS,MAApB,GAA6B,KAAK7C,WAAL,CAAiB8C,QAAjB,KAA8B;AAAA;AAAA,0BAAIC,YAAJ,CAAiBE,qBAA5E;AACA,eAAKC,gBAAL,CAAsBL,MAAtB,GAA+B,KAAK7C,WAAL,CAAiB8C,QAAjB,KAA8B;AAAA;AAAA,0BAAIC,YAAJ,CAAiBI,qBAA9E;;AACA,cAAI,KAAKnD,WAAL,CAAiB8C,QAAjB,KAA8B;AAAA;AAAA,0BAAIC,YAAJ,CAAiBC,mBAAnD,EAAwE;AACpE;AACA,kBAAMI,UAAU,GAAG;AAAA;AAAA,gCAAM7B,GAAN,CAAU8B,mBAAV,CAA8B,KAAKrD,WAAL,CAAiBsD,MAA/C,CAAnB;AACA,kBAAMC,UAAU,GAAG;AAAA;AAAA,gCAAMhC,GAAN,CAAUiC,gBAAV,CAA2B,KAAKxD,WAAL,CAAiBsD,MAA5C,CAAnB;AACA,iBAAKG,cAAL,CAAoBlB,MAApB,GAA6BmB,MAAM,CAACN,UAAU,GAAGG,UAAd,CAAnC;AACA,iBAAKI,YAAL,CAAkBd,MAAlB,GAA2BU,UAAU,IAAIH,UAAzC;AACH,WAND,MAMO,IAAG,KAAKpD,WAAL,CAAiB8C,QAAjB,KAA8B;AAAA;AAAA,0BAAIC,YAAJ,CAAiBI,qBAAlD,EAAwE;AAC3E,iBAAKM,cAAL,CAAoBlB,MAApB,GAA6BmB,MAAM,CAAC,KAAK1D,WAAL,CAAiB4D,UAAjB,GAA8B,KAAKzD,WAApC,CAAnC;AACA,iBAAKwD,YAAL,CAAkBd,MAAlB,GAA2B,KAAK1C,WAAL,IAAoB,KAAKH,WAAL,CAAiB4D,UAAhE;AACA,iBAAKC,iBAAL,CAAuBtB,MAAvB,GAAgC;AAAA;AAAA,oCAAQuB,MAAR,CAAe,kBAAf,CAAhC;AACA,iBAAKD,iBAAL,CAAuBE,QAAvB,GAAkC,EAAlC;AACA,iBAAKF,iBAAL,CAAuBG,YAAvB,GAAsC,CAAtC;AACH,WANM,MAMD;AACF,iBAAKP,cAAL,CAAoBlB,MAApB,GAA6BmB,MAAM,CAAC,KAAK1D,WAAL,CAAiB4D,UAAjB,GAA8B,KAAKzD,WAApC,CAAnC;AACA,iBAAKwD,YAAL,CAAkBd,MAAlB,GAA2B,KAAK1C,WAAL,IAAoB,KAAKH,WAAL,CAAiB4D,UAAhE;AACH;;AACD,cAAI,KAAK5D,WAAL,CAAiBiE,OAArB,EAA8B;AAC1B,iBAAKC,UAAL,CAAgBC,IAAhB,CAAqBtB,MAArB,GAA8B,IAA9B;AACA,iBAAKqB,UAAL,CAAgBE,UAAhB,CAA2B,KAAKpE,WAAL,CAAiBiE,OAA5C;AACH,WAHD,MAGO;AACH,iBAAKC,UAAL,CAAgBC,IAAhB,CAAqBtB,MAArB,GAA8B,KAA9B;AACH;AACJ;;AACDwB,QAAAA,kBAAkB,GAAG;AACjB,gBAAMjB,UAAU,GAAG;AAAA;AAAA,8BAAM7B,GAAN,CAAU8B,mBAAV,CAA8B,KAAKrD,WAAL,CAAiBsD,MAA/C,CAAnB;AACA,gBAAMC,UAAU,GAAG;AAAA;AAAA,8BAAMhC,GAAN,CAAUiC,gBAAV,CAA2B,KAAKxD,WAAL,CAAiBsD,MAA5C,CAAnB;;AACA,cAAIC,UAAU,IAAIH,UAAlB,EAA8B;AAC1B;AAAA;AAAA,sCAAS;AAAA;AAAA,oCAAQU,MAAR,CAAe,mBAAf,CAAT;AACA;AACH;;AACD,cAAIQ,GAAG,GAAG,IAAI;AAAA;AAAA,8BAAMC,4BAAV,EAAV;AACAD,UAAAA,GAAG,CAACE,WAAJ,GAAkB,KAAKxE,WAAL,CAAiB2C,EAAnC;AACA2B,UAAAA,GAAG,CAAChD,GAAJ,GAAU,CAAV;AACA;AAAA;AAAA,0BAAImD,IAAJ,CAAS;AAAA;AAAA,8BAAMC,GAAN,CAAUC,wBAAnB,EAA6CL,GAA7C;AACH;;AACDM,QAAAA,gBAAgB,GAAE;AACd,cAAIC,IAAI,GAAG,IAAX;;AACA,cAAIA,IAAI,CAAC1E,WAAL,IAAoB0E,IAAI,CAAC7E,WAAL,CAAiB4D,UAAzC,EAAqD;AACjD;AAAA;AAAA,sCAAS;AAAA;AAAA,oCAAQE,MAAR,CAAe,mBAAf,CAAT;AACA;AACH;;AACD,cAAIQ,GAAG,GAAG,IAAI;AAAA;AAAA,8BAAMC,4BAAV,EAAV;AACAD,UAAAA,GAAG,CAACE,WAAJ,GAAkB,KAAKxE,WAAL,CAAiB2C,EAAnC;AACA2B,UAAAA,GAAG,CAAChD,GAAJ,GAAU,CAAV;AACA;AAAA;AAAA,0BAAImD,IAAJ,CAAS;AAAA;AAAA,8BAAMC,GAAN,CAAUC,wBAAnB,EAA6CL,GAA7C;AACH;;AACDQ,QAAAA,WAAW,GAAG;AACV,cAAID,IAAI,GAAG,IAAX;;AACA,cAAIA,IAAI,CAAC1E,WAAL,IAAoB0E,IAAI,CAAC7E,WAAL,CAAiB4D,UAAzC,EAAqD;AACjD;AAAA;AAAA,sCAAS;AAAA;AAAA,oCAAQE,MAAR,CAAe,mBAAf,CAAT;AACA;AACH;;AACD;AAAA;AAAA,wCAAWvC,GAAX,CAAewD,UAAf,CAA0BF,IAAI,CAAC7E,WAAL,CAAiB8B,UAA3C,EAAuD,MAAM;AACzD;AAAA;AAAA,4CAAYP,GAAZ,CAAgBkB,gBAAhB,CAAiCoC,IAAI,CAAC5E,UAAtC,EAAkD+E,GAAlD,CAAsDH,IAAI,CAAC7E,WAAL,CAAiB2C,EAAvE,EAA2EkC,IAAI,CAAC1E,WAAL,GAAmB,CAA9F;AACA0E,YAAAA,IAAI,CAACrE,YAAL;AACH,WAHD;AAIH;;AA3H0C,O;;;;;iBAEnB,I;;;;;;;iBAEJ,I;;;;;;;iBAEG,I;;;;;;;iBAEF,I;;;;;;;iBAEG,I;;;;;;;iBAEA,I;;;;;;;iBAEH,I;;;;;;;iBAEM,I;;;;;;;iBAEN,I","sourcesContent":["import { _decorator, Component, Label, Node, Sprite, Vec3 } from 'cc';\r\nimport { ItemInfo } from '../../item/ItemInfo';\r\nimport { ItemPoolMgr } from '../../item/ItemPoolMgr';\r\nimport { tab } from '../../../../Table/table_gen';\r\nimport { ChannelMgr } from '../../../../channel/ChannelMgr';\r\nimport { MallDataMgr } from '../../shop/MallDataMgr';\r\nimport { MALLNAME } from '../../../../Common/script/EnumTypeMgr';\r\nimport { AdMgr } from '../../AdMgr';\r\nimport { ShowTips } from '../../../mgr/UIMgr';\r\nimport { proto } from 'client_protocol';\r\nimport { Net } from '../../../net/Net';\r\nimport { LangMgr } from '../../../mgr/LangMgr';\r\nimport { PayControl } from '../../pay/PayControl';\r\nconst { ccclass, property } = _decorator;\r\n\r\n@ccclass('NewHandGiftItem')\r\nexport class NewHandGiftItem extends Component {\r\n    @property(Node)\r\n    node_first_item: Node = null;\r\n    @property(Node)\r\n    node_layout: Node = null;\r\n    @property(Node)\r\n    node_price_btn: Node = null;\r\n    @property(Node)\r\n    node_ads_btn: Node = null;\r\n    @property(Node)\r\n    node_diamond_btn:Node = null;\r\n    @property(Label)\r\n    lbl_limit_time: Label = null;\r\n    @property(Node)\r\n    node_nothing: Node = null;\r\n    @property(Label)\r\n    lbl_diamond_count: Label = null;\r\n    @property(Sprite)\r\n    sp_chaozhi: Sprite = null;\r\n    private mallItemTab: tab.MallItemTabe = null;\r\n    private _view_name: MALLNAME = MALLNAME.NONE;\r\n    private boughtCount: number = 0;\r\n    initData(viewData, viewName: MALLNAME) {\r\n        //   根据商品id设置item\r\n        this._view_name = viewName;\r\n        this.mallItemTab = viewData;\r\n        //先创建首个奖励\r\n        this.setStaticView();\r\n        this.setAsyncView();\r\n    }\r\n    setStaticView() {\r\n        const awards = this.mallItemTab.GetItemIds;\r\n        const awardNums = this.mallItemTab.GetItemNum;\r\n        const firstAward = awards[0];\r\n        const firstAwardNum = awardNums[0];\r\n        const otherAward = [];\r\n        const otherAwardNums = [];\r\n        for (let i = 1; i < awards.length; i++) {\r\n            otherAward.push(awards[i]);\r\n            otherAwardNums.push(awardNums[i]);\r\n        }\r\n        const firstInfo = new ItemInfo();\r\n        firstInfo.itemId = firstAward;\r\n        firstInfo.num = firstAwardNum;\r\n        ItemPoolMgr.ins.createRewadItem(firstInfo, this.node_first_item);\r\n        if (otherAward.length === 0) {\r\n            this.node_first_item.setPosition(new Vec3(0, -135, 0));\r\n        }\r\n        this.node_layout.destroyAllChildren();\r\n        for (let i = 0; i < otherAward.length; i++) {\r\n            const awardInfo = new ItemInfo();\r\n            awardInfo.itemId = otherAward[i];\r\n            awardInfo.num = otherAwardNums[i];\r\n            ItemPoolMgr.ins.createRewadItem(awardInfo, this.node_layout);\r\n        }\r\n        // 显示价格\r\n        if(this.mallItemTab.RechargeId){\r\n            const rechargeTab = tab.getData().RechargeTableById.getValue(this.mallItemTab.RechargeId);\r\n            const lbl_price = this.node_price_btn.getChildByName(\"price_txt\").getComponent(Label);\r\n            lbl_price.string = ChannelMgr.getSdkRechargeShowPrice(rechargeTab);\r\n        }\r\n    }\r\n    setAsyncView() {\r\n        this.boughtCount = MallDataMgr.ins.getFixedShopData(this._view_name).get(this.mallItemTab.Id);\r\n        this.node_ads_btn.active = this.mallItemTab.CostType === tab.MallCostType.MallCostType_Advert;\r\n        this.node_price_btn.active = this.mallItemTab.CostType === tab.MallCostType.MallCostType_Recharge;\r\n        this.node_diamond_btn.active = this.mallItemTab.CostType === tab.MallCostType.MallCostType_CostItem;\r\n        if (this.mallItemTab.CostType === tab.MallCostType.MallCostType_Advert) {\r\n            // 当前是广告 显示广告次数跟广告剩余次数\r\n            const maxAdTimes = AdMgr.ins.getAdCountMaxByType(this.mallItemTab.AdType);\r\n            const curAdTimes = AdMgr.ins.getAdCountByType(this.mallItemTab.AdType);\r\n            this.lbl_limit_time.string = String(maxAdTimes - curAdTimes);\r\n            this.node_nothing.active = curAdTimes >= maxAdTimes\r\n        } else if(this.mallItemTab.CostType === tab.MallCostType.MallCostType_CostItem){\r\n            this.lbl_limit_time.string = String(this.mallItemTab.LimitCount - this.boughtCount);\r\n            this.node_nothing.active = this.boughtCount >= this.mallItemTab.LimitCount;\r\n            this.lbl_diamond_count.string = LangMgr.getLab(\"ui_commondesc_90\");\r\n            this.lbl_diamond_count.fontSize = 26;\r\n            this.lbl_diamond_count.outlineWidth = 3;\r\n        }else {\r\n            this.lbl_limit_time.string = String(this.mallItemTab.LimitCount - this.boughtCount);\r\n            this.node_nothing.active = this.boughtCount >= this.mallItemTab.LimitCount\r\n        }\r\n        if (this.mallItemTab.IconUrl) {\r\n            this.sp_chaozhi.node.active = true;\r\n            this.sp_chaozhi.setTexture(this.mallItemTab.IconUrl)\r\n        } else {\r\n            this.sp_chaozhi.node.active = false;\r\n        }\r\n    }\r\n    clickFreeAdBuyItem() {\r\n        const maxAdTimes = AdMgr.ins.getAdCountMaxByType(this.mallItemTab.AdType);\r\n        const curAdTimes = AdMgr.ins.getAdCountByType(this.mallItemTab.AdType);\r\n        if (curAdTimes >= maxAdTimes) {\r\n            ShowTips(LangMgr.getLab('Tips_timeshortage'));\r\n            return\r\n        }\r\n        let msg = new proto.Msg_BuyFixedShopCommodityReq();\r\n        msg.commodityId = this.mallItemTab.Id;\r\n        msg.num = 1;\r\n        Net.Send(proto.Ptl.BuyFixedShopCommodityReq, msg);\r\n    }\r\n    clickFreeBuyItem(){\r\n        var self = this;\r\n        if (self.boughtCount >= self.mallItemTab.LimitCount) {\r\n            ShowTips(LangMgr.getLab('Tips_timeshortage'));\r\n            return\r\n        }\r\n        let msg = new proto.Msg_BuyFixedShopCommodityReq();\r\n        msg.commodityId = this.mallItemTab.Id;\r\n        msg.num = 1;\r\n        Net.Send(proto.Ptl.BuyFixedShopCommodityReq, msg);\r\n    }\r\n    clicRMBkBuy() {\r\n        var self = this;\r\n        if (self.boughtCount >= self.mallItemTab.LimitCount) {\r\n            ShowTips(LangMgr.getLab('Tips_timeshortage'));\r\n            return\r\n        }\r\n        PayControl.ins.requestPay(self.mallItemTab.RechargeId, () => {\r\n            MallDataMgr.ins.getFixedShopData(self._view_name).set(self.mallItemTab.Id, self.boughtCount + 1);\r\n            self.setAsyncView();\r\n        })\r\n    }\r\n}\r\n\r\n\r\n"]}