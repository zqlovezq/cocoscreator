{"version":3,"sources":["file:///C:/chickenStarClient/client/assets/scripts/logic/model/common/ResourceBuyPop.ts"],"names":["_decorator","instantiate","Label","Node","Prefab","ViewPop","tab","LangMgr","ResourceBuyItem","EventMgr","proto","UIMgr","ViewName","SettingRedManager","ccclass","property","ResourceBuyPop","itemId","register","onMsg","Ptl","BuyStaminaRsp","on_s2c_BuyStaminaRsp","BuyGoldRsp","on_s2c_BuyGoldRsp","onShow","openData","initView","onClose","CurrencyType","CurrencyType_Stamina","ins","getSetting","setSetting","CurrencyType_Gold","itemTab","getData","ItemTableById","getValue","titleLab","string","getCombineString","getLab","Name","lbl_common","node_energy","active","node_common","initStaminaView","initGoldView","resLayoutNode","destroyAllChildren","aDTable","BuyStaminaTableByType","BuyStaminaType","BuyStaminaType_WatchAdverts","currTable","BuyStaminaType_UseCurrency","item","resBuyPrefab","parent","getComponent","initEnergyView","item2","node_common_layout","BuyGoldTable","forEach","value","key","msg","error","code","CommonErrorCode","Succeed","show","viewName","CongratulationPop","data","rewards","items"],"mappings":"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","sourcesContent":["import { _decorator, Component, instantiate, Label, Node, Prefab } from 'cc';\r\nimport { ViewPop } from '../../../framework/base/ViewPop';\r\nimport { tab } from '../../../Table/table_gen';\r\nimport { LangMgr } from '../../mgr/LangMgr';\r\nimport { ResourceBuyItem } from './ResourceBuyItem';\r\nimport { EventMgr } from '../../mgr/EventMgr';\r\nimport { proto } from 'client_protocol';\r\nimport { UIMgr } from '../../mgr/UIMgr';\r\nimport { ViewName } from '../../define/ViewDefine';\r\nimport { SettingRedManager } from '../role/SettingRedManager';\r\nconst { ccclass, property } = _decorator;\r\n\r\n/**\r\n * \r\n * ResourceBuyPop\r\n * zhudingchao\r\n * Mon Jun 17 2024 13:52:15 GMT+0800 (中国标准时间)\r\n * db://assets/scripts/logic/model/common/ResourceBuyPop.ts\r\n *\r\n */\r\n\r\n@ccclass('ResourceBuyPop')\r\nexport class ResourceBuyPop extends ViewPop {\r\n\r\n    @property(Node)\r\n    resLayoutNode: Node = null;\r\n    @property(Prefab)\r\n    resBuyPrefab: Prefab = null;\r\n    @property(Label)\r\n    titleLab: Label = null;\r\n\r\n    @property(Node)\r\n    node_energy: Node = null;\r\n    @property(Node)\r\n    node_common: Node = null;\r\n    @property(Label)\r\n    lbl_common: Label = null;\r\n    @property(Node)\r\n    node_common_layout: Node = null;\r\n\r\n\r\n    private itemId: number;\r\n    register(): void {\r\n        EventMgr.onMsg(proto.Ptl.BuyStaminaRsp, this.on_s2c_BuyStaminaRsp, this);\r\n        EventMgr.onMsg(proto.Ptl.BuyGoldRsp, this.on_s2c_BuyGoldRsp, this)\r\n    }\r\n    onShow(): void {\r\n        if (this.openData && this.openData[\"itemId\"]) {\r\n            this.itemId = this.openData[\"itemId\"];\r\n            this.initView();\r\n        }\r\n    }\r\n    onClose(): void {\r\n        super.onClose();\r\n        if (this.itemId == tab.CurrencyType.CurrencyType_Stamina) {\r\n            if (!SettingRedManager.ins.getSetting(\"RedStamina\")) {\r\n                SettingRedManager.ins.setSetting(\"RedStamina\", true);\r\n            }\r\n        }else if (this.itemId === tab.CurrencyType.CurrencyType_Gold) {\r\n            if (!SettingRedManager.ins.getSetting(\"GoldBuy\")) {\r\n                SettingRedManager.ins.setSetting(\"GoldBuy\", true);\r\n            }\r\n        }\r\n    }\r\n    initView() {\r\n        let itemTab = tab.getData().ItemTableById.getValue(this.itemId);\r\n        //this.titleLab.string=\"购买\"+LangMgr.getLab(itemTab.Name);\r\n        this.titleLab.string = LangMgr.getCombineString(\"ui_commondesc_91\", [LangMgr.getLab(itemTab.Name)]);\r\n        this.lbl_common.string = LangMgr.getCombineString(\"ui_commondesc_91\", [LangMgr.getLab(itemTab.Name)]);\r\n        this.node_energy.active = this.itemId == tab.CurrencyType.CurrencyType_Stamina;\r\n        this.node_common.active = !this.node_energy.active;\r\n        if (this.itemId == tab.CurrencyType.CurrencyType_Stamina) {\r\n            this.initStaminaView();\r\n        } else if (this.itemId === tab.CurrencyType.CurrencyType_Gold) {\r\n            this.initGoldView();\r\n        }\r\n\r\n    }\r\n    private initStaminaView() {\r\n        this.resLayoutNode.destroyAllChildren();\r\n        let aDTable = tab.getData().BuyStaminaTableByType.getValue(tab.BuyStaminaType.BuyStaminaType_WatchAdverts);\r\n        let currTable = tab.getData().BuyStaminaTableByType.getValue(tab.BuyStaminaType.BuyStaminaType_UseCurrency);\r\n        let item = instantiate(this.resBuyPrefab);\r\n        item.parent = this.resLayoutNode;\r\n        item.getComponent(ResourceBuyItem).initEnergyView(aDTable);\r\n        let item2 = instantiate(this.resBuyPrefab);\r\n        item2.parent = this.resLayoutNode;\r\n        item2.getComponent(ResourceBuyItem).initEnergyView(currTable);\r\n    }\r\n    private initGoldView() {\r\n        this.node_common_layout.destroyAllChildren();\r\n        tab.getData().BuyGoldTable.forEach((value, key) => {\r\n            const item = instantiate(this.resBuyPrefab);\r\n            item.parent = this.node_common_layout;\r\n            item.getComponent(ResourceBuyItem).initGoldView(value);\r\n        })\r\n    }\r\n    // 请求购买体力返回\r\n    on_s2c_BuyStaminaRsp(msg: proto.Msg_BuyStaminaRsp) {\r\n        if (!msg.error || msg.error.code == proto.CommonErrorCode.Succeed) {\r\n            UIMgr.ins.show({ viewName: ViewName.CongratulationPop, data: msg.rewards })\r\n            this.initStaminaView();\r\n        }\r\n\r\n    }\r\n    on_s2c_BuyGoldRsp(msg: proto.Msg_BuyGoldRsp) {\r\n        if (!msg.error || msg.error.code == proto.CommonErrorCode.Succeed) {\r\n            UIMgr.ins.show({ viewName: ViewName.CongratulationPop, data: msg.items })\r\n            this.initGoldView();\r\n        }\r\n    }\r\n}"]}