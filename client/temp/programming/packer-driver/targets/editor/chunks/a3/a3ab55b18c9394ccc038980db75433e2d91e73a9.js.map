{"version":3,"sources":["file:///C:/chickenStarClient/client/assets/scripts/logic/model/jianghu/dailyExplore/InstanceZonesView.ts"],"names":["_decorator","Button","instantiate","Label","Node","Prefab","Sprite","Toggle","UITransform","ViewPop","JIANGHU_TYPE","RoleData","InfiniteList","InstanceZonesViewItem","EventMgr","proto","Net","ShowItemNotEnoughTips","ShowTips","UIMgr","ViewName","GameplayViewDataMgr","LangMgr","CommonTipsPop","ItemData","RedMgr","RedDotType","ActivityData","ConsumptionToPurchase","GameUtil","ccclass","property","InstanceZonesView","view_type","NONE","_GoldStageData","_FeedStageData","curExportInfo","_sweepInfo","register","onMsg","Ptl","StartStageRsp","on_s2c_StartStageRsp","FinishStageRsp","on_s2c_FinishStageRsp","SweepExploreStageRsp","on_s2c_SweepExploreStageRsp","SweepExploreStageOneClickRsp","on_s2c_SweepExploreStageOneClickRsp","GetExploreStageInfoMapRsp","on_s2c_GetExploreStageInfoMapRsp","unRegister","msg","ins","initData","stageInfoMap","refreshEvent","ChallengeDailyFreeTimes","list_view","Refresh","scrollToIndex","error","code","CommonErrorCode","Succeed","_msg","Msg_GetExploreStageInfoMapReq","Send","GetExploreStageInfoMapReq","show","viewName","CongratulationPop","data","rewards","freeSweepTimes","notFreeSweepTimes","changeDataByViewType","onShow","ChallengeDailyAward","openData","GoldStage","node_toggle","getChildByName","getComponent","isChecked","getStageTab","FeedStage","lbl_power","string","convertNumber","powerScore","Init","getCellNumber","getCellCount","bind","getCellSize","getCellHeight","getCellIdentifer","getCellView","getCellData","GetCellData","type","getExportInfo","node_gold_bg","active","node_exp_bg","reward_btn_1","reward_btn_2","getSweepInfo","setCurFightStageId","freeTimes","node_sweep_free","node_sweep_buy","String","buyTimes","vipLevel","vipMsg","node_ordinary_sweep","clearedStageIds","indexOf","setOrdinaryBtn","node_sweep","grayscale","interactable","index","getCurSweepStageId","pos","GetScrollPosOfCell","maxY","getContent","height","max_y","y","setContentPos","onDestroy","clickChangeView","e","Number","Reload","length","idx","identifer","pfb_item","exportData","onClickAwardLayer","InstanceRewardPop","oneClickSweep","sweepInfo","needDiamond","curHaveDiamond","getCount","sendMsg","Msg_SweepExploreStageOneClickReq","buySweepTimes","stageId","SweepExploreStageOneClickReq","i","maxBuyTimes","addCount","diamondData","tipsStr","getCombineString","create","val","getLab","onClikhideView","onClose","GameplayView","sweepNode","buyNode","lockNode","node_sweep_buy_diamond","onClickSweep","canSweep","setSweepdata","Msg_SweepExploreStageReq","SweepExploreStageReq","self","canUse"],"mappings":"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","sourcesContent":["import { _decorator, Button, Component, EventTouch, instantiate, Label, Node, Prefab, Sprite, Toggle, UITransform } from 'cc';\r\nimport { ViewPop } from '../../../../framework/base/ViewPop';\r\nimport { JIANGHU_TYPE } from '../../../../Common/script/EnumTypeMgr';\r\nimport { RoleData } from '../../role/RoleData';\r\nimport InfiniteList from '../../../../Common/InfiniteList/InfiniteList';\r\nimport { InstanceZonesViewItem } from './InstanceZonesViewItem';\r\nimport { tab } from '../../../../Table/table_gen';\r\nimport { EventMgr } from '../../../mgr/EventMgr';\r\nimport { proto } from 'client_protocol';\r\nimport { Net } from '../../../net/Net';\r\nimport { ShowItemNotEnoughTips, ShowTips, UIMgr } from '../../../mgr/UIMgr';\r\nimport { ViewName } from '../../../define/ViewDefine';\r\nimport { GameplayViewDataMgr } from '../GameplayViewDataMgr';\r\nimport { LangMgr } from '../../../mgr/LangMgr';\r\nimport { CommonTipsPop } from '../../common/CommonTipsPop';\r\nimport { ItemData } from '../../item/ItemData';\r\nimport { RedMgr } from '../../../mgr/RedMgr';\r\nimport { RedDotType } from '../../../red/RedDotType';\r\nimport { ActivityData } from '../../activity/ActivityData';\r\nimport { ConsumptionToPurchase, GameUtil } from '../../../utils/GameUtil';\r\nconst { ccclass, property } = _decorator;\r\n\r\n@ccclass('InstanceZonesView')\r\nexport class InstanceZonesView extends ViewPop {\r\n    @property(Label)\r\n    lbl_power: Label = null;\r\n    @property(InfiniteList)\r\n    list_view: InfiniteList = null;\r\n    @property(Prefab)\r\n    pfb_item: Node = null;\r\n    @property(Node)\r\n    node_gold_bg: Node = null;\r\n    @property(Node)\r\n    node_exp_bg: Node = null;\r\n    @property(Node)\r\n    node_sweep_free: Node = null;\r\n    @property(Node)\r\n    node_sweep_buy: Node = null;\r\n    @property(Node)\r\n    reward_btn_1: Node = null;\r\n    @property(Node)\r\n    reward_btn_2: Node = null;\r\n    @property(Node)\r\n    node_toggle: Node = null;\r\n    @property(Node)\r\n    node_sweep: Node = null;\r\n    @property(Node)\r\n    node_ordinary_sweep: Node = null;\r\n    @property(Label)\r\n    node_sweep_buy_diamond: Label = null;\r\n\r\n    private view_type: JIANGHU_TYPE = JIANGHU_TYPE.NONE;\r\n    private _GoldStageData: tab.PveStageTable[] = [];\r\n    private _FeedStageData: tab.PveStageTable[] = [];\r\n    private curExportInfo: proto.IExportStageInfo = null;\r\n    private _sweepInfo: any = null;\r\n    register(): void {\r\n        EventMgr.onMsg(proto.Ptl.StartStageRsp, this.on_s2c_StartStageRsp, this);\r\n        EventMgr.onMsg(proto.Ptl.FinishStageRsp, this.on_s2c_FinishStageRsp, this);\r\n        EventMgr.onMsg(proto.Ptl.SweepExploreStageRsp, this.on_s2c_SweepExploreStageRsp, this)\r\n        EventMgr.onMsg(proto.Ptl.SweepExploreStageOneClickRsp, this.on_s2c_SweepExploreStageOneClickRsp, this)\r\n        EventMgr.onMsg(proto.Ptl.GetExploreStageInfoMapRsp, this.on_s2c_GetExploreStageInfoMapRsp, this);\r\n    }\r\n    unRegister(): void {\r\n        super.unRegister();\r\n    }\r\n    on_s2c_GetExploreStageInfoMapRsp(msg: proto.Msg_GetExploreStageInfoMapRsp) {\r\n        GameplayViewDataMgr.ins.initData(msg.stageInfoMap);\r\n        RedMgr.refreshEvent(RedDotType.ChallengeDailyFreeTimes);\r\n        this.list_view.Refresh();\r\n        this.scrollToIndex();\r\n    }\r\n    // 开始主线关卡\r\n    on_s2c_StartStageRsp(msg: proto.Msg_StartStageRsp) {\r\n        // let finish_msg = new proto.Msg_FinishStageReq();\r\n        // finish_msg.result = proto.Msg_FinishStageReq.Result.Win;\r\n        // finish_msg.aliveSeconds = 540\r\n        // Net.Send(proto.Ptl.FinishStageReq, finish_msg)\r\n    }\r\n    on_s2c_FinishStageRsp(msg: proto.Msg_FinishStageRsp) {\r\n        if (msg.error && msg.error.code != proto.CommonErrorCode.Succeed) return;\r\n        let _msg = new proto.Msg_GetExploreStageInfoMapReq();\r\n        Net.Send(proto.Ptl.GetExploreStageInfoMapReq, _msg);\r\n    }\r\n    on_s2c_SweepExploreStageRsp(msg: proto.Msg_SweepExploreStageRsp) {\r\n        if (msg.error && msg.error.code != proto.CommonErrorCode.Succeed) return;\r\n        UIMgr.ins.show({ viewName: ViewName.CongratulationPop, data: msg.rewards })\r\n        this.curExportInfo.freeSweepTimes = msg.freeSweepTimes;\r\n        this.curExportInfo.notFreeSweepTimes = msg.notFreeSweepTimes;\r\n        this.changeDataByViewType(false);\r\n        this.list_view.Refresh();\r\n        RedMgr.refreshEvent(RedDotType.ChallengeDailyFreeTimes);\r\n    }\r\n    on_s2c_SweepExploreStageOneClickRsp(msg: proto.Msg_SweepExploreStageOneClickRsp) {\r\n        if (msg.error && msg.error.code != proto.CommonErrorCode.Succeed) return;\r\n        UIMgr.ins.show({ viewName: ViewName.CongratulationPop, data: msg.rewards })\r\n        this.curExportInfo.freeSweepTimes = msg.freeSweepTimes;\r\n        this.curExportInfo.notFreeSweepTimes = msg.notFreeSweepTimes;\r\n        this.changeDataByViewType(false);\r\n        this.list_view.Refresh();\r\n        RedMgr.refreshEvent(RedDotType.ChallengeDailyFreeTimes);\r\n    }\r\n    onShow(): void {\r\n        // 默认黄金工厂\r\n        RedMgr.refreshEvent(RedDotType.ChallengeDailyAward);\r\n        if(typeof this.openData===\"number\"){\r\n            this.openData = [this.openData];\r\n        }\r\n        this.view_type = this.openData ? this.openData[0] : JIANGHU_TYPE.GoldStage;\r\n        this.node_toggle.getChildByName(\"Toggle\" + this.view_type).getComponent(Toggle).isChecked = true;\r\n        this.changeDataByViewType(true);\r\n        this._GoldStageData = GameplayViewDataMgr.ins.getStageTab(JIANGHU_TYPE.GoldStage);\r\n        this._FeedStageData = GameplayViewDataMgr.ins.getStageTab(JIANGHU_TYPE.FeedStage);\r\n        this.lbl_power.string = GameUtil.convertNumber(RoleData.ins.powerScore);\r\n        // const vipLevel = ActivityData.ins.vipMsg.vipLevel;\r\n\r\n        // this.node_sweep.active = vipLevel >= 2;\r\n        this.list_view.Init({\r\n            getCellNumber: this.getCellCount.bind(this),\r\n            getCellSize: this.getCellHeight.bind(this),\r\n            getCellIdentifer: this.getCellIdentifer.bind(this),\r\n            getCellView: this.getCellView.bind(this),\r\n            getCellData: this.GetCellData.bind(this),\r\n        });\r\n        this.scrollToIndex();\r\n    }\r\n    // 根据viewtype变化的数据\r\n    changeDataByViewType(type: boolean) {\r\n        if (type) {\r\n            this.curExportInfo = GameplayViewDataMgr.ins.getExportInfo(this.view_type);\r\n            this.node_gold_bg.active = this.view_type === JIANGHU_TYPE.GoldStage;\r\n            this.node_exp_bg.active = !(this.view_type === JIANGHU_TYPE.GoldStage);\r\n            this.reward_btn_1.active = this.view_type === JIANGHU_TYPE.GoldStage;\r\n            this.reward_btn_2.active = this.view_type === JIANGHU_TYPE.FeedStage;\r\n        }\r\n        this._sweepInfo = GameplayViewDataMgr.ins.getSweepInfo(this.view_type);\r\n        GameplayViewDataMgr.ins.setCurFightStageId(this.view_type);\r\n        if (this._sweepInfo.freeTimes > 0) {\r\n            this.node_sweep_free.active = true;\r\n            this.node_sweep_buy.active = false;\r\n            this.node_sweep_free.getChildByName(\"num_label\").getComponent(Label).string = String(this._sweepInfo.freeTimes);\r\n        } else {\r\n            this.node_sweep_free.active = false;\r\n            this.node_sweep_buy.active = true;\r\n            this.node_sweep_buy.getChildByName(\"num_label\").getComponent(Label).string = String(this._sweepInfo.buyTimes);\r\n        }\r\n        const vipLevel = ActivityData.ins.vipMsg.vipLevel;\r\n        if (this.view_type === JIANGHU_TYPE.GoldStage) {\r\n            this.node_ordinary_sweep.active = vipLevel < 2 && this.curExportInfo.clearedStageIds.indexOf(10101) > -1;\r\n        } else {\r\n            this.node_ordinary_sweep.active = vipLevel < 2 && this.curExportInfo.clearedStageIds.indexOf(10201) > -1;\r\n        }\r\n        this.setOrdinaryBtn();\r\n        this.node_sweep.getComponent(Sprite).grayscale = (this._sweepInfo.freeTimes===0&&this._sweepInfo.buyTimes===0)||vipLevel < 2;\r\n        this.node_sweep.getComponent(Button).interactable = !(this._sweepInfo.freeTimes===0&&this._sweepInfo.buyTimes===0)&&vipLevel >= 2;\r\n\r\n    }\r\n    scrollToIndex() {\r\n        const index = this.curExportInfo.clearedStageIds.indexOf(GameplayViewDataMgr.ins.getCurSweepStageId(this.view_type));\r\n        const pos = this.list_view.GetScrollPosOfCell(index);\r\n        const maxY = this.list_view.getContent().getComponent(UITransform).height-490;\r\n        let max_y = pos.y>maxY?maxY:pos.y;\r\n        this.list_view.setContentPos(max_y, 0, max_y);\r\n    }\r\n    protected onDestroy(): void {\r\n        super.onDestroy();\r\n    }\r\n    clickChangeView(e: EventTouch, type: string) {\r\n        if (this.view_type === Number(type)) {\r\n            return;\r\n        }\r\n        this.view_type = Number(type);\r\n        this.changeDataByViewType(true);\r\n        this.list_view.Reload(false, true);\r\n        this.scrollToIndex();\r\n    }\r\n    getCellCount() {\r\n        if (this.view_type === JIANGHU_TYPE.GoldStage) {\r\n            return this._GoldStageData.length;\r\n        } else {\r\n            return this._FeedStageData.length;\r\n        }\r\n    }\r\n    getCellHeight(idx: number) {\r\n        return 100;\r\n    }\r\n    getCellIdentifer(idx: number) {\r\n        return \"InstanceZonesViewItem\"\r\n    }\r\n    getCellView(idx: number, identifer: string) {\r\n        return instantiate(this.pfb_item).getComponent(InstanceZonesViewItem);\r\n    }\r\n    GetCellData(idx: number) {\r\n        if (this.view_type === JIANGHU_TYPE.GoldStage) {\r\n            return { data: this._GoldStageData[idx], type: this.view_type, exportData: this.curExportInfo };\r\n        } else {\r\n            return { data: this._FeedStageData[idx], type: this.view_type, exportData: this.curExportInfo };\r\n        }\r\n    }\r\n    // 点击进入通关奖励界面\r\n    onClickAwardLayer() {\r\n        UIMgr.ins.show({ viewName: ViewName.InstanceRewardPop, data: this.view_type })\r\n    }\r\n    // 一键扫荡\r\n    oneClickSweep() {\r\n        const sweepInfo = this._sweepInfo;\r\n        let needDiamond = 0;\r\n        const curHaveDiamond = ItemData.ins.getCount(1);\r\n        const sendMsg = (() => {\r\n            let msg = new proto.Msg_SweepExploreStageOneClickReq();\r\n            msg.buySweepTimes = sweepInfo.buyTimes > 0;\r\n            msg.stageId = GameplayViewDataMgr.ins.getCurSweepStageId(this.view_type);\r\n            Net.Send(proto.Ptl.SweepExploreStageOneClickReq, msg);\r\n        })\r\n        // 剩余次数 所需要的钻石为\r\n        if (sweepInfo.buyTimes) {\r\n            for (let i = this.curExportInfo.notFreeSweepTimes; i < sweepInfo.maxBuyTimes; i++) {\r\n                const addCount = sweepInfo.diamondData[i]? sweepInfo.diamondData[i]:sweepInfo.diamondData[sweepInfo.diamondData.length-1]\r\n                needDiamond += addCount\r\n            }\r\n            if (this.curExportInfo.clearedStageIds.length > 0) {\r\n                const tipsStr = LangMgr.getCombineString(\"Tips_instance_2\", [sweepInfo.freeTimes, sweepInfo.buyTimes, needDiamond]);\r\n                CommonTipsPop.create(tipsStr, ((val) => {\r\n                    if (val) {\r\n                        if (curHaveDiamond < needDiamond) {\r\n                            ShowItemNotEnoughTips(1);\r\n                        } else {\r\n                            sendMsg();\r\n                        }\r\n                    }\r\n                }))\r\n            }\r\n        } else {\r\n            ShowTips(LangMgr.getLab(\"Tips_timeshortage\"));\r\n        }\r\n    }\r\n    // 关闭界面\r\n    onClikhideView() {\r\n        this.onClose();\r\n        UIMgr.ins.show({ viewName: ViewName.GameplayView })\r\n    }\r\n    // 设置普通扫荡按钮\r\n    setOrdinaryBtn() {\r\n        if (this.node_ordinary_sweep.active) {\r\n            const sweepNode = this.node_ordinary_sweep.getChildByName(\"sweep_btn\");\r\n            const buyNode = this.node_ordinary_sweep.getChildByName(\"paysweep_btn\")\r\n            const lockNode = this.node_ordinary_sweep.getChildByName(\"lock_node\")\r\n            sweepNode.active = this._sweepInfo.freeTimes > 0;\r\n            buyNode.active = this._sweepInfo.freeTimes == 0 && this._sweepInfo.buyTimes > 0;\r\n            lockNode.active = this._sweepInfo.buyTimes === 0;\r\n            if (this.node_sweep_buy.active) {\r\n                this.node_sweep_buy_diamond.string = LangMgr.getCombineString(\"ui_instance_3\", [this._sweepInfo.diamondData[this.curExportInfo.notFreeSweepTimes]]);\r\n            }\r\n        }\r\n    }\r\n    // 扫荡\r\n    onClickSweep() {\r\n        const canSweep = this.setSweepdata();\r\n        if (canSweep) {\r\n            this.sendMsg();\r\n        }\r\n    }\r\n    sendMsg() {\r\n        let msg = new proto.Msg_SweepExploreStageReq();\r\n        msg.stageId = GameplayViewDataMgr.ins.getCurSweepStageId(this.view_type);\r\n        Net.Send(proto.Ptl.SweepExploreStageReq, msg)\r\n    }\r\n    // 如果是扫荡判断当前的数据 返回是否可以扫荡\r\n    setSweepdata(): boolean {\r\n        var self = this;\r\n        const sweepInfo = this._sweepInfo;\r\n        const needDiamond = this._sweepInfo.diamondData[this.curExportInfo.notFreeSweepTimes];\r\n        let canUse = false;\r\n        if (sweepInfo.freeTimes === 0) {\r\n            // 判断付费次数\r\n            if (sweepInfo.buyTimes === 0) {\r\n                ShowTips(LangMgr.getLab('Tips_timeshortage'));\r\n            } else {\r\n                // 弹窗是否花费一定钻石购买次数\r\n                ConsumptionToPurchase(1, needDiamond, \"Tips_instance_1\", () => {\r\n                    self.sendMsg();\r\n                })\r\n            }\r\n        } else {\r\n            canUse = true;\r\n        }\r\n        return canUse;\r\n    }\r\n}\r\n\r\n\r\n"]}