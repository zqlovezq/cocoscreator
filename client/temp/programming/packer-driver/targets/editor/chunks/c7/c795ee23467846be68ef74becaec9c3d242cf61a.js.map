{"version":3,"sources":["file:///C:/chickenStarClient/client/assets/scripts/logic/model/hero/herobag/HeroMaterialPop.ts"],"names":["_decorator","Color","Label","Node","Prefab","ViewPop","ItemPoolMgr","HeroData","HeroDataControl","HeroItem","EventMgr","LocalEvent","ItemInfo","CommonItem","tab","LangMgr","CommonTipsPop","checkSameDay","RecruitType","ccclass","property","HeroMaterialPop","_heroList","_selectCount","_needCount","_needStar","register","onShow","node_content","destroyAllChildren","mainHeroInfo","ins","getById","heroId","HeroMap","getHerosByType","openData","type","stepId","getHerosMaterialMap","node_empty","active","map","size","node_select","getHerosMaterialMapCount","needCount","vocationArr","AnyArr","heroArr","forEach","value","key","commonTab","getData","HeroCommonCostTableById","getValue","HeroClass","HeroClass_Any","push","itemId","star","count","id","length","sort","id1","id2","heroInfo1","heroInfo2","heroTab1","heroTable","heroTab2","itemTab1","itemTable","itemTab2","Aptitude","Sort","totalArr","concat","i","data","createCommonItem","createHeroItem","refreshLbl","lbl_choice_num","string","String","lbl_total_num","color","fromHEX","GetKeyValue_ConfigTable","InterfaceTxtRed","onDestroy","self","heroInfo","isSelect","Boolean","getHerosMaterialById","item","ts","getComponent","UpdateContent","setSelect","setTouchCallBack","select","getSelect","cb","obj","emitLocal","Hero_Material_Select","ChoiceSSR","HeroAptitude","HeroAptitude_SSR","tipsStr","getLab","create","val","gacha","num","createItem","setSelectState","setStar","canclePop","setHerosMaterialMap","onClose"],"mappings":"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","sourcesContent":["import { _decorator, Color, Component, Label, log, Node, Prefab } from 'cc';\r\nimport { ViewPop } from '../../../../framework/base/ViewPop';\r\nimport { ItemPoolMgr } from '../../item/ItemPoolMgr';\r\nimport { HeroInfo } from '../HeroInfo';\r\nimport { HeroData } from '../HeroData';\r\nimport { HeroDataControl } from './HeroDataControl';\r\nimport { HeroItem } from '../../item/HeroItem';\r\nimport { EventMgr } from '../../../mgr/EventMgr';\r\nimport { LocalEvent } from '../../../define/LocalEvent';\r\nimport { HeroTeamControl } from '../HeroTeamControl';\r\nimport { ItemInfo } from '../../item/ItemInfo';\r\nimport { CommonItem } from '../../item/CommonItem';\r\nimport { tab } from '../../../../Table/table_gen';\r\nimport { LangMgr } from '../../../mgr/LangMgr';\r\nimport { CommonTipsPop } from '../../common/CommonTipsPop';\r\nimport { checkSameDay } from '../../../utils/GameUtil';\r\nimport { RecruitType } from '../../../../Common/script/EnumTypeMgr';\r\nconst { ccclass, property } = _decorator;\r\n\r\n@ccclass('HeroMaterialPop')\r\nexport class HeroMaterialPop extends ViewPop {\r\n    @property(Prefab)\r\n    pfb_hero_item: Prefab = null;\r\n    @property(Prefab)\r\n    pfb_common_item: Prefab = null;\r\n\r\n    @property(Node)\r\n    node_content: Node = null;\r\n    @property(Node)\r\n    node_empty: Node = null;\r\n    @property(Node)\r\n    node_select: Node = null;\r\n\r\n    @property(Label)\r\n    lbl_choice_num: Label = null;\r\n    @property(Label)\r\n    lbl_total_num: Label = null;\r\n    private _heroList: HeroInfo[] = [];\r\n    private _selectCount: number = 0;\r\n    private _needCount: number = 0;\r\n    private _needStar: number = 0;\r\n    register(): void {\r\n\r\n    }\r\n    onShow(): void {\r\n        this.node_content.destroyAllChildren();\r\n        let mainHeroInfo = HeroData.ins.getById(HeroDataControl.ins.heroId);\r\n        this.node_content.destroyAllChildren();\r\n        let HeroMap = mainHeroInfo.getHerosByType(this.openData.type, this.openData.stepId, mainHeroInfo.getHerosMaterialMap());\r\n        this.node_empty.active = HeroMap.map.size === 0;\r\n        this.node_select.active = HeroMap.map.size >0;\r\n        this._selectCount = mainHeroInfo.getHerosMaterialMapCount(this.openData.type);\r\n        this._needCount = HeroMap.needCount;\r\n\r\n        const vocationArr = [];\r\n        const AnyArr = [];\r\n        const heroArr = [];\r\n        HeroMap.map.forEach((value,key)=>{\r\n            const commonTab = tab.getData().HeroCommonCostTableById.getValue(key-value);\r\n            if(commonTab){\r\n                if(commonTab.HeroClass===tab.HeroClass.HeroClass_Any){\r\n                    AnyArr.push({\r\n                        itemId:key,\r\n                        star:HeroMap.star,\r\n                        count:value,\r\n                    })\r\n                }else{\r\n                    vocationArr.push({\r\n                        itemId:key,\r\n                        star:HeroMap.star,\r\n                        count:value,\r\n                    })\r\n                }\r\n            }else{\r\n                heroArr.push(value.id);\r\n            }\r\n        })\r\n        if(heroArr.length>0){\r\n            heroArr.sort((id1,id2)=>{\r\n                const heroInfo1 = HeroData.ins.getById(id1);\r\n                const heroInfo2 = HeroData.ins.getById(id2);\r\n                const heroTab1 = heroInfo1.heroTable;\r\n                const heroTab2 = heroInfo2.heroTable;\r\n                const itemTab1 = heroInfo1.itemTable;\r\n                const itemTab2 = heroInfo2.itemTable;\r\n                if(heroTab1.Aptitude!=heroTab2.Aptitude){\r\n                    return heroTab1.Aptitude-heroTab2.Aptitude;\r\n                }else{\r\n                    return itemTab1.Sort-itemTab2.Sort;\r\n                }\r\n            })\r\n        }\r\n        const totalArr = vocationArr.concat(AnyArr.concat(heroArr));\r\n        for(let i=0;i<totalArr.length;i++){\r\n            const data = totalArr[i];\r\n            if(typeof data===\"object\"){\r\n                this.createCommonItem(data.itemId, data.star, data.count);\r\n            }else{\r\n                this.createHeroItem(data);\r\n            }\r\n        }\r\n        // totalArr.forEach((value, key) => {\r\n        //     if (typeof value == \"object\") {\r\n        //         this.createHeroItem(value.id);\r\n        //     } else {\r\n        //         this.createCommonItem(key, HeroMap.star, value);\r\n        //     }\r\n        // });\r\n        this.refreshLbl();\r\n    }\r\n    refreshLbl() {\r\n        this.lbl_choice_num.string = String(this._selectCount);\r\n        this.lbl_total_num.string = String(this._needCount);\r\n        if (this._selectCount >= this._needCount) {\r\n            this.lbl_choice_num.color = new Color().fromHEX(\"#455183\");\r\n        } else {\r\n            this.lbl_choice_num.color = new Color().fromHEX(tab.getData().GetKeyValue_ConfigTable().InterfaceTxtRed);\r\n        }\r\n    }\r\n    onDestroy(): void {\r\n        super.onDestroy();\r\n    }\r\n    createHeroItem(id: number) {\r\n        var self = this;\r\n        const type = this.openData.type\r\n        let heroInfo = HeroData.ins.getById(id);\r\n        let mainHeroInfo = HeroData.ins.getById(HeroDataControl.ins.heroId);\r\n        let isSelect = Boolean(mainHeroInfo.getHerosMaterialById(id));\r\n        let item = null;\r\n        if (heroInfo) {\r\n            item = ItemPoolMgr.ins.createHeroItem(heroInfo, this.node_content);\r\n        }\r\n        if (item) {\r\n            let ts = item.getComponent(HeroItem)\r\n            ts.UpdateContent(heroInfo);\r\n            ts.setSelect(isSelect);\r\n            ts.setTouchCallBack(() => {\r\n                /* 如果当前的item在别的type中已经存在 则返回 */\r\n                let select = ts.getSelect();\r\n                let cb = function(){\r\n                    let obj = mainHeroInfo.getHerosMaterialById(id);\r\n                    if (obj && obj.type !== type) {\r\n                        return\r\n                    }\r\n                    if (!select) {\r\n                        self._selectCount++;\r\n                    } else {\r\n                        self._selectCount--;\r\n                    }\r\n                    if (self._selectCount > self._needCount) {\r\n                        self._selectCount--;\r\n                        return;\r\n                    }\r\n                    ts.setSelect(!select);\r\n                    self.refreshLbl();\r\n                    EventMgr.emitLocal(LocalEvent.Hero_Material_Select, [ts.getSelect(), id, type]);\r\n                }\r\n                if(select){\r\n                    cb()\r\n                    return;\r\n                }\r\n                if(!checkSameDay(RecruitType.ChoiceSSR)&&heroInfo.heroTable.Aptitude===tab.HeroAptitude.HeroAptitude_SSR&&self._selectCount<self._needCount){\r\n                    const tipsStr = LangMgr.getLab(\"Tips_risingstar_1\");\r\n                    CommonTipsPop.create(tipsStr, ((val) => {\r\n                        if (val) {\r\n                            cb();\r\n                        }\r\n                    }), {\r\n                        gacha: RecruitType.ChoiceSSR\r\n                    })\r\n                }else{\r\n                    cb();\r\n                }\r\n            })\r\n        }\r\n    }\r\n    createCommonItem(itemId: number, star: number, count: number) {\r\n        const type = this.openData.type\r\n        let mainHeroInfo = HeroData.ins.getById(HeroDataControl.ins.heroId);\r\n        let isSelect = Boolean(mainHeroInfo.getHerosMaterialById(itemId));\r\n        let data = new ItemInfo();\r\n        data.itemId = itemId - count;\r\n        data.num = 1\r\n        let item = ItemPoolMgr.ins.createItem(data,this.node_content);\r\n        let ts = item.getComponent(CommonItem)\r\n        ts.setSelectState(isSelect);\r\n        ts.setStar(star);\r\n        ts.setTouchCallBack(() => {\r\n            /* 如果当前的item在别的type中已经存在 则返回 */\r\n            let obj = mainHeroInfo.getHerosMaterialById(itemId);\r\n            if (obj && obj.type !== type) {\r\n                return\r\n            }\r\n            let select = ts.getSelect();\r\n            if (!select) {\r\n                this._selectCount++;\r\n            } else {\r\n                this._selectCount--;\r\n            }\r\n            if (this._selectCount > this._needCount) {\r\n                this._selectCount--;\r\n                return;\r\n            }\r\n            ts.setSelectState(!select);\r\n            this.refreshLbl();\r\n            EventMgr.emitLocal(LocalEvent.Hero_Material_Select, [ts.getSelect(), itemId, type,data.itemId]);\r\n        })\r\n    }\r\n    canclePop(){\r\n        let mainHeroInfo = HeroData.ins.getById(HeroDataControl.ins.heroId);\r\n        mainHeroInfo.setHerosMaterialMap(this.openData.stepId);\r\n        EventMgr.emitLocal(LocalEvent.Hero_Material_Select);\r\n        this.onClose();\r\n    }\r\n}\r\n\r\n\r\n"]}