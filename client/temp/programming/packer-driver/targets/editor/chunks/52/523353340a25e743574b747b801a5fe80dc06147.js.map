{"version":3,"sources":["file:///C:/chickenStarClient/client/assets/scripts/logic/model/association/AssociationRankPop.ts"],"names":["_decorator","instantiate","Node","Prefab","ViewPop","proto","AssociationData","AssociationRankBottomItem","AssociationRankTopItem","InfiniteList","RoleData","ccclass","property","AssociationRankPop","bossGuildRank","bossRoleRank","view_type","rank_list","top_list","onShow","ins","getRoleRank","getGuildRank","switchView","String","e","type","Number","rankList","i","length","push","initStaticView","createTopItem","parentNode","node_top_items","children","item","pfb_rank_top_item","parent","itemTs","getComponent","initData","onDestroy","register","unRegister","canInit","list_view","stopAutoScroll","node","active","Init","getCellNumber","getCellCount","bind","getCellSize","getCellHeight","getCellIdentifer","getCellView","getCellData","GetCellData","createMyRank","idx","identifer","pfb_rank_item","rankData","index","roleData","getMyData","setMyRank","data","ranking","createDataByRankId","allRank","concat","simple","id","guild","getAssocitionSimpleInfo","rankLevel","node_my_rank_item","UpdateContent","isSelf","setPlayerMyRank","SimpleRank","score","SimpleRole","level","name","powerScore","headIcon","avatarInfo","headFrame","GuildBossRank","members","getAssocitionInfo"],"mappings":"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","sourcesContent":["import { _decorator, Component, EventTouch, instantiate, Node, Prefab } from 'cc';\r\nimport { ViewPop } from '../../../framework/base/ViewPop';\r\nimport { proto } from 'client_protocol';\r\nimport { AssociationData } from './AssociationData';\r\nimport { AssociationRankBottomItem } from './AssociationRankBottomItem';\r\nimport { AssociationRankTopItem } from './AssociationRankTopItem';\r\nimport InfiniteList from '../../../Common/InfiniteList/InfiniteList';\r\nimport { RoleData } from '../role/RoleData';\r\nconst { ccclass, property } = _decorator;\r\n\r\n@ccclass('AssociationRankPop')\r\nexport class AssociationRankPop extends ViewPop {\r\n    @property(InfiniteList)\r\n    list_view: InfiniteList = null;\r\n    @property(Node)\r\n    node_top_items: Node = null;\r\n    @property(Prefab)\r\n    pfb_rank_top_item: Prefab = null;\r\n    @property(Prefab)\r\n    pfb_rank_item: Prefab = null;\r\n    @property(AssociationRankBottomItem)\r\n    node_my_rank_item: AssociationRankBottomItem = null;\r\n    private bossGuildRank: proto.IGuildBossRank[] = []//公会排行榜\r\n    private bossRoleRank: proto.ISimpleRank[] = []//公会个人排行榜\r\n    private view_type: number = 0;//1:个人排行 2：公会排行\r\n    private rank_list = [];\r\n    private top_list = [];\r\n    onShow(): void {\r\n        this.view_type = 1;\r\n        this.bossRoleRank = AssociationData.ins.getRoleRank();\r\n        this.bossGuildRank = AssociationData.ins.getGuildRank();\r\n        this.switchView(null, String(this.view_type));\r\n    }\r\n    // 根据view_type刷新数据\r\n    switchView(e: EventTouch, type: string) {\r\n        if(e&&Number(type)===this.view_type){\r\n            return\r\n        }\r\n        this.view_type = Number(type);\r\n        this.rank_list = [];\r\n        this.top_list = [];\r\n        const rankList = Number(type) === 1 ? this.bossRoleRank : this.bossGuildRank;\r\n        for (let i = 0; i < rankList.length; i++) {\r\n            if (i < 3) {\r\n                this.top_list.push(rankList[i])\r\n            } else {\r\n                this.rank_list.push(rankList[i])\r\n            }\r\n        }\r\n        this.initStaticView();\r\n        this.createTopItem();\r\n    }\r\n    /* 创建前三的数据 */\r\n    createTopItem() {\r\n        for (let i = 0; i < 3; i++) {\r\n            const parentNode = this.node_top_items.children[i];\r\n            let item = null;\r\n            if (!parentNode.children[0]) {\r\n                item = instantiate(this.pfb_rank_top_item);\r\n                item.parent = parentNode;\r\n            } else {\r\n                item = parentNode.children[0]\r\n            }\r\n            const itemTs: AssociationRankTopItem = item.getComponent(AssociationRankTopItem);\r\n            itemTs.initData(this.top_list[i], this.view_type)\r\n        }\r\n    }\r\n    protected onDestroy(): void {\r\n        super.onDestroy();\r\n    }\r\n    register(): void {\r\n\r\n    }\r\n    unRegister(): void {\r\n        super.unRegister();\r\n    }\r\n    initStaticView() {\r\n        let canInit = this.rank_list.length > 0;\r\n        this.list_view.stopAutoScroll();\r\n        if (canInit) {\r\n            this.list_view.node.parent.active = true;\r\n            this.list_view.Init({\r\n                getCellNumber: this.getCellCount.bind(this),\r\n                getCellSize: this.getCellHeight.bind(this),\r\n                getCellIdentifer: this.getCellIdentifer.bind(this),\r\n                getCellView: this.getCellView.bind(this),\r\n                getCellData: this.GetCellData.bind(this),\r\n            });\r\n        } else {\r\n            this.list_view.node.parent.active = false;\r\n        }\r\n        this.createMyRank();\r\n    }\r\n    getCellCount() {\r\n        return this.rank_list.length;\r\n    }\r\n    getCellHeight(idx: number) {\r\n        return 82;\r\n    }\r\n    getCellIdentifer(idx: number) {\r\n        return \"RankBottomItem\"\r\n    }\r\n    getCellView(idx: number, identifer: string) {\r\n        return instantiate(this.pfb_rank_item).getComponent(AssociationRankBottomItem);\r\n    }\r\n    GetCellData(idx: number) {\r\n        return { rankData: this.rank_list[idx], index: idx, view_type: this.view_type };\r\n    }\r\n    createMyRank() {\r\n        const roleData = this.getMyData();\r\n        if(roleData){\r\n            this.setMyRank(roleData.data, roleData.ranking)\r\n        }else{\r\n            const rankData = this.createDataByRankId()\r\n            this.setMyRank(rankData, -1)\r\n        }\r\n    }\r\n    // 获取当前自己的数据\r\n    getMyData(){\r\n        let allRank = this.top_list.concat(this.rank_list);\r\n        if(this.view_type===1){\r\n            for(let i=0;i<allRank.length;i++){\r\n                const roleData: proto.ISimpleRank = allRank[i];\r\n                if(roleData.simple.id===RoleData.ins.id){\r\n                    return {data:roleData,ranking:i}\r\n                }\r\n            }\r\n        }else if(this.view_type===2){\r\n            for(let i=0;i<allRank.length;i++){\r\n                const roleData: proto.IGuildBossRank = allRank[i];\r\n                if(roleData.guild.simple.id===AssociationData.ins.getAssocitionSimpleInfo().id){\r\n                    return {data:roleData,ranking:i}\r\n                }\r\n            }\r\n        }\r\n    }\r\n    setMyRank(rankData: proto.ISimpleRank | proto.IGuildBossRank,rankLevel: number) {\r\n        this.node_my_rank_item.UpdateContent({ rankData: rankData, index: rankLevel + 1, view_type: this.view_type, isSelf: true })\r\n        this.node_my_rank_item.setPlayerMyRank(rankLevel + 1);\r\n    }\r\n    createDataByRankId() {\r\n        let data = null;\r\n        switch (this.view_type) {\r\n            case 1:\r\n                data = new proto.SimpleRank();\r\n                data.score = 0;\r\n                data.simple = new proto.SimpleRole();\r\n                data.simple.id = RoleData.ins.id;\r\n                data.simple.level = RoleData.ins.level;\r\n                data.simple.name = RoleData.ins.name;\r\n                data.simple.powerScore = RoleData.ins.powerScore;\r\n                data.simple.headIcon = RoleData.ins.avatarInfo.headIcon;\r\n                data.simple.headFrame = RoleData.ins.avatarInfo.headFrame;\r\n                break;\r\n            case 2:\r\n                data = new proto.GuildBossRank();\r\n                data.score = 0;\r\n                data.members = 0;\r\n                data.guild = AssociationData.ins.getAssocitionInfo()\r\n                break;\r\n            default:\r\n                break;\r\n        }\r\n        return data;\r\n    }\r\n}\r\n\r\n\r\n"]}