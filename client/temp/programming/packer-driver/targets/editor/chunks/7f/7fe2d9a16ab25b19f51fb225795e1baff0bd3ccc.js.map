{"version":3,"sources":["file:///C:/chickenStarClient/client/assets/scripts/logic/fight/result/FightLosePop.ts"],"names":["_decorator","Label","Node","ViewPop","BattleMainDataControl","tab","LangMgr","DamageStatisticsData","ItemInfo","ItemPoolMgr","CommonItem","FightRootControl","setTextTime_3","WaveTimeControl","RoleData","UIMgr","ViewName","stepBranchGuide","FightData","FincaFightData","ccclass","property","FightLosePop","awards","onLoad","ins","isPvp","curClearStageId","lbl_skill_count","node","parent","active","great_node","damage_Node","register","unRegister","onShow","openData","i","length","award","createCommonItem","pveTab","getData","PveStageTableByStageId","getValue","stageId","lbl_name","string","getLab","StageName","String","totalKill","StageType","PveStageType","PveStageType_MainChapter","lbl_max_alive_second","getCurMaxAliveSecond","nowTotalTime","lbl_alive_second","PveStageType_PVPBattle","fincaFight_result","getCombineString","getChangeScoreStr","fincaBattleFightRsp","newScore","getStageClearIds","setClientData","onDestroy","data","info","itemId","num","itemItem","createItem","node_content","itemTs","getComponent","setTouchCallBack","clickGoHomeBtn","pvpEnd","enterMain","clickDamageDetail","event","show","viewName","FightDamageRankPop"],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAASA,MAAAA,U,OAAAA,U;AAAuBC,MAAAA,K,OAAAA,K;AAAOC,MAAAA,I,OAAAA,I;;AAC9BC,MAAAA,O,iBAAAA,O;;AAEAC,MAAAA,qB,iBAAAA,qB;;AACAC,MAAAA,G,iBAAAA,G;;AACAC,MAAAA,O,iBAAAA,O;;AACAC,MAAAA,oB,iBAAAA,oB;;AACAC,MAAAA,Q,iBAAAA,Q;;AACAC,MAAAA,W,iBAAAA,W;;AACAC,MAAAA,U,iBAAAA,U;;AACAC,MAAAA,gB,kBAAAA,gB;;AACAC,MAAAA,a,kBAAAA,a;;AACAC,MAAAA,e,kBAAAA,e;;AACAC,MAAAA,Q,kBAAAA,Q;;AACAC,MAAAA,K,kBAAAA,K;;AACAC,MAAAA,Q,kBAAAA,Q;;AAEAC,MAAAA,e,kBAAAA,e;;AACAC,MAAAA,S,kBAAAA,S;;AAEAC,MAAAA,c,kBAAAA,c;;;;;;;;;OACH;AAAEC,QAAAA,OAAF;AAAWC,QAAAA;AAAX,O,GAAwBrB,U;;8BAGjBsB,Y,WADZF,OAAO,CAAC,cAAD,C,UAEHC,QAAQ,CAACnB,IAAD,C,UAERmB,QAAQ,CAACpB,KAAD,C,UAERoB,QAAQ,CAACpB,KAAD,C,UAERoB,QAAQ,CAACpB,KAAD,C,UAERoB,QAAQ,CAACpB,KAAD,C,UAERoB,QAAQ,CAACnB,IAAD,C,UAERmB,QAAQ,CAACnB,IAAD,C,UAERmB,QAAQ,CAACpB,KAAD,C,2BAhBb,MACaqB,YADb;AAAA;AAAA,8BAC0C;AAAA;AAAA;;AAAA;;AAAA;;AAAA;;AAAA;;AAAA;;AAAA;;AAAA;;AAAA;;AAAA,eAkB9BC,MAlB8B,GAkBP,EAlBO;AAAA;;AAmB5BC,QAAAA,MAAM,GAAS;AACrB,gBAAMA,MAAN;;AACA,cAAI;AAAA;AAAA,sCAAUC,GAAV,CAAcC,KAAlB,EAAyB;AACrB;AAAA;AAAA,sCAASD,GAAT,CAAaE,eAAb,GAA+B,KAA/B;AACA,iBAAKC,eAAL,CAAqBC,IAArB,CAA0BC,MAA1B,CAAiCC,MAAjC,GAA0C,KAA1C;AACA,iBAAKC,UAAL,CAAgBD,MAAhB,GAAyB,KAAzB;AACA,iBAAKE,WAAL,CAAiBF,MAAjB,GAA0B,KAA1B;AACH;AACJ;;AAEDG,QAAAA,QAAQ,GAAS,CAEhB;;AACDC,QAAAA,UAAU,GAAS;AACf,gBAAMA,UAAN;AACH;;AACDC,QAAAA,MAAM,GAAS;AACX;AACA,eAAKb,MAAL,GAAc,KAAKc,QAAnB;;AACA,eAAK,IAAIC,CAAC,GAAG,CAAb,EAAgBA,CAAC,GAAG,KAAKf,MAAL,CAAYgB,MAAhC,EAAwCD,CAAC,EAAzC,EAA6C;AACzC,kBAAME,KAAiB,GAAG,KAAKjB,MAAL,CAAYe,CAAZ,CAA1B;AACA,iBAAKG,gBAAL,CAAsBD,KAAtB;AACH,WANU,CAOX;AACA;;;AACA,gBAAME,MAAM,GAAG;AAAA;AAAA,0BAAIC,OAAJ,GAAcC,sBAAd,CAAqCC,QAArC,CAA8C;AAAA;AAAA,sCAAUpB,GAAV,CAAcqB,OAA5D,CAAf;AACA,eAAKC,QAAL,CAAcC,MAAd,GAAuB;AAAA;AAAA,kCAAQC,MAAR,CAAeP,MAAM,CAACQ,SAAtB,CAAvB,CAVW,CAWX;;AACA,eAAKtB,eAAL,CAAqBoB,MAArB,GAA8BG,MAAM,CAAC;AAAA;AAAA,4DAAqB1B,GAArB,CAAyB2B,SAA1B,CAApC,CAZW,CAaX;;AACA,cAAIV,MAAM,CAACW,SAAP,KAAqB;AAAA;AAAA,0BAAIC,YAAJ,CAAiBC,wBAA1C,EAAoE;AAChE,iBAAKC,oBAAL,CAA0BR,MAA1B,GAAmC;AAAA;AAAA,gDAAc;AAAA;AAAA,gEAAsBvB,GAAtB,CAA0BgC,oBAA1B,CAA+C;AAAA;AAAA,sCAAShC,GAAT,CAAaE,eAA5D,CAAd,CAAnC;AACH,WAFD,MAEO;AACH,iBAAK6B,oBAAL,CAA0BR,MAA1B,GAAmC;AAAA;AAAA,gDAAc;AAAA;AAAA,oDAAgBvB,GAAhB,CAAoBiC,YAAlC,CAAnC;AACH,WAlBU,CAmBX;;;AACA,eAAKC,gBAAL,CAAsBX,MAAtB,GAA+B;AAAA;AAAA,8CAAc;AAAA;AAAA,kDAAgBvB,GAAhB,CAAoBiC,YAAlC,CAA/B;;AACA,cAAIhB,MAAM,CAACW,SAAP,KAAqB;AAAA;AAAA,0BAAIC,YAAJ,CAAiBM,sBAA1C,EAAkE;AAC9D,iBAAKD,gBAAL,CAAsBX,MAAtB,GAA+B,EAA/B,CAD8D,CAC5B;;AAClC,iBAAKa,iBAAL,CAAuBhC,IAAvB,CAA4BE,MAA5B,GAAqC,IAArC;AACA,iBAAK8B,iBAAL,CAAuBb,MAAvB,GAAgC;AAAA;AAAA,oCAAQc,gBAAR,CAAyB,kBAAzB,EAA6C,CAAC;AAAA;AAAA,kDAAerC,GAAf,CAAmBsC,iBAAnB,CAAqC;AAAA;AAAA,wCAAUtC,GAAV,CAAcuC,mBAAd,CAAkCC,QAAvE,CAAD,CAA7C,CAAhC;AACH,WAzBU,CA2BX;;;AACA,cAAI;AAAA;AAAA,8DAAsBxC,GAAtB,CAA0ByC,gBAA1B,GAA6C3B,MAA7C,KAAwD,CAAxD,IAA6D;AAAA;AAAA,oCAASd,GAAT,CAAaE,eAAb,KAAiC,GAAlG,EAAuG;AACnG;AAAA;AAAA,sCAASF,GAAT,CAAa0C,aAAb,CAA2B,YAA3B,EAAyChB,MAAM,CAAC,GAAD,CAA/C;AACA;AAAA;AAAA,oDAAgB,GAAhB;AACH;AAEJ;;AACSiB,QAAAA,SAAS,GAAS;AACxB,gBAAMA,SAAN;AACH;;AACD3B,QAAAA,gBAAgB,CAAC4B,IAAD,EAAmB;AAC/B,gBAAMC,IAAI,GAAG;AAAA;AAAA,qCAAb;AACAA,UAAAA,IAAI,CAACC,MAAL,GAAcF,IAAI,CAACE,MAAnB;AACAD,UAAAA,IAAI,CAACE,GAAL,GAAWH,IAAI,CAACG,GAAhB;AACA,gBAAMC,QAAQ,GAAG;AAAA;AAAA,0CAAYhD,GAAZ,CAAgBiD,UAAhB,CAA2BJ,IAA3B,EAAiC,KAAKK,YAAtC,CAAjB;AACA,gBAAMC,MAAM,GAAGH,QAAQ,CAACI,YAAT;AAAA;AAAA,uCAAf;AACAD,UAAAA,MAAM,CAACE,gBAAP,CAAwB,MAAM,CAE7B,CAFD;AAGH,SAjFqC,CAkFtC;;;AACAC,QAAAA,cAAc,GAAG;AACb,cAAI;AAAA;AAAA,sCAAUtD,GAAV,CAAcC,KAAlB,EAAyB;AACrB;AAAA;AAAA,sDAAiBD,GAAjB,CAAqBuD,MAArB;AACA;AACH;;AACD;AAAA;AAAA,oDAAiBvD,GAAjB,CAAqBwD,SAArB;AACH,SAzFqC,CA2FtC;;;AACAC,QAAAA,iBAAiB,CAACC,KAAD,EAAoB;AACjC;AAAA;AAAA,8BAAM1D,GAAN,CAAU2D,IAAV,CAAe;AAAEC,YAAAA,QAAQ,EAAE;AAAA;AAAA,sCAASC,kBAArB;AAAyCjB,YAAAA,IAAI,EAAE;AAAEc,cAAAA,KAAK,EAAEA;AAAT;AAA/C,WAAf;AACH;;AA9FqC,O;;;;;iBAEjB,I;;;;;;;iBAEH,I;;;;;;;iBAEO,I;;;;;;;iBAEK,I;;;;;;;iBAEJ,I;;;;;;;iBAEN,I;;;;;;;iBAED,I;;;;;;;iBAEQ,I","sourcesContent":["import { _decorator, Component, Label, Node, EventTouch } from 'cc';\r\nimport { ViewPop } from '../../../framework/base/ViewPop';\r\nimport { proto } from 'client_protocol';\r\nimport { BattleMainDataControl } from '../../model/home/battle/BattleMainDataControl';\r\nimport { tab } from '../../../Table/table_gen';\r\nimport { LangMgr } from '../../mgr/LangMgr';\r\nimport { DamageStatisticsData } from '../base/damage/DamageStatisticsData';\r\nimport { ItemInfo } from '../../model/item/ItemInfo';\r\nimport { ItemPoolMgr } from '../../model/item/ItemPoolMgr';\r\nimport { CommonItem } from '../../model/item/CommonItem';\r\nimport { FightRootControl } from '../FightRootControl';\r\nimport { setTextTime_3 } from '../../utils/GameUtil';\r\nimport { WaveTimeControl } from '../wave/WaveTimeControl';\r\nimport { RoleData } from '../../model/role/RoleData';\r\nimport { UIMgr } from '../../mgr/UIMgr';\r\nimport { ViewName } from '../../define/ViewDefine';\r\nimport { Net } from '../../net/Net';\r\nimport { stepBranchGuide } from '../../guide/GuideTask';\r\nimport { FightData } from '../data/FightData';\r\nimport { PvpControl } from '../pvp/PvpControl';\r\nimport { FincaFightData } from '../../model/fincaFight/FincaFightData';\r\nconst { ccclass, property } = _decorator;\r\n\r\n@ccclass('FightLosePop')\r\nexport class FightLosePop extends ViewPop {\r\n    @property(Node)\r\n    node_content: Node = null;\r\n    @property(Label)\r\n    lbl_name: Label = null;\r\n    @property(Label)\r\n    lbl_skill_count: Label = null;\r\n    @property(Label)\r\n    lbl_max_alive_second: Label = null;\r\n    @property(Label)\r\n    lbl_alive_second: Label = null;\r\n    @property(Node)\r\n    damage_Node: Node = null\r\n    @property(Node)\r\n    great_node: Node = null\r\n    @property(Label)\r\n    fincaFight_result: Label = null;\r\n\r\n    private awards: proto.Item[] = [];\r\n    protected onLoad(): void {\r\n        super.onLoad()\r\n        if (FightData.ins.isPvp) {\r\n            RoleData.ins.curClearStageId = 60001;\r\n            this.lbl_skill_count.node.parent.active = false\r\n            this.great_node.active = false\r\n            this.damage_Node.active = false\r\n        }\r\n    }\r\n\r\n    register(): void {\r\n\r\n    }\r\n    unRegister(): void {\r\n        super.unRegister()\r\n    }\r\n    onShow(): void {\r\n        // 创建奖励\r\n        this.awards = this.openData;\r\n        for (let i = 0; i < this.awards.length; i++) {\r\n            const award: proto.Item = this.awards[i];\r\n            this.createCommonItem(award);\r\n        }\r\n        // 设置关卡名称\r\n        // this.lbl_name.string = LangMgr.getLab(chapterData.Name);\r\n        const pveTab = tab.getData().PveStageTableByStageId.getValue(FightData.ins.stageId);\r\n        this.lbl_name.string = LangMgr.getLab(pveTab.StageName);\r\n        // 击杀怪物数量\r\n        this.lbl_skill_count.string = String(DamageStatisticsData.ins.totalKill);\r\n        // 最大存活时间\r\n        if (pveTab.StageType === tab.PveStageType.PveStageType_MainChapter) {\r\n            this.lbl_max_alive_second.string = setTextTime_3(BattleMainDataControl.ins.getCurMaxAliveSecond(RoleData.ins.curClearStageId));\r\n        } else {\r\n            this.lbl_max_alive_second.string = setTextTime_3(WaveTimeControl.ins.nowTotalTime);\r\n        }\r\n        // 当前的时间\r\n        this.lbl_alive_second.string = setTextTime_3(WaveTimeControl.ins.nowTotalTime);\r\n        if (pveTab.StageType === tab.PveStageType.PveStageType_PVPBattle) {\r\n            this.lbl_alive_second.string = \"\" //setTextTime_3(Math.floor(PvpControl.ins.time/1000));\r\n            this.fincaFight_result.node.active = true\r\n            this.fincaFight_result.string = LangMgr.getCombineString(\"ui_fincafight_13\", [FincaFightData.ins.getChangeScoreStr(FightData.ins.fincaBattleFightRsp.newScore)])\r\n        }\r\n\r\n        // 如果当前处于新手引导阶段\r\n        if (BattleMainDataControl.ins.getStageClearIds().length === 0 && RoleData.ins.curClearStageId === 101) {\r\n            RoleData.ins.setClientData(\"guideTrunk\", String(200));\r\n            stepBranchGuide(301);\r\n        }\r\n\r\n    }\r\n    protected onDestroy(): void {\r\n        super.onDestroy()\r\n    }\r\n    createCommonItem(data: proto.Item) {\r\n        const info = new ItemInfo();\r\n        info.itemId = data.itemId;\r\n        info.num = data.num;\r\n        const itemItem = ItemPoolMgr.ins.createItem(info, this.node_content);\r\n        const itemTs = itemItem.getComponent(CommonItem);\r\n        itemTs.setTouchCallBack(() => {\r\n\r\n        })\r\n    }\r\n    // 点击确定返回主页\r\n    clickGoHomeBtn() {\r\n        if (FightData.ins.isPvp) {\r\n            FightRootControl.ins.pvpEnd()\r\n            return\r\n        }\r\n        FightRootControl.ins.enterMain();\r\n    }\r\n\r\n    // 点击战斗伤害详情\r\n    clickDamageDetail(event: EventTouch) {\r\n        UIMgr.ins.show({ viewName: ViewName.FightDamageRankPop, data: { event: event } })\r\n    }\r\n\r\n}\r\n\r\n\r\n"]}