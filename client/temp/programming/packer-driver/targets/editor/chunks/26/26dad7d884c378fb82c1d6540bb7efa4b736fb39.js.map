{"version":3,"sources":["file:///C:/chickenStarClient/client/assets/scripts/logic/model/jianghu/dailyExplore/InstanceRewardPopItem.ts"],"names":["_decorator","Label","Node","tab","proto","AWARD_STATE","JIANGHU_TYPE","UIMgr","ViewName","Net","ItemInfo","ItemPoolMgr","LangMgr","GameplayViewDataMgr","InfiniteCell","ccclass","property","InstanceRewardPopItem","_state","NONE","_tabData","view_type","UpdateContent","data","view","exportData","node","name","String","StageId","receivedFirstRewardStageIds","indexOf","GOT","ins","getCurSweepStageId","curFightStageId","GO","LOCK","RECEIVE","pveStageTab","getData","PveStageTableByStageId","getValue","lbl_stage_id","string","getCombineString","getLab","StageName","setAwardState","showAwardItem","node_layout","destroyAllChildren","i","ClearRewardItemIds","length","itemId","itemCount","ClearRewardItemNum","itemInfo","num","createItem","state","node_lock","active","node_go","node_receive","node_got","goStage","GoldStage","FeedStage","hideView","InstanceRewardPop","show","viewName","InstanceZonesView","getAward","msg","Msg_ReceiveExploreStageFirstRewardReq","stageId","Send","Ptl","ReceiveExploreStageFirstRewardReq"],"mappings":"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","sourcesContent":["import { _decorator, Component, Label, Node } from 'cc';\r\nimport { tab } from '../../../../Table/table_gen';\r\nimport { proto } from 'client_protocol';\r\nimport { AWARD_STATE, JIANGHU_TYPE } from '../../../../Common/script/EnumTypeMgr';\r\nimport { UIMgr } from '../../../mgr/UIMgr';\r\nimport { ViewName } from '../../../define/ViewDefine';\r\nimport { Net } from '../../../net/Net';\r\nimport { ItemInfo } from '../../item/ItemInfo';\r\nimport { ItemPoolMgr } from '../../item/ItemPoolMgr';\r\nimport { LangMgr } from '../../../mgr/LangMgr';\r\nimport { GameplayViewDataMgr } from '../GameplayViewDataMgr';\r\nimport InfiniteCell from '../../../../Common/InfiniteList/InfiniteCell';\r\nimport { PowerDifficultyTag } from '../../home/PowerDifficultyTag';\r\nimport { RoleData } from '../../role/RoleData';\r\nconst { ccclass, property } = _decorator;\r\n\r\n@ccclass('InstanceRewardPopItem')\r\nexport class InstanceRewardPopItem extends InfiniteCell {\r\n    @property(Node)\r\n    node_lock: Node = null;\r\n    @property(Node)\r\n    node_go: Node = null;\r\n    @property(Node)\r\n    node_receive: Node = null;\r\n    @property(Node)\r\n    node_got: Node = null;\r\n    @property(Node)\r\n    node_layout: Node = null;\r\n    @property(Label)\r\n    lbl_stage_id: Label = null;\r\n\r\n    private _state: AWARD_STATE = AWARD_STATE.NONE;\r\n    private _tabData: tab.PveClearStageTable = null;\r\n    private view_type: JIANGHU_TYPE = JIANGHU_TYPE.NONE\r\n    UpdateContent(data: any) {\r\n        this._tabData = data.data;\r\n        this.view_type = data.view;\r\n        const exportData: proto.IExportStageInfo = data.exportData;\r\n        this.node.name = String(this._tabData.StageId);\r\n        if (exportData.receivedFirstRewardStageIds.indexOf(this._tabData.StageId) > -1) {\r\n            this._state = AWARD_STATE.GOT;\r\n        } else {\r\n            if (GameplayViewDataMgr.ins.getCurSweepStageId(this.view_type) < this._tabData.StageId) {\r\n                if (GameplayViewDataMgr.ins.curFightStageId === this._tabData.StageId) {\r\n                    this._state = AWARD_STATE.GO;\r\n                } else {\r\n                    this._state = AWARD_STATE.LOCK;\r\n                }\r\n            } else {\r\n                this._state = AWARD_STATE.RECEIVE;\r\n            }\r\n        }\r\n        // 拿着stageID去pveStageTable找数据\r\n        const pveStageTab = tab.getData().PveStageTableByStageId.getValue(this._tabData.StageId);\r\n        this.lbl_stage_id.string = LangMgr.getCombineString(\"ui_instance_1\", [LangMgr.getLab(pveStageTab.StageName)]);\r\n        this.setAwardState(this._state);\r\n        this.showAwardItem();\r\n\r\n    }\r\n    // 显示奖励\r\n    showAwardItem() {\r\n        this.node_layout.destroyAllChildren();\r\n        for (let i = 0; i < this._tabData.ClearRewardItemIds.length; i++) {\r\n            const itemId = this._tabData.ClearRewardItemIds[i];\r\n            const itemCount = this._tabData.ClearRewardItemNum[i];\r\n            if (itemId) {\r\n                const itemInfo = new ItemInfo();\r\n                itemInfo.itemId = itemId;\r\n                itemInfo.num = itemCount;\r\n                ItemPoolMgr.ins.createItem(itemInfo, this.node_layout);\r\n            }\r\n        }\r\n    }\r\n    setAwardState(state: AWARD_STATE) {\r\n        this.node_lock.active = false;\r\n        this.node_go.active = false;\r\n        this.node_receive.active = false;\r\n        this.node_got.active = false;\r\n        switch (state) {\r\n            case AWARD_STATE.GO:\r\n                this.node_go.active = true;\r\n                break;\r\n            case AWARD_STATE.GOT:\r\n                this.node_got.active = true;\r\n                break;\r\n            case AWARD_STATE.LOCK:\r\n                this.node_lock.active = true;\r\n                break;\r\n            case AWARD_STATE.RECEIVE:\r\n                this.node_receive.active = true;\r\n                break;\r\n            default:\r\n                break;\r\n        }\r\n    }\r\n    // 点击前往副本\r\n    goStage() {\r\n        let view_type = JIANGHU_TYPE.NONE\r\n        if (this._tabData.StageId < 10200) {\r\n            view_type = JIANGHU_TYPE.GoldStage\r\n        } else {\r\n            view_type = JIANGHU_TYPE.FeedStage\r\n        }\r\n        UIMgr.ins.hideView(ViewName.InstanceRewardPop);\r\n        UIMgr.ins.show({ viewName: ViewName.InstanceZonesView, data: [view_type] })\r\n    }\r\n    // 点击领取奖励\r\n    getAward() {\r\n        let msg = new proto.Msg_ReceiveExploreStageFirstRewardReq();\r\n        msg.stageId = this._tabData.StageId;\r\n        Net.Send(proto.Ptl.ReceiveExploreStageFirstRewardReq, msg)\r\n    }\r\n}\r\n\r\n\r\n"]}