{"version":3,"sources":["file:///C:/chickenStarClient/client/assets/scripts/logic/model/association/AssociationRankRewardPop.ts"],"names":["_decorator","instantiate","Label","Node","Prefab","Toggle","ViewPop","tab","LangMgr","GameUtil","AssociationData","AssociationRankRewardItem","ccclass","property","AssociationRankRewardPop","view_type","onShow","openData","isChecked","switchView","String","onDestroy","register","unRegister","e","type","Number","showRoleRank","showScoreDrop","rankId","contentNode","destroyAllChildren","tables","getData","RankRewardTableById","getValue","ranks","Ranking","key","str","split","item","itemPrefab","parent","rewards","getRewardsByDropId","DropId","getComponent","initView","rank","ins","getSelfRoleRankCount","getSelfGuildRankCount","myRankLab","node","active","myRankGuildLab","myScoreLab","string","getLab","GuildBossPointTable","lastScore","i","length","_tab","score","Damage","lastTab","PointRaito"],"mappings":"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","sourcesContent":["import { _decorator, Component, EventTouch, instantiate, Label, Node, Prefab, Toggle } from 'cc';\r\nimport { ViewPop } from '../../../framework/base/ViewPop';\r\nimport { tab } from '../../../Table/table_gen';\r\nimport { LangMgr } from '../../mgr/LangMgr';\r\nimport { GameUtil } from '../../utils/GameUtil';\r\nimport { AssociationData } from './AssociationData';\r\nimport { AssociationRankRewardItem } from './AssociationRankRewardItem';\r\nconst { ccclass, property } = _decorator;\r\n\r\n@ccclass('AssociationRankRewardPop')\r\nexport class AssociationRankRewardPop extends ViewPop {\r\n    @property(Node)\r\n    contentNode: Node = null;\r\n    @property(Label)\r\n    myRankLab: Label = null;\r\n    @property(Label)\r\n    myRankGuildLab: Label = null;\r\n    @property(Label)\r\n    myScoreLab: Label = null;\r\n    @property(Prefab)\r\n    itemPrefab: Prefab = null;\r\n    @property(Toggle)\r\n    toggle_16:Toggle = null;\r\n    @property(Toggle)\r\n    toggle_15:Toggle = null;\r\n    @property(Toggle)\r\n    toggle_17:Toggle = null;\r\n    private view_type: number = 0;\r\n    onShow(): void {\r\n        // 个人16 公会15 17伤害奖励\r\n        this.view_type = this.openData ? this.openData : 16;\r\n        this[\"toggle_\"+this.view_type].isChecked = true;\r\n        this.switchView(null, String(this.view_type));\r\n    }\r\n    protected onDestroy(): void {\r\n        super.onDestroy();\r\n    }\r\n    register(): void {\r\n\r\n    }\r\n    unRegister(): void {\r\n        super.unRegister();\r\n    }\r\n    switchView(e: EventTouch, type: string) {\r\n        if (e && Number(type) === this.view_type) {\r\n            return\r\n        }\r\n        this.view_type = Number(type);\r\n        if (this.view_type < 17) {\r\n            this.showRoleRank(this.view_type)\r\n        } else {\r\n            this.showScoreDrop();\r\n        }\r\n    }\r\n    showRoleRank(rankId: number) {\r\n        this.contentNode.destroyAllChildren();\r\n        let tables = tab.getData().RankRewardTableById.getValue(rankId);\r\n        let ranks = tables.Ranking;\r\n        for (let key in ranks) {\r\n            let str = ranks[key].split(\";\");\r\n            if (Number(str[0]) && Number(str[1])) {\r\n                let item = instantiate(this.itemPrefab);\r\n                item.parent = this.contentNode;\r\n                let rewards = GameUtil.getRewardsByDropId(tables.DropId[key]);\r\n                item.getComponent(AssociationRankRewardItem).initView(Number(str[0]), Number(str[1]), rewards);\r\n            }\r\n        }\r\n        let rank = rankId === 16 ? AssociationData.ins.getSelfRoleRankCount() : AssociationData.ins.getSelfGuildRankCount();\r\n        this.myRankLab.node.parent.active = false;\r\n        this.myRankGuildLab.node.parent.active = false;\r\n        this.myScoreLab.node.parent.active = false\r\n        if (rankId === 16) {\r\n            this.myRankLab.node.parent.active = true;\r\n            this.myRankLab.string = rank > 0 ? rank + \"\" : LangMgr.getLab(\"ui_worldboss_5\");\r\n        } else {\r\n            this.myRankGuildLab.node.parent.active = true;\r\n            this.myRankGuildLab.string = rank > 0 ? rank + \"\" : LangMgr.getLab(\"ui_worldboss_5\");\r\n        }\r\n    }\r\n    showScoreDrop() {\r\n        this.contentNode.destroyAllChildren();\r\n        this.myRankLab.node.parent.active = false;\r\n        this.myRankGuildLab.node.parent.active = false;\r\n        this.myScoreLab.node.parent.active = true;\r\n        let tables = tab.getData().GuildBossPointTable;\r\n\r\n        let lastScore = 0;\r\n        for(let i=0;i<tables.length-1;i++){\r\n            const _tab = tables[i];\r\n            let item = instantiate(this.itemPrefab);\r\n            item.parent = this.contentNode;\r\n            let rewards = GameUtil.getRewardsByDropId(_tab.DropId);\r\n\r\n            //计算分数 (10000*10000-3000*10000)/25000+3000\r\n            let score = 0;\r\n            if(i===0){\r\n                score = _tab.Damage;\r\n                lastScore = score;\r\n            }else{\r\n                const lastTab = tables[i-1];\r\n                score = lastScore+(_tab.Damage-lastTab.Damage)*10000/_tab.PointRaito;\r\n                lastScore = score;\r\n            }\r\n\r\n            item.getComponent(AssociationRankRewardItem).initView(0, score, rewards);\r\n        }\r\n    }\r\n}\r\n\r\n\r\n"]}