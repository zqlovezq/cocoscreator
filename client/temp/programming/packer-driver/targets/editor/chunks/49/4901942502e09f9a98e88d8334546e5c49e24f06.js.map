{"version":3,"sources":["file:///C:/chickenStarClient/client/assets/scripts/logic/model/recruit/RecruitGuaranteePop.ts"],"names":["_decorator","Label","RichText","sp","ViewPop","proto","Net","tab","ItemData","ShowItemNotEnoughTips","UIMgr","ViewName","LangMgr","OpenFunctionMgr","RecruitType","EventMgr","ccclass","property","RecruitGuaranteePop","Skeleton","gachaData","onShow","self","getData","GachaTableById","getValue","needCount","ItemCount","curCount","ins","getCount","lbl_cur_count","string","openTab","OpenFunctionTableByName","OpenFunctionName","OpenFunctionName_GachaHeroSSR","rich_txt_recruit","getCombineString","schedule","randomAction","on_s2c_GachaRsp","spineAction","getRandomValue","spine_draw","setAnimation","randomNumber","Math","random","onDisable","unschedule","onDestroy","register","onMsg","Ptl","GachaRsp","unRegister","clickGacha","isOpen","checkFunctionIsOpen","showFunctionTips","msg","Msg_GachaReq","id","Id","Send","GachaReq","showGachaProbabilityView","event","type","show","viewName","RecruitMustProbabilityPop","data","SeniorGuarantee","recruit"],"mappings":"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","sourcesContent":["import { _decorator, Component, EventTouch, Label, Node, RichText, sp } from 'cc';\r\nimport { ViewPop } from '../../../framework/base/ViewPop';\r\nimport { proto } from 'client_protocol';\r\nimport { Net } from '../../net/Net';\r\nimport { tab } from '../../../Table/table_gen';\r\nimport { ItemData } from '../item/ItemData';\r\nimport { ShowItemNotEnoughTips, ShowTips, UIMgr } from '../../mgr/UIMgr';\r\nimport { ViewName } from '../../define/ViewDefine';\r\nimport { LangMgr } from '../../mgr/LangMgr';\r\nimport { OpenFunctionMgr } from '../../../Common/component/OpenFunctionMgr';\r\nimport { RecruitType } from '../../../Common/script/EnumTypeMgr';\r\nimport { EventMgr } from '../../mgr/EventMgr';\r\nconst { ccclass, property } = _decorator;\r\n\r\n@ccclass('RecruitGuaranteePop')\r\nexport class RecruitGuaranteePop extends ViewPop {\r\n    @property(Label)\r\n    lbl_cur_count: Label = null;\r\n    @property(RichText)\r\n    rich_txt_recruit: RichText = null;\r\n    @property(sp.Skeleton)\r\n    spine_draw: sp.Skeleton = null;\r\n    private gachaData: tab.GachaTable = null;\r\n    onShow(): void {\r\n        const self = this;\r\n        // 当前的gacha数据为\r\n        this.gachaData = tab.getData().GachaTableById.getValue(100);\r\n        // 需要消耗的数量\r\n        const needCount = this.gachaData.ItemCount;\r\n        // 当前道具数量\r\n        const curCount = ItemData.ins.getCount(51);\r\n        this.lbl_cur_count.string = curCount + \"/\" + needCount;\r\n        // 解锁条件\r\n        const openTab: tab.OpenFunctionTable = tab.getData().OpenFunctionTableByName.getValue(tab.OpenFunctionName.OpenFunctionName_GachaHeroSSR);\r\n        this.rich_txt_recruit.string = LangMgr.getCombineString(\"ui_recruit_3\", [needCount]);\r\n\r\n        this.schedule(this.randomAction, 2)\r\n    }\r\n    on_s2c_GachaRsp(){\r\n        const needCount = this.gachaData.ItemCount;\r\n        // 当前道具数量\r\n        const curCount = ItemData.ins.getCount(51);\r\n        this.lbl_cur_count.string = curCount + \"/\" + needCount;\r\n    }\r\n    randomAction() {\r\n        let spineAction = this.getRandomValue();\r\n        this.spine_draw.setAnimation(0, spineAction, false);\r\n    }\r\n    getRandomValue(): string {\r\n        const randomNumber = Math.random(); // 生成一个 [0, 1) 之间的随机数\r\n        if (randomNumber < 0.5) {\r\n            return \"idle\"; // 50%的概率返回1\r\n        } else {\r\n            return \"xuanzhuan\"; // 50%的概率返回2\r\n        }\r\n    }\r\n    protected onDisable(): void {\r\n        this.unschedule(this.randomAction);\r\n    }\r\n    protected onDestroy(): void {\r\n        super.onDestroy()\r\n    }\r\n    register(): void {\r\n        EventMgr.onMsg(proto.Ptl.GachaRsp, this.on_s2c_GachaRsp, this);\r\n    }\r\n    unRegister(): void {\r\n        super.unRegister()\r\n    }\r\n    /* 点击招募 */\r\n    clickGacha() {\r\n        // 是否解锁\r\n        const isOpen = OpenFunctionMgr.ins.checkFunctionIsOpen(tab.OpenFunctionName.OpenFunctionName_GachaHeroSSR);\r\n        if (!isOpen) {\r\n            OpenFunctionMgr.ins.showFunctionTips(tab.OpenFunctionName.OpenFunctionName_GachaHeroSSR);\r\n            return;\r\n        }\r\n        // 先判断是否道具足够\r\n        const needCount = this.gachaData.ItemCount;\r\n        const curCount = ItemData.ins.getCount(51);\r\n        if (curCount < needCount) {\r\n            // 道具不足\r\n            ShowItemNotEnoughTips(51);\r\n            return\r\n        }\r\n        let msg = new proto.Msg_GachaReq();\r\n        msg.id = this.gachaData.Id;\r\n        Net.Send(proto.Ptl.GachaReq, msg);\r\n    }\r\n    /* 显示概率公示界面 */\r\n    showGachaProbabilityView(event: EventTouch, type: string) {\r\n        UIMgr.ins.show({\r\n            viewName: ViewName.RecruitMustProbabilityPop, data: {\r\n                type: RecruitType.SeniorGuarantee,\r\n                recruit: 100\r\n            }\r\n        });\r\n    }\r\n}\r\n\r\n\r\n"]}