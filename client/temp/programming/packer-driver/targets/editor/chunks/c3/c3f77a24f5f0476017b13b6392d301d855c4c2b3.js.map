{"version":3,"sources":["file:///C:/chickenStarClient/client/assets/scripts/logic/fight/base/damage/DamageLab.ts"],"names":["_decorator","Font","Label","Layers","Node","Tween","tween","FightRootControl","CocosUtil","ResMgr","FightData","ccclass","property","DamageLab","get","lab","pools","pop","addComponent","put","node","parent","push","destroy","child","ins","getDamagesNode","children","len","length","i","v","stopAllByTarget","removeFromParent","getComponent","index","frameDatas","addShowDamageNum","data","b","frameIndex","isDamage","damage","recycle","pos","x","getPosition","center","y","setTimeout","showDamageNum","layer","Enum","DEFAULT","string","getShowStr","fontSize","getColor","size","font","path","spacingX","offsetx","position","cacheMode","CacheMode","BITMAP","addChild","to","scale","v3","by","call","start","showCureNum","cureHp","isCritical"],"mappings":"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","sourcesContent":["import { _decorator, Color, Component, director, Font, instantiate, Label, Layers, Node, Prefab, ResolutionPolicy, Tween, tween, Vec3, view } from 'cc';\nimport { FightRootControl } from '../../FightRootControl';\nimport { AbsObj } from '../obj/AbsObj';\nimport { CocosUtil } from '../../../utils/CocosUtil';\nimport { DamageData } from './DamageData';\nimport { ResMgr } from '../../../mgr/ResMgr';\nimport { FightData } from '../../data/FightData';\nconst { ccclass, property } = _decorator;\n\n\n@ccclass('DamageLab')\nexport class DamageLab {\n    //缓存池管理\n    static pools: Array<Label> = [];\n    static frameDatas: Array<DamageData> = [];\n\n    static get() {\n        let lab = this.pools.pop();\n        if (!lab) {\n            lab = new Node(\"damageNode\").addComponent(Label)\n        }\n        return lab;\n    }\n\n    static put(lab: Label) {\n        lab.node.parent = null\n        DamageLab.pools.push(lab)\n    }\n\n    static destroy() {\n        let child = FightRootControl.ins.getDamagesNode().children\n        let len = child.length\n        for (let i = len - 1; i >= 0; i--) {\n            let v = child[i]\n            Tween.stopAllByTarget(v)\n            v.removeFromParent()\n            DamageLab.put(v.getComponent(Label))\n        }\n\n        for (let index = 0; index < DamageLab.pools.length; index++) {\n            const v = DamageLab.pools[index];\n            v.destroy()\n        }\n        DamageLab.frameDatas.length = 0\n        DamageLab.pools.length = 0\n    }\n\n    static addShowDamageNum(data: DamageData, b: AbsObj, frameIndex: number = 0) {\n        if (!FightData.ins.isDamage() || data.damage == 0) {//不飘伤害，直接回收\n            data.recycle()\n            return\n        }\n        data.pos.x = b.getPosition().x + b.center.x\n        data.pos.y = b.getPosition().y + b.center.y\n\n        data.frameIndex = frameIndex\n\n\n        if (frameIndex > 0) {\n            if (frameIndex % 2 == 1) {\n                data.pos.x -= frameIndex * 5\n            }else{\n                data.pos.x += frameIndex/2 * 5\n            }\n            setTimeout(() => {\n                DamageLab.showDamageNum(data)\n            }, frameIndex*200);\n           \n        } else {\n            DamageLab.showDamageNum(data)\n        }\n      \n    }\n\n    static showDamageNum(data: DamageData) {\n        let lab = DamageLab.get()\n        lab.node.layer = Layers.Enum.DEFAULT\n        lab.string = data.getShowStr()\n        lab.fontSize = data.getColor().size || 20\n        lab.font = ResMgr.get(data.getColor().path, Font)\n        lab.spacingX = data.getColor().offsetx\n        lab.node.position = data.pos\n        lab.cacheMode = Label.CacheMode.BITMAP\n        FightRootControl.ins.getDamagesNode().addChild(lab.node)\n        data.recycle()\n\n        tween(lab.node)\n            .to(0.09, { scale: CocosUtil.v3(1.75) })\n            .to(0.13, { scale: CocosUtil.v3(1) })\n            .to(0.13, { scale: CocosUtil.v3(1.5) })\n            .to(0.09, { scale: CocosUtil.v3(1) })\n            .by(0.13, { position: CocosUtil.v3(0, 50, 0) })\n            .call(() => {\n                DamageLab.put(lab)\n            })\n            .start()\n    }\n\n    showCureNum(cureHp: number, isCritical: boolean) {\n\n    }\n\n}\n\n"]}