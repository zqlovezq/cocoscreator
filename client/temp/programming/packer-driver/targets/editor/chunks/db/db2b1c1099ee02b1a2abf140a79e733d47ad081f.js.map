{"version":3,"sources":["file:///C:/chickenStarClient/client/assets/scripts/logic/model/association/AssociationGiftButton.ts"],"names":["_decorator","CCString","Component","Label","AssociationData","tab","LangMgr","setTextTime","RoleData","ccclass","property","AssociationGiftButton","endGiftTimer","_giftData","updateGiftTimer","timerGiftLab","string","getLab","unschedule","onLoad","ins","getBargainGift","type","node","active","Boolean","initGiftEndTimer","isOpen","checkFunctionIsOpen","GuildOFName","GuildOFName_GuildGift","guildInfo","getAssocitionInfo","buyGift","isBoughtCycleGift","serverTime","getServerUtcTime","expireTime","schedule","getFunctionTips"],"mappings":"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","sourcesContent":["import { _decorator, CCString, Component, Label, Node } from 'cc';\r\nimport { AssociationData } from './AssociationData';\r\nimport { tab } from '../../../Table/table_gen';\r\nimport { LangMgr } from '../../mgr/LangMgr';\r\nimport { setTextTime } from '../../utils/GameUtil';\r\nimport { RoleData } from '../role/RoleData';\r\nimport { proto } from 'client_protocol';\r\nconst { ccclass, property } = _decorator;\r\n\r\n@ccclass('AssociationGiftButton')\r\nexport class AssociationGiftButton extends Component {\r\n    @property(CCString)\r\n    type:string = \"\"\r\n    @property(Label)\r\n    timerGiftLab:Label = null;\r\n    private endGiftTimer:number = 0;\r\n    private _giftData:proto.GuildGift = null;\r\n    protected onLoad(): void {\r\n        this._giftData = AssociationData.ins.getBargainGift(this.type);\r\n        this.node.active = Boolean(this._giftData);\r\n        if(this._giftData){\r\n            this.initGiftEndTimer();\r\n        }\r\n    }\r\n    initGiftEndTimer() {\r\n        this.unschedule(this.updateGiftTimer)\r\n        const isOpen = AssociationData.ins.checkFunctionIsOpen(tab.GuildOFName.GuildOFName_GuildGift);\r\n        const guildInfo = AssociationData.ins.getAssocitionInfo();\r\n        const buyGift = guildInfo.isBoughtCycleGift;\r\n        if (isOpen) {\r\n            if(buyGift){\r\n                this.timerGiftLab.string = LangMgr.getLab(\"ui_association_65\");\r\n            }else{\r\n                const serverTime = RoleData.ins.getServerUtcTime();\r\n                this.endGiftTimer =  this._giftData.expireTime - serverTime;\r\n                if(this.endGiftTimer>=0){\r\n                    this.timerGiftLab.string = LangMgr.getLab(\"ui_commondesc_109\")+setTextTime(this.endGiftTimer);\r\n                    this.schedule(this.updateGiftTimer, 1)\r\n                }else{\r\n                    this.timerGiftLab.string = LangMgr.getLab(\"ui_association_65\");\r\n                }\r\n            }\r\n        }else{\r\n            this.timerGiftLab.string = AssociationData.ins.getFunctionTips(tab.GuildOFName.GuildOFName_GuildGift);\r\n        }\r\n    }\r\n    updateGiftTimer = () => {\r\n        this.endGiftTimer--;\r\n        if (this.endGiftTimer >= 0) {\r\n            this.timerGiftLab.string = LangMgr.getLab(\"ui_commondesc_109\")+setTextTime(this.endGiftTimer);\r\n        } else {\r\n            this.unschedule(this.updateGiftTimer)\r\n        }\r\n    }\r\n}\r\n\r\n\r\n"]}