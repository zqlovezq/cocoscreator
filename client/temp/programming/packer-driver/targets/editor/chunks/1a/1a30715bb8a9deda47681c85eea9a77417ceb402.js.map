{"version":3,"sources":["file:///C:/chickenStarClient/client/assets/scripts/logic/model/home/battle/BattleMainItem.ts"],"names":["_decorator","Label","Node","Sprite","Toggle","InfiniteCell","EventMgr","LocalEvent","tab","LangMgr","ccclass","property","BattleMainItem","ClickStage","_chapterData","touchCallBack","_selfData","stageIds","onLoad","node","on","EventType","TOUCH_END","onTouchItem","TOUCH_CANCEL","onButtonTouchCancel","TOUCH_START","onButtonTouchStart","event","propagationStopped","setTouchCallBack","callBack","e","console","log","dataIndex","emitLocal","Level_Item_Select","UpdateContent","info","ins","data","index","node_stage","parent","active","sp_select_lock","sp_select_unLock","curFightStageId","getCurFightStageId","getData","MainChapterTableById","getValue","stageInfo","StageIds","EliteStageIds","setTexture","IconSelect","lbl_name","string","getLab","Name","sp_lock_icon","Icon","sp_icon","islock","getStageIsLock","Id","node_active","levelCount","length","i","stageNode","getChildByName","stageId","getComponent","isChecked","bar","node_bar","lockMark","clickSwitchStage","stage","levelStage","Number","scheduleOnce","idx","indexOf","setSelect","isSelect"],"mappings":"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","sourcesContent":["import { _decorator, Component, EventTouch, Label, log, Node, Sprite, Toggle } from 'cc';\r\nimport InfiniteCell from '../../../../Common/InfiniteList/InfiniteCell';\r\nimport { EventMgr } from '../../../mgr/EventMgr';\r\nimport { LocalEvent } from '../../../define/LocalEvent';\r\nimport { tab } from '../../../../Table/table_gen';\r\nimport { LangMgr } from '../../../mgr/LangMgr';\r\nimport { BattleMainDataControl } from './BattleMainDataControl';\r\nconst { ccclass, property } = _decorator;\r\n\r\n@ccclass('BattleMainItem')\r\nexport class BattleMainItem extends InfiniteCell {\r\n    @property(Label)\r\n    lbl_name:Label = null;\r\n    @property(Node)\r\n    node_stage:Node = null;\r\n    @property(Node)\r\n    node_bar:Node = null;\r\n    @property(Sprite)\r\n    sp_lock_icon:Sprite = null;\r\n    @property(Sprite)\r\n    sp_icon:Sprite = null;\r\n    @property(Node)\r\n    node_active:Node = null;\r\n    @property(Sprite)\r\n    sp_select_unLock:Sprite = null;\r\n    @property(Sprite)\r\n    sp_select_lock:Sprite = null;\r\n    @property(Node)\r\n    node_info:Node = null;\r\n    public ClickStage:number = 0;\r\n    private _chapterData:tab.MainChapterTable = null;\r\n    private touchCallBack: Function;\r\n    private _selfData:any = null;\r\n    private stageIds = [];\r\n    protected onLoad(): void {\r\n        this.node.on(Node.EventType.TOUCH_END, this.onTouchItem, this)\r\n        this.node.on(Node.EventType.TOUCH_CANCEL, this.onButtonTouchCancel, this);\r\n        this.node.on(Node.EventType.TOUCH_START, this.onButtonTouchStart, this);\r\n    }\r\n    onButtonTouchStart(event: EventTouch) {\r\n        // 阻止 ScrollView 的触摸事件\r\n        event.propagationStopped = true;\r\n    }\r\n    setTouchCallBack(callBack: Function) {\r\n        this.touchCallBack = callBack;\r\n    }\r\n    onButtonTouchCancel(event: EventTouch) {\r\n        // 阻止 ScrollView 的触摸事件\r\n        event.propagationStopped = true;\r\n    }\r\n    private onTouchItem(e: EventTouch) {\r\n        console.log(\"cocos TOUCH_END this.dataIndex=\",this.dataIndex);\r\n        EventMgr.emitLocal(LocalEvent.Level_Item_Select, [this.dataIndex]);\r\n    }\r\n    UpdateContent(info: any): void {\r\n        this._selfData = info.ins;\r\n        let data = info.index;\r\n        this.node_stage.parent.active = false;\r\n        this.sp_select_lock.node.active = false;\r\n        this.sp_select_unLock.node.active = false;\r\n        const curFightStageId = this._selfData.getCurFightStageId()\r\n        this._chapterData = tab.getData().MainChapterTableById.getValue(data+1);\r\n        \r\n        this.stageIds = null;\r\n        if(this._selfData.stageInfo){\r\n            this.stageIds = this._chapterData.StageIds\r\n        }else{\r\n            this.stageIds = this._chapterData.EliteStageIds\r\n        }\r\n\r\n        this.sp_select_unLock.setTexture(this._chapterData.IconSelect);\r\n        this.sp_select_lock.setTexture(this._chapterData.IconSelect);\r\n        // 获取当前的章节\r\n        this.ClickStage = this.stageIds[0];\r\n        // 章节名称\r\n        this.lbl_name.string = LangMgr.getLab(this._chapterData.Name);\r\n        // 章节图片\r\n        this.sp_lock_icon.setTexture(this._chapterData.Icon);\r\n        this.sp_icon.setTexture(this._chapterData.Icon);\r\n        let islock = this._selfData.getStageIsLock(this._chapterData.Id);\r\n        this.node_active.active = !islock;\r\n        if(!islock){\r\n            const levelCount = this.stageIds.length;\r\n            for(let i=0;i<5;i++){\r\n                const stageNode = this.node_stage.getChildByName(\"Toggle\"+(i+1));\r\n                const stageId =  this.stageIds[i];\r\n                stageNode.active = i<levelCount;\r\n                stageNode.getComponent(Toggle).isChecked = curFightStageId==stageId;\r\n                if(curFightStageId==stageId){\r\n                    this.ClickStage = curFightStageId;\r\n                }\r\n                if(i>=1){\r\n                    const bar = this.node_bar.getChildByName(\"bar_\"+(i+1));\r\n                    bar.active = i<levelCount;\r\n    \r\n                    let lockMark = stageNode.getChildByName(\"lockmark\");\r\n                    lockMark.active = curFightStageId<stageId;\r\n                }\r\n            }\r\n        }\r\n    }\r\n    clickSwitchStage(event: EventTouch, stage: string){\r\n        /* 判断当前是否解锁 如果未解锁返回 */\r\n        const curFightStageId = this._selfData.getCurFightStageId()\r\n        const levelStage = Number(stage);\r\n        if(this.stageIds[levelStage]&&curFightStageId<this.stageIds[levelStage]){\r\n            this.scheduleOnce(()=>{\r\n                const idx = this.stageIds.indexOf(this.ClickStage);\r\n                const stageNode =this.node_stage.getChildByName(\"Toggle\"+(idx+1));\r\n                stageNode.getComponent(Toggle).isChecked = true;\r\n            })\r\n            return;\r\n        }\r\n        this.ClickStage = this.stageIds[levelStage];\r\n    }\r\n    setSelect(isSelect:boolean){\r\n        this.sp_select_lock.node.active = isSelect;\r\n        this.sp_select_unLock.node.active = isSelect;\r\n        let islock = this._selfData.getStageIsLock(this._chapterData.Id);\r\n        if(!islock){\r\n            this.node_stage.parent.active = isSelect;\r\n            this.node_stage.active = isSelect;\r\n            this.node_bar.active = isSelect;\r\n        }\r\n    }\r\n}\r\n\r\n\r\n"]}