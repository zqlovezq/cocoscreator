{"version":3,"sources":["file:///C:/chickenStarClient/client/assets/scripts/logic/fight/pvp/PvpUIView.ts"],"names":["_decorator","instantiate","Label","Layout","Node","Prefab","ViewScreen","FightRootControl","FightState","setTextTime_3","PvpControl","FightBarItem","Func","OpenFunctionMgr","tab","LangMgr","ShowTips","FightMsgControl","FightData","CommonTipsPop","CommonTipsPopCloseType","EventMgr","FightEvent","FightWeaponTeam","ccclass","property","PvpUIView","speedIdx","bookIndex","onLoad","schedule","updateTime","attackWeapon","node","active","defanseWeapon","team_layout","getComponent","horizontalDirection","HorizontalDirection","RIGHT_TO_LEFT","onShow","register","onFight","Pvp_start","idx","checkInt","getItem","Math","max","setSpeedIdx","list","index","length","v","info","ins","getPvpFightInfoByGroup","setBooks","books","questLevel","checkBookActive","getData","GetKeyValue_ConfigTable","PvPRogueTick","time","activeBookIndex","isFight","time_lab","string","stageTab","Time","floor","createBarItem","barItem","barItemPfb","barNode","addChild","onSpeedClick","event","data","checkSpeedOpen","setItem","speedNodeParent","children","element","timeScale","TimeScale","istips","isTest","checkFunctionIsOpen","OpenFunctionName","OpenFunctionName_FightSpeed2","openTab","OpenFunctionTableByName","getValue","PlayerLv","key","getCombineString","OpenFunctionName_FightSpeed3","getLab","onPauseClick","pause","create","btnType","confirm","setState","end","pvpEnd"],"mappings":"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","sourcesContent":["\nimport { _decorator, director, EditBox, EventTouch, Font, game, instantiate, js, Label, Layers, Layout, Node, Prefab, ProgressBar, Size, Sprite, SpriteFrame, Toggle, Tween, tween, UIOpacity, UITransform, v2, v3, Vec3, view } from 'cc';\nimport { ViewScreen } from '../../../framework/base/ViewScreen';\nimport { FightRootControl, FightState } from '../FightRootControl';\nimport { setTextTime_3 } from '../../utils/GameUtil';\nimport { PvpControl } from './PvpControl';\nimport { FightBarItem } from '../view/common/FightBarItem';\nimport { FightMacro } from '../define/FightDefine';\nimport { Func } from '../../utils/Func';\nimport { OpenFunctionMgr } from '../../../Common/component/OpenFunctionMgr';\nimport { tab } from '../../../Table/table_gen';\nimport { LangMgr } from '../../mgr/LangMgr';\nimport { ShowTips } from '../../mgr/UIMgr';\nimport { FightMsgControl } from '../FightMsgControl';\nimport { FightData } from '../data/FightData';\nimport { CommonTipsPop, CommonTipsPopCloseType } from '../../model/common/CommonTipsPop';\nimport { LocalEvent } from '../../define/LocalEvent';\nimport { EventMgr } from '../../mgr/EventMgr';\nimport { FightEvent } from '../define/FightEvent';\nimport { FightWeaponTeam } from '../view/common/FightWeaponTeam';\n\nconst { ccclass, property } = _decorator;\n\n\n\n@ccclass('PvpUIView')\nexport class PvpUIView extends ViewScreen {\n\n    @property(Label)\n    time_lab: Label = null\n    @property(Node)\n    barNode: Node = null\n    @property(Prefab)\n    barItemPfb: Prefab = null\n\n    @property(Node)\n    speedNodeParent: Node = null\n    speedIdx: number = 1\n\n\n    @property(FightWeaponTeam)\n    attackWeapon: FightWeaponTeam = null\n\n    @property(FightWeaponTeam)\n    defanseWeapon: FightWeaponTeam = null\n\n    bookIndex: number = 0\n    protected onLoad(): void {\n        super.onLoad()\n        this.schedule(() => {\n            this.updateTime()\n        }, 1)\n        this.attackWeapon.node.active = this.defanseWeapon.node.active = false\n        this.defanseWeapon.team_layout.getComponent(Layout).horizontalDirection = Layout.HorizontalDirection.RIGHT_TO_LEFT\n    }\n\n    onShow(): void {\n\n    }\n\n    register(): void {\n        EventMgr.onFight(FightEvent.Pvp_start, this.Pvp_start, this)\n    }\n    Pvp_start() {\n        let idx = Func.checkInt(Func.getItem(\"FightSpeedIdx\"))\n        idx = Math.max(idx, 1)\n        this.setSpeedIdx(idx)\n\n        let list = [this.attackWeapon, this.defanseWeapon]\n        for (let index = 0; index < list.length; index++) {\n            const v = list[index];\n            let info = FightData.ins.getPvpFightInfoByGroup(index)\n            if (info){\n                v.node.active = true\n                v.setBooks(info.books, info.questLevel)\n            }else{\n                v.node.active = false\n            }\n            \n        }\n\n\n        this.schedule(() => {\n            this.checkBookActive()\n        }, 1)\n        this.checkBookActive()\n    }\n\n    checkBookActive() {\n        for (let index = this.bookIndex; index < tab.getData().GetKeyValue_ConfigTable().PvPRogueTick.length; index++) {\n            const time = tab.getData().GetKeyValue_ConfigTable().PvPRogueTick[index];\n            if (PvpControl.ins.time >= time) {\n                this.attackWeapon.activeBookIndex(index)\n                this.defanseWeapon.activeBookIndex(index)\n                this.bookIndex = index + 1\n                break;\n            }\n        }\n    }\n\n    updateTime() {\n        if (FightRootControl.ins.isFight()) {\n            this.time_lab.string = setTextTime_3(FightData.ins.stageTab.Time   -Math.floor(PvpControl.ins.time / 1000))\n        }\n    }\n\n    createBarItem() {\n        let barItem = instantiate(this.barItemPfb)\n        this.barNode.addChild(barItem)\n        return barItem.getComponent(FightBarItem)\n    }\n\n\n\n    onSpeedClick(event: EventTouch, data: any) {\n        let idx = Func.checkInt(data);\n        if (this.checkSpeedOpen(idx + 1, true)) {\n            idx = idx + 1\n            this.setSpeedIdx(idx)\n        } else {\n            if (idx + 1 >= 3) {\n                this.setSpeedIdx(1);\n            }\n        }\n\n\n    }\n\n\n    setSpeedIdx(idx: number) {\n        if (idx > 3) {\n            idx = 1\n        }\n        this.speedIdx = idx\n        Func.setItem(\"FightSpeedIdx\", idx)\n\n        for (let index = 0; index < this.speedNodeParent.children.length; index++) {\n            const element = this.speedNodeParent.children[index];\n            element.active = (idx - 1 == index)\n        }\n\n        FightData.ins.timeScale = Math.max(Func.checkInt(tab.getData().GetKeyValue_ConfigTable().TimeScale[this.speedIdx - 1]), 0.8)\n    }\n    checkSpeedOpen(index: number, istips: boolean = false) {\n        if (FightMsgControl.ins.isTest) {\n            return true\n        }\n        if (index == 1) {\n            return true;\n        } else if (index == 2) {\n            if (OpenFunctionMgr.ins.checkFunctionIsOpen(tab.OpenFunctionName.OpenFunctionName_FightSpeed2)) {\n                return true;\n            } else {\n                if (istips) {\n                    let openTab = tab.getData().OpenFunctionTableByName.getValue(tab.OpenFunctionName.OpenFunctionName_FightSpeed2);\n                    let PlayerLv = openTab.PlayerLv;\n                    let key = \"ui_fight_16\"\n                    ShowTips(LangMgr.getCombineString(key, [PlayerLv]));\n                }\n                return false;\n            }\n\n        } else if (index == 3) {\n            if (OpenFunctionMgr.ins.checkFunctionIsOpen(tab.OpenFunctionName.OpenFunctionName_FightSpeed3)) {\n                return true;\n            } else {\n                if (istips) {\n                    ShowTips(LangMgr.getLab(\"ui_fight_17\"));\n                }\n\n                return false;\n            }\n        } else {\n            return true;\n        }\n    }\n\n\n    onPauseClick() {\n        FightData.ins.pause = true\n        CommonTipsPop.create(LangMgr.getLab(\"是否退出战斗？\"), (btnType: CommonTipsPopCloseType) => {\n            FightData.ins.pause = false\n            if (btnType == CommonTipsPopCloseType.confirm) {\n                // EventMgr.emitLocal(LocalEvent.quitFight)\n                FightRootControl.ins.setState(FightState.end)\n                FightRootControl.ins.pvpEnd()\n            }\n        })\n    }\n}\n\n"]}