{"version":3,"sources":["file:///C:/chickenStarClient/client/assets/scripts/logic/model/home/battle/UIScrollSelect.ts"],"names":["_decorator","Button","CCFloat","CCInteger","Component","EventHandler","instantiate","Node","Prefab","UITransform","v3","BattleMainItem","ccclass","property","EventType","UIScrollSelect","tooltip","type","visible","circlePage","childs","isTouching","hasTouchMove","isTestX","_touchId","currentIndex","_toMoveX","dx","moveAim","onLoad","i","item","pfb_level_item","content","addChild","getComponent","UpdateContent","children","length","position","deltaX","y","scrollTo","idx","anim","console","error","node","name","log","_checkChildX","emitEvents","selectEvents","target","SCROLL_START","index","scrollToLeft","_setPageBtnsStatus","scrollToRight","isRightEdge","rightBtn","interactable","isLeftEdge","leftBtn","child","x","z","Math","min","abs","scale","centerScale","minScale","start","on","TOUCH_START","_onTouch","TOUCH_MOVE","TOUCH_END","_onTouchEnd","TOUCH_CANCEL","event","touch","getUIStartLocation","evt","getUILocation","_move","SCROLL_ING","_isMoveEdge","leftEdge","rightEdge","left","right","edge","tf","lo","convertToNodeSpaceAR","mx","ceil","event1","SCROLL_END","max","minidx","dt","update","stepx","scrollSpeed","lx","round","tox","cx"],"mappings":"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","sourcesContent":["/**\r\n * Created by jsroads on 2021/8/30.5:46 下午\r\n * Note:\r\n */\r\nimport {_decorator, Button, CCFloat, CCInteger, Component, EventHandler, EventTouch, instantiate, Node, Prefab, UITransform, v3} from 'cc';\r\nimport { BattleMainItem } from './BattleMainItem';\r\n\r\nconst {ccclass, property} = _decorator;\r\n\r\nexport enum EventType {\r\n    SCROLL_START,\r\n    SCROLL_ING,\r\n    SCROLL_END\r\n}\r\n\r\n@ccclass('UIScrollSelect')\r\nexport class UIScrollSelect extends Component {\r\n    public static EventType = EventType;\r\n    @property(Prefab)\r\n    pfb_level_item: Prefab = null;\r\n    @property(Node)\r\n    content: Node = null;\r\n    @property({\r\n        tooltip: \"是否无限翻页\"\r\n    })\r\n    circlePage: boolean = true;\r\n    @property({\r\n        type: Button,\r\n        tooltip: '左边按钮',\r\n        visible(this: UIScrollSelect) {\r\n            return !this.circlePage;\r\n        }\r\n    })\r\n    leftBtn: Button = null;\r\n    @property({\r\n        type: Button,\r\n        tooltip: '右边按钮',\r\n        visible(this: UIScrollSelect) {\r\n            return !this.circlePage;\r\n        }\r\n    })\r\n    rightBtn: Button = null;\r\n\r\n    @property({\r\n        type: CCInteger,\r\n        tooltip: '单个控件之间的距离'\r\n    })\r\n    deltaX: number = 100; //x间隔距离\r\n    @property({\r\n        type: CCFloat,\r\n        tooltip: '中心点的缩放比例'\r\n    })\r\n    centerScale: number = 1.0;\r\n    @property({\r\n        type: CCFloat,\r\n        tooltip: '边缘点的缩放比例'\r\n    })\r\n    minScale: number = 1.0;\r\n    @property({\r\n        type: CCFloat,\r\n        tooltip: '滚动时的速度'\r\n    })\r\n    scrollSpeed: number = 300;\r\n    @property({\r\n        type: EventHandler,\r\n        tooltip: \"选择后的回调\"\r\n    })\r\n    selectEvents: Array<EventHandler> = [];\r\n\r\n\r\n\r\n    private childs: Array<Node> = [];\r\n    private isTouching: boolean = false;\r\n    private hasTouchMove: boolean = false;\r\n    private isTestX: boolean = false;\r\n    private _touchId: any = null;\r\n    private currentIndex: number = 0;\r\n    private _toMoveX: number = 1; //移动方向\r\n    private dx: number = 0;\r\n    private moveAim: number = 0;\r\n\r\n    onLoad() {\r\n        for(let i=0;i<10;i++){\r\n            let item = instantiate(this.pfb_level_item);\r\n            this.content.addChild(item);\r\n            item.getComponent(BattleMainItem).UpdateContent(i);\r\n        }\r\n\r\n        this.childs = [];\r\n        for (let i = 0; i < this.content.children.length; i++) {\r\n            this.childs[i] = this.content.children[i];\r\n            this.childs[i].position = v3(this.deltaX * (i - 1), this.childs[i].position.y, 0);\r\n        }\r\n        this.isTouching = false;\r\n        this.hasTouchMove = false;\r\n        this.isTestX = false;\r\n        this._touchId = null;\r\n        // this.currentIndex = 0;\r\n        this.scrollTo(0, false);\r\n    }\r\n\r\n    /** 滚动到指定节点\r\n     * @param idx\r\n     * @param anim 是否带移动动画\r\n     */\r\n    scrollTo(idx: number, anim: boolean = true) {\r\n        if (idx < 0 && idx >= this.childs.length) {\r\n            return console.error(this.node.name + '->移动超出边界面');\r\n        }\r\n        this.currentIndex = idx;\r\n        console.log(\"cocos---3this.moveAim\",idx);\r\n        this.moveAim = idx;\r\n        if (!anim) {\r\n            for (let i = 0; i < this.childs.length; i++) {\r\n                this._checkChildX(this.childs[i], (i - idx) * this.deltaX);\r\n            }\r\n        } else {\r\n            this.isTestX = true;\r\n            EventHandler.emitEvents(this.selectEvents, {\r\n                target: this,\r\n                type: EventType.SCROLL_START,\r\n                index: this.currentIndex\r\n            });\r\n        }\r\n    }\r\n\r\n    /** 向左滚一个点 */\r\n    scrollToLeft() {\r\n        this._toMoveX = 1;\r\n        this.scrollTo((this.currentIndex - 1 + this.childs.length) % this.childs.length);\r\n        this._setPageBtnsStatus();\r\n    }\r\n\r\n    /** 向左滚一个点 */\r\n    scrollToRight() {\r\n        this._toMoveX = -1;\r\n        this.scrollTo((this.currentIndex + 1 + this.childs.length) % this.childs.length);\r\n        this._setPageBtnsStatus();\r\n\r\n    }\r\n\r\n    /**\r\n     * 更新按钮状态\r\n     */\r\n    _setPageBtnsStatus() {\r\n        const isRightEdge: boolean = this.currentIndex >= this.childs.length - 1;\r\n        if (!this.circlePage && isRightEdge) {\r\n            console.log(\"已经到了最右边\", this.currentIndex);\r\n            if (this.rightBtn) this.rightBtn.interactable = false;\r\n        } else {\r\n            if (this.rightBtn) this.rightBtn.interactable = true;\r\n        }\r\n        const isLeftEdge: boolean = this.currentIndex <= 0;\r\n        if (!this.circlePage && isLeftEdge) {\r\n            console.log(\"已经到了最左边\", this.currentIndex);\r\n            if (this.leftBtn) this.leftBtn.interactable = false;\r\n        } else {\r\n            if (this.leftBtn) this.leftBtn.interactable = true;\r\n        }\r\n    }\r\n\r\n    _checkChildX(child: Node, x: number) {\r\n        if (this.circlePage) {\r\n            if (x > this.childs.length / 2 * this.deltaX) {\r\n                x -= this.childs.length * this.deltaX;\r\n            } else if (x < -this.childs.length / 2 * this.deltaX) {\r\n                x += this.childs.length * this.deltaX;\r\n            }\r\n        }\r\n        child.position = v3(x, child.position.y, child.position.z);\r\n        let dx = Math.min(Math.abs(x), this.deltaX);\r\n        let scale: number = (1 - dx / this.deltaX) * (this.centerScale - this.minScale) + this.minScale;\r\n        child.scale = v3(scale, scale, 1);\r\n    }\r\n\r\n    start() {\r\n        this.content.on(Node.EventType.TOUCH_START, this._onTouch, this);\r\n        this.content.on(Node.EventType.TOUCH_MOVE, this._onTouch, this);\r\n        this.content.on(Node.EventType.TOUCH_END, this._onTouchEnd, this);\r\n        this.content.on(Node.EventType.TOUCH_CANCEL, this._onTouchEnd, this);\r\n    }\r\n\r\n    _onTouch(event: EventTouch) {\r\n        if (this._touchId != null && event.touch != this._touchId) {\r\n            return;\r\n        }\r\n        if (event.type == Node.EventType.TOUCH_START) {\r\n            this.isTouching = true;\r\n            this.hasTouchMove = false;\r\n            this.isTestX = false;\r\n            this._touchId = event.touch;\r\n            this.dx = event.getUIStartLocation().x;\r\n            let evt = {\r\n                target: this,\r\n                type: EventType.SCROLL_START,\r\n                index: this.currentIndex\r\n            };\r\n            EventHandler.emitEvents(this.selectEvents, evt);\r\n            return;\r\n        }\r\n        this.hasTouchMove = true;\r\n        let dx = event.getUILocation().x - this.dx;\r\n        this._move(dx);\r\n        this.dx = event.getUILocation().x;\r\n        let evt = {\r\n            target: this,\r\n            type: EventType.SCROLL_ING,\r\n            dx: this.dx\r\n        };\r\n        EventHandler.emitEvents(this.selectEvents, evt);\r\n    }\r\n\r\n    /**\r\n     * 是否到达左右边缘\r\n     * @returns {{left: boolean, right: boolean}}\r\n     */\r\n    _isMoveEdge() {\r\n        const leftEdge = this.childs[0].position.x >= 0;\r\n        const rightEdge = this.childs[this.childs.length - 1].position.x <= 0;\r\n        return {left: leftEdge, right: rightEdge};\r\n    }\r\n\r\n    _onTouchEnd(event) {\r\n        if (this._touchId != null && event.touch != this._touchId) {\r\n            return;\r\n        }\r\n        this.isTouching = false;\r\n        if (event.type == Node.EventType.TOUCH_END || event.type == Node.EventType.TOUCH_CANCEL) {\r\n            this._touchId = null;\r\n        }\r\n        if (!this.circlePage) {\r\n            let edge = this._isMoveEdge();\r\n            if (edge.right) {\r\n                console.log(\"最右边 无法动\");\r\n                return;\r\n            }\r\n            if (edge.left) {\r\n                console.log(\"最左边 无法动\");\r\n                return;\r\n            }\r\n        }\r\n        let tf = this.node.getComponent(UITransform);\r\n        let lo = tf.convertToNodeSpaceAR(event.getUILocation());\r\n        if (!this.hasTouchMove) {\r\n\r\n            let mx = Math.ceil((lo.x - this.deltaX / 2) / this.deltaX);\r\n            if (mx === 0) {\r\n                let event1 = {\r\n                    target: this,\r\n                    type: EventType.SCROLL_END,\r\n                    index: this.currentIndex\r\n                };\r\n                EventHandler.emitEvents(this.selectEvents, event1);\r\n            } else {\r\n                this.moveAim = (this.currentIndex + mx + this.childs.length) % this.childs.length;\r\n                console.log(\"cocos---1this.moveAim\",this.moveAim);\r\n                this._toMoveX = mx > 0 ? -1 : 1;\r\n                this.isTestX = true;\r\n            }\r\n            return;\r\n        }\r\n        let max = this.deltaX;\r\n        let minidx = 0;\r\n        for (let i = 0; i < this.childs.length; i++) {\r\n            if (Math.abs(this.childs[i].position.x) <= max) {\r\n                max = Math.abs(this.childs[i].position.x);\r\n                minidx = i;\r\n            }\r\n        }\r\n        this.moveAim = minidx;\r\n        console.log(\"cocos---2this.moveAim\",this.moveAim);\r\n        this._toMoveX = this.childs[minidx].position.x >= 0 ? -1 : 1;\r\n        this.isTestX = true;\r\n    }\r\n\r\n    _move(dt) {\r\n        if (dt === 0) return;\r\n        if (!this.circlePage) {\r\n            let edge = this._isMoveEdge();\r\n            if (dt < 0 && edge.right) {\r\n                console.log(\"最右边 无法动\");\r\n                return;\r\n            }\r\n            if (dt > 0 && edge.left) {\r\n                console.log(\"最左边 无法动\");\r\n                return;\r\n            }\r\n        }\r\n        for (let i = 0; i < this.childs.length; i++) {\r\n            this._checkChildX(this.childs[i], this.childs[i].position.x + dt);\r\n        }\r\n    }\r\n\r\n\r\n    update(dt) {\r\n        if (this.isTouching || !this.isTestX) {\r\n            return;\r\n        }\r\n        let stepx = this._toMoveX * dt * this.scrollSpeed;\r\n        let lx = this.childs[this.moveAim].position.x;\r\n        for (let i = 0; i < this.childs.length; i++) {\r\n            this._checkChildX(this.childs[i], this.childs[i].position.x + stepx);\r\n        }\r\n\r\n        let x = this.childs[0].position.x;\r\n        let idx = Math.round(x / this.deltaX);\r\n        let tox = this.deltaX * idx;\r\n        let cx = this.childs[this.moveAim].position.x;\r\n        if (lx * cx < 0 && Math.abs(cx) < this.deltaX) {\r\n            this.isTestX = false;\r\n            for (let i = 0; i < this.childs.length; i++) {\r\n                if (Math.abs(this.childs[i].position.x) <= Math.abs(stepx)) {\r\n                    this.currentIndex = i;\r\n                    break;\r\n                }\r\n            }\r\n            for (let i = 0; i < this.childs.length; i++) {\r\n                this._checkChildX(this.childs[i], this.childs[i].position.x + tox - x);\r\n            }\r\n            let event = {\r\n                target: this,\r\n                type: EventType.SCROLL_END,\r\n                index: this.currentIndex\r\n            };\r\n            EventHandler.emitEvents(this.selectEvents, event);\r\n        }\r\n    }\r\n}\r\n"]}