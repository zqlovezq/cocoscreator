{"version":3,"sources":["file:///C:/chickenStarClient/client/assets/scripts/logic/model/chat/ChatPop.ts"],"names":["_decorator","EditBox","instantiate","Node","Prefab","ToggleContainer","ViewPop","InfiniteList","ShowTips","EventMgr","proto","ChatData","RoleData","Func","ChatPlayerItem","ChatControl","ChatServerItem","SensitiveWordsManager","LangMgr","AssociationData","tab","ChatAssociationItem","ccclass","property","ChatTextLabelWidth","ChatTextSize","ChatPop","channelType","ChatChannelType","World","isInitWorldList","isInitSystemList","isInitAssociationList","currMessageInfo","scroll","channelId","lastLen","register","onMsg","Ptl","SendChatMessageRsp","on_s2c_SendChatMessageRsp","ChatMessagePush","on_s2c_Msg_ChatMessagePush","onShow","openData","toggleContainer","toggleItems","isChecked","node_guild_btn","active","ins","getInGuild","initView","initWorldView","System","initSystemView","Guild","initAssociationView","associationNode","worldNode","systemNode","worldEditbox","node","getChanneIdByType","getMessageInfosByType","length","associationList","Init","getCellNumber","GetCellNumber","bind","getCellSize","GetCellSize","getCellIdentifer","GetCellIdentifer","getCellView","GetCellView","getCellData","GetCellData","Reload","scheduleOnce","reloadScrollToBottom","worldList","systemList","GetCellSizeSys","nowList","setAllRead","stopAutoScroll","ScrollToCell","setScrollToCell","index","v","idx","isAutoScrolling","chat","getStrZhLen","normal","Math","floor","clientCustomNotice","noticeType","ChatBreviaryType","ChatBreviaryType_GuildGiftBargain","ChatBreviaryType_GuildGiftLow","sender","roleId","id","identifier","selfPfb","getComponent","otherPfb","serverPfb","guildPfb","onClickToggle","event","type","Number","onClickSend","str","string","replace","getLab","check","requestSendChatMessage","msg","error","code","CommonErrorCode","Succeed","SensitiveWords","ChatMsgNotShow","pushMsg","Msg_ChatMessagePush","message","isBottom","posRange","_getActiveCellIndexRange","y"],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAASA,MAAAA,U,OAAAA,U;AAAuBC,MAAAA,O,OAAAA,O;AAASC,MAAAA,W,OAAAA,W;AAAaC,MAAAA,I,OAAAA,I;AAAMC,MAAAA,M,OAAAA,M;AAAyBC,MAAAA,e,OAAAA,e;;AAC5EC,MAAAA,O,iBAAAA,O;;AACFC,MAAAA,Y;;AAEEC,MAAAA,Q,iBAAAA,Q;;AACAC,MAAAA,Q,iBAAAA,Q;;AACAC,MAAAA,K,oBAAAA,K;;AAEAC,MAAAA,Q,iBAAAA,Q;;AACAC,MAAAA,Q,iBAAAA,Q;;AACAC,MAAAA,I,iBAAAA,I;;AACAC,MAAAA,c,iBAAAA,c;;AACAC,MAAAA,W,kBAAAA,W;;AACAC,MAAAA,c,kBAAAA,c;;AACFC,MAAAA,qB;;AACEC,MAAAA,O,kBAAAA,O;;AACAC,MAAAA,e,kBAAAA,e;;AACAC,MAAAA,G,kBAAAA,G;;AACAC,MAAAA,mB,kBAAAA,mB;;;;;;;;;OACH;AAAEC,QAAAA,OAAF;AAAWC,QAAAA;AAAX,O,GAAwBvB,U;AAE9B;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;oCACawB,kB,GAAqB,G;;8BACrBC,Y,GAAe,E;;yBAEfC,O,WADZJ,OAAO,CAAC,UAAD,C,UAEHC,QAAQ;AAAA;AAAA,uC,UAERA,QAAQ;AAAA;AAAA,uC,UAERA,QAAQ;AAAA;AAAA,uC,UAERA,QAAQ,CAACpB,IAAD,C,UAERoB,QAAQ,CAACpB,IAAD,C,UAERoB,QAAQ,CAACpB,IAAD,C,UAERoB,QAAQ,CAACtB,OAAD,C,UAGRsB,QAAQ,CAACnB,MAAD,C,WAGRmB,QAAQ,CAACnB,MAAD,C,WAGRmB,QAAQ,CAACnB,MAAD,C,WAGRmB,QAAQ,CAACnB,MAAD,C,WAERmB,QAAQ,CAAClB,eAAD,C,WAGRkB,QAAQ,CAACpB,IAAD,C,2BA/Bb,MACauB,OADb;AAAA;AAAA,8BACqC;AAAA;AAAA;;AAAA;;AAAA;;AAAA;;AAAA;;AAAA;;AAAA;;AAAA;;AAAA;;AAAA;;AAAA;;AAAA;;AAAA;;AAAA;;AAAA,eAiCzBC,WAjCyB,GAiCY;AAAA;AAAA,8BAAMC,eAAN,CAAsBC,KAjClC;AAAA,eAkCzBC,eAlCyB,GAkCP,KAlCO;AAAA,eAmCzBC,gBAnCyB,GAmCN,KAnCM;AAAA,eAoCzBC,qBApCyB,GAoCD,KApCC;AAAA,eAqCzBC,eArCyB;AAAA,eAsCzBC,MAtCyB;AAAA,eAuCzBC,SAvCyB;AAAA,eAwCzBC,OAxCyB,GAwCP,CAxCO;AAAA;;AA0CjCC,QAAAA,QAAQ,GAAS;AACb;AAAA;AAAA,oCAASC,KAAT,CAAe;AAAA;AAAA,8BAAMC,GAAN,CAAUC,kBAAzB,EAA6C,KAAKC,yBAAlD,EAA6E,IAA7E;AACA;AAAA;AAAA,oCAASH,KAAT,CAAe;AAAA;AAAA,8BAAMC,GAAN,CAAUG,eAAzB,EAA0C,KAAKC,0BAA/C,EAA2E,IAA3E;AACH;;AACDC,QAAAA,MAAM,GAAS;AACX,cAAI,KAAKC,QAAT,EAAmB;AACf,iBAAKlB,WAAL,GAAmB,KAAKkB,QAAL,CAAc,aAAd,CAAnB;AACH;;AACD,cAAI,KAAKlB,WAAL,IAAoB;AAAA;AAAA,8BAAMC,eAAN,CAAsBC,KAA9C,EAAqD;AACjD,iBAAKiB,eAAL,CAAqBC,WAArB,CAAiC,KAAKpB,WAAtC,EAAmDqB,SAAnD,GAA+D,IAA/D;AACH;;AACD,eAAKC,cAAL,CAAoBC,MAApB,GAA6B;AAAA;AAAA,kDAAgBC,GAAhB,CAAoBC,UAApB,EAA7B;AACA,eAAKC,QAAL;AAGH;;AACDA,QAAAA,QAAQ,GAAG;AACP,cAAI,KAAK1B,WAAL,IAAoB;AAAA;AAAA,8BAAMC,eAAN,CAAsBC,KAA9C,EAAqD;AACjD,iBAAKyB,aAAL;AACH,WAFD,MAEO,IAAI,KAAK3B,WAAL,IAAoB;AAAA;AAAA,8BAAMC,eAAN,CAAsB2B,MAA9C,EAAsD;AACzD,iBAAKC,cAAL;AACH,WAFM,MAEA,IAAI,KAAK7B,WAAL,IAAoB;AAAA;AAAA,8BAAMC,eAAN,CAAsB6B,KAA9C,EAAqD;AACxD,iBAAKC,mBAAL;AACH;AACJ;;AACDA,QAAAA,mBAAmB,GAAG;AAClB,eAAKC,eAAL,CAAqBT,MAArB,GAA8B,IAA9B;AACA,eAAKU,SAAL,CAAeV,MAAf,GAAwB,KAAxB;AACA,eAAKW,UAAL,CAAgBX,MAAhB,GAAyB,KAAzB;AACA,eAAKY,YAAL,CAAkBC,IAAlB,CAAuBb,MAAvB,GAAgC,IAAhC;AACA,eAAKf,SAAL,GAAiB;AAAA;AAAA,oCAASgB,GAAT,CAAaa,iBAAb,CAA+B,KAAKrC,WAApC,CAAjB;AACA,eAAKM,eAAL,GAAuB;AAAA;AAAA,oCAASkB,GAAT,CAAac,qBAAb,CAAmC,KAAKtC,WAAxC,CAAvB;AACA,eAAKS,OAAL,GAAe,KAAKH,eAAL,CAAqBiC,MAApC;;AAEA,cAAI,CAAC,KAAKlC,qBAAV,EAAiC;AAC7B,iBAAKmC,eAAL,CAAqBC,IAArB,CAA0B;AACtBC,cAAAA,aAAa,EAAE,KAAKC,aAAL,CAAmBC,IAAnB,CAAwB,IAAxB,CADO;AAEtBC,cAAAA,WAAW,EAAE,KAAKC,WAAL,CAAiBF,IAAjB,CAAsB,IAAtB,CAFS;AAGtBG,cAAAA,gBAAgB,EAAE,KAAKC,gBAAL,CAAsBJ,IAAtB,CAA2B,IAA3B,CAHI;AAItBK,cAAAA,WAAW,EAAE,KAAKC,WAAL,CAAiBN,IAAjB,CAAsB,IAAtB,CAJS;AAKtBO,cAAAA,WAAW,EAAE,KAAKC,WAAL,CAAiBR,IAAjB,CAAsB,IAAtB;AALS,aAA1B;AAOA,iBAAKvC,qBAAL,GAA6B,IAA7B;AACH;;AACD,eAAKE,MAAL,GAAc,KAAKiC,eAAnB;AACA,eAAKjC,MAAL,CAAY8C,MAAZ,CAAmB,IAAnB;;AACA,cAAI,KAAK/C,eAAL,CAAqBiC,MAArB,IAA+B,CAAnC,EAAsC;AAClC,iBAAKe,YAAL,CAAkB,MAAM;AACpB,mBAAKC,oBAAL;AACH,aAFD;AAGH;AACJ;;AACD5B,QAAAA,aAAa,GAAG;AACZ,eAAKM,SAAL,CAAeV,MAAf,GAAwB,IAAxB;AACA,eAAKW,UAAL,CAAgBX,MAAhB,GAAyB,KAAzB;AACA,eAAKS,eAAL,CAAqBT,MAArB,GAA8B,KAA9B;AACA,eAAKY,YAAL,CAAkBC,IAAlB,CAAuBb,MAAvB,GAAgC,IAAhC;AACA,eAAKf,SAAL,GAAiB;AAAA;AAAA,oCAASgB,GAAT,CAAaa,iBAAb,CAA+B,KAAKrC,WAApC,CAAjB;AACA,eAAKM,eAAL,GAAuB;AAAA;AAAA,oCAASkB,GAAT,CAAac,qBAAb,CAAmC,KAAKtC,WAAxC,CAAvB;AACA,eAAKS,OAAL,GAAe,KAAKH,eAAL,CAAqBiC,MAApC;;AACA,cAAI,CAAC,KAAKpC,eAAV,EAA2B;AACvB,iBAAKqD,SAAL,CAAef,IAAf,CAAoB;AAChBC,cAAAA,aAAa,EAAE,KAAKC,aAAL,CAAmBC,IAAnB,CAAwB,IAAxB,CADC;AAEhBC,cAAAA,WAAW,EAAE,KAAKC,WAAL,CAAiBF,IAAjB,CAAsB,IAAtB,CAFG;AAGhBG,cAAAA,gBAAgB,EAAE,KAAKC,gBAAL,CAAsBJ,IAAtB,CAA2B,IAA3B,CAHF;AAIhBK,cAAAA,WAAW,EAAE,KAAKC,WAAL,CAAiBN,IAAjB,CAAsB,IAAtB,CAJG;AAKhBO,cAAAA,WAAW,EAAE,KAAKC,WAAL,CAAiBR,IAAjB,CAAsB,IAAtB;AALG,aAApB;AAOA,iBAAKzC,eAAL,GAAuB,IAAvB;AACH;;AACD,eAAKI,MAAL,GAAc,KAAKiD,SAAnB;AACA,eAAKjD,MAAL,CAAY8C,MAAZ,CAAmB,IAAnB;;AACA,cAAI,KAAK/C,eAAL,CAAqBiC,MAArB,IAA+B,CAAnC,EAAsC;AAClC,iBAAKe,YAAL,CAAkB,MAAM;AACpB,mBAAKC,oBAAL;AACH,aAFD;AAGH;AAEJ;;AACD1B,QAAAA,cAAc,GAAG;AACb,eAAKI,SAAL,CAAeV,MAAf,GAAwB,KAAxB;AACA,eAAKW,UAAL,CAAgBX,MAAhB,GAAyB,IAAzB;AACA,eAAKS,eAAL,CAAqBT,MAArB,GAA8B,KAA9B;AACA,eAAKf,SAAL,GAAiB;AAAA;AAAA,oCAASgB,GAAT,CAAaa,iBAAb,CAA+B,KAAKrC,WAApC,CAAjB;AACA,eAAKM,eAAL,GAAuB;AAAA;AAAA,oCAASkB,GAAT,CAAac,qBAAb,CAAmC,KAAKtC,WAAxC,CAAvB;AACA,eAAKS,OAAL,GAAe,KAAKH,eAAL,CAAqBiC,MAApC;;AACA,cAAI,CAAC,KAAKnC,gBAAV,EAA4B;AACxB,iBAAKqD,UAAL,CAAgBhB,IAAhB,CAAqB;AACjBC,cAAAA,aAAa,EAAE,KAAKC,aAAL,CAAmBC,IAAnB,CAAwB,IAAxB,CADE;AAEjBC,cAAAA,WAAW,EAAE,KAAKa,cAAL,CAAoBd,IAApB,CAAyB,IAAzB,CAFI;AAGjBG,cAAAA,gBAAgB,EAAE,KAAKC,gBAAL,CAAsBJ,IAAtB,CAA2B,IAA3B,CAHD;AAIjBK,cAAAA,WAAW,EAAE,KAAKC,WAAL,CAAiBN,IAAjB,CAAsB,IAAtB,CAJI;AAKjBO,cAAAA,WAAW,EAAE,KAAKC,WAAL,CAAiBR,IAAjB,CAAsB,IAAtB;AALI,aAArB;AAOA,iBAAKxC,gBAAL,GAAwB,IAAxB;AACH;;AAGD,eAAKG,MAAL,GAAc,KAAKkD,UAAnB;AACA,eAAKlD,MAAL,CAAY8C,MAAZ,CAAmB,IAAnB;;AACA,cAAI,KAAK/C,eAAL,CAAqBiC,MAArB,IAA+B,CAAnC,EAAsC;AAClC,iBAAKe,YAAL,CAAkB,MAAM;AACpB,mBAAKC,oBAAL;AACH,aAFD;AAGH;AACJ;;AAEDA,QAAAA,oBAAoB,GAAG;AACnB,cAAII,OAAO,GAAG,KAAKrD,eAAnB;AACA,eAAKsD,UAAL;;AACA,cAAID,OAAO,CAACpB,MAAR,IAAkB,EAAtB,EAA0B;AAAC;AACvB,iBAAKhC,MAAL,CAAYsD,cAAZ;AACA,iBAAKtD,MAAL,CAAYuD,YAAZ,CAAyBH,OAAO,CAACpB,MAAR,GAAiB,CAA1C,EAA6C,CAA7C;AACA,iBAAKwB,eAAL,CAAqBJ,OAAO,CAACpB,MAAR,GAAiB,CAAtC;AACH,WAJD,MAIO;AACH,iBAAKwB,eAAL,CAAqBJ,OAAO,CAACpB,MAAR,GAAiB,CAAtC;AACH;AACJ;;AAEDqB,QAAAA,UAAU,GAAG;AACT,cAAID,OAAO,GAAG,KAAKrD,eAAnB;;AACA,eAAK,IAAI0D,KAAK,GAAG,CAAjB,EAAoBA,KAAK,GAAGL,OAAO,CAACpB,MAApC,EAA4CyB,KAAK,EAAjD,EAAqD;AACjD,kBAAMC,CAAC,GAAGN,OAAO,CAACK,KAAD,CAAjB,CADiD,CAEjD;AACH,WALQ,CAMT;;AACH;;AAEDD,QAAAA,eAAe,CAACG,GAAD,EAAc;AACzB,cAAI,KAAK3D,MAAL,CAAY4D,eAAZ,EAAJ,EAAmC;AAC/B,iBAAK5D,MAAL,CAAYsD,cAAZ;AACH;;AACD,eAAKD,UAAL;AACA,eAAKrD,MAAL,CAAYuD,YAAZ,CAAyBI,GAAG,GAAG,CAA/B;AACH;;AAKDvB,QAAAA,aAAa,GAAW;AACpB,iBAAO,KAAKrC,eAAL,CAAqBiC,MAA5B;AACH;;AAEDO,QAAAA,WAAW,CAACoB,GAAD,EAAsB;AAC7B,cAAIE,IAAI,GAAG,KAAK9D,eAAL,CAAqB4D,GAArB,CAAX;;AACA,cAAIE,IAAJ,EAAU;AACN,gBAAIA,IAAI,CAAC,OAAD,CAAJ,IAAiB,IAArB,EAA2B;AACvBA,cAAAA,IAAI,CAAC,OAAD,CAAJ,GAAgB;AAAA;AAAA,gCAAKC,WAAL,CAAiBD,IAAI,CAACE,MAAtB,CAAhB;AACH;;AAED,mBAAOC,IAAI,CAACC,KAAL,CAAWJ,IAAI,CAAC,OAAD,CAAJ,GAAgBtE,YAAhB,GAA+BD,kBAA1C,IAAgE,EAAhE,GAAqE,EAA5E;AACH,WAND,MAMO;AACH,mBAAO,GAAP;AACH;AACJ;;AACD6D,QAAAA,cAAc,CAACQ,GAAD,EAAsB;AAChC,cAAIE,IAAI,GAAG,KAAK9D,eAAL,CAAqB4D,GAArB,CAAX;;AACA,cAAIE,IAAJ,EAAU;AACN,gBAAIA,IAAI,CAAC,OAAD,CAAJ,IAAiB,IAArB,EAA2B;AACvBA,cAAAA,IAAI,CAAC,OAAD,CAAJ,GAAgB;AAAA;AAAA,gCAAKC,WAAL,CAAiBD,IAAI,CAACE,MAAtB,CAAhB;AACH;;AAED,mBAAOC,IAAI,CAACC,KAAL,CAAWJ,IAAI,CAAC,OAAD,CAAJ,GAAgBtE,YAAhB,GAA+BD,kBAA1C,IAAgE,EAAhE,GAAqE,EAA5E;AACH,WAND,MAMO;AACH,mBAAO,GAAP;AACH;AACJ;;AACDmD,QAAAA,gBAAgB,CAACkB,GAAD,EAAsB;AAClC,cAAI,KAAKlE,WAAL,IAAoB;AAAA;AAAA,8BAAMC,eAAN,CAAsB2B,MAA9C,EAAsD;AAClD,mBAAO,gBAAP;AACH,WAFD,MAEO;AACH,gBAAIwC,IAAI,GAAG,KAAK9D,eAAL,CAAqB4D,GAArB,CAAX;;AACA,gBAAIE,IAAI,CAACK,kBAAL,KAA0BL,IAAI,CAACK,kBAAL,CAAwBC,UAAxB,KAAuC;AAAA;AAAA,4BAAIC,gBAAJ,CAAqBC,iCAA5D,IAAiGR,IAAI,CAACK,kBAAL,CAAwBC,UAAxB,KAAuC;AAAA;AAAA,4BAAIC,gBAAJ,CAAqBE,6BAAvL,CAAJ,EAA2N;AACvN,qBAAO,qBAAP;AACH;;AACD,gBAAIT,IAAI,IAAIA,IAAI,CAACU,MAAL,CAAYC,MAAZ,IAAsB;AAAA;AAAA,sCAASvD,GAAT,CAAawD,EAA/C,EAAmD;AAC/C,qBAAO,gBAAP;AACH;;AACD,mBAAO,eAAP;AACH;AAEJ;;AAED9B,QAAAA,WAAW,CAACgB,GAAD,EAAce,UAAd,EAAgD;AACvD,kBAAQA,UAAR;AACI,iBAAK,gBAAL;AACI,qBAAO1G,WAAW,CAAC,KAAK2G,OAAN,CAAX,CAA0BC,YAA1B;AAAA;AAAA,mDAAP;;AACJ,iBAAK,eAAL;AACI,qBAAO5G,WAAW,CAAC,KAAK6G,QAAN,CAAX,CAA2BD,YAA3B;AAAA;AAAA,mDAAP;;AACJ,iBAAK,gBAAL;AACI,qBAAO5G,WAAW,CAAC,KAAK8G,SAAN,CAAX,CAA4BF,YAA5B;AAAA;AAAA,mDAAP;;AACJ,iBAAK,qBAAL;AACI,qBAAO5G,WAAW,CAAC,KAAK+G,QAAN,CAAX,CAA2BH,YAA3B;AAAA;AAAA,6DAAP;AARR;;AAUA,iBAAO,IAAP;AACH;;AAED/B,QAAAA,WAAW,CAACc,GAAD,EAAc;AACrB,iBAAO,KAAK5D,eAAL,CAAqB4D,GAArB,CAAP;AACH;;AAEDqB,QAAAA,aAAa,CAACC,KAAD,EAAQC,IAAR,EAAc;AACvBA,UAAAA,IAAI,GAAGC,MAAM,CAACD,IAAD,CAAb;;AACA,cAAI,KAAKzF,WAAL,IAAoByF,IAAxB,EAA8B;AAC1B,iBAAKzF,WAAL,GAAmByF,IAAnB;;AACA,gBAAI,KAAKzF,WAAL,IAAoB;AAAA;AAAA,gCAAMC,eAAN,CAAsB2B,MAA9C,EAAsD;AAClD,mBAAKC,cAAL;AACH,aAFD,MAEO,IAAI,KAAK7B,WAAL,IAAoB;AAAA;AAAA,gCAAMC,eAAN,CAAsBC,KAA9C,EAAqD;AACxD,mBAAKyB,aAAL;AACH,aAFM,MAEA,IAAI,KAAK3B,WAAL,IAAoB;AAAA;AAAA,gCAAMC,eAAN,CAAsB6B,KAA9C,EAAqD;AACxD,mBAAKC,mBAAL;AACH;AACJ;AAEJ;;AACD4D,QAAAA,WAAW,GAAG;AACV,cAAIC,GAAG,GAAG,KAAKzD,YAAL,CAAkB0D,MAAlB,CAAyBC,OAAzB,CAAiC,gBAAjC,EAAmD,EAAnD,CAAV;;AACA,cAAIF,GAAG,IAAI,EAAX,EAAe;AACX;AACA;AAAA;AAAA,sCAAS;AAAA;AAAA,oCAAQG,MAAR,CAAe,aAAf,CAAT;AACA;AACH;;AACD,cAAI,CAAC;AAAA;AAAA,8DAAsBvE,GAAtB,CAA0BwE,KAA1B,CAAgCJ,GAAhC,CAAL,EAA2C;AACvC;AAAA;AAAA,sCAAS;AAAA;AAAA,oCAAQG,MAAR,CAAe,mBAAf,CAAT;AACA;AACH;;AAED;AAAA;AAAA,0CAAYvE,GAAZ,CAAgByE,sBAAhB,CAAuC,KAAKzF,SAA5C,EAAuDoF,GAAvD,EAZU,CAaV;AACA;AACA;AAEA;AACA;AACA;AACA;AACH;;AACD9E,QAAAA,yBAAyB,CAACoF,GAAD,EAAoC;AACzD,cAAIA,GAAG,CAACC,KAAJ,CAAUC,IAAV,IAAkB;AAAA;AAAA,8BAAMC,eAAN,CAAsBC,OAA5C,EAAqD;AACjD,iBAAKnE,YAAL,CAAkB0D,MAAlB,GAA2B,EAA3B;AACH,WAFD,MAEM,IAAIK,GAAG,CAACC,KAAJ,CAAUC,IAAV,IAAkB;AAAA;AAAA,8BAAMC,eAAN,CAAsBE,cAA5C,EAA2D;AAC7D,iBAAKpE,YAAL,CAAkB0D,MAAlB,GAA2B,EAA3B;AACH,WAFK,MAEA,IAAIK,GAAG,CAACC,KAAJ,CAAUC,IAAV,IAAkB;AAAA;AAAA,8BAAMC,eAAN,CAAsBG,cAA5C,EAA2D;AAC7D,iBAAKrE,YAAL,CAAkB0D,MAAlB,GAA2B,EAA3B;AACA,gBAAIY,OAAO,GAAG,IAAI;AAAA;AAAA,gCAAMC,mBAAV,EAAd;AACAD,YAAAA,OAAO,CAACE,OAAR,GAAkBT,GAAG,CAACS,OAAtB;AACA,iBAAK3F,0BAAL,CAAgCyF,OAAhC;AACH;AAEJ;;AACDzF,QAAAA,0BAA0B,CAACkF,GAAD,EAAiC;AACvD,cAAIR,MAAM,CAACQ,GAAG,CAACS,OAAJ,CAAYnG,SAAb,CAAN,IAAiCkF,MAAM,CAAC,KAAKlF,SAAN,CAA3C,EAA6D;AACzD,iBAAKF,eAAL,GAAuB;AAAA;AAAA,sCAASkB,GAAT,CAAac,qBAAb,CAAmC,KAAKtC,WAAxC,CAAvB;AACA,iBAAKO,MAAL,CAAY8C,MAAZ,CAAmB,IAAnB;;AACA,gBAAI,KAAK5C,OAAL,IAAgB,CAApB,EAAuB;AACnB,mBAAKA,OAAL,GAAe,KAAKH,eAAL,CAAqBiC,MAApC;AACH;;AACD,gBAAIqE,QAAQ,GAAG,KAAf;;AACA,gBAAIC,QAAQ,GAAG,KAAKtG,MAAL,CAAYuG,wBAAZ,EAAf;;AACA,gBAAI,KAAKrG,OAAL,GAAeoG,QAAQ,CAACE,CAAxB,IAA6B,CAAjC,EAAoC;AAChCH,cAAAA,QAAQ,GAAG,IAAX;AACH;;AACD,iBAAKnG,OAAL,GAAe,KAAKH,eAAL,CAAqBiC,MAApC;;AACA,gBAAIqE,QAAJ,EAAc;AACV,mBAAKtD,YAAL,CAAkB,MAAM;AACpB,qBAAKC,oBAAL;AACH,eAFD;AAGH;AAEJ;AAEJ;;AAzTgC,O;;;;;iBAEP,I;;;;;;;iBAEC,I;;;;;;;iBAEK,I;;;;;;;iBAEd,I;;;;;;;iBAEC,I;;;;;;;iBAEK,I;;;;;;;iBAEA,I;;;;;;;iBAGN,I;;;;;;;iBAGC,I;;;;;;;iBAGC,I;;;;;;;iBAGD,I;;;;;;;iBAEgB,I;;;;;;;iBAGZ,I","sourcesContent":["import { _decorator, Component, EditBox, instantiate, Node, Prefab, ToggleComponent, ToggleContainer } from 'cc';\r\nimport { ViewPop } from '../../../framework/base/ViewPop';\r\nimport InfiniteList from '../../../Common/InfiniteList/InfiniteList';\r\nimport InfiniteCell from '../../../Common/InfiniteList/InfiniteCell';\r\nimport { ShowTips } from '../../mgr/UIMgr';\r\nimport { EventMgr } from '../../mgr/EventMgr';\r\nimport { proto } from 'client_protocol';\r\nimport { ChatMessageInfo } from './ChatMessageInfo';\r\nimport { ChatData } from './ChatData';\r\nimport { RoleData } from '../role/RoleData';\r\nimport { Func } from '../../utils/Func';\r\nimport { ChatPlayerItem } from './ChatPlayerItem';\r\nimport { ChatControl } from './ChatControl';\r\nimport { ChatServerItem } from './ChatServerItem';\r\nimport SensitiveWordsManager from '../../utils/SensitiveWordsManager';\r\nimport { LangMgr } from '../../mgr/LangMgr';\r\nimport { AssociationData } from '../association/AssociationData';\r\nimport { tab } from '../../../Table/table_gen';\r\nimport { ChatAssociationItem } from './ChatAssociationItem';\r\nconst { ccclass, property } = _decorator;\r\n\r\n/**\r\n * \r\n * ChatView\r\n * zhudingchao\r\n * Thu Jun 13 2024 16:29:31 GMT+0800 (中国标准时间)\r\n * db://assets/scripts/logic/model/chat/ChatView.ts\r\n *\r\n */\r\nexport const ChatTextLabelWidth = 390\r\nexport const ChatTextSize = 20\r\n@ccclass('ChatView')\r\nexport class ChatPop extends ViewPop {\r\n    @property(InfiniteList)\r\n    worldList: InfiniteList = null;\r\n    @property(InfiniteList)\r\n    systemList: InfiniteList = null;\r\n    @property(InfiniteList)\r\n    associationList: InfiniteList = null;\r\n    @property(Node)\r\n    worldNode: Node = null;\r\n    @property(Node)\r\n    systemNode: Node = null;\r\n    @property(Node)\r\n    associationNode: Node = null;\r\n    @property(EditBox)\r\n    worldEditbox: EditBox = null;\r\n\r\n    @property(Prefab)\r\n    selfPfb: Prefab = null\r\n\r\n    @property(Prefab)\r\n    otherPfb: Prefab = null\r\n\r\n    @property(Prefab)\r\n    serverPfb: Prefab = null\r\n\r\n    @property(Prefab)\r\n    guildPfb: Prefab = null\r\n    @property(ToggleContainer)\r\n    toggleContainer: ToggleContainer = null;\r\n\r\n    @property(Node)\r\n    node_guild_btn: Node = null;\r\n\r\n    private channelType: proto.ChatChannelType = proto.ChatChannelType.World;\r\n    private isInitWorldList = false;\r\n    private isInitSystemList = false;\r\n    private isInitAssociationList = false;\r\n    private currMessageInfo: Array<ChatMessageInfo>;\r\n    private scroll: InfiniteList;\r\n    private channelId: number;\r\n    private lastLen: number = 0;\r\n\r\n    register(): void {\r\n        EventMgr.onMsg(proto.Ptl.SendChatMessageRsp, this.on_s2c_SendChatMessageRsp, this);\r\n        EventMgr.onMsg(proto.Ptl.ChatMessagePush, this.on_s2c_Msg_ChatMessagePush, this);\r\n    }\r\n    onShow(): void {\r\n        if (this.openData) {\r\n            this.channelType = this.openData[\"channelType\"];\r\n        }\r\n        if (this.channelType != proto.ChatChannelType.World) {\r\n            this.toggleContainer.toggleItems[this.channelType].isChecked = true;\r\n        }\r\n        this.node_guild_btn.active = AssociationData.ins.getInGuild();\r\n        this.initView();\r\n\r\n\r\n    }\r\n    initView() {\r\n        if (this.channelType == proto.ChatChannelType.World) {\r\n            this.initWorldView();\r\n        } else if (this.channelType == proto.ChatChannelType.System) {\r\n            this.initSystemView();\r\n        } else if (this.channelType == proto.ChatChannelType.Guild) {\r\n            this.initAssociationView();\r\n        }\r\n    }\r\n    initAssociationView() {\r\n        this.associationNode.active = true;\r\n        this.worldNode.active = false;\r\n        this.systemNode.active = false;\r\n        this.worldEditbox.node.active = true;\r\n        this.channelId = ChatData.ins.getChanneIdByType(this.channelType);\r\n        this.currMessageInfo = ChatData.ins.getMessageInfosByType(this.channelType);\r\n        this.lastLen = this.currMessageInfo.length;\r\n\r\n        if (!this.isInitAssociationList) {\r\n            this.associationList.Init({\r\n                getCellNumber: this.GetCellNumber.bind(this),\r\n                getCellSize: this.GetCellSize.bind(this),\r\n                getCellIdentifer: this.GetCellIdentifer.bind(this),\r\n                getCellView: this.GetCellView.bind(this),\r\n                getCellData: this.GetCellData.bind(this),\r\n            });\r\n            this.isInitAssociationList = true;\r\n        }\r\n        this.scroll = this.associationList;\r\n        this.scroll.Reload(true);\r\n        if (this.currMessageInfo.length != 0) {\r\n            this.scheduleOnce(() => {\r\n                this.reloadScrollToBottom();\r\n            })\r\n        }\r\n    }\r\n    initWorldView() {\r\n        this.worldNode.active = true;\r\n        this.systemNode.active = false;\r\n        this.associationNode.active = false;\r\n        this.worldEditbox.node.active = true;\r\n        this.channelId = ChatData.ins.getChanneIdByType(this.channelType);\r\n        this.currMessageInfo = ChatData.ins.getMessageInfosByType(this.channelType);\r\n        this.lastLen = this.currMessageInfo.length;\r\n        if (!this.isInitWorldList) {\r\n            this.worldList.Init({\r\n                getCellNumber: this.GetCellNumber.bind(this),\r\n                getCellSize: this.GetCellSize.bind(this),\r\n                getCellIdentifer: this.GetCellIdentifer.bind(this),\r\n                getCellView: this.GetCellView.bind(this),\r\n                getCellData: this.GetCellData.bind(this),\r\n            });\r\n            this.isInitWorldList = true;\r\n        }\r\n        this.scroll = this.worldList;\r\n        this.scroll.Reload(true);\r\n        if (this.currMessageInfo.length != 0) {\r\n            this.scheduleOnce(() => {\r\n                this.reloadScrollToBottom();\r\n            })\r\n        }\r\n\r\n    }\r\n    initSystemView() {\r\n        this.worldNode.active = false;\r\n        this.systemNode.active = true;\r\n        this.associationNode.active = false;\r\n        this.channelId = ChatData.ins.getChanneIdByType(this.channelType);\r\n        this.currMessageInfo = ChatData.ins.getMessageInfosByType(this.channelType);\r\n        this.lastLen = this.currMessageInfo.length;\r\n        if (!this.isInitSystemList) {\r\n            this.systemList.Init({\r\n                getCellNumber: this.GetCellNumber.bind(this),\r\n                getCellSize: this.GetCellSizeSys.bind(this),\r\n                getCellIdentifer: this.GetCellIdentifer.bind(this),\r\n                getCellView: this.GetCellView.bind(this),\r\n                getCellData: this.GetCellData.bind(this),\r\n            });\r\n            this.isInitSystemList = true;\r\n        }\r\n\r\n\r\n        this.scroll = this.systemList;\r\n        this.scroll.Reload(true);\r\n        if (this.currMessageInfo.length != 0) {\r\n            this.scheduleOnce(() => {\r\n                this.reloadScrollToBottom();\r\n            })\r\n        }\r\n    }\r\n\r\n    reloadScrollToBottom() {\r\n        let nowList = this.currMessageInfo;\r\n        this.setAllRead()\r\n        if (nowList.length >= 10) {//从0-n可能太多， 就只滑动最后3个\r\n            this.scroll.stopAutoScroll()\r\n            this.scroll.ScrollToCell(nowList.length - 4, 0)\r\n            this.setScrollToCell(nowList.length - 1)\r\n        } else {\r\n            this.setScrollToCell(nowList.length - 1)\r\n        }\r\n    }\r\n\r\n    setAllRead() {\r\n        let nowList = this.currMessageInfo;\r\n        for (let index = 0; index < nowList.length; index++) {\r\n            const v = nowList[index];\r\n            // v.isReaded = true\r\n        }\r\n        // this.checkRead()\r\n    }\r\n\r\n    setScrollToCell(idx: number) {\r\n        if (this.scroll.isAutoScrolling()) {\r\n            this.scroll.stopAutoScroll()\r\n        }\r\n        this.setAllRead()\r\n        this.scroll.ScrollToCell(idx - 1)\r\n    }\r\n\r\n\r\n\r\n\r\n    GetCellNumber(): number {\r\n        return this.currMessageInfo.length\r\n    }\r\n\r\n    GetCellSize(idx: number): number {\r\n        let chat = this.currMessageInfo[idx]\r\n        if (chat) {\r\n            if (chat[\"zhLen\"] == null) {\r\n                chat[\"zhLen\"] = Func.getStrZhLen(chat.normal)\r\n            }\r\n\r\n            return Math.floor(chat[\"zhLen\"] * ChatTextSize / ChatTextLabelWidth) * 30 + 95\r\n        } else {\r\n            return 120;\r\n        }\r\n    }\r\n    GetCellSizeSys(idx: number): number {\r\n        let chat = this.currMessageInfo[idx]\r\n        if (chat) {\r\n            if (chat[\"zhLen\"] == null) {\r\n                chat[\"zhLen\"] = Func.getStrZhLen(chat.normal)\r\n            }\r\n\r\n            return Math.floor(chat[\"zhLen\"] * ChatTextSize / ChatTextLabelWidth) * 20 + 50\r\n        } else {\r\n            return 120;\r\n        }\r\n    }\r\n    GetCellIdentifer(idx: number): string {\r\n        if (this.channelType == proto.ChatChannelType.System) {\r\n            return \"ChatServerItem\";\r\n        } else {\r\n            let chat = this.currMessageInfo[idx]\r\n            if (chat.clientCustomNotice&&(chat.clientCustomNotice.noticeType === tab.ChatBreviaryType.ChatBreviaryType_GuildGiftBargain || chat.clientCustomNotice.noticeType === tab.ChatBreviaryType.ChatBreviaryType_GuildGiftLow)) {\r\n                return \"ChatAssociationItem\";\r\n            }\r\n            if (chat && chat.sender.roleId == RoleData.ins.id) {\r\n                return \"ChatPlayerItem\";\r\n            }\r\n            return \"ChatOtherItem\";\r\n        }\r\n\r\n    }\r\n\r\n    GetCellView(idx: number, identifier: string): InfiniteCell {\r\n        switch (identifier) {\r\n            case \"ChatPlayerItem\":\r\n                return instantiate(this.selfPfb).getComponent(ChatPlayerItem);\r\n            case \"ChatOtherItem\":\r\n                return instantiate(this.otherPfb).getComponent(ChatPlayerItem);\r\n            case \"ChatServerItem\":\r\n                return instantiate(this.serverPfb).getComponent(ChatServerItem);\r\n            case \"ChatAssociationItem\":\r\n                return instantiate(this.guildPfb).getComponent(ChatAssociationItem);\r\n        }\r\n        return null;\r\n    }\r\n\r\n    GetCellData(idx: number) {\r\n        return this.currMessageInfo[idx];\r\n    }\r\n\r\n    onClickToggle(event, type) {\r\n        type = Number(type);\r\n        if (this.channelType != type) {\r\n            this.channelType = type;\r\n            if (this.channelType == proto.ChatChannelType.System) {\r\n                this.initSystemView();\r\n            } else if (this.channelType == proto.ChatChannelType.World) {\r\n                this.initWorldView();\r\n            } else if (this.channelType == proto.ChatChannelType.Guild) {\r\n                this.initAssociationView();\r\n            }\r\n        }\r\n\r\n    }\r\n    onClickSend() {\r\n        var str = this.worldEditbox.string.replace(/(^\\s*)|(\\s*$)/g, \"\")\r\n        if (str == \"\") {\r\n            //ShowTips(\"请输入聊天内容\")\r\n            ShowTips(LangMgr.getLab(\"Tips_chat_1\"))\r\n            return\r\n        }\r\n        if (!SensitiveWordsManager.ins.check(str)) {\r\n            ShowTips(LangMgr.getLab(\"CommonErrorCode_4\"));\r\n            return\r\n        }\r\n\r\n        ChatControl.ins.requestSendChatMessage(this.channelId, str);\r\n        // let chat = new proto.ChatMessage()\r\n        // chat.type = ChatType.text\r\n        // chat.normal = new proto.ChatMessageNormal({ content: str })\r\n\r\n        // if (ChatCtrl.ins.sendChat(this.selectId, chat)) {\r\n        //     this.editBox.string = \"\"\r\n        //     this.checkCd()\r\n        // }\r\n    }\r\n    on_s2c_SendChatMessageRsp(msg: proto.Msg_SendChatMessageRsp) {\r\n        if (msg.error.code == proto.CommonErrorCode.Succeed) {\r\n            this.worldEditbox.string = \"\";\r\n        }else if (msg.error.code == proto.CommonErrorCode.SensitiveWords){\r\n            this.worldEditbox.string = \"\";\r\n        }else if (msg.error.code == proto.CommonErrorCode.ChatMsgNotShow){\r\n            this.worldEditbox.string = \"\";\r\n            let pushMsg = new proto.Msg_ChatMessagePush()\r\n            pushMsg.message = msg.message\r\n            this.on_s2c_Msg_ChatMessagePush(pushMsg)\r\n        }\r\n\r\n    }\r\n    on_s2c_Msg_ChatMessagePush(msg: proto.Msg_ChatMessagePush) {\r\n        if (Number(msg.message.channelId) == Number(this.channelId)) {\r\n            this.currMessageInfo = ChatData.ins.getMessageInfosByType(this.channelType);\r\n            this.scroll.Reload(true);\r\n            if (this.lastLen == 0) {\r\n                this.lastLen = this.currMessageInfo.length;\r\n            }\r\n            let isBottom = false\r\n            let posRange = this.scroll._getActiveCellIndexRange()\r\n            if (this.lastLen - posRange.y <= 2) {\r\n                isBottom = true;\r\n            }\r\n            this.lastLen = this.currMessageInfo.length;\r\n            if (isBottom) {\r\n                this.scheduleOnce(() => {\r\n                    this.reloadScrollToBottom();\r\n                })\r\n            }\r\n\r\n        }\r\n\r\n    }\r\n}"]}