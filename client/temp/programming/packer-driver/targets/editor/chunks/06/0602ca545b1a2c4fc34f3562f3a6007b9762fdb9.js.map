{"version":3,"sources":["file:///C:/chickenStarClient/client/assets/scripts/logic/model/rareBook/RareBookInfo.ts"],"names":["_decorator","proto","tab","RareBookData","ItemData","Func","RareBookControl","RedMgr","RedDotType","RoleData","ccclass","property","RareBookInfo","BookData","_bookTable","_itemTable","isLock","_isWear","_bookLevelTable","_bookStarTable","_attrMap","maxStar","_fragmentTable","_isRedPoint","_tujianRedPoint","_isCanStudy","_isCanUpStar","_nextLevelTable","isMaxLevel","merge","bookInfo","key","value","Number","getItem","ins","id","String","value2","updateCanStudy","updateCanUpStar","initItemId","itemId","star","level","update","nextLevelTable","initBookLevelTable","getBookLevelTable","bookTable","Aptitude","Class","initBookStarTable","getBoolStarTable","getAttrMapByLevelRatio","ratio","types","values","map","Map","bookStarTable","AttrType","AttrValue","t","v","Math","floor","has","set","get","initAttrMap","bookLevelTable","Ratio","fragmentTable","getBookFragmentByBookItemId","getData","BookTableById","getValue","itemTable","ItemTableById","isWear","b","levelRatio","attrMap","isLevelLimit","MaxLevel","isMaxStar","isCanActivate","curr","getCount","Id","Count","isRedPoint","isCanStudy","isCanUpStar","setItem","refreshEvent","Book_Job","firstLookRed","tujianRedPoint","refreshfTujianRedPoint","nextLevel","nextLavelTable","itemid","isItemsEnoughByList","MaterialIdList","MaterialCountList","needNum","currNum","Quality","GetKeyValue_ConfigTable","BookStarUniversalMaterialQuality","BookStarUniversalMaterial","currNum2"],"mappings":"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","sourcesContent":["import { _decorator, Component, Node } from 'cc';\r\nimport { proto } from 'client_protocol';\r\nimport { tab } from '../../../Table/table_gen';\r\nimport { RareBookData } from './RareBookData';\r\nimport { ItemData } from '../item/ItemData';\r\nimport { Func } from '../../utils/Func';\r\nimport { RareBookControl } from './RareBookControl';\r\nimport { RedMgr } from '../../mgr/RedMgr';\r\nimport { RedDotType } from '../../red/RedDotType';\r\nimport { RoleData } from '../role/RoleData';\r\nconst { ccclass, property } = _decorator;\r\n\r\n/**\r\n * \r\n * BareBookInfo\r\n * zhudingchao\r\n * Wed May 22 2024 15:32:38 GMT+0800 (中国标准时间)\r\n * db://assets/scripts/logic/model/rareBook/BareBookInfo.ts\r\n *\r\n */\r\n\r\n@ccclass('RareBookInfo')\r\nexport class RareBookInfo extends proto.BookData {\r\n\r\n    private _bookTable: tab.BookTable;\r\n    private _itemTable: tab.ItemTable;\r\n    public isLock: boolean = false;\r\n    private _isWear: boolean = false;\r\n    private _bookLevelTable: tab.BookLevelTable;\r\n    private _bookStarTable: tab.BookStarTable;\r\n    private _attrMap: Map<number, number>;\r\n    public maxStar: number;\r\n    private _fragmentTable: tab.BookFragmentTable;\r\n    private _isRedPoint: boolean = false;\r\n    private _tujianRedPoint: boolean = false;\r\n    private _isCanStudy: boolean = false;\r\n    private _isCanUpStar: boolean = false;\r\n    merge(bookInfo: any) {\r\n        for (const key in bookInfo) {\r\n            this[key] = bookInfo[key]\r\n        }\r\n\r\n        this.isLock = true;\r\n        let value = Number(Func.getItem(\"RareBook_RedPoint_\"+RoleData.ins.id+\"_\" + String(this.id)))\r\n        if (value && value == 1) {\r\n            this._isRedPoint = false;\r\n        } else {\r\n            this._isRedPoint = true;\r\n        }\r\n        let value2 = Number(Func.getItem(\"RareBook_tujianRedPoint_\" + String(this.id)));\r\n        if (value2 && value2 == 1) {\r\n            this._tujianRedPoint = false;\r\n        } else {\r\n            this._tujianRedPoint = true;\r\n        }\r\n        this.updateCanStudy();\r\n        this.updateCanUpStar();\r\n\r\n\r\n    }\r\n    initItemId(itemId: number) {\r\n        this.itemId = itemId;\r\n        this.star = 1;\r\n        this.level = 0;\r\n        this.isLock = false;\r\n    }\r\n    update(bookInfo: any) {\r\n        if (bookInfo.level != this.level) {\r\n            this.nextLevelTable = null;\r\n        }\r\n        for (const key in bookInfo) {\r\n            this[key] = bookInfo[key]\r\n        }\r\n        this._bookLevelTable = null;\r\n        this._bookStarTable = null;\r\n        this._attrMap = null;\r\n        this.updateCanStudy();\r\n        this.updateCanUpStar();\r\n    }\r\n\r\n    private initBookLevelTable() {\r\n        this._bookLevelTable = RareBookData.ins.getBookLevelTable(this.bookTable.Aptitude, this.bookTable.Class, this.level);\r\n    }\r\n    private initBookStarTable() {\r\n        this._bookStarTable = RareBookData.ins.getBoolStarTable(this.itemId, this.star);\r\n    }\r\n\r\n    public getAttrMapByLevelRatio(ratio: number, types: tab.AttrType[] = null, values: number[] = null) {\r\n        let map = new Map();\r\n        if (!types) {\r\n            types = this.bookStarTable.AttrType;\r\n        }\r\n        if (!values) {\r\n            values = this.bookStarTable.AttrValue;\r\n        }\r\n\r\n        for (let key in types) {\r\n            let t = types[key];\r\n            let v = Math.floor(values[key] * (10000 + ratio) / 10000);\r\n            if (map.has(t)) {\r\n                map.set(t, map.get(t) + v);\r\n            } else {\r\n                map.set(t, v);\r\n            }\r\n\r\n        }\r\n        return map;\r\n    }\r\n    private initAttrMap() {\r\n\r\n        this._attrMap = this.getAttrMapByLevelRatio(this.level == 0 ? 0 : this.bookLevelTable.Ratio)\r\n\r\n    }\r\n    get fragmentTable() {\r\n        if (!this._fragmentTable) {\r\n            this._fragmentTable = RareBookData.ins.getBookFragmentByBookItemId(this.itemId);\r\n        }\r\n        return this._fragmentTable;\r\n    }\r\n    get bookTable() {\r\n        if (!this._bookTable) {\r\n            this._bookTable = tab.getData().BookTableById.getValue(this.itemId);\r\n        }\r\n        return this._bookTable;\r\n    }\r\n    get itemTable() {\r\n        if (!this._itemTable) {\r\n            this._itemTable = tab.getData().ItemTableById.getValue(this.itemId);\r\n        }\r\n        return this._itemTable;\r\n    }\r\n    get isWear() {\r\n        return this._isWear;\r\n    }\r\n    set isWear(b: boolean) {\r\n        this._isWear = b;\r\n    }\r\n    get bookLevelTable() {\r\n        if (!this._bookLevelTable && this.level > 0) {\r\n            this.initBookLevelTable();\r\n        }\r\n\r\n        return this._bookLevelTable;\r\n    }\r\n    get bookStarTable() {\r\n        if (!this._bookStarTable) {\r\n            this.initBookStarTable();\r\n        }\r\n        return this._bookStarTable;\r\n    }\r\n\r\n    get levelRatio() {\r\n\r\n        return this.bookLevelTable ? this.bookLevelTable.Ratio : 0;\r\n    }\r\n    get attrMap() {\r\n        if (!this._attrMap) {\r\n            this.initAttrMap();\r\n        }\r\n        return this._attrMap;\r\n    }\r\n    isLevelLimit() {\r\n        return this.level >= this.bookStarTable.MaxLevel;\r\n\r\n    }\r\n\r\n    isMaxStar() {\r\n        return this.star >= this.maxStar;\r\n    }\r\n\r\n    isCanActivate() {\r\n        let curr = ItemData.ins.getCount(this.fragmentTable.Id);\r\n        return curr >= this.fragmentTable.Count\r\n    }\r\n    get isRedPoint() {\r\n       \r\n        if (!this.isLock) {\r\n            if(this.isCanActivate()){\r\n                return true;\r\n            }\r\n            return false;\r\n        }\r\n\r\n        return this._isRedPoint || this.isCanStudy || this.isCanUpStar;\r\n    }\r\n    set isRedPoint(b: boolean) {\r\n        this._isRedPoint = b;\r\n        if (b == false && this.isLock) {\r\n            Func.setItem(\"RareBook_RedPoint_\"+RoleData.ins.id+\"_\" + String(this.id), 1);\r\n            // if(!this.isCanStudy&&!this.isCanUpStar){\r\n                RedMgr.refreshEvent(RedDotType.Book_Job);\r\n                \r\n            // }\r\n           \r\n        }\r\n    }\r\n    get firstLookRed(){\r\n        return this._isRedPoint;\r\n    }\r\n\r\n    get tujianRedPoint() {\r\n        if (!this.isLock) {\r\n            return false;\r\n        }\r\n        return this._tujianRedPoint;\r\n    }\r\n    set tujianRedPoint(b: boolean) {\r\n        this._tujianRedPoint = b;\r\n        if (b == false && this.isLock) {\r\n            Func.setItem(\"RareBook_tujianRedPoint_\" + String(this.id), 1)\r\n            RareBookControl.ins.refreshfTujianRedPoint(this.bookTable.Class);\r\n        }\r\n    }\r\n    private _nextLevelTable: tab.BookLevelTable;\r\n    private isMaxLevel: boolean = false;\r\n\r\n    get nextLevelTable() {\r\n        if (!this._nextLevelTable) {\r\n            let nextLevel = this.level + 1;\r\n            let nextLavelTable = RareBookData.ins.getBookLevelTable(this.bookTable.Aptitude, this.bookTable.Class, nextLevel)\r\n            this._nextLevelTable = nextLavelTable;\r\n            if (this._nextLevelTable) {\r\n                this.isMaxLevel = false;\r\n            } else {\r\n                this.isMaxLevel = true;\r\n            }\r\n        }\r\n        return this._nextLevelTable;\r\n    }\r\n    set nextLevelTable(tab: any) {\r\n        this._nextLevelTable = tab;\r\n    }\r\n    /**是否可以研习 */\r\n    updateCanStudy() {\r\n        let isCanStudy= this._isCanStudy;\r\n        if (!this.isLock || this.isLevelLimit() || this.isMaxLevel || !this.nextLevelTable) {\r\n          this._isCanStudy=false;\r\n        \r\n        }else{\r\n            let itemid = ItemData.ins.isItemsEnoughByList(this.nextLevelTable.MaterialIdList, this.nextLevelTable.MaterialCountList);\r\n          \r\n            this._isCanStudy= itemid <= 0;\r\n        }\r\n      \r\n        return isCanStudy!=this._isCanStudy;\r\n    }\r\n    get isCanStudy(){\r\n        return this._isCanStudy;\r\n    }\r\n    get isCanUpStar(){\r\n        return this._isCanUpStar;\r\n    }\r\n    /**是否可以升星 */\r\n    updateCanUpStar() {\r\n        let isCanUpStar=this._isCanUpStar;\r\n        if (this.bookStarTable && !this.isMaxStar()) {\r\n            let id = this.bookStarTable.MaterialIdList[0];\r\n            let needNum = this.bookStarTable.MaterialCountList[0];\r\n            let currNum = Number(ItemData.ins.getCount(id));\r\n            if (this.itemTable.Quality >= tab.getData().GetKeyValue_ConfigTable().BookStarUniversalMaterialQuality) {\r\n                let itemId = tab.getData().GetKeyValue_ConfigTable().BookStarUniversalMaterial;\r\n                let currNum2 = Number(ItemData.ins.getCount(itemId));\r\n                currNum += currNum2;\r\n\r\n            }\r\n            if (needNum <= currNum) {\r\n                this._isCanUpStar = true;\r\n            } else {\r\n                this._isCanUpStar = false;\r\n            }\r\n        }else{\r\n            this._isCanUpStar = false;\r\n        }\r\n\r\n       \r\n        return isCanUpStar!=this._isCanUpStar;\r\n    }\r\n}"]}