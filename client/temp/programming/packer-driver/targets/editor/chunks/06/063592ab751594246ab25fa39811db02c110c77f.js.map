{"version":3,"sources":["file:///C:/chickenStarClient/client/assets/scripts/logic/model/fengyunRanking/FengyunRankControl.ts"],"names":["_decorator","log","AbsControl","EventMgr","proto","Net","FengyunRankData","RedMgr","RedDotType","ccclass","property","FengyunRankControl","ins","_instance","purge","register","onMsg","Ptl","GetHonorRollMapRsp","on_s2c_GetHonorRollMapRsp","ReceiveHonorRollTasksRewardsRsp","on_s2c_ReceiveHonorRollTasksRewardsRsp","request","reqGetHonorRollMap","msg","Msg_GetHonorRollMapReq","Send","GetHonorRollMapReq","reqReceiveHonorRollTasksRewards","activityId","taskIds","Msg_ReceiveHonorRollTasksRewardsReq","ReceiveHonorRollTasksRewardsReq","initMapData","refreshEvent","Feng_Yun_Rank","error","code","CommonErrorCode","Succeed","info","getHonorRollInfoByActId","key","task","tasks","find","a","id","isReceived"],"mappings":"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","sourcesContent":["import { _decorator, Component, log, Node } from 'cc';\r\nimport { AbsControl } from '../../../framework/base/IAbs';\r\nimport { EventMgr } from '../../mgr/EventMgr';\r\nimport { proto } from 'client_protocol';\r\nimport { Net } from '../../net/Net';\r\nimport { FengyunRankData } from './FengyunRankData';\r\nimport { RedMgr } from '../../mgr/RedMgr';\r\nimport { RedDotType } from '../../red/RedDotType';\r\nconst { ccclass, property } = _decorator;\r\n\r\n/**\r\n * \r\n * FengyunRankControl\r\n * zhudingchao\r\n * Wed Jul 17 2024 19:58:00 GMT+0800 (中国标准时间)\r\n * db://assets/scripts/logic/model/fengyunRanking/FengyunRankControl.ts\r\n *\r\n */\r\n\r\n@ccclass('FengyunRankControl')\r\nexport class FengyunRankControl extends AbsControl {\r\n    private static _instance: FengyunRankControl;\r\n    public static get ins() {\r\n        if (null == this._instance) {\r\n            this._instance = new FengyunRankControl();\r\n        }\r\n        return this._instance;\r\n    }\r\n    purge(): void {\r\n    }\r\n\r\n    register(): void {\r\n        EventMgr.onMsg(proto.Ptl.GetHonorRollMapRsp, this.on_s2c_GetHonorRollMapRsp, this)\r\n        EventMgr.onMsg(proto.Ptl.ReceiveHonorRollTasksRewardsRsp, this.on_s2c_ReceiveHonorRollTasksRewardsRsp, this)\r\n\r\n\r\n\r\n    }\r\n    request() {\r\n\r\n    }\r\n    reqGetHonorRollMap(){\r\n        let msg = new proto.Msg_GetHonorRollMapReq();\r\n        Net.Send(proto.Ptl.GetHonorRollMapReq, msg)\r\n    }\r\n    reqReceiveHonorRollTasksRewards(activityId:number,taskIds:number[]){\r\n        let msg = new proto.Msg_ReceiveHonorRollTasksRewardsReq();\r\n        msg.activityId=activityId;\r\n        msg.taskIds=taskIds;\r\n        Net.Send(proto.Ptl.ReceiveHonorRollTasksRewardsReq, msg)\r\n    }\r\n    on_s2c_GetHonorRollMapRsp(msg: proto.Msg_GetHonorRollMapRsp) {\r\n        FengyunRankData.ins.initMapData(msg);\r\n        RedMgr.refreshEvent(RedDotType.Feng_Yun_Rank);\r\n        log(\"收到荣耀消息==\",msg);\r\n    }\r\n\r\n    on_s2c_ReceiveHonorRollTasksRewardsRsp(msg: proto.Msg_ReceiveHonorRollTasksRewardsRsp) {\r\n        if (!msg.error || msg.error.code == proto.CommonErrorCode.Succeed) {\r\n            // ActivityData.ins.vipMsg.boughtVipGifts.push(msg.vipLevel);\r\n            let info=FengyunRankData.ins.getHonorRollInfoByActId(msg.activityId);\r\n            for(let key in msg.taskIds){\r\n                let task=info.tasks.find(a=>a.id==msg.taskIds[key]);\r\n                if(task){\r\n                    task.isReceived=true;\r\n                }\r\n            }\r\n            \r\n            RedMgr.refreshEvent(RedDotType.Feng_Yun_Rank);\r\n        }\r\n    }\r\n}"]}