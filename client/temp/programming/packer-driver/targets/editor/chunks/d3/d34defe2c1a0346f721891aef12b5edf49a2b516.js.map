{"version":3,"sources":["file:///C:/chickenStarClient/client/assets/scripts/logic/model/association/AssociationInfoPop.ts"],"names":["_decorator","EditBox","Node","Sprite","Toggle","ViewPop","AssociationControl","ASSOCIATIONPOP","SettingsManager","ItemData","ShowItemNotEnoughTips","ShowTips","UIMgr","tab","ViewName","AssociationData","RoleData","LangMgr","ccclass","property","AssociationInfoPop","view_type","NONE","curSelectFlagId","_clickToggle","onShow","openData","view","showView","register","unRegister","onDestroy","node_create","active","CREATE","node_notice","NOTICE","node_change_info","CHANGE","node_donate","DONATE","toggle_auto_enter","isChecked","ins","getSetting","getAssocitionSimpleInfo","flagId","refreshFlagId","reqCreateGuild","DiamondCount","getByItemId","num","getData","GetKeyValue_ConfigTable","CreateGuildCostDiamond","edit_box_create_name","string","length","console","log","curTime","getServerUtcTime","getAssocitionInfo","notAllowJoinTime","str","getCombineString","GuildJoinCd","onClose","edit_box_create_notice","onClickEnter","onClickAutoEnterToggle","onClickChangeNotice","edit_box_change_notice","reqSetGuildNotice","onClickChangeInfo","GuildChangeNameCost","edit_box_change_name","reqSetGuildNameAndFlag","onClickChangeFlagId","show","viewName","AssociationChangeFlagPop","flagtab","GuildFlagTableById","getValue","sp_flag_img","setTexture","IconUrl"],"mappings":"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","sourcesContent":["import { _decorator, Component, EditBox, EventTouch, Node, Sprite, Toggle } from 'cc';\r\nimport { ViewPop } from '../../../framework/base/ViewPop';\r\nimport { AssociationControl } from './AssociationControl';\r\nimport { ASSOCIATIONPOP } from '../../../Common/script/EnumTypeMgr';\r\nimport { SettingsManager } from '../role/SettingsManager';\r\nimport { ItemInfo } from '../item/ItemInfo';\r\nimport { ItemData } from '../item/ItemData';\r\nimport { ShowItemNotEnoughTips, ShowTips, UIMgr } from '../../mgr/UIMgr';\r\nimport { tab } from '../../../Table/table_gen';\r\nimport { EventMgr } from '../../mgr/EventMgr';\r\nimport { LocalEvent } from '../../define/LocalEvent';\r\nimport { ViewName } from '../../define/ViewDefine';\r\nimport { AssociationData } from './AssociationData';\r\nimport { GameUtil } from '../../utils/GameUtil';\r\nimport { RoleData } from '../role/RoleData';\r\nimport { LangMgr } from '../../mgr/LangMgr';\r\nconst { ccclass, property } = _decorator;\r\n\r\n@ccclass('AssociationInfoPop')\r\nexport class AssociationInfoPop extends ViewPop {\r\n    @property(Node)\r\n    node_create:Node = null;//创建鸡舍节点\r\n    @property(Node)\r\n    node_notice:Node = null;//修改公告鸡舍节点\r\n    @property(Node)\r\n    node_change_info:Node = null;//修改信息鸡舍节点\r\n    @property(Node)\r\n    node_donate:Node = null;//捐献鸡舍节点\r\n    @property(Toggle)\r\n    toggle_auto_enter:Toggle = null;//自动审批加入按钮\r\n    @property(EditBox)\r\n    edit_box_create_name:EditBox = null;//创建公会的名字\r\n    @property(EditBox)\r\n    edit_box_create_notice:EditBox = null;//创建公会的公告\r\n    @property(EditBox)\r\n    edit_box_change_notice:EditBox = null;//更改公会的公告\r\n    @property(EditBox)\r\n    edit_box_change_name:EditBox = null;//更改公会的公告\r\n    @property(Sprite)\r\n    sp_flag_img:Sprite = null;\r\n    private view_type:ASSOCIATIONPOP = ASSOCIATIONPOP.NONE\r\n    public curSelectFlagId: number = 0;\r\n    private _clickToggle:boolean = false\r\n    onShow(): void {\r\n        this.view_type = this.openData.view;\r\n        this.showView();\r\n    }\r\n    register(): void {\r\n        \r\n    }\r\n    unRegister(): void {\r\n        super.unRegister();\r\n    }\r\n    protected onDestroy(): void {\r\n        super.onDestroy();\r\n    }\r\n    showView(){\r\n        this.node_create.active = this.view_type===ASSOCIATIONPOP.CREATE;\r\n        this.node_notice.active = this.view_type===ASSOCIATIONPOP.NOTICE;\r\n        this.node_change_info.active = this.view_type===ASSOCIATIONPOP.CHANGE;\r\n        this.node_donate.active = this.view_type===ASSOCIATIONPOP.DONATE;\r\n        switch (this.view_type) {\r\n            case ASSOCIATIONPOP.CREATE:\r\n                this.toggle_auto_enter.isChecked = !SettingsManager.ins.getSetting(\"needCheckAssociation\")\r\n                break;\r\n            case ASSOCIATIONPOP.CHANGE:\r\n                this.curSelectFlagId = AssociationData.ins.getAssocitionSimpleInfo().flagId?AssociationData.ins.getAssocitionSimpleInfo().flagId:1;\r\n                this.refreshFlagId();\r\n                break;\r\n            default:\r\n                break;\r\n        }\r\n    }\r\n    /* 创建公会 */\r\n    reqCreateGuild(){\r\n        // 钻石不足\r\n        const DiamondCount = ItemData.ins.getByItemId(1).num;\r\n        if(DiamondCount<tab.getData().GetKeyValue_ConfigTable().CreateGuildCostDiamond){\r\n            ShowItemNotEnoughTips(1);\r\n            return;\r\n        }\r\n        if(this.edit_box_create_name.string.length===0){\r\n            console.log(\"公会名字不能为空\")\r\n            return;\r\n        }\r\n        // 当前时间不足\r\n        const curTime = RoleData.ins.getServerUtcTime(); \r\n        if(AssociationData.ins.getAssocitionInfo()&&curTime<AssociationData.ins.getAssocitionInfo().notAllowJoinTime){\r\n            console.log(\"创建公会cd未结束\");\r\n            const str = LangMgr.getCombineString(\"Tips_association_4\",[tab.getData().GetKeyValue_ConfigTable().GuildJoinCd/60]);\r\n            ShowTips(str);\r\n            return\r\n        }\r\n        this.onClose();\r\n        AssociationControl.ins.reqCreateGuild(this.edit_box_create_name.string,0,this.edit_box_create_notice.string,this.toggle_auto_enter.isChecked);\r\n    }\r\n    onClickEnter(){\r\n        this._clickToggle = true;\r\n    }\r\n    onClickAutoEnterToggle(){\r\n        if(this._clickToggle){\r\n            this._clickToggle = false;\r\n        }\r\n    }\r\n    /* 更改公告 */\r\n    onClickChangeNotice(){\r\n        if(this.edit_box_change_notice.string.length===0){\r\n            console.log(\"更改公告不能为空\")\r\n            return;\r\n        }\r\n        AssociationControl.ins.reqSetGuildNotice(this.edit_box_change_notice.string);\r\n    }\r\n    /* 更换旗帜跟公会名字 */\r\n    onClickChangeInfo(){\r\n        const DiamondCount = ItemData.ins.getByItemId(1).num;\r\n        if(DiamondCount<tab.getData().GetKeyValue_ConfigTable().GuildChangeNameCost){\r\n            ShowItemNotEnoughTips(1);\r\n            return;\r\n        }\r\n        if(this.edit_box_change_name.string.length===0){\r\n            console.log(\"更改信息名字不能为空\")\r\n            return;\r\n        }\r\n        AssociationControl.ins.reqSetGuildNameAndFlag(this.edit_box_change_name.string,this.curSelectFlagId);\r\n    }  \r\n    /* 点击更换旗帜 */\r\n    onClickChangeFlagId(){\r\n        UIMgr.ins.show({ viewName: ViewName.AssociationChangeFlagPop})\r\n    }\r\n    refreshFlagId(){\r\n        const flagtab = tab.getData().GuildFlagTableById.getValue(this.curSelectFlagId);\r\n        this.sp_flag_img.setTexture(flagtab.IconUrl);\r\n    }\r\n}\r\n\r\n\r\n"]}