{"version":3,"sources":["file:///C:/chickenStarClient/client/assets/scripts/logic/fight/view/common/FightBossBarItem.ts"],"names":["_decorator","Component","Label","ProgressBar","SpriteFrame","LangMgr","HP_PRO","ccclass","property","FightBossBarItem","_isActive","attrData","monster","lastHp","lastCount","setBoss","_monster","node","active","setAttrData","info","nameLab","string","getLab","configTab","Name","dead","isDead","hpBar1","progress","hpBar2","data","update","dt","changeHp","hpPercent","count","Math","ceil","hpCount","changeColor","colorCount","barSprite","spriteFrame","barSfs"],"mappings":"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","sourcesContent":["import { _decorator, Button, Color, Component, Label, Node, Prefab, ProgressBar, Sprite, SpriteFrame } from \"cc\";\n\nimport { FightAttrData } from \"../../data/FightAttrData\";\nimport { Monster } from \"../../base/obj/role/monster/Monster\";\nimport { LangMgr } from \"../../../mgr/LangMgr\";\n\nlet HP_PRO = 2000\n\nconst { ccclass, property } = _decorator;\n/** 战斗Boss进度条， 血条*/\n@ccclass('FightBossBarItem')\nexport class FightBossBarItem extends Component {\n\n    @property(ProgressBar)\n    hpBar1: ProgressBar = null\n    @property(ProgressBar)\n    hpBar2: ProgressBar = null\n\n    @property(Label)\n    nameLab: Label = null\n\n    @property(Label)\n    hpCount: Label = null\n\n    @property([SpriteFrame])\n    barSfs: SpriteFrame[] = []\n\n\n    _isActive: boolean = false\n\n    attrData: FightAttrData\n\n    monster: Monster\n    lastHp: number = 0\n    lastCount: number = 0\n    setBoss(_monster: Monster) {\n        this.monster = _monster\n        if (this.monster == null) {\n            this.node.active = false\n            return\n        }\n        this.lastHp = -1\n        this.node.active = true\n        this.setAttrData(this.monster.info.attrData)\n        this.nameLab.string = LangMgr.getLab(this.monster.info.configTab.Name)\n    }\n\n    dead() {\n        if (this.node.active && this.monster.isDead) {\n            this.hpBar1.progress = this.hpBar2.progress = 0\n        }\n    }\n\n    setAttrData(data: FightAttrData) {\n        this.attrData = data\n    }\n\n    protected update(dt: number): void {\n        if (this.monster && !this.monster.isDead && this.monster.info) {\n            this.changeHp()\n        }\n    }\n    changeHp() {\n        if (this.lastHp == 1 || this.lastHp != this.attrData.hpPercent) {\n            this.lastHp = this.attrData.hpPercent\n            let count = Math.ceil((this.lastHp) / HP_PRO)\n            if (count != this.lastCount) {\n                this.hpCount.string = (\"x\" + count)\n                this.changeColor(count)\n            }\n            this.lastCount = count\n            this.hpBar2.progress = 1 - (count * HP_PRO - this.lastHp) / HP_PRO\n        }\n    }\n    changeColor(colorCount: number) {\n        colorCount = colorCount - 1\n        this.hpBar2.barSprite.spriteFrame = this.barSfs[colorCount]\n        if (colorCount != 0) {\n            this.hpBar1.barSprite.spriteFrame = this.barSfs[colorCount - 1]\n            this.hpBar1.progress = 1\n        } else {\n            this.hpBar1.progress = 0\n        }\n    }\n}"]}