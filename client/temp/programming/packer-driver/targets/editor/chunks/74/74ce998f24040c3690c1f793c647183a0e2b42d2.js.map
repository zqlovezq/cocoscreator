{"version":3,"sources":["file:///C:/chickenStarClient/client/assets/scripts/logic/model/role/RoleControl.ts"],"names":["RoleControl","_decorator","js","log","AbsControl","Net","EventMgr","proto","RoleData","LocalEvent","HeroControl","EquipControl","EquipData","RareBookData","ItemData","MailControl","TaskControl","PrestigeControl","tab","ShowTips","LangMgr","PayControl","RedMgr","RedDotType","ActivityControl","FriendControl","SceneMgr","FengyunRankData","OpenFunctionMgr","ActivityData","LoginData","ChannelMgr","P8PostEventName","Func","GameplayControl","Http","SettingRedManager","ccclass","property","noticeRed","ins","_instance","register","onMsg","Ptl","SyncRolePush","on_s2c_SyncRolePush","GetMainStageInfoRsp","on_s2c_GetMainStageInfoRsp","GetStaminaInfoRsp","on_s2c_GetStaminaInfoRsp","BuyStaminaRsp","on_s2c_BuyStaminaRsp","BuyGoldRsp","on_s2c_BuyGoldRsp","UseRedeemCodeRsp","on_s2c_UseRedeemCodeRsp","VipBonusPush","on_s2c_VipBonusPush","GetServerTimeRsp","on_s2c_GetServerTime","onLocal","LocalEvent_Common_Net_ErrorCode","onNetCommonNetErrorCode","registerCalculateFb","RedStamina","buyStaminaRedPoint","notice","red_Notice","msg","requestGetServerTime","setData","role","initServerTimer","serverTime","isCreatRole","createRole","sdkRole","intoServer","initOpenActivityMap","activities","setOpenFunctionData","openFunctions","initData","requestEquips","requestHeros","initEquipData","initBookData","requestGetMails","request","initMapData","honorRollInfo","checkFighting","requestStaminaInfo","setVipPrivilege","todayLoginTimes","day","getCreateTimeDay","postEvent","day2_login","Msg_GetStaminaInfoReq","Send","GetStaminaInfoReq","Msg_GetServerTimeReq","clientTime","serverTimer","GetServerTimeReq","requestBuyStamina","type","num","Msg_BuyStaminaReq","BuyStaminaReq","requestBuyGold","Msg_BuyGoldReq","BuyGoldReq","requestUseRedeemCode","code","Msg_UseRedeemCodeReq","UseRedeemCodeReq","updateNoticeRed","addr","loginServerTab","NoticeAddr","host","method","reqParam","cb","responseJson","length","notices","sort","a","b","created_at","newNotice","lastTimer","Number","getItem","refreshEvent","fightingStageId","isFightScene","console","warn","Msg_FinishStageReq","result","Result","Quit","FinishStageReq","emitLocal","quitFight","pb","ptl","errorCode","error","ShowErrorTips","message","CommonErrorCode","Failed","Disconnect","errMsg","key","formatStr","lab","getLab","mainStageInfo","newStageId","clearedStageIds","dungeon_completed_3","id","isPost","setItem","dungeon_completed_10","dungeon_completed_20","Succeed","refreshGoldHistory","history","GoldBuy","staminaInfo","remainBuyTimesMap","remainBuyTimes","addPrivilege","vipBonusMap","buyTimes","BuyStaminaType","BuyStaminaType_WatchAdverts","curStaminaCount","getCount","maxStaminaCount","getData","GetKeyValue_ConfigTable","InitialStaminaMaxCount","getPrivilegeValue","VipBonus","VipBonus_StaminaLimit","isStaminaEnough","isCloseBuyPop","getSetting"],"mappings":"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","sourcesContent":["import { Node, _decorator, js, log, sys } from \"cc\";\nimport { AbsControl, AbsMgr } from \"../../../framework/base/IAbs\";\nimport { Net } from \"../../net/Net\";\nimport { EventMgr } from \"../../mgr/EventMgr\";\nimport { proto } from \"client_protocol\";\nimport { RoleData } from \"../role/RoleData\";\nimport { LocalEvent } from \"../../define/LocalEvent\";\nimport { ItemControl } from \"../item/ItemControl\";\nimport { HeroControl } from \"../hero/HeroControl\";\nimport { EquipControl } from \"../equip/EquipControl\";\nimport { EquipData } from \"../equip/EquipData\";\nimport { RareBookData } from \"../rareBook/RareBookData\";\nimport { ItemData } from \"../item/ItemData\";\nimport { Role } from \"../../fight/base/obj/role/role/Role\";\nimport { MailControl } from \"../mail/MailControl\";\nimport { TaskControl } from \"../task/TaskControl\";\nimport { PrestigeControl } from \"../prestige/PrestigeControl\";\nimport { tab } from \"../../../Table/table_gen\";\nimport { ShowTips } from \"../../mgr/UIMgr\";\nimport { LangMgr } from \"../../mgr/LangMgr\";\nimport { PayControl } from \"../pay/PayControl\";\nimport { RedMgr } from \"../../mgr/RedMgr\";\nimport { RedDotType } from \"../../red/RedDotType\";\nimport { ActivityControl } from \"../activity/ActivityControl\";\nimport { FriendControl } from \"../friends/FriendControl\";\nimport { SceneMgr, ScenesName } from \"../../mgr/SceneMgr\";\nimport { FengyunRankData } from \"../fengyunRanking/FengyunRankData\";\nimport { OpenFunctionMgr } from \"../../../Common/component/OpenFunctionMgr\";\nimport { ActivityData } from \"../activity/ActivityData\";\nimport { LoginData } from \"../login/LoginData\";\nimport { ChannelMgr } from \"../../../channel/ChannelMgr\";\nimport { P8PostEventName } from \"../../../channel/ChannelDefine\";\nimport { Func } from \"../../utils/Func\";\nimport { GameplayControl } from \"../jianghu/GameplayControl\";\nimport Http from \"../../net/Http\";\nimport { SettingRedManager } from \"./SettingRedManager\";\n\nconst { ccclass, property } = _decorator;\n\n\nexport class RoleControl extends AbsControl {\n\n    private static _instance: RoleControl;\n    public noticeRed: boolean = false;\n    public static get ins() {\n        if (null == this._instance) {\n            this._instance = new RoleControl();\n        }\n        return this._instance;\n    }\n\n\n\n\n\n    register(): void {\n        EventMgr.onMsg(proto.Ptl.SyncRolePush, this.on_s2c_SyncRolePush, this)\n        EventMgr.onMsg(proto.Ptl.GetMainStageInfoRsp, this.on_s2c_GetMainStageInfoRsp, this)\n        EventMgr.onMsg(proto.Ptl.GetStaminaInfoRsp, this.on_s2c_GetStaminaInfoRsp, this)\n        EventMgr.onMsg(proto.Ptl.BuyStaminaRsp, this.on_s2c_BuyStaminaRsp, this)\n        EventMgr.onMsg(proto.Ptl.BuyGoldRsp, this.on_s2c_BuyGoldRsp, this)\n        EventMgr.onMsg(proto.Ptl.UseRedeemCodeRsp, this.on_s2c_UseRedeemCodeRsp, this)\n        EventMgr.onMsg(proto.Ptl.VipBonusPush, this.on_s2c_VipBonusPush, this)\n        EventMgr.onMsg(proto.Ptl.GetServerTimeRsp, this.on_s2c_GetServerTime, this)\n        EventMgr.onLocal(LocalEvent.LocalEvent_Common_Net_ErrorCode, this.onNetCommonNetErrorCode, this)\n\n\n        RedMgr.ins.registerCalculateFb(RedDotType.RedStamina, this.buyStaminaRedPoint, this);\n        RedMgr.ins.registerCalculateFb(RedDotType.notice, this.red_Notice, this);\n    }\n\n    //----------------处理回调---------------------\n\n    on_s2c_SyncRolePush(msg: proto.Msg_SyncRolePush) {\n        //只做保存数据\n        this.requestGetServerTime();\n        RoleData.ins.setData(msg.role)\n        RoleData.ins.initServerTimer(msg.role.serverTime);\n\n        if (LoginData.ins.isCreatRole) {\n            ChannelMgr.createRole(RoleData.ins.sdkRole())\n        }\n        ChannelMgr.intoServer(RoleData.ins.sdkRole())\n\n\n        ActivityData.ins.initOpenActivityMap(msg.role.activities as proto.Activity[])\n        OpenFunctionMgr.ins.setOpenFunctionData(RoleData.ins.openFunctions);\n\n\n        //获取基础数据 拿到英雄数据后再做场景跳转\n\n        // ItemControl.ins.requestItems()\n        ItemData.ins.initData();\n        EquipControl.ins.requestEquips()\n        HeroControl.ins.requestHeros()\n        EquipData.ins.initEquipData();\n        RareBookData.ins.initBookData();\n        MailControl.ins.requestGetMails();\n        TaskControl.ins.request();\n        PrestigeControl.ins.request();\n        PayControl.ins.request();\n        ActivityControl.ins.request();\n        FriendControl.ins.request();\n        FengyunRankData.ins.initMapData(msg.role.honorRollInfo as proto.Msg_GetHonorRollMapRsp);\n        GameplayControl.ins.request();\n        this.checkFighting();\n        this.requestStaminaInfo();\n        this.setVipPrivilege();\n\n        if (RoleData.ins.todayLoginTimes == 1) {\n            let day = RoleData.ins.getCreateTimeDay();\n            if (day == 2) {\n                ChannelMgr.postEvent(P8PostEventName.day2_login);\n            }\n        }\n\n\n\n    }\n\n    /**\n     * 请求获得体力相关信息\n     */\n    requestStaminaInfo() {\n        let msg = new proto.Msg_GetStaminaInfoReq();\n        Net.Send(proto.Ptl.GetStaminaInfoReq, msg)\n    }\n    /**\n   * 请求获得服务器时间\n   */\n    requestGetServerTime() {\n        let msg = new proto.Msg_GetServerTimeReq();\n        msg.clientTime = RoleData.ins.serverTimer;\n        Net.Send(proto.Ptl.GetServerTimeReq, msg)\n    }\n\n\n    /**\n     * 请求购买体力\n     */\n    requestBuyStamina(type: tab.BuyStaminaType, num: number = 1) {\n        let msg = new proto.Msg_BuyStaminaReq();\n        msg.type = type;\n        msg.num = num;\n        Net.Send(proto.Ptl.BuyStaminaReq, msg)\n\n    }\n    /** \n     * 请求购买金币 \n     */\n    requestBuyGold(type: tab.BuyGoldType) {\n        let msg = new proto.Msg_BuyGoldReq();\n        msg.type = type;\n        Net.Send(proto.Ptl.BuyGoldReq, msg)\n    }\n    /**\n       * 请求使用兑换码\n       */\n    requestUseRedeemCode(code: string) {\n        let msg = new proto.Msg_UseRedeemCodeReq();\n        msg.code = code;\n        Net.Send(proto.Ptl.UseRedeemCodeReq, msg)\n    }\n    updateNoticeRed() {\n        let addr = LoginData.ins.loginServerTab.NoticeAddr;\n        Http.request({\n            host: addr,\n            method: \"GET\",\n            reqParam: \"\",\n            cb: (responseJson) => {\n                // console.log(responseJson)\n                if (responseJson && responseJson.length > 0) {\n                    let notices: Array<any> = responseJson;\n\n                    notices.sort((a, b) => {\n                        return b.created_at - a.created_at;\n                    })\n                    let newNotice = notices[0];\n                    let lastTimer = Number(Func.getItem(\"notice_created_at\"));\n                    if (lastTimer && lastTimer != 0) {\n                        this.noticeRed = newNotice.created_at > lastTimer;\n                    } else {\n                        this.noticeRed = true;\n                    }\n\n                    // callBack(this.noticeRed);\n                    RedMgr.refreshEvent(RedDotType.notice);\n                }\n\n            }\n        })\n    }\n\n\n\n    checkFighting() {\n        if (RoleData.ins.fightingStageId) {\n            if (SceneMgr.isFightScene()) {\n                //身上有关卡id，还在战斗场景。\n                console.warn(\"身上有关卡id，还在战斗场景。\", RoleData.ins.fightingStageId)\n                return\n            }\n            console.warn(\"在战斗中， 先清除战斗状态\", RoleData.ins.fightingStageId)\n            let msg = new proto.Msg_FinishStageReq();\n            msg.result = proto.Msg_FinishStageReq.Result.Quit\n            Net.Send(proto.Ptl.FinishStageReq, msg)\n            RoleData.ins.fightingStageId = 0\n        } else {\n            //可能在战斗场景， 尝试退出\n            EventMgr.emitLocal(LocalEvent.quitFight)\n        }\n    }\n\n    /**\n     * 错误码统一处理\n     * @param pb \n     * @param ptl \n     */\n    onNetCommonNetErrorCode(pb: any, ptl: number) {\n        if (pb) {\n            let errorCode = pb.error ? pb.error.code : 0\n            if (errorCode) {\n                this.ShowErrorTips(errorCode, pb.error ? pb.error.message : \"\")\n                if (errorCode == proto.CommonErrorCode.Failed) {\n                    Net.Disconnect()\n                }\n            }\n        }\n    }\n    ShowErrorTips(errorCode: number, errMsg: String = \"\") {\n        let key = js.formatStr(\"CommonErrorCode_%s\", errorCode)\n        let lab = LangMgr.getLab(key)\n        if (key != lab) {\n            ShowTips(LangMgr.getLab(key));\n        }\n        console.error(\"错误码：\" + key, \"server_err_msg：\" + errMsg)\n\n    }\n\n    // 获取主线关卡信息\n    on_s2c_GetMainStageInfoRsp(msg: proto.Msg_GetMainStageInfoRsp) {\n        RoleData.ins.mainStageInfo = msg\n        let newStageId = msg.clearedStageIds.length > 0 ? msg.clearedStageIds[msg.clearedStageIds.length - 1] : 0;\n        if (newStageId > 0) {\n            if (newStageId == 303) {\n                let key = P8PostEventName.dungeon_completed_3 + \"_\" + RoleData.ins.id;\n                let isPost = Func.getItem(key);\n                if (!isPost) {\n                    ChannelMgr.postEvent(P8PostEventName.dungeon_completed_3)\n                    Func.setItem(key, true);\n                }\n\n            } else if (newStageId == 1004) {\n                let key = P8PostEventName.dungeon_completed_10 + \"_\" + RoleData.ins.id;\n                let isPost = Func.getItem(key);\n                if (!isPost) {\n                    ChannelMgr.postEvent(P8PostEventName.dungeon_completed_10)\n                    Func.setItem(key, true);\n                }\n\n            } else if (newStageId == 2005) {\n                let key = P8PostEventName.dungeon_completed_20 + \"_\" + RoleData.ins.id;\n                let isPost = Func.getItem(key);\n                if (!isPost) {\n                    ChannelMgr.postEvent(P8PostEventName.dungeon_completed_20)\n                    Func.setItem(key, true);\n                }\n\n            }\n        }\n    }\n    // 获取金币购买信息返回\n    on_s2c_BuyGoldRsp(msg: proto.Msg_BuyGoldRsp) {\n        if (msg.error && msg.error.code != proto.CommonErrorCode.Succeed) return;\n        RoleData.ins.refreshGoldHistory(msg.history as proto.BuyGoldHistory);\n        log(\"购买金币信息==\", msg)\n        RedMgr.refreshEvent(RedDotType.GoldBuy);\n    }\n    // 获取体力信息返回\n    on_s2c_GetStaminaInfoRsp(msg: proto.Msg_GetStaminaInfoRsp) {\n        RoleData.ins.staminaInfo = msg;\n        log(\"体力信息==\", msg)\n        RedMgr.refreshEvent(RedDotType.RedStamina);\n    }\n    // 请求购买体力返回\n    on_s2c_BuyStaminaRsp(msg: proto.Msg_BuyStaminaRsp) {\n        if (!msg.error || msg.error.code == proto.CommonErrorCode.Succeed) {\n            if (msg.type) {\n                RoleData.ins.staminaInfo.remainBuyTimesMap[msg.type] = msg.remainBuyTimes;\n            } else {\n                RoleData.ins.staminaInfo.remainBuyTimesMap[0] = msg.remainBuyTimes;\n            }\n            RedMgr.refreshEvent(RedDotType.RedStamina);\n\n        }\n\n    }\n    // 使用兑换码返回\n    on_s2c_UseRedeemCodeRsp(msg: proto.Msg_UseRedeemCodeRsp) {\n        if (!msg.error || msg.error.code == proto.CommonErrorCode.Succeed) {\n\n\n        }\n\n    }\n    // vip特权推送\n    on_s2c_VipBonusPush(msg: proto.Msg_VipBonusPush) {\n        RoleData.ins.addPrivilege(msg.vipBonusMap)\n\n    }\n    on_s2c_GetServerTime(msg: proto.Msg_GetServerTimeRsp) {\n        RoleData.ins.initServerTimer(msg.serverTime);\n    }\n\n    /**\n     * 购买体力红点\n     * @returns \n     */\n    buyStaminaRedPoint() {\n        // 剩余广告买体力有次数\n        const buyTimes = RoleData.ins.staminaInfo.remainBuyTimesMap[tab.BuyStaminaType.BuyStaminaType_WatchAdverts];\n        // 玩家体力不足\n        let curStaminaCount = ItemData.ins.getCount(6);\n        let maxStaminaCount = tab.getData().GetKeyValue_ConfigTable().InitialStaminaMaxCount + RoleData.ins.getPrivilegeValue(tab.VipBonus.VipBonus_StaminaLimit);\n        const isStaminaEnough = curStaminaCount < maxStaminaCount;\n        // 是否打开过界面\n        const isCloseBuyPop = SettingRedManager.ins.getSetting(\"RedStamina\");\n        return buyTimes > 0 && isStaminaEnough && !isCloseBuyPop;\n    }\n    red_Notice() {\n        return this.noticeRed;\n    }\n    /* vip贵宾数据 */\n    setVipPrivilege() {\n        const vipBonusMap = RoleData.ins.vipBonusMap;\n        RoleData.ins.addPrivilege(vipBonusMap);\n    }\n}"]}