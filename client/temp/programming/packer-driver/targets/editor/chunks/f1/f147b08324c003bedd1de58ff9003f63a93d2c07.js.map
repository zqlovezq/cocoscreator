{"version":3,"sources":["file:///C:/chickenStarClient/client/assets/scripts/logic/fight/base/obj/bullet/Bullet.ts"],"names":["_decorator","js","PhysicsSystem","Vec3","Func","Trigger","AbsObj","AbsObjType","AbsMoveType","BulletMove","BulletMoveLine","tab","BulletState101Born","BulletState102Move","BulletState103Boom","AbsStateType","BulletMoveRound","BulletMoveTarget","BulletControl","BulletTargetType","BulletMoveCentrifugation","DamageCalculation","AbsObjInfoAttr","DamageLab","BulletForwardArrow","CollisionGroup","MathAngle","ShapeType","BulletMoveForwardOwner","EventMgr","FightEvent","FightData","BuffControl","BuletMoveLaser","Sound","BuletMoveTrackLaser","Random","ccclass","property","tempPos","Bullet","objType","bullet","move","info","bulletSoleId","owner","bulletTargetType","default","targetRole","targetPos","startPos","havaDamageObjIds","Array","hitCount","isCanTrigger","OutOfScreen","hitBackIds","Map","ignoreTriggerTime","isOwnDeath","reset","length","x","y","z","clear","isMaskParent","parent","node","removeFromParent","destroy","initMachine","stateMachine","addState","setObjInfo","_info","setBoundTabs","setStateAnimId","bulletBorn","configTab","BornAnimationId","bulletMove","WalkAnimationId","bulletBoom","DeadAnimationId","bound","boundTabs","Type","BoundType","BoundType_Circle","type","Sphere","center","Parameters","radius","BoundType_Rectangle","Box","size","init","speed","Speed","group","PhysicsGroup","roleBullet","setTrigger","initBoby","isDead","formatStr","body","id","configId","random","setVelocity","ve","checkNodeAngle","setVelocityAngle","angle","Trajectory","Trajectory_StraightLine","Trajectory_Laser","Trajectory_Trajectory","setAngle","voAngle","name","angleToDirection","velocity","multiplyScalar","voRatio","setAbsOnwer","abs","lockAttr","getTruePosition","rotatePoint","position","add","getPosition","setStartPos","pos","set","ZERO","setPosition","setTargetType","target","setTargetRole","setTargetPos","isSearchNone","isExtends","role","getBulletGroup","bulletGroup","EffectUnit","EffectUnit_Mine","monsterBullet","EffectUnit_Friend","EffectUnit_Enemy","enemy","forwardArrowOffset","offsety","getObjAttr","forwardArrowOffsetY","offsetAngle","Math","targetDirection","traceDirection","getHitPos","run","isForwardOwner","updateGroup","isForwardArrowAndType","intersect","getMove","parallel","changeState","updateFrame","dt","isLock","recycle","moveType","absMove","isCentrifugation","isRound","Trajectory_Trackless","setAbs","setLiftTime","getLiveTime","onMoveComplete","onTrigger","b","trigger","exit","defanseAbs","object","enter","onHitRole","stay","DamageTick","checkDamageTick","isInvincible","checkParentSoleId","parentSoleId","isOlnyOne","checkBulletDamageGroup","groupId","ins","PlayHitEffect","hitSound","onSkillTrigger","Triggertype","Triggertype_AtHIT","otherAbsInfo","damageData","DamageScale","beHitFront","endDamegeObj","damageAmount","DamageAmount","index","bullet_damageCalculate","addBuff","addBuffTab","objId","onHitDamage","addShowDamageNum","isDamage","damage","setIsHit","HitShake","isMonster","IsDefeat","beatBackSpeed","curBearFrame","IsHitBack","has","isHitBack","HitBack","setSkillBearBack","isSuccess","getAttrData","getAttr","AttrType","AttrType_HitBackChance","getData","GetKeyValue_ConfigTable","NormalHitBack","emitFight","Kill","addDamageTick","beHitBack","checkHitTrigger","isHitDeath","addObjAttr","isPenetrationDeath","isCatapult","catapultCount","isCatapultDeath","addCatapult","onFlyComplete","onOwnerDeal","preCollider","ignoreTrigger","isCollisionInterval","time","CollisionInterval","setIgnoreTrigger","lateCollider","avatarUpdate","animationId","avatar","animTab","zIndex","AnimationType","AnimationType_SkeletonData","AnimationType_Plist","AnimationType_SpriteFrame","setzIndex","addHitCount","addHavaDamageObjId","remove","push","addhavaDamageObjIds","objIds","element"],"mappings":"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","sourcesContent":["import { _decorator, absMax, instantiate, js, Layers, Node, PhysicsSystem, Prefab, Quat, sp, Vec3 } from 'cc';\nimport { Func } from '../../../../utils/Func';\nimport { CollisionObject, Trigger } from '../../../../../framework/collision/CollisionObject';\nimport { CollisionBody } from '../../../../../framework/collision/CollisionBody';\nimport { AbsObj, AbsObjType } from '../AbsObj';\nimport { AbsRole } from '../role/AbsRole';\nimport { AbsMoveType, BulletMove } from '../../move/AbsMove';\nimport { BulletMoveLine } from '../../move/bullet/BulletMoveLine';\nimport { tab } from '../../../../../Table/table_gen';\nimport { BulletState101Born } from './state/BulletState101Born';\nimport { BulletState102Move } from './state/BulletState102Move';\nimport { BulletState103Boom } from './state/BulletState103Boom';\nimport { AbsState, AbsStateType } from '../state/AbsState';\nimport { BulletInfo } from './BulletInfo';\nimport { BulletMoveRound } from '../../move/bullet/BulletMoveRound';\nimport { BulletMoveTarget } from '../../move/bullet/BulletMoveTarget';\nimport { BulletControl, BulletTargetType } from './BulletControl';\nimport { BulletMoveCentrifugation } from '../../move/bullet/BulletMoveCentrifugation';\nimport { DamageCalculation } from '../../damage/DamageCalculation';\nimport { AbsObjInfoAttr } from '../AbsObjInfo';\nimport { DamageLab } from '../../damage/DamageLab';\nimport { BulletForwardArrow, CollisionGroup } from '../../../define/FightDefine';\nimport { MathAngle } from '../../../../../framework/collision/Maths';\nimport { ShapeType } from '../../../../../framework/collision/CollisionShape';\nimport { AbsOwner } from '../AbsOwner';\nimport { DamageData } from '../../damage/DamageData';\nimport { BulletMoveForwardOwner } from '../../move/bullet/BulletMoveForwardOwner';\nimport { EventMgr } from '../../../../mgr/EventMgr';\nimport { FightEvent } from '../../../define/FightEvent';\nimport { FightDamageRankItem } from '../../../view/damage/FightDamageRankItem';\nimport { FightData } from '../../../data/FightData';\nimport { BuffControl } from '../../buff/BuffControl';\nimport { BuletMoveLaser } from '../../move/bullet/BuletMoveLaser';\nimport Sound from '../../../../utils/Sound';\nimport { BuletMoveTrackLaser } from '../../move/bullet/BuletMoveTrackLaser';\nimport { Random } from '../../../util/Random';\nconst { ccclass, property } = _decorator;\nconst tempPos = new Vec3(0, 0, 0);\n\n\n@ccclass('Bullet')\nexport class Bullet extends AbsObj {\n    objType: AbsObjType = AbsObjType.bullet;\n\n    move: BulletMove\n    info: BulletInfo\n\n    /** 子弹唯一id */\n    bulletSoleId: string\n\n    /** 子弹所有人 */\n    owner: AbsOwner\n\n    bulletTargetType: BulletTargetType = BulletTargetType.default\n    /** 目标 */\n    targetRole: AbsRole\n    /** 目标位置 */\n    targetPos: Vec3 = new Vec3()\n    /** 开始位置 */\n    startPos: Vec3 = new Vec3()\n\n    /** 伤害过的对象 */\n    havaDamageObjIds: Array<number> = new Array()\n\n    /** 命中次数 */\n    hitCount: number = 0\n\n    isCanTrigger: boolean = true\n    /** 飞出屏幕 */\n    OutOfScreen: boolean = false\n\n    hitBackIds:Map<number,number> = new Map()\n\n    reset(): void {\n        super.reset()\n        this.hitCount = 0\n        this.havaDamageObjIds.length = 0\n        this.OutOfScreen = false\n        this.targetRole = null\n        this.targetPos.x = this.targetPos.y = this.targetPos.z = 0\n        this.startPos.x = this.startPos.y = this.startPos.z = 0\n        this.hitBackIds.clear()\n        if (this.isMaskParent()) {\n            let parent = this.node.parent\n            this.node.removeFromParent()\n            parent.destroy()\n        }\n    }\n    initMachine() {\n        super.initMachine()\n\n        this.stateMachine.addState(new BulletState101Born())\n        this.stateMachine.addState(new BulletState102Move())\n        this.stateMachine.addState(new BulletState103Boom())\n    }\n\n    setObjInfo(_info: BulletInfo) {\n        super.setObjInfo(_info)\n\n        // this.setBounds(this.info.configTab.Bounds)\n        this.setBoundTabs()\n\n        this.setStateAnimId(AbsStateType.bulletBorn, this.info.configTab.BornAnimationId)\n        this.setStateAnimId(AbsStateType.bulletMove, this.info.configTab.WalkAnimationId)\n        this.setStateAnimId(AbsStateType.bulletBoom, this.info.configTab.DeadAnimationId)\n    }\n\n    setBoundTabs(): void {\n        this.isCanTrigger = false\n        let bound = this.info.configTab.boundTabs[0]\n        if (bound.Type == tab.BoundType.BoundType_Circle) {\n            this.type = ShapeType.Sphere\n            this.center.x = bound.Parameters[0]\n            this.center.y = bound.Parameters[1]\n            this.radius = bound.Parameters[2]\n            if (this.center.x != 0 || this.center.y != 0 || this.radius != 0) {\n                this.isCanTrigger = true\n            }\n        } else if (bound.Type == tab.BoundType.BoundType_Rectangle) {\n            this.type = ShapeType.Box\n\n            this.center.x = bound.Parameters[0]\n            this.center.y = bound.Parameters[1]\n            this.size.x = bound.Parameters[2]\n            this.size.y = bound.Parameters[3]\n            if (this.center.x != 0 || this.center.y != 0 || this.size.x != 0 || this.size.y != 0) {\n                this.isCanTrigger = true\n            }\n            // this.center.x = 0\n            // this.center.y = 0\n            // this.size.x = 100\n            // this.size.y = 20\n\n        }\n    }\n\n    init(): void {\n        this.speed = this.info.configTab.Speed\n\n        this.group = PhysicsSystem.PhysicsGroup[CollisionGroup.roleBullet]\n\n        this.setTrigger(this.isCanTrigger)\n        this.initBoby()\n        this.isDead = true\n        this.bulletSoleId = js.formatStr(\"%s_%s_%s\", this.body.id, this.configId, Func.random(1, 100000))\n    }\n\n    setVelocity(ve: Vec3) {\n        super.setVelocity(ve)\n        this.checkNodeAngle()\n    }\n\n    setVelocityAngle(angle: number) {\n        super.setVelocityAngle(angle)\n        this.checkNodeAngle()\n    }\n\n    checkNodeAngle() {\n        if (this.isMaskParent() || this.info.configTab.Trajectory == tab.Trajectory.Trajectory_StraightLine || this.info.configTab.Trajectory == tab.Trajectory.Trajectory_Laser || this.info.configTab.Trajectory == tab.Trajectory.Trajectory_Trajectory) {\n            this.setAngle(this.voAngle)\n        }\n    }\n\n    isMaskParent() {\n        return this.node && this.node.parent && this.node.parent.name == \"BulletLaunchMask\"\n    }\n\n\n    setAngle(angle: number) {\n        if (this.isMaskParent()) {\n            this.voAngle = 0\n            super.setAngle(this.voAngle)\n            MathAngle.angleToDirection(this.voAngle, this.velocity)\n            this.velocity.multiplyScalar(this.speed * this.voRatio)\n            this.node.parent.angle = angle\n        } else {\n            super.setAngle(angle)\n        }\n    }\n\n    setAbsOnwer(owner: AbsOwner) {\n        this.owner = owner\n        if (owner && owner.abs && owner.abs.isDead) {\n            owner.lockAttr()\n        }\n    }\n\n    getTruePosition() {\n        if (this.isMaskParent()) {\n            MathAngle.rotatePoint(this.node.position, this.node.parent.angle, tempPos)\n            tempPos.add(this.node.parent.position)\n            // console.log(\"实际位置\", tempPos.x, tempPos.y, \"遮罩位置\", this.node.parent.position.x, this.node.parent.position.y, \"节点位置\", this.node.position.x, this.node.position.y)\n            return tempPos\n        } else {\n            return this.getPosition()\n        }\n    }\n\n    setStartPos(pos: Vec3) {\n        this.startPos.set(pos)\n        if (this.isMaskParent()) {\n            this.node.parent.position = this.startPos\n            tempPos.set(Vec3.ZERO)\n            this.setPosition(tempPos)\n            this.getTruePosition()\n        } else {\n            this.setPosition(this.startPos)\n        }\n    }\n    setTargetType(type: BulletTargetType, target: AbsRole | Vec3 | number) {\n        this.bulletTargetType = type\n        this.setTargetRole(null)\n        this.setTargetPos(null)\n        if (this.info.configTab.isSearchNone() && !this.info.configTab.isExtends()) {\n            this.bulletTargetType = BulletTargetType.default\n            return\n        }\n        switch (type) {\n            case BulletTargetType.role:\n                this.setTargetRole(target as AbsRole)\n                break\n            case BulletTargetType.pos:\n                this.setTargetPos(target as Vec3)\n                break\n            case BulletTargetType.angle:\n                this.voAngle = target as number\n                break\n        }\n    }\n\n    private setTargetPos(pos: Vec3) {\n        if (pos == null) {\n            this.targetPos.set(0, 0, 0)\n            return\n        }\n        this.targetPos.set(pos)\n    }\n\n    private setTargetRole(abs: AbsRole) {\n        this.targetRole = abs\n    }\n\n    getBulletGroup() {\n        //ToDo  正常角色发出的子弹为roleBullet, 怪物子弹为monsterBullet    roleBullet碰撞怪物， monsterBullet碰撞角色\n        let bulletGroup = CollisionGroup.roleBullet\n        if (this.info.configTab.EffectUnit == tab.EffectUnit.EffectUnit_Mine) {//自身\n            if (this.owner.objType == AbsObjType.role) {\n                bulletGroup = CollisionGroup.monsterBullet\n            }\n        } else if (this.info.configTab.EffectUnit == tab.EffectUnit.EffectUnit_Friend) {//友方\n            if (this.owner.objType == AbsObjType.role) {\n                bulletGroup = CollisionGroup.monsterBullet\n            }\n        } else if (this.info.configTab.EffectUnit == tab.EffectUnit.EffectUnit_Enemy) {//敌方\n            if (this.owner.objType == AbsObjType.enemy) {\n                bulletGroup = CollisionGroup.monsterBullet\n            }\n        }\n        return bulletGroup\n    }\n\n    forwardArrowOffset() {\n        let offsety = this.info.getObjAttr(AbsObjInfoAttr.forwardArrowOffsetY)\n        if (offsety == 0) {\n            return\n        }\n        let offsetAngle = (offsety > 0 ? 90 : -90) + this.voAngle\n        MathAngle.angleToDirection(offsetAngle, tempPos)\n        tempPos.multiplyScalar(Math.abs(offsety))\n        this.startPos.add(tempPos)\n        this.setPosition(this.startPos)\n    }\n\n    targetDirection() {\n        if (this.bulletTargetType == BulletTargetType.angle) {\n            this.setVelocityAngle(this.voAngle)\n        } else if (this.bulletTargetType == BulletTargetType.pos) {\n            this.traceDirection(this.startPos, this.targetPos)\n        } else if (this.bulletTargetType == BulletTargetType.role) {\n            this.traceDirection(this.startPos, this.targetRole.getHitPos())\n        }\n    }\n\n    run() {\n        this.isOwnDeath = this.info.isOwnDeath()\n        if (this.info.isForwardOwner()) {\n            this.bulletTargetType = BulletTargetType.owner\n        }\n\n        this.updateGroup(this.getBulletGroup())\n        this.targetDirection()\n        this.isDead = false\n\n        if (this.info.isForwardArrowAndType(BulletForwardArrow.intersect)) { //多向剑相交， 需要先设置发射点偏移量\n            this.forwardArrowOffset()\n            this.targetDirection()\n        }\n        this.move = this.getMove(this.info.configTab.Trajectory)\n\n        if (this.info.isForwardArrowAndType(BulletForwardArrow.parallel)) { //多向剑平行，朝向角度计算完之后， 设置发射点偏移量\n            this.forwardArrowOffset()\n        }\n        //设置正向剑属性\n\n        this.changeState(AbsStateType.bulletBorn)\n    }\n    ignoreTriggerTime: number = 0\n    updateFrame(dt: number) {\n        if (this.isDead) {\n            return\n        }\n        if (this.owner && !this.owner.isLock) { //来源属性非锁定状态， 并且发射者已死亡\n            if (this.owner.abs && this.owner.abs.isDead) {\n                this.recycle()\n                return\n            }\n        }\n        super.updateFrame(dt)\n\n    }\n\n\n\n    getMove(moveType: tab.Trajectory) {\n        let absMove: BulletMove\n        if (this.info.isForwardOwner()) {\n            absMove = new BulletMoveForwardOwner()\n        } else if (this.info.isCentrifugation()) {\n            absMove = new BulletMoveCentrifugation()\n        } else if (this.info.isRound()) {\n            absMove = new BulletMoveRound()\n        } else {\n            if (moveType == tab.Trajectory.Trajectory_StraightLine) {\n                absMove = new BulletMoveLine()\n            } else if (moveType == tab.Trajectory.Trajectory_Trackless) {\n                absMove = new BulletMoveTarget()\n            } else if (moveType == tab.Trajectory.Trajectory_Laser) {\n                absMove = new BuletMoveLaser()\n            } else if (moveType == tab.Trajectory.Trajectory_Trajectory) {\n                absMove = new BuletMoveTrackLaser()\n            } else {\n                absMove = new BulletMove(AbsMoveType.default)\n            }\n        }\n\n        absMove.setAbs(this)\n        absMove.setLiftTime(this.info.getLiveTime())\n        absMove.init()\n        return absMove\n    }\n\n    onMoveComplete() {\n        this.changeState(AbsStateType.bulletBoom)\n    }\n\n\n    onTrigger(b: CollisionBody, trigger: Trigger) {\n        if (trigger == Trigger.exit) return;\n\n        let defanseAbs = (b.object as AbsRole)\n        if (trigger == Trigger.enter) {\n            this.onHitRole(defanseAbs)\n        } else if (trigger == Trigger.stay) {\n            if (this.info.configTab.DamageTick > 0) {\n                if (defanseAbs.checkDamageTick(this.bulletSoleId)) {\n                    return\n                }\n                this.onHitRole(defanseAbs)\n            }\n        }\n    }\n\n    /**\n     * 命中角色\n     * @param defanseAbs \n     */\n    onHitRole(defanseAbs: AbsRole) {\n        if (defanseAbs.info.isInvincible()) {\n            return\n        }\n\n        if (defanseAbs.checkParentSoleId(this.info.parentSoleId) != 0) {\n            // console.log(\"父对象已伤害过\")\n            return\n        }\n        if (this.info.isOlnyOne() && defanseAbs.checkBulletDamageGroup(this.info.groupId)) {\n            // console.log(\"子弹组已伤害过\")\n            return\n        }\n        Sound.ins.PlayHitEffect(this.info.hitSound())\n        if (this.owner.abs && !this.owner.abs.isDead) {\n            this.owner.abs.info.onSkillTrigger(tab.Triggertype.Triggertype_AtHIT, { otherAbsInfo: defanseAbs.info })\n        }\n        let damageData: DamageData\n        if (this.info.configTab.DamageScale.length > 0) {\n\n            super.onHitRole(defanseAbs)\n            defanseAbs.info.beHitFront(this)\n            this.endDamegeObj = defanseAbs\n\n            let damageAmount = this.info.configTab.DamageAmount + 1\n            for (let index = 0; index < damageAmount; index++) {\n                damageData = DamageCalculation.bullet_damageCalculate(this, defanseAbs, index)\n                if (damageData) {\n                    //目前只有眩晕\n                    BuffControl.ins.addBuff(damageData.addBuffTab, this.owner.objId, defanseAbs)\n                    defanseAbs.info.onHitDamage(damageData)\n                    DamageLab.addShowDamageNum(damageData, defanseAbs, index)\n                }\n            }\n        } else {\n            // console.log(\"碰撞角色，但是没有伤害\")\n        }\n\n        if (damageData && damageData.isDamage() && damageData.damage >= 0) {\n            defanseAbs.setIsHit(this.info.configTab.HitShake)\n            if (defanseAbs.isMonster()) {\n                if (!defanseAbs.info.configTab.IsDefeat) {\n                    defanseAbs.beatBackSpeed = defanseAbs.curBearFrame = 0\n                }\n                if (defanseAbs.info.configTab.IsHitBack && !this.hitBackIds.has(defanseAbs.objId)) {\n                    if (this.info.configTab.isHitBack()) {\n                        tempPos.x = this.info.configTab.HitBack[1]\n                        tempPos.z = this.info.configTab.HitBack[0]\n                        tempPos.y = 0\n                        defanseAbs.setSkillBearBack(true, tempPos)\n                        this.hitBackIds.set(defanseAbs.objId, 1)\n                    }else if (Random.isSuccess(this.owner.getAttrData().getAttr(tab.AttrType.AttrType_HitBackChance))){\n                        tempPos.x = tab.getData().GetKeyValue_ConfigTable().NormalHitBack[1]\n                        tempPos.z = tab.getData().GetKeyValue_ConfigTable().NormalHitBack[0]\n                        tempPos.y = 0\n                        defanseAbs.setSkillBearBack(true, tempPos)\n                        this.hitBackIds.set(defanseAbs.objId, 1)\n                    }\n                }\n            }\n        }\n        if (defanseAbs.isDead) {\n            EventMgr.emitFight(FightEvent.Kill, damageData, this.owner, defanseAbs)\n        }\n        if (!defanseAbs.isDead && this.info.configTab.DamageTick) {\n            defanseAbs.addDamageTick(this.bulletSoleId, this.info.configTab.DamageTick)\n        }\n\n        defanseAbs.info.beHitBack(this)\n\n        BulletControl.ins.checkHitTrigger(this)\n\n        if (this.info.isHitDeath()) {\n            this.info.addObjAttr(AbsObjInfoAttr.hitCount, 1)\n            if (this.info.isPenetrationDeath()) {//穿透完毕\n                if (this.info.isCatapult()) {// 检测是否弹射\n                    this.info.addObjAttr(AbsObjInfoAttr.catapultCount, 1)\n                    if (!this.info.isCatapultDeath()) {//还有弹射次数\n                        BulletControl.ins.addCatapult(this, defanseAbs)\n                        return\n                    }\n                }\n                this.move.onFlyComplete()\n            }\n        }\n    }\n    isOwnDeath: boolean = false\n    /** 子弹所有人死亡 */\n    onOwnerDeal() {\n        this.owner.lockAttr()\n        if (this.isOwnDeath) {\n            this.move.onFlyComplete()\n        }\n    }\n\n    preCollider() {\n        if (this.ignoreTrigger && this.isCollisionInterval()) {\n            if (FightData.time - this.ignoreTriggerTime >= this.info.configTab.CollisionInterval) {\n                this.setIgnoreTrigger(false)\n            }\n        }\n    }\n    lateCollider() {\n        if (this.isCollisionInterval() && !this.ignoreTrigger) {\n            this.setIgnoreTrigger(true)\n            this.ignoreTriggerTime = FightData.time\n        }\n    }\n\n    isCollisionInterval() {\n        if (!this.isDead && this.info) {\n            return this.info.configTab.CollisionInterval > 0\n        }\n        return super.isCollisionInterval()\n    }\n\n    avatarUpdate() {\n        if (this.animationId > 0 && this.avatar && this.avatar.animTab) {\n            let zIndex = 0\n            switch (this.avatar.animTab.Type) {\n                case tab.AnimationType.AnimationType_SkeletonData:\n                    zIndex = 1\n                    break\n                case tab.AnimationType.AnimationType_Plist:\n                    zIndex = 2\n                    break\n                case tab.AnimationType.AnimationType_SpriteFrame:\n                    zIndex = 3\n                    break\n            }\n            Func.setzIndex(this.node, zIndex)\n        }\n    }\n\n    addHitCount() {\n        this.hitCount += 1\n    }\n\n    /** 添加一个伤害目标id */\n    addHavaDamageObjId(objId: number) {\n        Func.remove(this.havaDamageObjIds, objId)\n        this.havaDamageObjIds.push(objId)\n    }\n\n    addhavaDamageObjIds(objIds: number[]) {\n        if (objIds){\n            for (let index = 0; index < objIds.length; index++) {\n                const element = objIds[index];\n                this.addHavaDamageObjId(element)\n            }\n        }\n    }\n}\n\n"]}