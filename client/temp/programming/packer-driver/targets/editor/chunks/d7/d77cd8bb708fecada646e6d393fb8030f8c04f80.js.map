{"version":3,"sources":["file:///C:/chickenStarClient/client/assets/scripts/logic/model/association/AssociationApplyView.ts"],"names":["_decorator","Button","instantiate","Label","Prefab","Sprite","ComponentBase","ShowTips","UIMgr","ViewName","InfiniteList","AssociationApplyItem","EventMgr","proto","AssociationControl","AssociationView","RoleData","AssociationData","LangMgr","tab","Net","ButtonLock","ccclass","property","AssociationApplyView","_list","register","onMsg","Ptl","GetRecommendGuildsRsp","on_s2c_GetRecommendGuildsRsp","ApplyJoinGuildRsp","on_s2c_ApplyJoinGuildRsp","ApplyJoinGuildOneClickRsp","on_s2c_ApplyJoinGuildOneClickRsp","unRegister","onDestroy","onShow","reqGetRecommendGuilds","ins","createAssociation","show","viewName","AssociationCreatePop","getCellCount","length","getCellHeight","idx","getCellIdentifer","getCellView","identifer","cell","pfb_item","getComponent","GetCellData","initList","isRefresh","list_view","Refresh","Init","getCellNumber","bind","getCellSize","getCellData","btn_one_click","interactable","node","grayscale","curTime","getServerUtcTime","getAssocitionInfo","notAllowJoinTime","lbl_time","active","string","getCombineString","getData","GetKeyValue_ConfigTable","GuildJoinCd","msg","guilds","i","guild","getGuildIsRequest","id","subGuildRequests","onClose","view","getView","oneClickApplyJoinGuild","str","push","Msg_ApplyJoinGuildOneClickReq","guildIds","Send","ApplyJoinGuildOneClickReq","error","code","CommonErrorCode","Succeed"],"mappings":"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","sourcesContent":["/*\r\n * @Date: 2024-08-28 11:39:23\r\n * @LastEditors: wzq\r\n * @LastEditTime: 2024-10-30 14:55:06\r\n */\r\n\r\nimport { _decorator, Button, Component, instantiate, Label, log, Node, Prefab, Sprite } from 'cc';\r\nimport { ComponentBase } from '../../../framework/base/ComponentBase';\r\nimport { ShowTips, UIMgr } from '../../mgr/UIMgr';\r\nimport { ViewName } from '../../define/ViewDefine';\r\nimport { ASSOCIATIONPOP } from '../../../Common/script/EnumTypeMgr';\r\nimport InfiniteList from '../../../Common/InfiniteList/InfiniteList';\r\nimport { AssociationApplyItem } from './AssociationApplyItem';\r\nimport { EventMgr } from '../../mgr/EventMgr';\r\nimport { proto } from 'client_protocol';\r\nimport { AssociationControl } from './AssociationControl';\r\nimport { AssociationView } from './AssociationView';\r\nimport { RoleData } from '../role/RoleData';\r\nimport { AssociationData } from './AssociationData';\r\nimport { LangMgr } from '../../mgr/LangMgr';\r\nimport { tab } from '../../../Table/table_gen';\r\nimport { Net } from '../../net/Net';\r\nimport { ButtonLock } from '../../utils/GameUtil';\r\nconst { ccclass, property } = _decorator;\r\n\r\n@ccclass('AssociationApplyView')\r\nexport class AssociationApplyView extends ComponentBase {\r\n    @property(InfiniteList)\r\n    list_view: InfiniteList = null;\r\n    @property(Prefab)\r\n    pfb_item: Prefab = null;\r\n    @property(Label)\r\n    lbl_time:Label = null;\r\n    @property(Button)\r\n    btn_one_click:Button = null;\r\n    private _list:proto.ISimpleGuild[] = []\r\n    register(): void {\r\n        EventMgr.onMsg(proto.Ptl.GetRecommendGuildsRsp, this.on_s2c_GetRecommendGuildsRsp, this);\r\n        EventMgr.onMsg(proto.Ptl.ApplyJoinGuildRsp, this.on_s2c_ApplyJoinGuildRsp, this);\r\n        EventMgr.onMsg(proto.Ptl.ApplyJoinGuildOneClickRsp, this.on_s2c_ApplyJoinGuildOneClickRsp, this);\r\n    }\r\n    unRegister(): void {\r\n        super.unRegister();\r\n    }\r\n    protected onDestroy(): void {\r\n        super.onDestroy();\r\n    }\r\n    onShow(): void {\r\n        this.reqGetRecommendGuilds();\r\n    }\r\n    reqGetRecommendGuilds() {\r\n        AssociationControl.ins.reqGetRecommendGuilds();\r\n    }\r\n    // 创建鸡舍\r\n    createAssociation() {\r\n        // 打开创建鸡舍界面\r\n        UIMgr.ins.show({ viewName: ViewName.AssociationCreatePop})\r\n    }\r\n    getCellCount() {\r\n        return this._list.length\r\n    }\r\n    getCellHeight(idx: number) {\r\n        return 81\r\n    }\r\n    getCellIdentifer(idx: number) {\r\n        return \"AssociationApplyItem\";\r\n    }\r\n    getCellView(idx: number, identifer: string) {\r\n        let cell = instantiate(this.pfb_item).getComponent(AssociationApplyItem);\r\n        return cell;\r\n    }\r\n    GetCellData(idx: number) {\r\n        return this._list[idx];\r\n    }\r\n    initList(isRefresh?: boolean) {\r\n        if (isRefresh) {\r\n            this.list_view.Refresh();\r\n        } else {\r\n            this.list_view.Init({\r\n                getCellNumber: this.getCellCount.bind(this),\r\n                getCellSize: this.getCellHeight.bind(this),\r\n                getCellIdentifer: this.getCellIdentifer.bind(this),\r\n                getCellView: this.getCellView.bind(this),\r\n                getCellData: this.GetCellData.bind(this),\r\n            });\r\n            this.btn_one_click.interactable = true;\r\n            this.btn_one_click.node.getComponent(Sprite).grayscale = false;\r\n        }\r\n        const curTime = RoleData.ins.getServerUtcTime();\r\n        if (AssociationData.ins.getAssocitionInfo()&&curTime < AssociationData.ins.getAssocitionInfo().notAllowJoinTime) {\r\n            this.lbl_time.node.active = true;\r\n            this.lbl_time.string = LangMgr.getCombineString(\"Tips_association_4\",[tab.getData().GetKeyValue_ConfigTable().GuildJoinCd/60])\r\n        }else{\r\n            this.lbl_time.node.active = false;\r\n        }\r\n    }\r\n    on_s2c_GetRecommendGuildsRsp(msg: proto.Msg_GetRecommendGuildsRsp) {\r\n        this._list = msg.guilds;\r\n        for(let i=0;i<msg.guilds.length;i++){\r\n            const guild = msg.guilds[i];\r\n            if(AssociationData.ins.getGuildIsRequest(guild.id)){\r\n                AssociationData.ins.subGuildRequests(guild.id);\r\n            }\r\n        }\r\n        this.initList();\r\n    }\r\n    onClose() {\r\n        const view = UIMgr.ins.getView(\"AssociationView\").getComponent(AssociationView);\r\n        view.onClose();\r\n    }\r\n    on_s2c_ApplyJoinGuildRsp(msg: proto.Msg_ApplyJoinGuildRsp){\r\n        this.initList(true);\r\n    }\r\n    // 一键申请公会\r\n    @ButtonLock(1, () => { })\r\n    oneClickApplyJoinGuild(){\r\n        const curTime = RoleData.ins.getServerUtcTime();\r\n        if (AssociationData.ins.getAssocitionInfo()&&curTime < AssociationData.ins.getAssocitionInfo().notAllowJoinTime) {\r\n            const str = LangMgr.getCombineString(\"Tips_association_4\", [tab.getData().GetKeyValue_ConfigTable().GuildJoinCd / 60]);\r\n            ShowTips(str);\r\n            return;\r\n        }\r\n        const guilds = [];\r\n        for(let i=0;i<this._list.length;i++){\r\n            if(!AssociationData.ins.getGuildIsRequest(this._list[i].id)){\r\n                guilds.push(this._list[i].id);\r\n            }\r\n        }\r\n        if(guilds.length>0){\r\n            this.btn_one_click.interactable = false;\r\n            this.btn_one_click.node.getComponent(Sprite).grayscale = true;\r\n            let msg = new proto.Msg_ApplyJoinGuildOneClickReq();\r\n            msg.guildIds = guilds;\r\n            Net.Send(proto.Ptl.ApplyJoinGuildOneClickReq, msg);\r\n        }\r\n    }\r\n    on_s2c_ApplyJoinGuildOneClickRsp(msg: proto.Msg_ApplyJoinGuildOneClickRsp){\r\n        if (msg.error && msg.error.code != proto.CommonErrorCode.Succeed) return;\r\n        this.initList(true);\r\n    }\r\n}\r\n\r\n\r\n"]}