{"version":3,"sources":["file:///C:/chickenStarClient/client/assets/scripts/logic/fight/base/skill/SkillControl.ts"],"names":["_decorator","Vec3","AbsControl","tab","BulletControl","SearchEnemy","BuffControl","EffectControl","PlayerControl","AbsObjType","SkillPowerControl","EventMgr","FightEvent","ccclass","property","tempSkills","tempPos","SkillControl","ins","_instance","init","register","onFight","addSkill","skill","attack","initCd","info","addTakeSkill","switchSkill","skillTab","normalGroup","nowSkill","switchSkillGroup","skillGroup","useSkillAndBullet","targetPos","isInCD","attrData","console","log","useSkillTarget","useSkillBullet","isDestroy","use","onSkillTrigger","Triggertype","Triggertype_DetectionSkill","skillId","Id","enemys","skillGetBySearchEnemy","objId","objType","getPosition","EffectUnit","SearchNum","length","index","enemy","skillAttr","skillPower","checkSkillAddBuff","Effect","effectTabs","effectTab","random","addEffect","skillPowerBySkill","bulletGroupId","runningShot","Bullet","clickEmitBullet","runningShotBulletTab","bulletTab","audoEmitBullet","rogueUseSkillTarget","rogueInfo","roles","searchType","getSearchTypeByOwn","rogueTab","Own","ownRoles","role","EffectUnit_Friend","ownRole","skills","forEach","addWeaponSkillGroup","getRoles","parms","rogueId","v","Triggertype_Rogue","rogueUseSkillRoleLevelUp","ownClass","OwnClass","OwnClass_All","SearchEnemy_All","OwnClass_Assassin","SearchEnemy_Assassin","OwnClass_Archer","SearchEnemy_Archer","OwnClass_Priest","SearchEnemy_Priest","OwnClass_Caster","SearchEnemy_Caster","OwnClass_Warrior","SearchEnemy_Warrior"],"mappings":"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","sourcesContent":["import { _decorator, CCInteger, Color, Component, instantiate, Label, Node, Prefab, Quat, Rect, sp, Sprite, tween, UITransform, Vec2, Vec3, view } from 'cc';\nimport { AbsControl } from '../../../../framework/base/IAbs';\nimport { SkillTab } from '../../power/powerTab/SkillTab';\nimport { AbsRole } from '../obj/role/AbsRole';\nimport { AbsRoleInfo } from '../obj/role/AbsRoleInfo';\nimport { tab } from '../../../../Table/table_gen';\nimport { BulletControl } from '../obj/bullet/BulletControl';\nimport { SearchEnemy } from '../ai/SearchEnemy';\nimport { BuffControl } from '../buff/BuffControl';\nimport { EffectControl } from '../effect/EffectControl';\nimport { RogueInfo } from '../../view/rogue/RogueInfo';\nimport { PlayerControl } from '../obj/role/role/PlayerControl';\nimport { AbsObjType } from '../obj/AbsObj';\nimport { SkillGroupTab } from '../../power/powerTab/SkillGroupTab';\nimport { SkillPowerControl } from './SkillPowerControl';\nimport { EventMgr } from '../../../mgr/EventMgr';\nimport { FightEvent } from '../../define/FightEvent';\nimport { RoleData } from '../../../model/role/RoleData';\nimport { stepBranchGuide } from '../../../guide/GuideTask';\nimport { FightData } from '../../data/FightData';\nimport { GuideController } from '../../../guide/GuideController';\n\n\nconst { ccclass, property } = _decorator;\nconst tempSkills: SkillTab[] = []\n\nconst tempPos = new Vec3(0, 0, 0);\n@ccclass('SkillControl')\nexport class SkillControl extends AbsControl {\n    private static _instance: SkillControl;\n    public static get ins() {\n        if (null == this._instance) {\n            this._instance = new SkillControl();\n        }\n        return this._instance;\n    }\n\n    init(): void {\n        this.register()\n    }\n    register() {\n        EventMgr.onFight(FightEvent.addSkill, this.addSkill, this)\n    }\n\n    addSkill(skill: SkillTab, attack: AbsRole) {\n        skill.initCd()\n        attack.info.addTakeSkill(skill, true)\n    }\n\n    switchSkill(skillTab: SkillTab, attack: AbsRole) {\n        attack.info.normalGroup.nowSkill = skillTab\n    }\n\n    switchSkillGroup(skillGroup: SkillGroupTab, attack: AbsRole) {\n        attack.info.switchSkillGroup(skillGroup)\n    }\n\n    /** 释放技能 */\n    useSkillAndBullet(skill: SkillTab, attack: AbsRole, targetPos: Vec3 = null) {\n        if (skill.isInCD(attack.info.attrData)) {\n            console.log(\"技能cd中--\", skill)\n            return\n        }\n        this.useSkillTarget(skill, attack)\n        this.useSkillBullet(skill, attack, targetPos)\n    }\n\n    /** 使用技能目标 */\n    useSkillTarget(skill: SkillTab, attack: AbsRole) {\n        if (skill.isInCD(attack.info.attrData)) {\n            console.log(\"技能cd中--\", skill)\n            return\n        }\n        if (attack == null || (attack && attack.isDestroy())) {\n            console.log(\"已销毁\")\n            return\n        }\n\n        skill.use()\n\n        attack.info.onSkillTrigger(tab.Triggertype.Triggertype_DetectionSkill, { skillId: skill.Id })\n        let enemys = SearchEnemy.skillGetBySearchEnemy(attack.objId, attack.objType, attack.getPosition(), skill.EffectUnit, skill.SearchEnemy, skill.SearchNum)// skill.configTab.EffectNum)\n        if (enemys.length == 0) {\n            // console.log(\"useSkillTarget 没有找到目标\")\n            return\n        }\n\n        for (let index = 0; index < enemys.length; index++) {\n            const enemy = enemys[index];\n            this.skillAttr(skill, attack, enemy)\n            this.skillPower(skill, attack, enemy)\n        }\n\n        BuffControl.ins.checkSkillAddBuff(skill, attack, enemys)\n    }\n\n    /** 释放技能属性 */\n    skillAttr(skill: SkillTab, attack: AbsRole, enemy: AbsRole) {\n        if (skill.Effect.length == 0) {\n            return\n        }\n        for (let index = 0; index < skill.effectTabs.length; index++) {\n            const effectTab = skill.effectTabs[index];\n            effectTab.random()\n            EffectControl.ins.addEffect(effectTab, attack, enemy)\n        }\n    }\n\n    /** 释放技能增强 */\n    skillPower(skill: SkillTab, attack: AbsRole, enemy: AbsRole) {\n        SkillPowerControl.ins.skillPowerBySkill(enemy.info, skill)\n    }\n\n    /** 释放技能子弹 */\n    useSkillBullet(skill: SkillTab, attack: AbsRole, targetPos: Vec3 = null, bulletGroupId: number = 0, runningShot: boolean = false) {\n        if (skill.Bullet == 0) {\n            return\n        }\n        if (targetPos) {\n            return BulletControl.ins.clickEmitBullet(runningShot ? skill.runningShotBulletTab : skill.bulletTab, attack, targetPos, bulletGroupId)\n\n        }\n        return BulletControl.ins.audoEmitBullet(runningShot ? skill.runningShotBulletTab : skill.bulletTab, attack, bulletGroupId)\n    }\n\n\n    /** 肉鸽使用技能目标 */\n    rogueUseSkillTarget(rogueInfo: RogueInfo) {\n        let attack = PlayerControl.ins.roles[0]\n        let searchType = this.getSearchTypeByOwn(rogueInfo.rogueTab.Own)\n\n        let ownRoles = SearchEnemy.skillGetBySearchEnemy(attack.objId, AbsObjType.role, attack.getPosition(), tab.EffectUnit.EffectUnit_Friend, searchType, 1, true)\n        console.log(ownRoles)\n        for (let index = 0; index < ownRoles.length; index++) {\n            const ownRole = ownRoles[index];\n            rogueInfo.skills.forEach(skill => {\n                ownRole.info.addTakeSkill(skill, true)\n            })\n\n            if (rogueInfo.skillGroup) {\n                ownRole.info.addWeaponSkillGroup(rogueInfo.skillGroup)\n            }\n        }\n\n        let roles = PlayerControl.ins.getRoles()\n        let parms = { rogueId: rogueInfo.Id }\n        for (let index = 0; index < roles.length; index++) {\n            const v = roles[index];\n            v.info.onSkillTrigger(tab.Triggertype.Triggertype_Rogue, parms)\n        }\n    }\n    /** 角色升级肉鸽使用技能目标 */\n    rogueUseSkillRoleLevelUp(rogueInfo: RogueInfo) {\n\n    }\n\n    /** 根据英雄职业获取锁敌规则 */\n    getSearchTypeByOwn(ownClass: tab.OwnClass) {\n        switch (ownClass) {\n            case tab.OwnClass.OwnClass_All:\n                return tab.SearchEnemy.SearchEnemy_All\n            case tab.OwnClass.OwnClass_Assassin:\n                return tab.SearchEnemy.SearchEnemy_Assassin\n            case tab.OwnClass.OwnClass_Archer:\n                return tab.SearchEnemy.SearchEnemy_Archer\n            case tab.OwnClass.OwnClass_Priest:\n                return tab.SearchEnemy.SearchEnemy_Priest\n            case tab.OwnClass.OwnClass_Caster:\n                return tab.SearchEnemy.SearchEnemy_Caster\n            case tab.OwnClass.OwnClass_Warrior:\n                return tab.SearchEnemy.SearchEnemy_Warrior\n        }\n\n    }\n}\n"]}