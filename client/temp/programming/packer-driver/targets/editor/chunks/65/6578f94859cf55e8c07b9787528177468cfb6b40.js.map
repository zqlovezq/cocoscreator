{"version":3,"sources":["file:///C:/chickenStarClient/client/assets/scripts/logic/model/task/TaskView.ts"],"names":["_decorator","instantiate","Label","Node","Prefab","ScrollView","ViewPop","EventMgr","proto","TaskControl","TaskBoxItem","LocalEvent","TaskData","TaskCaseItem","tab","ItemData","UIMgr","ViewName","OpenFunctionMgr","TASKDAILY","ccclass","property","TaskView","currTag","DAILY","taskCaseItems","register","onMsg","Ptl","GetDailyTasksRsp","on_s2c_GetDailyTasksRsp","ReceiveDailyTaskRewardRsp","on_s2c_ReceiveDailyTaskRewardRsp","ReceiveDailyActivityTaskRewardRsp","on_s2c_ReceiveDailyActivityTaskRewardRsp","GetWeeklyTasksRsp","on_s2c_GetWeeklyTasksRsp","ReceiveWeeklyTaskRewardRsp","on_s2c_ReceiveWeeklyTaskRewardRsp","ReceiveWeeklyActivityTaskRewardRsp","on_s2c_ReceiveWeeklyActivityTaskRewardRsp","GetAchievementTasksRsp","on_s2c_GetAchievementRsp","ReceiveAchievementTaskRewardRsp","on_s2c_ReceiveAchievementTaskRewardRsp","onLocal","Item_Update","itemChange","TaskChangePush","on_s2c_TaskChangePush","ins","request","onShow","checkFunctionIsOpen","OpenFunctionName","OpenFunctionName_DailyTask","toggles","active","OpenFunctionName_WeeklyTask","OpenFunctionName_AchievementTask","openData","initDailyTaskView","removeCaseItem","dayTaskNode","weekTaskNode","taskNode","achieveNode","taskInfo","getDailyInfos","sortTaskList","key","item","creatorCaseItem","Number","node","parent","taskContent","initData","updateBoxItem","taskScrollView","scrollToTop","initWeekTaskView","getWeekInfos","initAchievement","getAchievementInfos","achieveContent","actives","getData","GetKeyValue_ConfigTable","DailyTaskRewardNeedCount","dailyActiveNum","getCount","CurrencyType","CurrencyType_DailyActivity","activeNumLab","string","i","length","lastValue","pro","taskBoxItems","initView","WEEK","WeeklyTaskBoxTable","weekActiveNum","CurrencyType_WeeklyActivity","Id","infos","sort","a","b","isReceived","taskTabId","isCanReceived","removeFromParent","index","taskCaseItemPrefab","com","getComponent","push","onClickToggle","event","tag","itemIds","msg","ACHIEVEMENT","error","code","CommonErrorCode","Succeed","show","viewName","CongratulationPop","data","rewards"],"mappings":"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","sourcesContent":["import { _decorator, Component, instantiate, Label, Node, Prefab, ScrollView } from 'cc';\r\nimport { ViewPop } from '../../../framework/base/ViewPop';\r\nimport { EventMgr } from '../../mgr/EventMgr';\r\nimport { proto } from 'client_protocol';\r\nimport { TaskControl } from './TaskControl';\r\nimport { TaskBoxItem } from './TaskBoxItem';\r\nimport { LocalEvent } from '../../define/LocalEvent';\r\nimport { TaskData } from './TaskData';\r\nimport { TaskCaseItem } from './TaskCaseItem';\r\nimport { tab } from '../../../Table/table_gen';\r\nimport { ItemData } from '../item/ItemData';\r\nimport { TaskInfo } from './TaskInfo';\r\nimport { UIMgr } from '../../mgr/UIMgr';\r\nimport { ViewName } from '../../define/ViewDefine';\r\nimport { OpenFunctionMgr } from '../../../Common/component/OpenFunctionMgr';\r\nimport { TASKDAILY } from '../../../Common/script/EnumTypeMgr';\r\nconst { ccclass, property } = _decorator;\r\n\r\n/**\r\n * \r\n * TaskView\r\n * zhudingchao\r\n * Tue Jun 04 2024 11:23:12 GMT+0800 (中国标准时间)\r\n * db://assets/scripts/logic/model/task/TaskView.ts\r\n *\r\n */\r\n\r\n@ccclass('TaskView')\r\nexport class TaskView extends ViewPop {\r\n    @property(Node)\r\n    taskNode: Node = null;\r\n    @property(Node)\r\n    achieveNode: Node = null;\r\n    @property(Node)\r\n    taskContent: Node = null;\r\n    @property(Node)\r\n    achieveContent: Node = null;\r\n    @property(Label)\r\n    activeNumLab: Label = null;\r\n    @property(Node)\r\n    dayTaskNode: Node = null;\r\n    @property(Node)\r\n    weekTaskNode: Node = null;\r\n    @property([TaskBoxItem])\r\n    taskBoxItems: Array<TaskBoxItem> = [];\r\n    @property(Prefab)\r\n    taskCaseItemPrefab: Prefab = null;\r\n    @property(ScrollView)\r\n    taskScrollView: ScrollView = null;\r\n    @property([Node])\r\n    toggles:Node[]=[];\r\n    private currTag: number = TASKDAILY.DAILY;\r\n\r\n    private taskCaseItems: Array<TaskCaseItem> = [];\r\n    register(): void {\r\n        EventMgr.onMsg(proto.Ptl.GetDailyTasksRsp, this.on_s2c_GetDailyTasksRsp, this);\r\n        EventMgr.onMsg(proto.Ptl.ReceiveDailyTaskRewardRsp, this.on_s2c_ReceiveDailyTaskRewardRsp, this);\r\n        EventMgr.onMsg(proto.Ptl.ReceiveDailyActivityTaskRewardRsp, this.on_s2c_ReceiveDailyActivityTaskRewardRsp, this);\r\n        EventMgr.onMsg(proto.Ptl.GetWeeklyTasksRsp, this.on_s2c_GetWeeklyTasksRsp, this);\r\n        EventMgr.onMsg(proto.Ptl.ReceiveWeeklyTaskRewardRsp, this.on_s2c_ReceiveWeeklyTaskRewardRsp, this);\r\n        EventMgr.onMsg(proto.Ptl.ReceiveWeeklyActivityTaskRewardRsp, this.on_s2c_ReceiveWeeklyActivityTaskRewardRsp, this);\r\n        EventMgr.onMsg(proto.Ptl.GetAchievementTasksRsp, this.on_s2c_GetAchievementRsp, this);\r\n        EventMgr.onMsg(proto.Ptl.ReceiveAchievementTaskRewardRsp, this.on_s2c_ReceiveAchievementTaskRewardRsp, this);\r\n        EventMgr.onLocal(LocalEvent.Item_Update, this.itemChange, this)\r\n        EventMgr.onMsg(proto.Ptl.TaskChangePush, this.on_s2c_TaskChangePush, this);\r\n        TaskControl.ins.request();\r\n    }\r\n    onShow(): void {\r\n        if(!OpenFunctionMgr.ins.checkFunctionIsOpen(tab.OpenFunctionName.OpenFunctionName_DailyTask)){\r\n            this.toggles[0].active=false;\r\n        }\r\n        if(!OpenFunctionMgr.ins.checkFunctionIsOpen(tab.OpenFunctionName.OpenFunctionName_WeeklyTask)){\r\n            this.toggles[1].active=false;\r\n        }\r\n        if(!OpenFunctionMgr.ins.checkFunctionIsOpen(tab.OpenFunctionName.OpenFunctionName_AchievementTask)){\r\n            this.toggles[2].active=false;\r\n        }\r\n        if (this.openData && this.openData[\"type\"]) {\r\n            this.currTag = this.openData[\"type\"];\r\n        }\r\n\r\n\r\n    }\r\n    initDailyTaskView() {\r\n        if(!this.toggles[0].active){\r\n            return;\r\n        }\r\n        this.removeCaseItem();\r\n        this.dayTaskNode.active = true;\r\n        this.weekTaskNode.active = false;\r\n        this.taskNode.active = true;\r\n        this.achieveNode.active = false;\r\n        let taskInfo = TaskData.ins.getDailyInfos();\r\n        this.sortTaskList(taskInfo);\r\n        for (let key in taskInfo) {\r\n            let item = this.creatorCaseItem(Number(key));\r\n            item.node.parent = this.taskContent;\r\n            item.initData(taskInfo[key]);\r\n        }\r\n        this.updateBoxItem();\r\n   \r\n        this.taskScrollView.scrollToTop();\r\n\r\n\r\n    }\r\n    initWeekTaskView() {\r\n        if(!this.toggles[1].active){\r\n            return;\r\n        }\r\n        this.removeCaseItem();\r\n        this.dayTaskNode.active = false;\r\n        this.weekTaskNode.active = true;\r\n        this.taskNode.active = true;\r\n        this.achieveNode.active = false;\r\n        let taskInfo = TaskData.ins.getWeekInfos();\r\n        this.sortTaskList(taskInfo);\r\n        for (let key in taskInfo) {\r\n            let item = this.creatorCaseItem(Number(key));\r\n            item.node.parent = this.taskContent;\r\n            item.initData(taskInfo[key]);\r\n        }\r\n        this.updateBoxItem();\r\n        this.taskScrollView.scrollToTop();\r\n\r\n    }\r\n    initAchievement() {\r\n        if(!this.toggles[2].active){\r\n            return;\r\n        }\r\n        this.removeCaseItem();\r\n        this.taskNode.active = false;\r\n        this.achieveNode.active = true;\r\n        let taskInfo = TaskData.ins.getAchievementInfos();\r\n        this.sortTaskList(taskInfo);\r\n        for (let key in taskInfo) {\r\n            let item = this.creatorCaseItem(Number(key));\r\n            item.node.parent = this.achieveContent;\r\n            item.initData(taskInfo[key]);\r\n        }\r\n    }\r\n\r\n    updateBoxItem(){\r\n        if(this.currTag==TASKDAILY.DAILY){\r\n            let actives = tab.getData().GetKeyValue_ConfigTable().DailyTaskRewardNeedCount;\r\n            let dailyActiveNum = ItemData.ins.getCount(tab.CurrencyType.CurrencyType_DailyActivity);\r\n            this.activeNumLab.string = dailyActiveNum + \"\";\r\n            for (let i: number = 0; i < actives.length; i++) {\r\n                let lastValue = 0;\r\n                let pro = 0;\r\n                if (i > 0) {\r\n                    lastValue = actives[i - 1];\r\n                }\r\n                if (dailyActiveNum <= lastValue) {\r\n                    pro = 0;\r\n                } else if (dailyActiveNum >= actives[i]) {\r\n                    pro = 1;\r\n                } else {\r\n                    pro = (dailyActiveNum - lastValue) / (actives[i] - lastValue);\r\n                }\r\n                this.taskBoxItems[i].initView(1, i, pro, actives[i]);\r\n            }\r\n        }else if(this.currTag==TASKDAILY.WEEK){\r\n            let actives = tab.getData().WeeklyTaskBoxTable;\r\n            let weekActiveNum = ItemData.ins.getCount(tab.CurrencyType.CurrencyType_WeeklyActivity);\r\n            this.activeNumLab.string = weekActiveNum + \"\";\r\n            for (let i: number = 0; i < actives.length; i++) {\r\n                let lastValue = 0;\r\n                let pro = 0;\r\n                if (i > 0) {\r\n                    lastValue = actives[i - 1].Id;\r\n                }\r\n                if (weekActiveNum <= lastValue) {\r\n                    pro = 0;\r\n                } else if (weekActiveNum >= actives[i].Id) {\r\n                    pro = 1;\r\n                } else {\r\n                    pro = (weekActiveNum - lastValue) / (actives[i].Id - lastValue);\r\n                }\r\n                this.taskBoxItems[i].initView(2, i, pro, actives[i].Id);\r\n            }\r\n        }\r\n       \r\n    }\r\n\r\n    sortTaskList(infos: Array<TaskInfo>) {\r\n        infos.sort((a, b) => {\r\n            if (a.isReceived && b.isReceived) {\r\n                return a.taskTabId - b.taskTabId;\r\n            }\r\n            if (a.isCanReceived && b.isCanReceived) {\r\n                return a.taskTabId - b.taskTabId;\r\n            }\r\n            if (a.isCanReceived) {\r\n                return -1;\r\n            }\r\n            if (b.isCanReceived) {\r\n                return 1;\r\n            }\r\n            if (a.isReceived) {\r\n                return 1;\r\n            }\r\n            if (b.isReceived) {\r\n                return -1;\r\n            }\r\n\r\n            return a.taskTabId - b.taskTabId;\r\n        })\r\n    }\r\n    removeCaseItem() {\r\n        if (this.taskCaseItems) {\r\n            for (let key in this.taskCaseItems) {\r\n                this.taskCaseItems[key].node.removeFromParent();\r\n            }\r\n        }\r\n    }\r\n\r\n    creatorCaseItem(index: number) {\r\n        if (!this.taskCaseItems[index]) {\r\n            let node = instantiate(this.taskCaseItemPrefab);\r\n            let com = node.getComponent(TaskCaseItem);\r\n            this.taskCaseItems.push(com);\r\n        }\r\n        return this.taskCaseItems[index];\r\n\r\n    }\r\n    onClickToggle(event, tag) {\r\n        tag = Number(tag);\r\n        if (this.currTag != tag) {\r\n            this.currTag = tag;\r\n            if (tag == 1) {\r\n                this.initDailyTaskView();\r\n            } else if (tag == 2) {\r\n                this.initWeekTaskView();\r\n            } else {\r\n                this.initAchievement();\r\n            }\r\n\r\n        }\r\n\r\n    }\r\n    itemChange(itemIds: Array<number>) {\r\n\r\n    }\r\n    on_s2c_GetDailyTasksRsp(msg: proto.Msg_GetDailyTasksRsp) {\r\n        if (this.currTag == TASKDAILY.DAILY) {\r\n            this.initDailyTaskView();\r\n        }\r\n    }\r\n    on_s2c_GetWeeklyTasksRsp(msg: proto.Msg_GetWeeklyTasksRsp) {\r\n        if (this.currTag == TASKDAILY.WEEK) {\r\n            this.initWeekTaskView();\r\n        }\r\n    }\r\n    on_s2c_GetAchievementRsp(msg: proto.Msg_GetAchievementTasksRsp) {\r\n        if (this.currTag == TASKDAILY.ACHIEVEMENT) {\r\n            this.initAchievement();\r\n        }\r\n    }\r\n    on_s2c_ReceiveDailyTaskRewardRsp(msg: proto.Msg_ReceiveDailyTaskRewardRsp) {\r\n        if (!msg.error||msg.error.code == proto.CommonErrorCode.Succeed) {\r\n            if (this.currTag == TASKDAILY.DAILY) {\r\n                this.initDailyTaskView();\r\n            }\r\n            UIMgr.ins.show({ viewName: ViewName.CongratulationPop, data: msg.rewards })\r\n        }\r\n    }\r\n    on_s2c_ReceiveDailyActivityTaskRewardRsp(msg: proto.Msg_ReceiveDailyActivityTaskRewardRsp) {\r\n        if (!msg.error||msg.error.code == proto.CommonErrorCode.Succeed) {\r\n            this.updateBoxItem();\r\n            UIMgr.ins.show({ viewName: ViewName.CongratulationPop, data: msg.rewards })\r\n        }\r\n    }\r\n    on_s2c_ReceiveWeeklyTaskRewardRsp(msg: proto.Msg_ReceiveWeeklyTaskRewardRsp) {\r\n        if (!msg.error||msg.error.code == proto.CommonErrorCode.Succeed) {\r\n            if (this.currTag == TASKDAILY.WEEK) {\r\n                this.initWeekTaskView();\r\n            }\r\n            UIMgr.ins.show({ viewName: ViewName.CongratulationPop, data: msg.rewards })\r\n        }\r\n    }\r\n    on_s2c_ReceiveWeeklyActivityTaskRewardRsp(msg: proto.Msg_ReceiveWeeklyActivityTaskRewardRsp) {\r\n        if (!msg.error||msg.error.code == proto.CommonErrorCode.Succeed) {\r\n            this.updateBoxItem();\r\n            UIMgr.ins.show({ viewName: ViewName.CongratulationPop, data: msg.rewards })\r\n        }\r\n    }\r\n    on_s2c_ReceiveAchievementTaskRewardRsp(msg: proto.Msg_ReceiveAchievementTaskRewardRsp) {\r\n        if (!msg.error||msg.error.code == proto.CommonErrorCode.Succeed) {\r\n            if (this.currTag == TASKDAILY.ACHIEVEMENT) {\r\n                this.initAchievement();\r\n            }\r\n        }\r\n        UIMgr.ins.show({ viewName: ViewName.CongratulationPop, data: msg.rewards })\r\n    }\r\n    on_s2c_TaskChangePush(msg:proto.Msg_TaskChangePush){\r\n        if(this.currTag==TASKDAILY.DAILY){\r\n            this.initDailyTaskView();\r\n        }else if(this.currTag==TASKDAILY.WEEK){\r\n            this.initWeekTaskView();\r\n        }else if(this.currTag==TASKDAILY.ACHIEVEMENT){\r\n            this.initAchievement();\r\n        }\r\n    }\r\n}"]}