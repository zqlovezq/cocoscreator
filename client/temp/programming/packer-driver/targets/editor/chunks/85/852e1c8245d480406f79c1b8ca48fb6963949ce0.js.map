{"version":3,"sources":["file:///C:/chickenStarClient/client/assets/scripts/logic/model/activity/monthlyCard/MonthlyCardItem.ts"],"names":["_decorator","Component","instantiate","Label","Node","Prefab","tab","ItemInfo","ItemPoolMgr","MonthlyCardPrivilegeItem","LangMgr","PayControl","ActivityControl","TimeUtil","RoleData","ChannelMgr","ccclass","property","MonthlyCardItem","table","state","initView","cardNode1","active","Type","PrivilegedType","PrivilegedType_MonthlyPass","cardNode2","PrivilegedType_PremiumMonthlyPass","itemInfo","initItemData","BuyRewardIds","BuyRewardNum","node","ins","createRewadItem","nowRewardNode","setPosition","key","RewardIds","info","RewardNum","everydayNode","initPrivilegeView","updateView","WordKey","item","privilegeItemPrefb","parent","privilegeNode","com","getComponent","bgNode","vipNode","richtext1","string","getLab","richtext2","lastTimer","priceBtnNode","claimBtnNode","gotBtnNode","timerNode","rechargeTable","getData","RechargeTableById","getValue","RechargeId","priceNumLabel","getSdkRechargeShowPrice","dayStr","data","formaterWithOutSecond3","getServerUtcTime","lastDayLab","onClickBuy","requestPay","onClickReceive","requestReceiveMonthlyPassDailyRewards"],"mappings":"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","sourcesContent":["import { _decorator, Component, instantiate, Label, Node, Prefab } from 'cc';\r\nimport { tab } from '../../../../Table/table_gen';\r\nimport { ItemInfo } from '../../item/ItemInfo';\r\nimport { ItemPoolMgr } from '../../item/ItemPoolMgr';\r\nimport { MonthlyCardPrivilegeItem } from './MonthlyCardPrivilegeItem';\r\nimport { LangMgr } from '../../../mgr/LangMgr';\r\nimport { PayControl } from '../../pay/PayControl';\r\nimport { ActivityControl } from '../ActivityControl';\r\nimport { TimeUtil } from '../../../utils/TimeUtil';\r\nimport { Role } from '../../../fight/base/obj/role/role/Role';\r\nimport { RoleData } from '../../role/RoleData';\r\nimport { ChannelMgr } from '../../../../channel/ChannelMgr';\r\nconst { ccclass, property } = _decorator;\r\n\r\n@ccclass('MonthlyCardItem')\r\nexport class MonthlyCardItem extends Component {\r\n    @property(Node)\r\n    cardNode1:Node=null;\r\n    @property(Node)\r\n    cardNode2:Node=null;\r\n    @property(Node)\r\n    nowRewardNode:Node=null;\r\n    @property(Node)\r\n    everydayNode:Node=null;\r\n    @property(Node)\r\n    privilegeNode:Node=null;\r\n    @property(Node)\r\n    priceBtnNode:Node=null;\r\n    @property(Label)\r\n    priceNumLabel:Label=null;\r\n    @property(Node)\r\n    claimBtnNode:Node=null;\r\n    @property(Node)\r\n    gotBtnNode:Node=null;\r\n    @property(Prefab)\r\n    privilegeItemPrefb:Prefab=null;\r\n    @property(Label)\r\n    lastDayLab:Label=null;\r\n    @property(Node)\r\n    timerNode:Node=null;\r\n    private table:tab.MonthlyPassTable;\r\n    private state:number;\r\n    initView(table:tab.MonthlyPassTable) {\r\n        this.table=table;\r\n        this.cardNode1.active=table.Type==tab.PrivilegedType.PrivilegedType_MonthlyPass;\r\n        this.cardNode2.active=table.Type==tab.PrivilegedType.PrivilegedType_PremiumMonthlyPass;\r\n\r\n        let itemInfo=new ItemInfo();\r\n        itemInfo.initItemData(table.BuyRewardIds[0],table.BuyRewardNum[0]);\r\n        let node:Node=ItemPoolMgr.ins.createRewadItem(itemInfo,this.nowRewardNode);\r\n        node.setPosition(0,-30);\r\n        for(let key in table.RewardIds){\r\n            let info=new ItemInfo();\r\n            info.initItemData(table.RewardIds[key],table.RewardNum[key]);\r\n            ItemPoolMgr.ins.createRewadItem(info,this.everydayNode);\r\n        }\r\n        this.initPrivilegeView();\r\n        this.updateView(0);\r\n    }\r\n\r\n    private initPrivilegeView(){\r\n        for(let key in this.table.WordKey){\r\n            let item=instantiate(this.privilegeItemPrefb);\r\n            item.parent=this.privilegeNode;\r\n            let com=item.getComponent(MonthlyCardPrivilegeItem);\r\n            com.bgNode.active=this.table.Type==tab.PrivilegedType.PrivilegedType_MonthlyPass;\r\n            com.vipNode.active=this.table.Type==tab.PrivilegedType.PrivilegedType_PremiumMonthlyPass;\r\n            if(this.table.Type==tab.PrivilegedType.PrivilegedType_MonthlyPass){\r\n                com.richtext1.string=LangMgr.getLab(this.table.WordKey[key]);\r\n            }else{\r\n                com.richtext2.string=LangMgr.getLab(this.table.WordKey[key]);\r\n            }\r\n        }\r\n    }\r\n    /**\r\n     * state: 0:未购买 1:已购买未领取 2:已领取\r\n     */\r\n    updateView(state:number,lastTimer:number=0){\r\n        this.state=state;\r\n        this.priceBtnNode.active=state==0;\r\n        this.claimBtnNode.active=state==1;\r\n        this.gotBtnNode.active=state==2;\r\n        if(state==0){\r\n            this.timerNode.active=false;\r\n            let rechargeTable=tab.getData().RechargeTableById.getValue(this.table.RechargeId);\r\n            this.priceNumLabel.string=ChannelMgr.getSdkRechargeShowPrice(rechargeTable);\r\n        }else{\r\n            this.timerNode.active=true;\r\n            let dayStr = LangMgr.getLab(\"Tips_common_day\")\r\n            let data=TimeUtil.formaterWithOutSecond3(lastTimer-RoleData.ins.getServerUtcTime())\r\n            this.lastDayLab.string=data[\"day\"]+dayStr\r\n        }\r\n        \r\n\r\n    }\r\n\r\n    onClickBuy(){\r\n        if(this.state==0){\r\n            PayControl.ins.requestPay(this.table.RechargeId,null)\r\n        }\r\n    }\r\n    onClickReceive(){\r\n        if(this.state==1){\r\n            ActivityControl.ins.requestReceiveMonthlyPassDailyRewards(this.table.Type);\r\n        }\r\n    }\r\n}\r\n\r\n\r\n"]}