{"version":3,"sources":["file:///C:/chickenStarClient/client/assets/scripts/logic/model/jianghu/dailyExplore/InstanceZonesViewItem.ts"],"names":["_decorator","Button","Label","Node","Sprite","InfiniteCell","tab","LangMgr","ItemInfo","ItemPoolMgr","ConsumptionToPurchase","GameUtil","proto","Net","JIANGHU_TYPE","GameplayViewDataMgr","ShowTips","PowerDifficultyTag","ccclass","property","InstanceZonesViewItem","_tabData","_viewType","NONE","_exportData","_sweepInfo","UpdateContent","data","type","exportData","ins","getSweepInfo","sweep","clearedStageIds","indexOf","StageId","setSweepBtn","lbl_level","string","getLab","StageName","node_content","destroyAllChildren","node_pass","active","getCurSweepStageId","node_challenge","node_lock","sweepTab","getData","PveSweepTableByStageId","getValue","i","SweepRewardItemIds","length","createItem","SweepRewardItemNum","curFightStageId","RewardItemId","RewardItemNum","lbl_recommend_power","convertNumber","RecommendFight","node","getComponent","setStageId","node_sweep","freeTimes","buyTimes","node_sweep_buy","needDiamond","diamondData","notFreeSweepTimes","node_sweep_buy_diamond","getCombineString","getChildByName","grayscale","interactable","itemId","num","itemInfo","onClickChallenge","msg","Msg_StartStageReq","stageId","Send","Ptl","StartStageReq","onClickSweep","canSweep","setSweepdata","sendMsg","Msg_SweepExploreStageReq","SweepExploreStageReq","self","sweepInfo","canUse"],"mappings":"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","sourcesContent":["import { _decorator, Button, Component, Label, labelAssembler, Node, RichText, Sprite } from 'cc';\r\nimport InfiniteCell from '../../../../Common/InfiniteList/InfiniteCell';\r\nimport { tab } from '../../../../Table/table_gen';\r\nimport { LangMgr } from '../../../mgr/LangMgr';\r\nimport { ItemInfo } from '../../item/ItemInfo';\r\nimport { ItemPoolMgr } from '../../item/ItemPoolMgr';\r\nimport { ConsumptionToPurchase, GameUtil, handleNumerText } from '../../../utils/GameUtil';\r\nimport { proto } from 'client_protocol';\r\nimport { Net } from '../../../net/Net';\r\nimport { JIANGHU_TYPE } from '../../../../Common/script/EnumTypeMgr';\r\nimport { GameplayViewDataMgr } from '../GameplayViewDataMgr';\r\nimport { ShowTips } from '../../../mgr/UIMgr';\r\nimport { PowerDifficultyTag } from '../../home/PowerDifficultyTag';\r\nconst { ccclass, property } = _decorator;\r\n\r\n@ccclass('InstanceZonesViewItem')\r\nexport class InstanceZonesViewItem extends InfiniteCell {\r\n    //@property(RichText)\r\n    //lbl_level: RichText = null;\r\n    @property(Label)\r\n    lbl_level: Label = null;\r\n    @property(Node)\r\n    node_content: Node = null;\r\n    @property(Node)\r\n    node_sweep: Node = null;\r\n    @property(Node)\r\n    node_challenge: Node = null;\r\n    @property(Node)\r\n    node_lock: Node = null;\r\n    @property(Node)\r\n    node_pass: Node = null;\r\n    @property(Node)\r\n    node_sweep_buy:Node = null;\r\n    @property(Label)\r\n    node_sweep_buy_diamond:Label = null;\r\n    @property(Label)\r\n    lbl_recommend_power: Label = null;\r\n    private _tabData: tab.PveStageTable = null;\r\n    private _viewType: JIANGHU_TYPE = JIANGHU_TYPE.NONE;\r\n    private _exportData: proto.IExportStageInfo = null;\r\n    private _sweepInfo:any = null;\r\n    UpdateContent(data): void {\r\n        this._tabData = data.data;\r\n        this._viewType = data.type;\r\n        this._exportData = data.exportData;\r\n        this._sweepInfo = GameplayViewDataMgr.ins.getSweepInfo(this._viewType);\r\n        const sweep = this._exportData.clearedStageIds.indexOf(this._tabData.StageId) > -1;\r\n        this.setSweepBtn();\r\n        //this.lbl_level.string = LangMgr.getCombineString(\"ui_instance_2\", [LangMgr.getLab(this._tabData.StageName)])\r\n        this.lbl_level.string = LangMgr.getLab(this._tabData.StageName)\r\n        // 显示是否可以扫荡 如果可以扫荡\r\n        this.node_content.destroyAllChildren();\r\n        this.node_pass.active = sweep && this._tabData.StageId !== GameplayViewDataMgr.ins.getCurSweepStageId(this._viewType);\r\n        this.node_challenge.active = false;\r\n        this.node_lock.active = false;\r\n        if (sweep) {\r\n            const sweepTab = tab.getData().PveSweepTableByStageId.getValue(this._tabData.StageId);\r\n            for (let i = 0; i < sweepTab.SweepRewardItemIds.length; i++) {\r\n                if (sweepTab.SweepRewardItemIds[i]) {\r\n                    this.createItem(sweepTab.SweepRewardItemIds[i], sweepTab.SweepRewardItemNum[i])\r\n                }\r\n            }\r\n        } else {\r\n            if (this._tabData.StageId === GameplayViewDataMgr.ins.curFightStageId) {\r\n                this.node_challenge.active = true;\r\n                for (let i = 0; i < this._tabData.RewardItemId.length; i++) {\r\n                    this.createItem(this._tabData.RewardItemId[i], this._tabData.RewardItemNum[i])\r\n                }\r\n                // 显示推荐战力\r\n                this.lbl_recommend_power.string =GameUtil.convertNumber(this._tabData.RecommendFight);\r\n            } else if (this._tabData.StageId > GameplayViewDataMgr.ins.curFightStageId) {\r\n                for (let i = 0; i < this._tabData.RewardItemId.length; i++) {\r\n                    this.createItem(this._tabData.RewardItemId[i], this._tabData.RewardItemNum[i])\r\n                }\r\n                this.node_lock.active = true;\r\n            }\r\n        }\r\n\r\n        \r\n        this.node.getComponent(PowerDifficultyTag) && this.node.getComponent(PowerDifficultyTag).setStageId(this._tabData.StageId)\r\n    }\r\n    // 如果当前item可以扫荡 设置扫荡按钮\r\n    setSweepBtn(){\r\n        const sweep = this._exportData.clearedStageIds.indexOf(this._tabData.StageId) > -1;\r\n        this.node_sweep.active = sweep && this._tabData.StageId === GameplayViewDataMgr.ins.getCurSweepStageId(this._viewType)&&(this._sweepInfo.freeTimes>0||this._sweepInfo.buyTimes===0);\r\n        this.node_sweep_buy.active = sweep && this._tabData.StageId === GameplayViewDataMgr.ins.getCurSweepStageId(this._viewType)&&this._sweepInfo.freeTimes==0&&this._sweepInfo.buyTimes>0;\r\n        if(this.node_sweep_buy.active){\r\n            const needDiamond = this._sweepInfo.diamondData[this._exportData.notFreeSweepTimes]?this._sweepInfo.diamondData[this._exportData.notFreeSweepTimes]:this._sweepInfo.diamondData[this._sweepInfo.diamondData.length-1]\r\n            this.node_sweep_buy_diamond.string = LangMgr.getCombineString(\"ui_instance_3\", [needDiamond]);\r\n        }\r\n        this.node_sweep.getChildByName(\"sweep_btn\").getComponent(Sprite).grayscale = this._sweepInfo.freeTimes===0&&this._sweepInfo.buyTimes===0\r\n        this.node_sweep.getChildByName(\"sweep_btn\").getComponent(Button).interactable = !(this._sweepInfo.freeTimes===0&&this._sweepInfo.buyTimes===0)\r\n    }\r\n    createItem(itemId: number, num: number) {\r\n        const itemInfo = new ItemInfo();\r\n        itemInfo.itemId = itemId;\r\n        itemInfo.num = num;\r\n        ItemPoolMgr.ins.createItem(itemInfo, this.node_content);\r\n    }\r\n    // 挑战\r\n    onClickChallenge() {\r\n        let msg = new proto.Msg_StartStageReq();\r\n        msg.stageId = this._tabData.StageId;\r\n        Net.Send(proto.Ptl.StartStageReq, msg)\r\n    }\r\n    // 扫荡\r\n    onClickSweep() {\r\n        const canSweep = this.setSweepdata();\r\n        if (canSweep) {\r\n            this.sendMsg();\r\n        }\r\n    }\r\n    sendMsg(){\r\n        let msg = new proto.Msg_SweepExploreStageReq();\r\n        msg.stageId = this._tabData.StageId;\r\n        Net.Send(proto.Ptl.SweepExploreStageReq, msg)\r\n    }\r\n    // 如果是扫荡判断当前的数据 返回是否可以扫荡\r\n    setSweepdata(): boolean {\r\n        var self = this;\r\n        const sweepInfo = this._sweepInfo;\r\n        const needDiamond = this._sweepInfo.diamondData[this._exportData.notFreeSweepTimes]?this._sweepInfo.diamondData[this._exportData.notFreeSweepTimes]:this._sweepInfo.diamondData[this._sweepInfo.diamondData.length-1]\r\n        let canUse = false;\r\n        if (sweepInfo.freeTimes===0) {\r\n            // 判断付费次数\r\n            if (sweepInfo.buyTimes===0) {\r\n                ShowTips(LangMgr.getLab('Tips_timeshortage'));\r\n            } else {\r\n                // 弹窗是否花费一定钻石购买次数\r\n                ConsumptionToPurchase(1, needDiamond, \"Tips_instance_1\",()=>{\r\n                    self.sendMsg();\r\n                })\r\n            }\r\n        } else {\r\n            canUse = true;\r\n        }\r\n        return canUse;\r\n    }\r\n}\r\n\r\n\r\n"]}