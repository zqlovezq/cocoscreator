{"version":3,"sources":["file:///C:/chickenStarClient/client/assets/scripts/logic/model/activity/wonderfulActivity/ChapterGiftView.ts"],"names":["_decorator","instantiate","Label","Node","Prefab","ScrollView","sp","Sprite","Toggle","ComponentBase","UIMgr","PayControl","ChapterGiftItem","tab","MallDataMgr","ItemInfo","ItemPoolMgr","EventMgr","LocalEvent","ViewName","createAnimation","Func","ActivityMainView","ChannelMgr","ccclass","property","ChapterGiftView","Skeleton","_shop_view","Map","_curView","register","onLocal","Chapter_Gift_Change","changeView","unRegister","onDestroy","onShow","map","size","ins","show","viewName","count","node_toggle_content","destroyAllChildren","forEach","val","key","id","mallTab","ChapterGiftTab","getData","MainChapterGiftTableByMallId","getValue","MallId","toggleItem","pfb_toggle","parent","toggleItemTs","getComponent","initData","MainChapterId","isChecked","scroll_view","scrollToRight","setViewByMallId","curMallTab","get","awards","GetItemIds","awardNums","GetItemNum","node_layout","i","length","awardInfo","itemId","num","createRewadItem","RechargeId","rechargeTab","RechargeTableById","lbl_price","string","getSdkRechargeShowPrice","chapterData","MainChapterTableById","spine_boss","node","AnimationId","sp_discount","setTexture","DiscountIcon","setItem","Id","view","getView","refreshChapterRed","clicRMBkBuy","self","requestPay","delete","getFixedShopData","set"],"mappings":"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","sourcesContent":["import { _decorator, Component, instantiate, Label, Node, Prefab, ScrollView, sp, Sprite, Toggle, Vec3 } from 'cc';\r\nimport { ComponentBase } from '../../../../framework/base/ComponentBase';\r\nimport { UIMgr } from '../../../mgr/UIMgr';\r\nimport { PayControl } from '../../pay/PayControl';\r\nimport { ChapterGiftItem } from './ChapterGiftItem';\r\nimport { tab } from '../../../../Table/table_gen';\r\nimport { MALLNAME } from '../../../../Common/script/EnumTypeMgr';\r\nimport { MallDataMgr } from '../../shop/MallDataMgr';\r\nimport { ItemInfo } from '../../item/ItemInfo';\r\nimport { ItemPoolMgr } from '../../item/ItemPoolMgr';\r\nimport { EventMgr } from '../../../mgr/EventMgr';\r\nimport { LocalEvent } from '../../../define/LocalEvent';\r\nimport { ViewName } from '../../../define/ViewDefine';\r\nimport { createAnimation } from '../../../utils/GameUtil';\r\nimport { Func } from '../../../utils/Func';\r\nimport { ActivityMainView } from './ActivityMainView';\r\nimport { ChannelMgr } from '../../../../channel/ChannelMgr';\r\nconst { ccclass, property } = _decorator;\r\n\r\n@ccclass('ChapterGiftView')\r\nexport class ChapterGiftView extends ComponentBase {\r\n    @property(Prefab)\r\n    pfb_toggle: Prefab = null;\r\n    @property(Node)\r\n    node_toggle_content: Node = null;\r\n    @property(Node)\r\n    node_layout:Node = null;\r\n    @property(Label)\r\n    lbl_price:Label = null;\r\n    @property(sp.Skeleton)\r\n    spine_boss:sp.Skeleton = null;\r\n    @property(Sprite)\r\n    sp_discount:Sprite = null;\r\n    @property(ScrollView)\r\n    scroll_view:ScrollView = null;\r\n    private _shop_view: Map<MALLNAME, tab.MallItemTabe> = new Map();\r\n    private _curView: number = 0;\r\n    register(): void {\r\n        EventMgr.onLocal(LocalEvent.Chapter_Gift_Change, this.changeView, this);\r\n    }\r\n    unRegister(): void {\r\n        super.unRegister()\r\n    }\r\n    protected onDestroy(): void {\r\n        super.onDestroy();\r\n    }\r\n    onShow(map?:Map<MALLNAME, tab.MallItemTabe>) {\r\n        if(map){\r\n            this._shop_view = map;\r\n        }\r\n        if(this._shop_view.size===0){\r\n            UIMgr.ins.show({ viewName: ViewName.ActivityMainView})\r\n            return;\r\n        }\r\n        let count = 0;\r\n        this.node_toggle_content.destroyAllChildren();\r\n        this._shop_view.forEach((val, key) => {\r\n            const id = key;\r\n            const mallTab = val;\r\n            const ChapterGiftTab = tab.getData().MainChapterGiftTableByMallId.getValue(mallTab.MallId);\r\n            const toggleItem = instantiate(this.pfb_toggle);\r\n            toggleItem.parent = this.node_toggle_content;\r\n            const toggleItemTs = toggleItem.getComponent(ChapterGiftItem);\r\n            toggleItemTs.initData(id, ChapterGiftTab.MainChapterId);\r\n            count++;\r\n            if (count === this._shop_view.size) {\r\n                this._curView = id;\r\n                toggleItem.getComponent(Toggle).isChecked = true;\r\n                if(this._shop_view.size>4){\r\n                    this.scroll_view.scrollToRight();\r\n                }\r\n            }\r\n        })\r\n        this.setViewByMallId()\r\n    }\r\n    changeView(id:number){\r\n        this._curView = id;\r\n        this.setViewByMallId();\r\n    }\r\n    // 根据MallItemTable的id创建界面\r\n    setViewByMallId() {\r\n        const curMallTab = this._shop_view.get(this._curView);\r\n        const ChapterGiftTab = tab.getData().MainChapterGiftTableByMallId.getValue(curMallTab.MallId);\r\n        const awards = curMallTab.GetItemIds;\r\n        const awardNums = curMallTab.GetItemNum;\r\n        this.node_layout.destroyAllChildren();\r\n        for (let i = 0; i < awards.length; i++) {\r\n            const awardInfo = new ItemInfo();\r\n            awardInfo.itemId = awards[i];\r\n            awardInfo.num = awardNums[i];\r\n            ItemPoolMgr.ins.createRewadItem(awardInfo, this.node_layout);\r\n        }\r\n        // 价格\r\n        if(curMallTab.RechargeId){\r\n            const rechargeTab = tab.getData().RechargeTableById.getValue(curMallTab.RechargeId);\r\n            this.lbl_price.string = ChannelMgr.getSdkRechargeShowPrice(rechargeTab);\r\n        }\r\n        const chapterData = tab.getData().MainChapterTableById.getValue(ChapterGiftTab.MainChapterId);\r\n        createAnimation(this.spine_boss.node,ChapterGiftTab.AnimationId);\r\n        this.sp_discount.setTexture(ChapterGiftTab.DiscountIcon);\r\n        // this.lbl_name.string = LangMgr.getLab(chapterData.Name);\r\n        Func.setItem(\"chapter_gift_\"+curMallTab.Id,\"true\");\r\n\r\n        const view = UIMgr.ins.getView('ActivityMainView');\r\n        view.getComponent(ActivityMainView).refreshChapterRed();\r\n    }\r\n    clicRMBkBuy() {\r\n        var self = this;\r\n        const curMallTab = this._shop_view.get(this._curView);\r\n        PayControl.ins.requestPay(curMallTab.RechargeId, () => {\r\n            this._shop_view.delete(this._curView);\r\n            MallDataMgr.ins.getFixedShopData(curMallTab.MallId).set(curMallTab.Id, 1);\r\n            self.onShow();\r\n        })\r\n    }\r\n}\r\n\r\n\r\n"]}