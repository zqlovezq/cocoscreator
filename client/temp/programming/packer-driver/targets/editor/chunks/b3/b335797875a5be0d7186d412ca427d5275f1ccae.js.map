{"version":3,"sources":["file:///C:/chickenStarClient/client/assets/scripts/logic/model/task/TaskControl.ts"],"names":["TaskControl","_decorator","AbsControl","EventMgr","proto","Net","TaskData","RedMgr","RedDotType","tab","ItemData","BattlePassDataMgr","LocalEvent","OpenFunctionMgr","AssociationData","ccclass","property","ins","_instance","register","onMsg","Ptl","GetDailyTasksRsp","on_s2c_GetDailyTasksRsp","ReceiveDailyTaskRewardRsp","on_s2c_ReceiveDailyTaskRewardRsp","ReceiveDailyActivityTaskRewardRsp","on_s2c_ReceiveDailyActivityTaskRewardRsp","ReceiveGuildTaskChestRewardsRsp","on_s2c_ReceiveGuildTaskChestRewardsRsp","GetWeeklyTasksRsp","on_s2c_GetWeeklyTasksRsp","ReceiveWeeklyTaskRewardRsp","on_s2c_ReceiveWeeklyTaskRewardRsp","ReceiveWeeklyActivityTaskRewardRsp","on_s2c_ReceiveWeeklyActivityTaskRewardRsp","GetAchievementTasksRsp","on_s2c_GetAchievementRsp","ReceiveAchievementTaskRewardRsp","on_s2c_ReceiveAchievementTaskRewardRsp","TaskChangePush","on_s2c_TaskChangePush","ReceiveGuildDailyTasksRewardsRsp","on_s2c_ReceiveGuildDailyTasksRewardsRsp","registerCalculateFb","DayTask","on_GetDayTaskRedPoint","WeekTask","on_GetWeekTaskRedPoint","AchievementTask","on_AchievementTaskRedPoint","Battle_Pass","red_Battle_Pass","Guild_Task","on_GetGuildTaskRedPoint","request","requestGetDailyTasks","requestWeeklyTasks","requestAchievementTasks","msg","Msg_GetDailyTasksReq","Send","GetDailyTasksReq","Msg_GetWeeklyTasksReq","GetWeeklyTasksReq","Msg_GetAchievementTasksReq","GetAchievementTasksReq","requestReceiveDailyTaskReward","taskIds","Msg_ReceiveDailyTaskRewardReq","ReceiveDailyTaskRewardReq","requestReceiveDailyActivityTaskReward","indexes","Msg_ReceiveDailyActivityTaskRewardReq","ReceiveDailyActivityTaskRewardReq","requestReceiveWeeklyTaskReward","Msg_ReceiveWeeklyTaskRewardReq","ReceiveWeeklyTaskRewardReq","requestReceiveWeeklyActivityTaskReward","Msg_ReceiveWeeklyActivityTaskRewardReq","ReceiveWeeklyActivityTaskRewardReq","requestReceiveAchievementTaskReward","Msg_ReceiveAchievementTaskRewardReq","ReceiveAchievementTaskRewardReq","requestReceiveGuildActivityTaskReward","Msg_ReceiveGuildTaskChestRewardsReq","ReceiveGuildTaskChestRewardsReq","requestReceiveGuildDailyTaskReward","Msg_ReceiveGuildDailyTasksRewardsReq","ReceiveGuildDailyTasksRewardsReq","initDailyTasks","refreshEvent","initWeekTasks","initAchieveTasks","error","code","CommonErrorCode","Succeed","receiveDailyTaskRewardSucc","receiveDailyActiveRewardSucc","receiveGuildActiveRewardSucc","receiveWeekTaskRewardSucc","receiveWeekActiveRewardSucc","receiveAchieveTaskRewardSucc","receiveGuildTaskRewardSucc","updateTask","emitLocal","TrialRed","checkFunctionIsOpen","OpenFunctionName","OpenFunctionName_DailyTask","infos","getDailyInfos","key","isCanReceived","actives","getData","GetKeyValue_ConfigTable","DailyTaskRewardNeedCount","dailyActiveNum","getCount","CurrencyType","CurrencyType_DailyActivity","i","length","getIsGetDailyActiveReward","OpenFunctionName_Association","getInGuild","getGuildInfos","GuildDailyTaskRewardNeedCount","getAssocitionInfo","dailyFinishedTaskNumber","getIsGetGuildActiveReward","OpenFunctionName_WeeklyTask","getWeekInfos","WeeklyTaskBoxTable","weekActiveNum","CurrencyType_WeeklyActivity","Id","getIsGetWeekActiveReward","OpenFunctionName_AchievementTask","getAchievementInfos","stateToChange","Object","keys","BattlePassTab","forEach","_key","Number","isNaN","data","getDataByPassName","id","getAllReceiveTaskId"],"mappings":"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","sourcesContent":["import { Node, _decorator, js, sys } from \"cc\";\nimport { AbsControl } from \"../../../framework/base/IAbs\";\nimport { EventMgr } from \"../../mgr/EventMgr\";\nimport { proto } from \"client_protocol\";\nimport { Net } from \"../../net/Net\";\nimport { TaskData } from \"./TaskData\";\nimport { RedMgr } from \"../../mgr/RedMgr\";\nimport { RedDotType } from \"../../red/RedDotType\";\nimport { tab } from \"../../../Table/table_gen\";\nimport { ItemData } from \"../item/ItemData\";\nimport { BattlePassDataMgr } from \"../activity/battlePass/BattlePassDataMgr\";\nimport { LocalEvent } from \"../../define/LocalEvent\";\nimport { OpenFunctionMgr } from \"../../../Common/component/OpenFunctionMgr\";\nimport { AssociationData } from \"../association/AssociationData\";\nimport { ActivityData } from \"../activity/ActivityData\";\n\nconst { ccclass, property } = _decorator;\n\n/** 任务 */\nexport class TaskControl extends AbsControl {\n\n    private static _instance: TaskControl;\n    public static get ins() {\n        if (null == this._instance) {\n            this._instance = new TaskControl();\n        }\n        return this._instance;\n    }\n\n    register(): void {\n        EventMgr.onMsg(proto.Ptl.GetDailyTasksRsp, this.on_s2c_GetDailyTasksRsp, this);\n        EventMgr.onMsg(proto.Ptl.ReceiveDailyTaskRewardRsp, this.on_s2c_ReceiveDailyTaskRewardRsp, this);\n        EventMgr.onMsg(proto.Ptl.ReceiveDailyActivityTaskRewardRsp, this.on_s2c_ReceiveDailyActivityTaskRewardRsp, this);\n        EventMgr.onMsg(proto.Ptl.ReceiveGuildTaskChestRewardsRsp, this.on_s2c_ReceiveGuildTaskChestRewardsRsp, this);\n        EventMgr.onMsg(proto.Ptl.GetWeeklyTasksRsp, this.on_s2c_GetWeeklyTasksRsp, this);\n        EventMgr.onMsg(proto.Ptl.ReceiveWeeklyTaskRewardRsp, this.on_s2c_ReceiveWeeklyTaskRewardRsp, this);\n        EventMgr.onMsg(proto.Ptl.ReceiveWeeklyActivityTaskRewardRsp, this.on_s2c_ReceiveWeeklyActivityTaskRewardRsp, this);\n        EventMgr.onMsg(proto.Ptl.GetAchievementTasksRsp, this.on_s2c_GetAchievementRsp, this);\n        EventMgr.onMsg(proto.Ptl.ReceiveAchievementTaskRewardRsp, this.on_s2c_ReceiveAchievementTaskRewardRsp, this);\n        EventMgr.onMsg(proto.Ptl.TaskChangePush, this.on_s2c_TaskChangePush, this);\n        EventMgr.onMsg(proto.Ptl.ReceiveGuildDailyTasksRewardsRsp, this.on_s2c_ReceiveGuildDailyTasksRewardsRsp, this);\n\n\n        RedMgr.ins.registerCalculateFb(RedDotType.DayTask, this.on_GetDayTaskRedPoint, this);\n        RedMgr.ins.registerCalculateFb(RedDotType.WeekTask, this.on_GetWeekTaskRedPoint, this);\n        RedMgr.ins.registerCalculateFb(RedDotType.AchievementTask, this.on_AchievementTaskRedPoint, this);\n        RedMgr.ins.registerCalculateFb(RedDotType.Battle_Pass, this.red_Battle_Pass, this);\n        RedMgr.ins.registerCalculateFb(RedDotType.Guild_Task, this.on_GetGuildTaskRedPoint, this);\n        // RedMgr.ins.registerCalculateFb(RedDotType.Gacha_Up_red, this.on_GetGachaUpTaskRedPoint, this);\n    }\n    request() {\n        this.requestGetDailyTasks();\n        this.requestWeeklyTasks();\n        this.requestAchievementTasks();\n    }\n    /**\n     *请求获得每日任务\n     */\n    requestGetDailyTasks() {\n        let msg = new proto.Msg_GetDailyTasksReq();\n        Net.Send(proto.Ptl.GetDailyTasksReq, msg)\n    }\n    /**\n   *请求获得每周任务\n   */\n    requestWeeklyTasks() {\n        let msg = new proto.Msg_GetWeeklyTasksReq;\n        Net.Send(proto.Ptl.GetWeeklyTasksReq, msg)\n    }\n    /**\n   *请求获得每周任务\n   */\n    requestAchievementTasks() {\n        let msg = new proto.Msg_GetAchievementTasksReq;\n        Net.Send(proto.Ptl.GetAchievementTasksReq, msg)\n    }\n    /**\n    *请求领取每日任务奖励\n    */\n    requestReceiveDailyTaskReward(taskIds: number[]) {\n        let msg = new proto.Msg_ReceiveDailyTaskRewardReq();\n        msg.taskIds = taskIds;\n        Net.Send(proto.Ptl.ReceiveDailyTaskRewardReq, msg)\n    }\n    /**\n     *请求领取每日活跃奖励\n    */\n    requestReceiveDailyActivityTaskReward(indexes: number[]) {\n        let msg = new proto.Msg_ReceiveDailyActivityTaskRewardReq();\n        msg.indexes = indexes;\n        Net.Send(proto.Ptl.ReceiveDailyActivityTaskRewardReq, msg)\n    }\n\n    /**\n    *请求领取每周任务奖励\n    */\n    requestReceiveWeeklyTaskReward(taskIds: number[]) {\n        let msg = new proto.Msg_ReceiveWeeklyTaskRewardReq;\n        msg.taskIds = taskIds;\n        Net.Send(proto.Ptl.ReceiveWeeklyTaskRewardReq, msg)\n    }\n\n    /**\n   *请求领取每周活跃奖励\n  */\n    requestReceiveWeeklyActivityTaskReward(indexes: number[]) {\n        let msg = new proto.Msg_ReceiveWeeklyActivityTaskRewardReq();\n        msg.indexes = indexes;\n        Net.Send(proto.Ptl.ReceiveWeeklyActivityTaskRewardReq, msg)\n    }\n    /*\n    *请求领取成就任务奖励\n    */\n    requestReceiveAchievementTaskReward(taskIds: number[]) {\n        let msg = new proto.Msg_ReceiveAchievementTaskRewardReq();\n        msg.taskIds = taskIds;\n        Net.Send(proto.Ptl.ReceiveAchievementTaskRewardReq, msg)\n    }\n\n    /**\n     *请求领取公会活跃奖励\n    */\n    requestReceiveGuildActivityTaskReward(indexes: number[]) {\n        let msg = new proto.Msg_ReceiveGuildTaskChestRewardsReq();\n        msg.indexes = indexes;\n        Net.Send(proto.Ptl.ReceiveGuildTaskChestRewardsReq, msg)\n    }\n\n    requestReceiveGuildDailyTaskReward(taskIds: number[]) {\n        let msg = new proto.Msg_ReceiveGuildDailyTasksRewardsReq();\n        msg.taskIds = taskIds;\n        Net.Send(proto.Ptl.ReceiveGuildDailyTasksRewardsReq, msg)\n    }\n\n    on_s2c_GetDailyTasksRsp(msg: proto.Msg_GetDailyTasksRsp) {\n        TaskData.ins.initDailyTasks(msg);\n        RedMgr.refreshEvent(RedDotType.DayTask);\n    }\n    on_s2c_GetWeeklyTasksRsp(msg: proto.Msg_GetWeeklyTasksRsp) {\n        TaskData.ins.initWeekTasks(msg);\n        RedMgr.refreshEvent(RedDotType.WeekTask);\n    }\n    on_s2c_GetAchievementRsp(msg: proto.Msg_GetAchievementTasksRsp) {\n        TaskData.ins.initAchieveTasks(msg);\n        RedMgr.refreshEvent(RedDotType.AchievementTask);\n    }\n    on_s2c_ReceiveDailyTaskRewardRsp(msg: proto.Msg_ReceiveDailyTaskRewardRsp) {\n        if (!msg.error || msg.error.code == proto.CommonErrorCode.Succeed) {\n            TaskData.ins.receiveDailyTaskRewardSucc(msg.taskIds);\n            RedMgr.refreshEvent(RedDotType.DayTask);\n        }\n    }\n    on_s2c_ReceiveDailyActivityTaskRewardRsp(msg: proto.Msg_ReceiveDailyActivityTaskRewardRsp) {\n        if (!msg.error || msg.error.code == proto.CommonErrorCode.Succeed) {\n            TaskData.ins.receiveDailyActiveRewardSucc(msg.indexes);\n            RedMgr.refreshEvent(RedDotType.DayTask);\n        }\n    }\n    on_s2c_ReceiveGuildTaskChestRewardsRsp(msg: proto.Msg_ReceiveGuildTaskChestRewardsRsp){\n        if (!msg.error || msg.error.code == proto.CommonErrorCode.Succeed) {\n            TaskData.ins.receiveGuildActiveRewardSucc(msg.indexes);\n            // 刷新任务红点\n            RedMgr.refreshEvent(RedDotType.Guild_Task);\n        }\n    }\n    on_s2c_ReceiveWeeklyTaskRewardRsp(msg: proto.Msg_ReceiveWeeklyTaskRewardRsp) {\n        if (!msg.error || msg.error.code == proto.CommonErrorCode.Succeed) {\n            TaskData.ins.receiveWeekTaskRewardSucc(msg.taskIds);\n            RedMgr.refreshEvent(RedDotType.WeekTask);\n        }\n    }\n    on_s2c_ReceiveWeeklyActivityTaskRewardRsp(msg: proto.Msg_ReceiveWeeklyActivityTaskRewardRsp) {\n        if (!msg.error || msg.error.code == proto.CommonErrorCode.Succeed) {\n            TaskData.ins.receiveWeekActiveRewardSucc(msg.indexes);\n            RedMgr.refreshEvent(RedDotType.WeekTask);\n        }\n    }\n    on_s2c_ReceiveAchievementTaskRewardRsp(msg: proto.Msg_ReceiveAchievementTaskRewardRsp) {\n        if (!msg.error || msg.error.code == proto.CommonErrorCode.Succeed) {\n            TaskData.ins.receiveAchieveTaskRewardSucc(msg.taskIds);\n            RedMgr.refreshEvent(RedDotType.AchievementTask);\n        }\n    }\n    on_s2c_ReceiveGuildDailyTasksRewardsRsp(msg: proto.Msg_ReceiveGuildDailyTasksRewardsRsp) {\n        if (!msg.error || msg.error.code == proto.CommonErrorCode.Succeed) {\n            TaskData.ins.receiveGuildTaskRewardSucc(msg.taskIds);\n            // 刷新任务红点\n            RedMgr.refreshEvent(RedDotType.Guild_Task);\n        }\n    }\n    on_s2c_TaskChangePush(msg: proto.Msg_TaskChangePush) {\n        TaskData.ins.updateTask(msg);\n        RedMgr.refreshEvent(RedDotType.DayTask);\n        RedMgr.refreshEvent(RedDotType.WeekTask);\n        RedMgr.refreshEvent(RedDotType.AchievementTask);\n        RedMgr.refreshEvent(RedDotType.Battle_Pass);\n        EventMgr.emitLocal(LocalEvent.TrialRed);\n        RedMgr.refreshEvent(RedDotType.Guild_Task);\n    }\n    on_GetDayTaskRedPoint() {\n        if (!OpenFunctionMgr.ins.checkFunctionIsOpen(tab.OpenFunctionName.OpenFunctionName_DailyTask)) {\n            return false;\n        }\n        let infos = TaskData.ins.getDailyInfos();\n        if (infos) {\n            for (let key in infos) {\n                if (infos[key].isCanReceived) {\n                    return true;\n                }\n            }\n        }\n        let actives = tab.getData().GetKeyValue_ConfigTable().DailyTaskRewardNeedCount;\n        let dailyActiveNum = ItemData.ins.getCount(tab.CurrencyType.CurrencyType_DailyActivity);\n        for (let i: number = 0; i < actives.length; i++) {\n            if (dailyActiveNum >= actives[i]) {\n                if (!TaskData.ins.getIsGetDailyActiveReward(i)) {\n                    return true;\n                }\n            }\n\n        }\n        return false;\n    }\n    on_GetGuildTaskRedPoint(){\n        if (!OpenFunctionMgr.ins.checkFunctionIsOpen(tab.OpenFunctionName.OpenFunctionName_Association)) {\n            return false;\n        }\n        if(!AssociationData.ins.getInGuild()){\n            return false;\n        }\n        let infos = TaskData.ins.getGuildInfos();\n        if (infos) {\n            for (let key in infos) {\n                if (infos[key].isCanReceived) {\n                    return true;\n                }\n            }\n        }\n        let actives = tab.getData().GetKeyValue_ConfigTable().GuildDailyTaskRewardNeedCount;\n        const dailyActiveNum = AssociationData.ins.getAssocitionInfo().dailyFinishedTaskNumber;\n        for (let i: number = 0; i < actives.length; i++) {\n            if (dailyActiveNum >= actives[i]) {\n                if (!TaskData.ins.getIsGetGuildActiveReward(i)) {\n                    return true;\n                }\n            }\n\n        }\n        return false;\n    }\n    // on_GetGachaUpTaskRedPoint(){\n    //     if (!OpenFunctionMgr.ins.checkFunctionIsOpen(tab.OpenFunctionName.OpenFunctionName_ActivityGachaUp)) {\n    //         return false;\n    //     }\n    //     const actInfos = ActivityData.ins.getAllUpData();\n    //     for(let i=0;i<actInfos.length;i++){\n    //         const info = actInfos[i];\n    //         const actTab = tab.getData().GachaUpTableById.getValue(info.activityTable.Param1);\n    //         const taskIds = actTab.TaskIds;\n    //         for(let i=0;i<taskIds.length;i++){\n    //            return TaskData.ins.getGachaUpTaskInfo(taskIds[i]).isCanReceived;\n    //         }\n    //     }\n    //     return false;\n    // }\n    on_GetWeekTaskRedPoint() {\n        if (!OpenFunctionMgr.ins.checkFunctionIsOpen(tab.OpenFunctionName.OpenFunctionName_WeeklyTask)) {\n            return false;\n        }\n        let infos = TaskData.ins.getWeekInfos();\n        if (infos) {\n            for (let key in infos) {\n                if (infos[key].isCanReceived) {\n                    return true;\n                }\n            }\n        }\n        let actives = tab.getData().WeeklyTaskBoxTable;\n        let weekActiveNum = ItemData.ins.getCount(tab.CurrencyType.CurrencyType_WeeklyActivity);\n        for (let i: number = 0; i < actives.length; i++) {\n            if (weekActiveNum >= actives[i].Id) {\n                if (!TaskData.ins.getIsGetWeekActiveReward(i)) {\n                    return true;\n                }\n            }\n\n        }\n        return false;\n    }\n    on_AchievementTaskRedPoint() {\n        if (!OpenFunctionMgr.ins.checkFunctionIsOpen(tab.OpenFunctionName.OpenFunctionName_AchievementTask)) {\n            return false;\n        }\n        let infos = TaskData.ins.getAchievementInfos();\n        if (infos) {\n            for (let key in infos) {\n                if (infos[key].isCanReceived) {\n                    return true;\n                }\n            }\n        }\n        return false;\n    }\n    red_Battle_Pass() {\n        let stateToChange = {};\n        Object.keys(tab.BattlePassTab).forEach(key => {\n            const _key = Number(key)\n            if (!isNaN(_key)) {\n                const data = BattlePassDataMgr.ins.getDataByPassName(_key);\n                if (data) {\n                    stateToChange[_key] = {};\n                    for (let i = 0; i < data.length; i++) {\n                        const id = data[i].Id\n                        stateToChange[_key][id] = BattlePassDataMgr.ins.getAllReceiveTaskId(id).length > 0;\n                    }\n                }\n            }\n        })\n        return stateToChange;\n    }\n}"]}