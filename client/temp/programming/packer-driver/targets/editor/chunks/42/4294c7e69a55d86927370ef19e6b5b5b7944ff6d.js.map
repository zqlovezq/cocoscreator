{"version":3,"sources":["file:///C:/chickenStarClient/client/assets/scripts/logic/fight/base/obj/AbsObjFactory.ts"],"names":["Layers","Node","Vec3","_decorator","AbsObjType","Bullet","Monster","Role","FightRootControl","RoleInfo","MonsterInfo","BulletInfo","ccclass","property","AbsObjFactory","addSelfId","selfId","init","getObjList","role","enemy","bullet","getRole","objInfo","parent","args","get","getMonster","getBullet","absType","absList","pools","set","console","log","length","getObjInfoList","poolInfos","obj","pop","addComponent","node","layer","Enum","DEFAULT","active","addChild","ins","getRootView","addNode","setAngle","setScale","ONE","objId","isRecycle","setObjInfo","initMachine","insert","getData","put","reset","removeFromParent","objType","push","putData","destroy","forEach","value","key","item","Map"],"mappings":"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","sourcesContent":["import { Input, Layers, Node, ObjectCurve, PhysicsSystem, Prefab, Quat, TiledUserNodeData, Vec3, _decorator, instantiate, sp, v3 } from 'cc';\nimport { AbsObj, AbsObjType } from './AbsObj';\nimport { Bullet } from './bullet/Bullet';\nimport { Monster } from './role/monster/Monster';\nimport { Role } from './role/role/Role';\nimport { ResMgr } from '../../../mgr/ResMgr';\nimport { FightRootControl } from '../../FightRootControl';\nimport { AbsObjInfo } from './AbsObjInfo';\nimport { RoleInfo } from './role/role/RoleInfo';\nimport { MonsterInfo } from './role/monster/MonsterInfo';\nimport { BulletInfo } from './bullet/BulletInfo';\nimport { RedDotType } from '../../../red/RedDotType';\n\nconst { ccclass, property } = _decorator;\n\n/**战斗对象工厂 */\n@ccclass('AbsObjFactory')\nexport class AbsObjFactory {\n\n    static pools: Map<number, AbsObj[]> = new Map<number, AbsObj[]>()\n    static poolInfos: Map<number, AbsObjInfo[]> = new Map<number, AbsObjInfo[]>()\n\n    static selfId: number\n\n    static addSelfId() {\n        AbsObjFactory.selfId += 1\n        return AbsObjFactory.selfId\n    }\n    static init() {\n        AbsObjFactory.selfId = 0\n        AbsObjFactory.getObjList(AbsObjType.role)\n        AbsObjFactory.getObjList(AbsObjType.enemy)\n        AbsObjFactory.getObjList(AbsObjType.bullet)\n    }\n\n    static getRole(objInfo: AbsObjInfo, parent?: Node, args?: any): Role {\n        return AbsObjFactory.get(AbsObjType.role, objInfo, parent, args) as Role\n    }\n\n    static getMonster(objInfo: AbsObjInfo, parent?: Node, args?: any): Monster {\n        return AbsObjFactory.get(AbsObjType.enemy, objInfo, parent, args) as Monster\n    }\n\n    static getBullet(objInfo: AbsObjInfo, parent?: Node, args?: any): Bullet {\n        return AbsObjFactory.get(AbsObjType.bullet, objInfo, parent, args) as Bullet\n    }\n\n    static getObjList(absType: AbsObjType): AbsObj[] {\n        let absList = AbsObjFactory.pools.get(absType)\n        if (absList == null) {\n            absList = []\n            AbsObjFactory.pools.set(absType, absList)\n        }\n        if (AbsObjFactory.selfId == 0){\n            console.log(\"AbsObjFactory.getObjList == 0\",absType,absList.length)\n        }\n        return absList\n    }\n\n    static getObjInfoList(absType: AbsObjType): AbsObjInfo[] {\n        let absList = AbsObjFactory.poolInfos.get(absType)\n        if (absList == null) {\n            absList = []\n            AbsObjFactory.poolInfos.set(absType, absList)\n        }\n        return absList\n    }\n\n    private static get(absType: AbsObjType, objInfo: AbsObjInfo, parent?: Node, args?: any) {\n        let obj: AbsObj\n\n        obj = AbsObjFactory.getObjList(absType).pop()\n        if (obj == null) {\n            if (absType === AbsObjType.role) {\n                obj = new Node(\"Role\").addComponent(Role)\n            } else if (absType === AbsObjType.enemy) {\n                obj = new Node(\"Monster\").addComponent(Monster)\n            } else if (absType == AbsObjType.bullet) {\n                obj = new Node(\"bullet\").addComponent(Bullet)\n            }\n        }\n\n\n        obj.node.layer = Layers.Enum.DEFAULT\n        obj.node.active = true\n        if (parent) {\n            parent.addChild(obj.node)\n        } else {\n            FightRootControl.ins.getRootView().addNode(obj.node)\n        }\n        obj.setAngle(0)\n        obj.setScale(Vec3.ONE)\n        obj.objId = AbsObjFactory.addSelfId()\n        obj.isRecycle = false\n        obj.setObjInfo(objInfo)\n        obj.initMachine()\n        obj.init()\n        obj.insert()\n        return obj\n    }\n\n    public static getData(absType: AbsObjType) {\n        let objInfo: AbsObjInfo\n        objInfo = AbsObjFactory.getObjInfoList(absType).pop()\n        if (objInfo == null) {\n            if (absType === AbsObjType.role) {\n                objInfo = new RoleInfo()\n            } else if (absType === AbsObjType.enemy) {\n                objInfo = new MonsterInfo()\n            } else if (absType == AbsObjType.bullet) {\n                objInfo = new BulletInfo()\n            }\n        }\n        objInfo.isRecycle = false\n        return objInfo\n    }\n\n    static put(obj: AbsObj) {\n        if (obj == null || (obj && obj.isRecycle)) {\n            return\n        }\n        obj.isRecycle = true\n        obj.reset()\n        obj.node.removeFromParent()\n        AbsObjFactory.getObjList(obj.objType).push(obj)\n    }\n\n    static putData(obj: AbsObjInfo) {\n        obj.isRecycle = true\n        obj.reset()\n        AbsObjFactory.getObjInfoList(obj.objType).push(obj)\n    }\n\n    /** 销毁对象池 */\n    static destroy() {\n\n        AbsObjFactory.pools.forEach((value, key) => {\n            value.forEach((item) => {\n                item.node.destroy()\n            })\n            value.length = 0\n        })\n    }\n\n}\n"]}