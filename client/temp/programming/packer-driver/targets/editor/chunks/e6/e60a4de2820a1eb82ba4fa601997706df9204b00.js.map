{"version":3,"sources":["file:///C:/chickenStarClient/client/assets/scripts/logic/model/activity/signIn/SignInView.ts"],"names":["_decorator","error","Label","ComponentBase","SignInRewardItem","ActivityData","proto","ActivityControl","EventMgr","UIMgr","ViewName","RoleData","TimeUtil","LangMgr","HeroDataControl","ccclass","property","SignInView","signId","type","tabs","msg","onTouchItem","day","ins","requestGetDailyReward","id","register","onMsg","Ptl","GetDailyRewardRsp","on_s2c_GetDailyRewardRsp","start","initView","getDailyRewardMsgByType","timeLab","Number","closeTime","lastTimer","getServerUtcTime","ret","formaterWithOutSecond3","hours","string","getCombineString","node","active","getDailyRewrdItemsById","i","signItems","length","Index","index","activatedList","indexOf","state","rewardList","updateView","updateState","code","CommonErrorCode","Succeed","data","show","viewName","CongratulationPop","rewards","onClickHero","event","heroId","refreshBookData","HeroBagView","viewType","zIndex"],"mappings":"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","sourcesContent":["import { _decorator, Component, error, Label, Node } from 'cc';\r\nimport { ComponentBase } from '../../../../framework/base/ComponentBase';\r\nimport { SignInRewardItem } from './SignInRewardItem';\r\nimport { ActivityData } from '../ActivityData';\r\nimport { tab } from '../../../../Table/table_gen';\r\nimport { proto } from 'client_protocol';\r\nimport { ActivityControl } from '../ActivityControl';\r\nimport { EventMgr } from '../../../mgr/EventMgr';\r\nimport { UIMgr } from '../../../mgr/UIMgr';\r\nimport { ViewName } from '../../../define/ViewDefine';\r\nimport { RoleData } from '../../role/RoleData';\r\nimport { TimeUtil } from '../../../utils/TimeUtil';\r\nimport { LangMgr } from '../../../mgr/LangMgr';\r\nimport { HeroDataControl } from '../../hero/herobag/HeroDataControl';\r\nconst { ccclass, property } = _decorator;\r\n\r\n/**\r\n * \r\n * SignInView\r\n * zhudingchao\r\n * Thu Jun 20 2024 17:38:38 GMT+0800 (中国标准时间)\r\n * db://assets/scripts/logic/model/activity/signIn/SignInView.ts\r\n *\r\n */\r\n\r\n@ccclass('SignInView')\r\nexport class SignInView extends ComponentBase {\r\n    @property([SignInRewardItem])\r\n    signItems: Array<SignInRewardItem> = [];\r\n    @property(Label)\r\n    timeLab:Label=null;\r\n    private signId: number;\r\n    private type: tab.DailyRewardType;\r\n    private tabs: Array<tab.DailyRewardItemTable>;\r\n    private msg: proto.Msg_DailyRewardPush;\r\n    register(): void {\r\n        EventMgr.onMsg(proto.Ptl.GetDailyRewardRsp, this.on_s2c_GetDailyRewardRsp, this)\r\n    }\r\n    protected start(): void {\r\n\r\n    }\r\n    initView(type: tab.DailyRewardType) {\r\n        this.type = type;\r\n\r\n        this.msg = ActivityData.ins.getDailyRewardMsgByType(this.type);\r\n        if (!this.msg) {\r\n            error(\"签到数据错误==\", type)\r\n            return;\r\n        }\r\n        if(this.timeLab){\r\n            if(Number(this.msg.closeTime)>0){\r\n                let lastTimer=Number(this.msg.closeTime)-RoleData.ins.getServerUtcTime();\r\n                if(lastTimer>0){\r\n                   let ret= TimeUtil.formaterWithOutSecond3(lastTimer);\r\n                   let day=ret.day?ret.day:0;\r\n                   let hours=ret.hours?ret.hours:0;\r\n                   this.timeLab.string=LangMgr.getCombineString(\"ui_commondesc_71\",[day,hours])\r\n                }else{\r\n                    this.timeLab.node.active=false;\r\n                }\r\n            }else{\r\n                this.timeLab.node.active=false;\r\n            }\r\n        }\r\n        this.tabs = ActivityData.ins.getDailyRewrdItemsById(this.msg.id);\r\n        for (let i: number = 0; i < this.signItems.length; i++) {\r\n            let day = this.tabs[i].Index;\r\n            let index = this.msg.activatedList.indexOf(day);\r\n            let state = 0;\r\n            if (index >= 0) {\r\n                state = 1;\r\n            } else {\r\n                index = this.msg.rewardList.indexOf(day);\r\n                if (index >= 0) {\r\n                    state = 2;\r\n                }\r\n            }\r\n            this.signItems[i].initView(this.tabs[i], state,this.onTouchItem);\r\n\r\n        }\r\n    }\r\n    updateView() {\r\n        this.msg = ActivityData.ins.getDailyRewardMsgByType(this.type);\r\n        for (let i: number = 0; i < this.signItems.length; i++) {\r\n            let day = this.tabs[i].Index;\r\n            let index = this.msg.activatedList.indexOf(day);\r\n            let state = 0;\r\n            if (index >= 0) {\r\n                state = 1;\r\n            } else {\r\n                index = this.msg.rewardList.indexOf(day);\r\n                if (index >= 0) {\r\n                    state = 2;\r\n                }\r\n            }\r\n            this.signItems[i].updateState(state);\r\n\r\n        }\r\n    }\r\n    onTouchItem=(day:number)=>{\r\n        ActivityControl.ins.requestGetDailyReward(this.msg.id,day)\r\n\r\n    }\r\n    // 领取每日奖励\r\n    on_s2c_GetDailyRewardRsp(msg: proto.Msg_GetDailyRewardRsp) {\r\n        if (!msg.error || msg.error.code == proto.CommonErrorCode.Succeed) {\r\n            if(msg.data.id==this.msg.id){\r\n                UIMgr.ins.show({ viewName: ViewName.CongratulationPop, data: msg.rewards })\r\n                this.updateView();\r\n            }\r\n             \r\n        }\r\n    }\r\n    onClickHero(event,heroId:number){\r\n        heroId=Number(heroId);\r\n        HeroDataControl.ins.refreshBookData(heroId);\r\n        UIMgr.ins.show({ viewName: ViewName.HeroBagView ,data:{viewType:2},zIndex:300})\r\n    }\r\n}"]}