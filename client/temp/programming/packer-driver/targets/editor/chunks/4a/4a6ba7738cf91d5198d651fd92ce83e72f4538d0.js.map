{"version":3,"sources":["file:///C:/chickenStarClient/client/assets/scripts/logic/model/rareBook/RareBookGroupItem.ts"],"names":["_decorator","Component","instantiate","Label","Node","Prefab","sp","LangMgr","RareBookData","RareBookItem","RareBookGroupAttributeITitleItem","UIMgr","ViewName","ccclass","property","RareBookGroupItem","Skeleton","bookInfos","groupTabs","rareBookItems","attrItems","groupId","onTouchItem","info","ins","show","viewName","RareBookDetailView","data","initData","table","GroupId","nameLab","string","getLab","Name","key","BookId","getBookInfoByItemId","push","item","rareBookItemPrefab","parent","rarebookLayout","com","getComponent","total","length","getSerieInfoById","Id","num","count","titleItemPrefab","attributeNode","animSp","node","active","redPoint","updateView","playAnim","setAnimation","setCompleteListener","trackEntry","loop"],"mappings":"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","sourcesContent":["import { _decorator, Component, Gradient, instantiate, Label, Node, Prefab, sp } from 'cc';\r\nimport { tab } from '../../../Table/table_gen';\r\nimport { LangMgr } from '../../mgr/LangMgr';\r\nimport { RareBookData } from './RareBookData';\r\nimport { RareBookItem } from './RareBookItem';\r\nimport { RareBookGroupAttributeITitleItem } from './RareBookGroupAttributeITitleItem';\r\nimport { RareBookInfo } from './RareBookInfo';\r\nimport { UIMgr } from '../../mgr/UIMgr';\r\nimport { ViewName } from '../../define/ViewDefine';\r\nconst { ccclass, property } = _decorator;\r\n\r\n/**\r\n * \r\n * RareBookGroupItem\r\n * zhudingchao\r\n * Mon May 27 2024 16:34:29 GMT+0800 (中国标准时间)\r\n * db://assets/scripts/logic/model/rareBook/RareBookGroupItem.ts\r\n *\r\n */\r\n\r\n@ccclass('RareBookGroupItem')\r\nexport class RareBookGroupItem extends Component {\r\n    @property(Node)\r\n    rarebookLayout: Node = null;\r\n    @property(Prefab)\r\n    rareBookItemPrefab: Prefab = null;\r\n    @property(Prefab)\r\n    titleItemPrefab: Prefab = null;\r\n    @property(Node)\r\n    attributeNode: Node = null;\r\n    @property(Label)\r\n    nameLab: Label = null;\r\n    @property(Node)\r\n    redPoint:Node=null;\r\n    @property(sp.Skeleton)\r\n    animSp:sp.Skeleton=null;\r\n    private bookInfos: RareBookInfo[];\r\n    private groupTabs: tab.BookSeriesTable[];\r\n    private rareBookItems: Array<RareBookItem>;\r\n    private attrItems: Array<RareBookGroupAttributeITitleItem>;\r\n    public groupId:number;\r\n    initData( groupTabs: tab.BookSeriesTable[]) {\r\n        let table=groupTabs[0]\r\n        this.groupId=table.GroupId;\r\n        this.nameLab.string = LangMgr.getLab(table.Name);\r\n        let bookInfos = [];\r\n        this.rareBookItems = [];\r\n        this.attrItems = [];\r\n        // let starMap: Map<number, number> = new Map();\r\n        for (let key in table.BookId) {\r\n            let info = RareBookData.ins.getBookInfoByItemId(table.BookId[key]);\r\n            bookInfos.push(info);\r\n            let item = instantiate(this.rareBookItemPrefab);\r\n            item.parent = this.rarebookLayout;\r\n            let com = item.getComponent(RareBookItem);\r\n            com.initData(info,true,this.onTouchItem,false);\r\n            this.rareBookItems.push(com);\r\n          \r\n\r\n        }\r\n        this.bookInfos = bookInfos;\r\n        this.groupTabs = groupTabs;\r\n        let total = bookInfos.length;\r\n\r\n        for (let key in groupTabs) {\r\n            let info=RareBookData.ins.getSerieInfoById(groupTabs[key].Id)\r\n            let num =info?info.count:0;\r\n            let item = instantiate(this.titleItemPrefab);\r\n            item.parent = this.attributeNode;\r\n            let com = item.getComponent(RareBookGroupAttributeITitleItem);\r\n            com.initData(groupTabs[key], num, total);\r\n            this.attrItems.push(com);\r\n        }\r\n        this.animSp.node.active=false;\r\n        this.redPoint.active=false;\r\n    }\r\n    onTouchItem=(info:RareBookInfo)=>{\r\n        UIMgr.ins.show({ viewName: ViewName.RareBookDetailView,data:{\"currInfo\":info}})\r\n    }\r\n    updateView(): void {\r\n        for (let key in this.rareBookItems) {\r\n            this.rareBookItems[key].updateView();\r\n        }\r\n        let total = this.rareBookItems.length;\r\n        for (let key in this.groupTabs) {\r\n            let info=RareBookData.ins.getSerieInfoById(this.groupTabs[key].Id)\r\n            let num =info?info.count:0;\r\n            let item = this.attrItems[key]\r\n            item.updateView(num, total);\r\n\r\n        }\r\n      \r\n    }\r\n\r\n    playAnim(){\r\n        this.animSp.node.active=true;\r\n        // this.redPoint.active=true;\r\n        this.animSp.setAnimation(0,\"idle\",false);\r\n        this.animSp.setCompleteListener((trackEntry) => {\r\n            if (trackEntry.loop) {\r\n                return\r\n            }\r\n            this.animSp.node.active=false;\r\n            this.redPoint.active=false;\r\n        \r\n        })\r\n        // this.scheduleOnce(()=>{\r\n           \r\n        // },1)\r\n    }\r\n\r\n}"]}