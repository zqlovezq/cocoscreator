{"version":3,"sources":["file:///C:/chickenStarClient/client/assets/scripts/logic/fight/define/FightRenderSort.ts"],"names":["_decorator","view","Func","FrameControl","AbsObjType","ccclass","property","FightRenderSort","sort","objects","bulletNode","children","length","objectSort","NodeSort","ySort","sortBullet","forEach","element","setzIndex","getVisibleSize","height","position","y","list","ins","getObjList","role","len","abs","i","node","enemy","animationId"],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;AAASA,MAAAA,U,OAAAA,U;AAA6BC,MAAAA,I,OAAAA,I;;AAC7BC,MAAAA,I,iBAAAA,I;;AACAC,MAAAA,Y,iBAAAA,Y;;AACAC,MAAAA,U,iBAAAA,U;;;;;;;;;OAGH;AAAEC,QAAAA,OAAF;AAAWC,QAAAA;AAAX,O,GAAwBN,U;AAE9B;AACA;;iCAEaO,e,WADZF,OAAO,CAAC,iBAAD,C,gBAAR,MACaE,eADb,CAC6B;AAEd,eAAJC,IAAI,CAACC,OAAD,EAAgBC,UAAhB,EAAkC;AACzC,cAAID,OAAO,CAACE,QAAR,CAAiBC,MAAjB,GAA0B,EAA9B,EAAkC;AAC9B,iBAAKC,UAAL,CAAgBJ,OAAhB;AACA;AAAA;AAAA,8BAAKK,QAAL,CAAcL,OAAd;AACH,WAHD,MAGO;AACH,iBAAKM,KAAL,CAAWN,OAAX;AACH;;AACD,eAAKO,UAAL,CAAgBN,UAAhB;AAEH;;AAGW,eAALK,KAAK,CAACN,OAAD,EAAgB;AACxB;AACAA,UAAAA,OAAO,CAACE,QAAR,CAAiBM,OAAjB,CAAyBC,OAAO,IAAI;AAChC;AAAA;AAAA,8BAAKC,SAAL,CAAeD,OAAf,EAAwBjB,IAAI,CAACmB,cAAL,GAAsBC,MAAtB,GAA+BH,OAAO,CAACI,QAAR,CAAiBC,CAAxE;AACH,WAFD;AAGA;AAAA;AAAA,4BAAKT,QAAL,CAAcL,OAAd;AACH;;AAEgB,eAAVI,UAAU,CAACJ,OAAD,EAAgB;AAC7B,cAAIe,IAAI,GAAG;AAAA;AAAA,4CAAaC,GAAb,CAAiBC,UAAjB,CAA4B;AAAA;AAAA,wCAAWC,IAAvC,CAAX;AAEA,cAAIC,GAAG,GAAGJ,IAAI,CAACZ,MAAf;AACA,cAAIiB,GAAJ;;AACA,eAAK,IAAIC,CAAC,GAAG,CAAb,EAAgBA,CAAC,GAAGF,GAApB,EAAyBE,CAAC,EAA1B,EAA8B;AAC1BD,YAAAA,GAAG,GAAGL,IAAI,CAACM,CAAD,CAAV;AACA;AAAA;AAAA,8BAAKX,SAAL,CAAeU,GAAG,CAACE,IAAnB,EAAyB9B,IAAI,CAACmB,cAAL,GAAsBC,MAAtB,GAA+BQ,GAAG,CAACE,IAAJ,CAAST,QAAT,CAAkBC,CAA1E;AACH;;AAEDC,UAAAA,IAAI,GAAG;AAAA;AAAA,4CAAaC,GAAb,CAAiBC,UAAjB,CAA4B;AAAA;AAAA,wCAAWM,KAAvC,CAAP;AACAJ,UAAAA,GAAG,GAAGJ,IAAI,CAACZ,MAAX;;AACA,eAAK,IAAIkB,CAAC,GAAG,CAAb,EAAgBA,CAAC,GAAGF,GAApB,EAAyBE,CAAC,EAA1B,EAA8B;AAC1BD,YAAAA,GAAG,GAAGL,IAAI,CAACM,CAAD,CAAV;AACA;AAAA;AAAA,8BAAKX,SAAL,CAAeU,GAAG,CAACE,IAAnB,EAAyBF,GAAG,CAACI,WAA7B;AACH;;AACD;AAAA;AAAA,4BAAKnB,QAAL,CAAcL,OAAd,EAhB6B,CAiB7B;AACA;AACA;AACA;AACA;AAEA;AAEH;;AAEgB,eAAVO,UAAU,CAACN,UAAD,EAAmB;AAChC;AAAA;AAAA,4BAAKI,QAAL,CAAcJ,UAAd;AACH;;AAnDwB,O","sourcesContent":["import { _decorator, Component, Node, view } from \"cc\";\nimport { Func } from \"../../utils/Func\";\nimport { FrameControl } from \"../base/frame/FrameControl\";\nimport { AbsObjType } from \"../base/obj/AbsObj\";\nimport { AbsRole } from \"../base/obj/role/AbsRole\";\n\nconst { ccclass, property } = _decorator;\n\n/** 战斗渲染排序 \n*/\n@ccclass('FightRenderSort')\nexport class FightRenderSort {\n\n    static sort(objects: Node, bulletNode: Node) {\n        if (objects.children.length > 80) {\n            this.objectSort(objects)\n            Func.NodeSort(objects)\n        } else {\n            this.ySort(objects)\n        }\n        this.sortBullet(bulletNode)\n\n    }\n\n\n    static ySort(objects: Node) {\n        /** y轴排序 */\n        objects.children.forEach(element => {\n            Func.setzIndex(element, view.getVisibleSize().height - element.position.y)\n        });\n        Func.NodeSort(objects)\n    }\n\n    static objectSort(objects: Node) {\n        let list = FrameControl.ins.getObjList(AbsObjType.role) as AbsRole[]\n\n        let len = list.length\n        let abs: AbsRole\n        for (let i = 0; i < len; i++) {\n            abs = list[i]\n            Func.setzIndex(abs.node, view.getVisibleSize().height - abs.node.position.y)\n        }\n\n        list = FrameControl.ins.getObjList(AbsObjType.enemy) as AbsRole[]\n        len = list.length\n        for (let i = 0; i < len; i++) {\n            abs = list[i]\n            Func.setzIndex(abs.node, abs.animationId)\n        }\n        Func.NodeSort(objects)\n        // let ids = []\n        // for (let index = 0; index < objects.children.length; index++) {\n        //     const v = objects.children[index];\n        //     ids.push(v[\"zIndex\"])\n        // }\n\n        // console.log('objectSort', ids)\n\n    }\n\n    static sortBullet(bulletNode: Node) {\n        Func.NodeSort(bulletNode)\n    }\n}"]}