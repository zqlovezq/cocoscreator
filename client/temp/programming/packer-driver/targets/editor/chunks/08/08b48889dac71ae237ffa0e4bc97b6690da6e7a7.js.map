{"version":3,"sources":["file:///C:/chickenStarClient/client/assets/scripts/logic/fight/power/powerTab/PowerBase.ts"],"names":["_decorator","tab","Func","ccclass","property","PowerBase","constructor","configId","powerType","skillPowers","setParentPowers","powers","insertParent","insertItem","setConfigId","id","tmpTab","PowerType","PowerType_SkillGroupTable","getData","SkillGroupTableById","getValue","PowerType_SkillTable","SkillTableById","PowerType_BuffTable","BuffTableById","PowerType_EffectTable","EffectTableById","PowerType_BulletTable","BulletTableById","PowerType_TriggerTable","TriggerTableById","copyTab","console","error","addPower","power","powerKey","PowerMent","isKey","index","PowerValue","length","v","addPowerValue","powerValue","key","Object","prototype","hasOwnProperty","call","copy","newBase","_obj","toObj","Array","isArray"],"mappings":"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","sourcesContent":["import { _decorator, Component, js } from \"cc\";\nimport { tab } from \"../../../../Table/table_gen\";\nimport { SkillPowers } from \"../SkillPowers\";\nimport { Func } from \"../../../utils/Func\";\nconst { ccclass, property } = _decorator;\n\n@ccclass('PowerBase')\nexport class PowerBase {\n    configId: number = 0\n    powerType: tab.PowerType\n\n    skillPowers: SkillPowers //增强存储\n\n    constructor() {\n    }\n\n    setParentPowers(powers: SkillPowers) {\n        this.skillPowers = powers\n    }\n\n    insertParent() {\n        if (this.skillPowers) {\n            this.skillPowers.insertItem(this)\n        }\n    }\n\n    setConfigId(id: number) {\n        this.configId = id\n        let tmpTab\n        switch (this.powerType) {\n            case tab.PowerType.PowerType_SkillGroupTable:\n                tmpTab = tab.getData().SkillGroupTableById.getValue(id)\n                break\n            case tab.PowerType.PowerType_SkillTable:\n                tmpTab = tab.getData().SkillTableById.getValue(id)\n                break\n            case tab.PowerType.PowerType_BuffTable:\n                tmpTab = tab.getData().BuffTableById.getValue(id)\n                break\n            case tab.PowerType.PowerType_EffectTable:\n                tmpTab = tab.getData().EffectTableById.getValue(id)\n                break\n            case tab.PowerType.PowerType_BulletTable:\n                tmpTab = tab.getData().BulletTableById.getValue(id)\n                break\n            case tab.PowerType.PowerType_TriggerTable:\n                tmpTab = tab.getData().TriggerTableById.getValue(id)\n                break\n        }\n        if (tmpTab) {\n            this.copyTab(tmpTab)\n            this.insertParent()\n        } else {\n            if (id) {\n                console.error(\"powerBase configId is null 找策划--\", tab.PowerType[this.powerType], id)\n            }\n        }\n    }\n\n    private copyTab(tmpTab: any) {\n        Func.copyTab(tmpTab, this)\n    }\n\n    addPower(power: tab.SkillPowerTable) {\n        let powerKey = power.PowerMent\n        if (this.isKey(powerKey)) {\n            for (let index = 0; index < power.PowerValue.length; index++) {\n                const v = power.PowerValue[index];\n                this.addPowerValue(powerKey, v, index)\n            }\n        }\n    }\n\n    addPowerValue(powerKey: string, powerValue: number, index: number) {\n        // console.log(powerKey, this.getValue(powerKey), typeof (this.getValue(powerKey)))\n        if (typeof (this.getValue(powerKey)) == 'number') {\n            this[powerKey] += powerValue\n        } else {\n            if (this[powerKey][index] == null) {//自身数组不足补0\n                this[powerKey][index] = 0\n            }\n            this[powerKey][index] += powerValue\n        }\n    }\n\n    isKey(key: string) {\n        return Object.prototype.hasOwnProperty.call(this, key)\n    }\n\n    getValue(key: string) {\n        return this[key]\n    }\n\n    copy() {\n        let newBase = new (this as any).constructor()\n        PowerBase.copyTab(this, newBase)\n        return newBase\n    }\n\n    static copyTab(_obj: any, toObj: any) {\n        for (let key in _obj) {\n            if (_obj.hasOwnProperty(key) && key != \"skillPowers\") {\n                if (typeof _obj[key] == \"object\") {\n                    if (_obj[key] instanceof PowerBase) {\n                        if (toObj[key] == null) {\n                            toObj[key] = _obj[key].copy()\n                        }\n                    } else {\n                        if (Array.isArray(_obj[key])) {\n                            if (toObj[key] == null) {\n                                toObj[key] = []\n                            }\n                        } else {\n                            toObj[key] = {}\n                        }\n                        PowerBase.copyTab(_obj[key], toObj[key])\n                    }\n                } else {\n                    toObj[key] = _obj[key]\n                }\n            }\n        }\n        return toObj\n    }\n}"]}