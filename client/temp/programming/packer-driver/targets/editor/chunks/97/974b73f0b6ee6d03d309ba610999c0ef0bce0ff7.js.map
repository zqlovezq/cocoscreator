{"version":3,"sources":["file:///C:/chickenStarClient/client/assets/scripts/logic/model/mutation/TalentView.ts"],"names":["_decorator","instantiate","Node","NodeEventType","Prefab","ScrollView","UITransform","Vec3","ViewPop","InfiniteList","tab","TalentItem","TalentViewSpecialItem","TalentMiniTipsPop","TalentBigTipsPop","EventMgr","proto","RoleData","RedMgr","RedDotType","ccclass","property","TalentView","_lineHeroCount","_list","_canClose","onShow","groupList","list_view","getContent","getComponent","setAnchorPoint","Init","getCellNumber","getCellCount","bind","getCellSize","getCellWidth","getCellIdentifer","getCellView","getCellData","GetCellData","smallLevel","ins","gene","smallGeneLevel","idex","Math","floor","pos","GetScrollPosOfCell","maxWidth","width","max_x","x","setContentPos","node","on","node_big_tips","active","node_small_tips","_scrollView","TOUCH_START","_onTouchStar","length","idx","identifer","cell","pfb_item","pfb_start_item","view","data","result","list","i","getData","GeneLevelTable","_geneTab","obj","small","big","Type","GeneType","GeneType_SmallGene","push","level","UnlockArgs","_obj","slice","concat","register","onMsg","Ptl","UpgradeGeneLevelRsp","on_s2c_UpgradeGeneLevelRsp","msg","error","code","CommonErrorCode","Succeed","self","type","content","item","getChildByName","String","itemTs","talentItemSmallAction","Refresh","refreshEvent","HeroGene","bigGeneLevel","onDestroy","showBigTips","target","ts","setData","worldPos","parent","convertToWorldSpaceAR","position","viewPos","convertToNodeSpaceAR","setPosition","y","showSmallTips","scrollViewMidX","distanceToCenter","clickMove","ceil","onClose"],"mappings":"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","sourcesContent":["import { _decorator, Component, instantiate, Node, NodeEventType, Prefab, ScrollView, UITransform, Vec2, Vec3 } from 'cc';\r\nimport { ViewPop } from '../../../framework/base/ViewPop';\r\nimport InfiniteList from '../../../Common/InfiniteList/InfiniteList';\r\nimport { tab } from '../../../Table/table_gen';\r\nimport { TalentItem } from './TalentItem';\r\nimport { TalentViewSpecialItem } from './TalentViewSpecialItem';\r\nimport { TalentMiniTipsPop } from './TalentMiniTipsPop';\r\nimport { TalentBigTipsPop } from './TalentBigTipsPop';\r\nimport { EventMgr } from '../../mgr/EventMgr';\r\nimport { proto } from 'client_protocol';\r\nimport { RoleData } from '../role/RoleData';\r\nimport { RedMgr } from '../../mgr/RedMgr';\r\nimport { RedDotType } from '../../red/RedDotType';\r\nimport { GuideController } from '../../guide/GuideController';\r\nimport { LocalEvent } from '../../define/LocalEvent';\r\nimport { UIMgr } from '../../mgr/UIMgr';\r\nimport { MutationView } from './MutationView';\r\nconst { ccclass, property } = _decorator;\r\nexport interface TalentData {\r\n    small: tab.GeneLevelTable,\r\n    big: tab.GeneLevelTable\r\n}\r\n@ccclass('TalentView')\r\nexport class TalentView extends ViewPop {\r\n    @property(Prefab)\r\n    pfb_item: Prefab = null;\r\n    @property(Prefab)\r\n    pfb_start_item: Prefab = null;\r\n\r\n    @property(InfiniteList)\r\n    list_view: InfiniteList = null;\r\n    @property(Node)\r\n    node_big_tips: Node = null;\r\n    @property(Node)\r\n    node_small_tips: Node = null;\r\n    private _lineHeroCount = 3;\r\n    private _list = [];\r\n    private _canClose:boolean = true;\r\n    onShow(): void {\r\n        this._list = this.groupList();\r\n        this.list_view.getContent().getComponent(UITransform).setAnchorPoint(0, 0.5);\r\n        this.list_view.Init({\r\n            getCellNumber: this.getCellCount.bind(this),\r\n            getCellSize: this.getCellWidth.bind(this),\r\n            getCellIdentifer: this.getCellIdentifer.bind(this),\r\n            getCellView: this.getCellView.bind(this),\r\n            getCellData: this.GetCellData.bind(this),\r\n        });\r\n        const smallLevel = RoleData.ins.gene.smallGeneLevel;\r\n        const idex = Math.floor(smallLevel / 3)\r\n        const pos = this.list_view.GetScrollPosOfCell(idex);\r\n\r\n        const maxWidth = this.list_view.getContent().getComponent(UITransform).width-1500;\r\n        let max_x = pos.x>maxWidth?maxWidth:pos.x;\r\n        this.list_view.setContentPos(-max_x, -max_x,0);\r\n\r\n        this.list_view.node.on(\"scroll-began\", () => {\r\n            this.node_big_tips.active = false;\r\n            this.node_small_tips.active = false;\r\n        }, this);\r\n        let _scrollView = this.list_view.getComponent(ScrollView);\r\n        _scrollView.node.on(NodeEventType.TOUCH_START, this._onTouchStar, this, true);\r\n    }\r\n    _onTouchStar() {\r\n        this.node_big_tips.active = false;\r\n        this.node_small_tips.active = false;\r\n    }\r\n    getCellCount() {\r\n        return this._list.length;\r\n    }\r\n    getCellWidth(idx: number) {\r\n        if(idx===0){\r\n            return 136.85\r\n        }\r\n        if(idx==this._list.length-1){\r\n            return 268+80\r\n        }\r\n        return 268;\r\n    }\r\n    getCellIdentifer(idx: number) {\r\n        if (idx === 0) {\r\n            return \"TalentViewSpecialItem\"\r\n        }\r\n        return \"TalentItem\";\r\n    }\r\n    getCellView(idx: number, identifer: string) {\r\n        let cell = null;\r\n        switch (identifer) {\r\n            case \"TalentItem\":\r\n                cell = instantiate(this.pfb_item).getComponent(TalentItem);\r\n                break;\r\n            case \"TalentViewSpecialItem\":\r\n                cell = instantiate(this.pfb_start_item).getComponent(TalentViewSpecialItem);\r\n                break;\r\n        }\r\n        return cell;\r\n    }\r\n    GetCellData(idx: number) {\r\n        return {\r\n            view: this,\r\n            data: this._list[idx]\r\n        };\r\n    }\r\n    /* 将英雄数据分组 */\r\n    groupList() {\r\n        const result = [];\r\n        const list = [];\r\n        for (let i = 0; i < tab.getData().GeneLevelTable.length; i++) {\r\n            const _geneTab = tab.getData().GeneLevelTable[i];\r\n            let obj: TalentData = {\r\n                small: null,\r\n                big: null\r\n            }\r\n            if (_geneTab.Type == tab.GeneType.GeneType_SmallGene) {\r\n                obj.small = _geneTab;\r\n                list.push(obj)\r\n            } else {\r\n                let level = _geneTab.UnlockArgs;\r\n                let _obj = list[level - 1];\r\n                _obj.big = _geneTab;\r\n            }\r\n        }\r\n        /* 3个一节 分组 */\r\n        for (let i = 0; i < list.length; i += this._lineHeroCount) {\r\n            result.push(list.slice(i, i + this._lineHeroCount));\r\n        }\r\n        return [null].concat(result);\r\n    }\r\n    register(): void {\r\n        // 监听基因升级\r\n        EventMgr.onMsg(proto.Ptl.UpgradeGeneLevelRsp, this.on_s2c_UpgradeGeneLevelRsp, this)\r\n    }\r\n    on_s2c_UpgradeGeneLevelRsp(msg: proto.Msg_UpgradeGeneLevelRsp) {\r\n        if (msg.error && msg.error.code != proto.CommonErrorCode.Succeed) return;\r\n        this._canClose = false;\r\n        let self = this;\r\n        if (msg.type === tab.GeneType.GeneType_SmallGene) {\r\n            let content = this.list_view.getContent();\r\n            let item = content.getChildByName(String(Math.floor(RoleData.ins.gene.smallGeneLevel/3)+1))\r\n            let itemTs = item.getComponent(TalentItem);\r\n            itemTs.talentItemSmallAction(()=>{\r\n                RoleData.ins.gene.smallGeneLevel = msg.level;\r\n                self.list_view.Refresh();\r\n                RedMgr.refreshEvent(RedDotType.HeroGene);\r\n                this._canClose = true;\r\n            })\r\n        } else {\r\n            RoleData.ins.gene.bigGeneLevel = msg.level;\r\n            this.list_view.Refresh();\r\n            RedMgr.refreshEvent(RedDotType.HeroGene);\r\n            this._canClose = true;\r\n        }\r\n    }\r\n    protected onDestroy(): void {\r\n        super.onDestroy();\r\n    }\r\n    showBigTips(target: Node, data: tab.GeneLevelTable) {\r\n        let ts = this.node_big_tips.getComponent(TalentBigTipsPop);\r\n        ts.setData(data);\r\n        const worldPos = target.parent.getComponent(UITransform).convertToWorldSpaceAR(target.position);\r\n        const viewPos = this.list_view.node.getComponent(UITransform).convertToNodeSpaceAR(worldPos);\r\n        this.node_big_tips.setPosition(new Vec3(viewPos.x - 640, viewPos.y + 200, 0))\r\n    }\r\n    showSmallTips(target: Node, data: tab.GeneLevelTable) {\r\n        let ts = this.node_small_tips.getComponent(TalentMiniTipsPop);\r\n        ts.setData(data);\r\n        const scrollViewMidX = this.list_view.node.getComponent(UITransform).width / 2;\r\n        const worldPos = target.parent.getComponent(UITransform).convertToWorldSpaceAR(target.position);\r\n        const viewPos = this.list_view.node.getComponent(UITransform).convertToNodeSpaceAR(worldPos);\r\n        const distanceToCenter = viewPos.x - scrollViewMidX;\r\n        if (distanceToCenter > 0) {\r\n            // 在屏幕右侧\r\n            this.node_small_tips.setPosition(new Vec3(viewPos.x - 740, viewPos.y, 0))\r\n        } else {\r\n            // 在屏幕左侧\r\n            this.node_small_tips.setPosition(new Vec3(viewPos.x - 540, viewPos.y, 0))\r\n        }\r\n    }\r\n    clickMove(){\r\n        let content = this.list_view.getContent();\r\n        let item = content.getChildByName(String(Math.ceil(RoleData.ins.gene.smallGeneLevel/3)))\r\n        let itemTs = item.getComponent(TalentItem);\r\n        itemTs.talentItemSmallAction(()=>{\r\n            \r\n        })\r\n    }\r\n    onClose(): void {\r\n        if(this._canClose){\r\n            super.onClose();\r\n        }\r\n    }\r\n}\r\n\r\n\r\n"]}