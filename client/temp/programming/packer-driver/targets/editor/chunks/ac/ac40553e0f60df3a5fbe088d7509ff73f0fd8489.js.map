{"version":3,"sources":["file:///C:/chickenStarClient/client/assets/scripts/logic/model/rareBook/RareBookGroupPop.ts"],"names":["_decorator","instantiate","Label","Node","Prefab","ViewPop","RareBookData","LangMgr","RareBookItem","tab","RareBookGroupAttributeITitleItem","ccclass","property","RareBookGroupPop","currItemId","register","onShow","openData","initView","stab","ins","getSerieTableByBookId","newgroupTabs","groupTabs","getData","BookSeriesTable","key","GroupId","push","nameLab","string","getLab","Name","bookInfos","starMap","Map","BookId","info","getBookInfoByItemId","item","rareBookItemPrefab","parent","rarebookLayout","com","getComponent","initData","isLock","k2","starlevel","Level","level","has","set","get","total","length","num","titleItemPrefab","attrNode"],"mappings":"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","sourcesContent":["import { _decorator, Component, instantiate, Label, Node, Prefab } from 'cc';\r\nimport { ViewPop } from '../../../framework/base/ViewPop';\r\nimport { RareBookData } from './RareBookData';\r\nimport { LangMgr } from '../../mgr/LangMgr';\r\nimport { RareBookItem } from './RareBookItem';\r\nimport { tab } from '../../../Table/table_gen';\r\nimport { RareBookGroupAttributeITitleItem } from './RareBookGroupAttributeITitleItem';\r\nconst { ccclass, property } = _decorator;\r\n\r\n/**\r\n * \r\n * RareBookGroupPop\r\n * zhudingchao\r\n * Mon May 27 2024 19:23:28 GMT+0800 (中国标准时间)\r\n * db://assets/scripts/logic/model/rareBook/RareBookGroupPop.ts\r\n *\r\n */\r\n\r\n@ccclass('RareBookGroupPop')\r\nexport class RareBookGroupPop extends ViewPop {\r\n    @property(Label)\r\n    nameLab: Label = null;\r\n    @property(Node)\r\n    rarebookLayout: Node = null;\r\n    @property(Node)\r\n    attrNode: Node = null;\r\n    @property(Prefab)\r\n    rareBookItemPrefab: Prefab = null;\r\n    @property(Prefab)\r\n    titleItemPrefab: Prefab = null;\r\n\r\n    private currItemId: number;\r\n\r\n    register(): void {\r\n\r\n    }\r\n    onShow(): void {\r\n        this.currItemId = this.openData[\"itemId\"];\r\n        if (this.currItemId) {\r\n            this.initView();\r\n        }\r\n    }\r\n    initView() {\r\n        let stab = RareBookData.ins.getSerieTableByBookId(this.currItemId);\r\n        if (stab) {\r\n            let newgroupTabs = [];\r\n            let groupTabs = tab.getData().BookSeriesTable;\r\n            for (let key in groupTabs) {\r\n                if (groupTabs[key].GroupId == stab.GroupId) {\r\n                    newgroupTabs.push(groupTabs[key]);\r\n                }\r\n            }\r\n            this.nameLab.string = LangMgr.getLab(stab.Name);\r\n            let bookInfos = [];\r\n\r\n            let starMap: Map<number, number> = new Map();\r\n            for (let key in stab.BookId) {\r\n                let info = RareBookData.ins.getBookInfoByItemId(stab.BookId[key]);\r\n                bookInfos.push(info);\r\n                let item = instantiate(this.rareBookItemPrefab);\r\n                item.parent = this.rarebookLayout;\r\n                let com = item.getComponent(RareBookItem);\r\n                com.initData(info, false);\r\n                if (info.isLock) {\r\n                    for (let k2 in newgroupTabs) {\r\n                        let starlevel = newgroupTabs[k2].Level;\r\n                        if (info.level >= starlevel) {\r\n                            if (starMap.has(starlevel)) {\r\n                                starMap.set(starlevel, starMap.get(starlevel) + 1)\r\n                            } else {\r\n                                starMap.set(starlevel, 1)\r\n                            }\r\n                        }\r\n                        // if(starMap.has(gr))\r\n                    }\r\n                }\r\n\r\n            }\r\n      \r\n            // this. groupTabs: tab.BookGroupTable[]\r\n            let total = bookInfos.length;\r\n\r\n            for (let key in newgroupTabs) {\r\n                let level = groupTabs[key].Level;\r\n                let num = starMap.has(level) ? starMap.get(level) : 0;\r\n                let item = instantiate(this.titleItemPrefab);\r\n                item.parent = this.attrNode;\r\n                let com = item.getComponent(RareBookGroupAttributeITitleItem);\r\n                com.initData(newgroupTabs[key], num, total);\r\n            }\r\n        }\r\n    }\r\n}"]}