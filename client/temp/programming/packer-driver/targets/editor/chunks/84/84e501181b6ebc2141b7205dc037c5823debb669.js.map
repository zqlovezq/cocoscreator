{"version":3,"sources":["file:///C:/chickenStarClient/client/assets/scripts/logic/model/activity/vip/VipPrivilegeView.ts"],"names":["_decorator","instantiate","Label","Node","Prefab","ProgressBar","ScrollView","Sprite","UITransform","Vec2","ComponentBase","tab","VipLvBtnItem","LangMgr","ItemInfo","ItemPoolMgr","VipPrivilegeItem","ItemData","ActivityControl","ActivityData","ShowTips","UIMgr","EventMgr","proto","ViewName","OpenFunctionMgr","LocalEvent","ccclass","property","VipPrivilegeView","vipLevel","currBtnItem","currVipLevel","privilegeItems","vipBonusTabMap","maxVipLevel","isCanBuy","onClickItem","item","setSelectState","initCurrVipView","register","onMsg","Ptl","VipLevelUpPush","on_s2c_VipLevelUpPush","ReceiveVipDailyGiftRsp","on_s2c_ReceiveVipDailyGiftRsp","BuyVipGiftRsp","on_s2c_BuyVipGiftRsp","onLocal","Item_Update","updateResourceNum","initView","ins","vipMsg","Map","vipBonus","getData","VipBonusTable","key","list","get","VipLv","set","push","initVipBtn","initGiftView","initProgress","vipBtnScrollview","content","removeAllChildren","vipTable","VipTableByVipLv","getValue","showLevel","ShowVipLv","tables","VipTable","len","length","i","node","vipBtnPrefab","parent","getComponent","scheduleOnce","setScrollPos","pos","getPosition","w","contentSize","width","scrollToOffset","x","currTable","privilegetitleLab1","string","getCombineString","privilegetitleLab2","rewardNode","VipRewardIds","itemInfo","initItemData","VipRewardNum","createRewadItem","ItemTableById","VipCostItemIds","priceIcon1","setTexture","Icon","priceIcon2","priceLab1","VipCostItemNum","priceLab2","ShowCost","active","lastBonus","currBonus","creatorPrivilegeItem","Number","bouns","tips","VipBonus","VipBonus_OpenFunction","getLab","AddValue","VipBonus_PatrolIdleTime","value","Math","floor","VipBonus_PatrolMoneyRatio","VipBonus_PatrolFoodRatio","richtex","upNode","newNode","findTab","find","a","deleteLine","privilegeScrollView","scrollToTop","updateBuyState","buyBtnNode","grayscale","purchasedBtnNode","getChildByName","isBuy","boughtVipGifts","indexOf","giftLab","giftSpr","isDailyGiftReceived","lightNode","arrowNode","lastVipTable","lastVipExp","VipExp","tipsLab","progressLabel","vipProgress","progress","currScore","getCount","CurrencyType","CurrencyType_VipExp","score","score2","index","privilegePrefab","com","updateView","onClickBuyBtn","id","isItemsEnoughByList","requesBuyVipGift","itemtab","Name","onClickReceiveGift","requesReceiveVipDailyGift","onClickGetVipExp","checkFunctionIsOpen","OpenFunctionName","OpenFunctionName_DailyShop","hideView","jumpLayer","Module","Module_ActivityMainView","show","viewName","DiamondBuyPop","msg","error","code","CommonErrorCode","Succeed","CongratulationPop","data","rewards","itemIds"],"mappings":"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","sourcesContent":["import { _decorator, Component, EventTouch, ForwardFlow, instantiate, Label, labelAssembler, log, Node, Prefab, ProgressBar, ScrollView, Sprite, UITransform, v2, Vec2 } from 'cc';\r\nimport { ComponentBase } from '../../../../framework/base/ComponentBase';\r\nimport { tab } from '../../../../Table/table_gen';\r\nimport { VipLvBtnItem } from './VipLvBtnItem';\r\nimport { LangMgr } from '../../../mgr/LangMgr';\r\nimport { ItemInfo } from '../../item/ItemInfo';\r\nimport { ItemPoolMgr } from '../../item/ItemPoolMgr';\r\nimport { VipPrivilegeItem } from './VipPrivilegeItem';\r\nimport { ItemData } from '../../item/ItemData';\r\nimport { ActivityControl } from '../ActivityControl';\r\nimport { ActivityData } from '../ActivityData';\r\nimport { ShowTips, UIMgr } from '../../../mgr/UIMgr';\r\nimport { EventMgr } from '../../../mgr/EventMgr';\r\nimport { proto } from 'client_protocol';\r\nimport { ViewName } from '../../../define/ViewDefine';\r\nimport { OpenFunctionMgr } from '../../../../Common/component/OpenFunctionMgr';\r\nimport { LocalEvent } from '../../../define/LocalEvent';\r\nimport { RedMgr } from '../../../mgr/RedMgr';\r\nimport { RedDotType } from '../../../red/RedDotType';\r\nconst { ccclass, property } = _decorator;\r\n\r\n/**\r\n * \r\n * VipPrivilegeView\r\n * zhudingchao\r\n * Mon Jul 01 2024 15:20:18 GMT+0800 (中国标准时间)\r\n * db://assets/scripts/logic/model/activity/vip/VipPrivilegeView.ts\r\n *\r\n */\r\n\r\n@ccclass('VipPrivilegeView')\r\nexport class VipPrivilegeView extends ComponentBase {\r\n    @property(Sprite)\r\n    giftSpr: Sprite = null;\r\n    @property(Label)\r\n    giftLab: Label = null;\r\n    @property(Label)\r\n    tipsLab: Label = null;\r\n    @property(Label)\r\n    privilegetitleLab1: Label = null;\r\n    @property(ScrollView)\r\n    privilegeScrollView: ScrollView = null;\r\n    @property(Label)\r\n    privilegetitleLab2: Label = null;\r\n    @property(Node)\r\n    rewardNode: Node = null;\r\n    @property(Sprite)\r\n    priceIcon1: Sprite = null;\r\n    @property(Sprite)\r\n    priceIcon2: Sprite = null;\r\n    @property(Label)\r\n    priceLab1: Label = null;\r\n    @property(Label)\r\n    priceLab2: Label = null;\r\n    @property(Node)\r\n    buyBtnNode: Node = null;\r\n    @property(Node)\r\n    purchasedBtnNode: Node = null;\r\n    @property(ScrollView)\r\n    vipBtnScrollview: ScrollView = null;\r\n    @property(ProgressBar)\r\n    vipProgress: ProgressBar = null;\r\n    @property(Label)\r\n    progressLabel: Label = null;\r\n    @property(UITransform)\r\n    deleteLine:UITransform=null;\r\n    @property(Prefab)\r\n    vipBtnPrefab: Prefab = null;\r\n    @property(Prefab)\r\n    privilegePrefab: Prefab = null;\r\n\r\n    @property(Node)\r\n    lightNode:Node=null;\r\n    @property(Node)\r\n    arrowNode:Node=null;\r\n\r\n    private vipLevel: number;\r\n    private currBtnItem: VipLvBtnItem;\r\n    private currVipLevel: number;\r\n    private privilegeItems: Array<VipPrivilegeItem>;\r\n    private vipBonusTabMap: Map<number, Array<tab.VipBonusTable>>;\r\n    private maxVipLevel: number = 0;\r\n    private isCanBuy: boolean = false;\r\n    register(): void {\r\n        EventMgr.onMsg(proto.Ptl.VipLevelUpPush, this.on_s2c_VipLevelUpPush, this)\r\n        EventMgr.onMsg(proto.Ptl.ReceiveVipDailyGiftRsp, this.on_s2c_ReceiveVipDailyGiftRsp, this)\r\n        EventMgr.onMsg(proto.Ptl.BuyVipGiftRsp, this.on_s2c_BuyVipGiftRsp, this)\r\n        EventMgr.onLocal(LocalEvent.Item_Update, this.updateResourceNum, this);\r\n    }\r\n    initView() {\r\n        this.vipLevel =ActivityData.ins.vipMsg.vipLevel;\r\n        this.currVipLevel =  this.vipLevel;\r\n        this.privilegeItems = [];\r\n        this.vipBonusTabMap = new Map();\r\n        let vipBonus = tab.getData().VipBonusTable;\r\n        for (let key in vipBonus) {\r\n            let list = this.vipBonusTabMap.get(vipBonus[key].VipLv);\r\n            if (!list) {\r\n                list = [];\r\n                this.vipBonusTabMap.set(vipBonus[key].VipLv, list);\r\n            }\r\n            list.push(vipBonus[key]);\r\n            if (vipBonus[key].VipLv > this.maxVipLevel) {\r\n                this.maxVipLevel = vipBonus[key].VipLv;\r\n            }\r\n        }\r\n\r\n        this.initVipBtn();\r\n        this.initCurrVipView();\r\n        this.initGiftView();\r\n        this.initProgress();\r\n    }\r\n    initVipBtn() {\r\n        this.currBtnItem = null;\r\n        this.vipBtnScrollview.content.removeAllChildren();\r\n        let vipTable = tab.getData().VipTableByVipLv.getValue(this.vipLevel);\r\n        let showLevel = vipTable.ShowVipLv;\r\n        let tables = tab.getData().VipTable;\r\n        let len = tables.length - 1;\r\n        for (let i = len; i >= 0; i--) {\r\n            if (tables[i].VipLv <= showLevel) {\r\n                let node = instantiate(this.vipBtnPrefab);\r\n                node.parent = this.vipBtnScrollview.content;\r\n                node.getComponent(VipLvBtnItem).initView(tables[i], this.onClickItem);\r\n                if (tables[i].VipLv == this.currVipLevel) {\r\n                    this.currBtnItem = node.getComponent(VipLvBtnItem);\r\n                }\r\n            }\r\n        }\r\n      \r\n        if (this.currBtnItem) {\r\n            this.currBtnItem.setSelectState(true);\r\n        }\r\n    \r\n        this.scheduleOnce(()=>{\r\n            this.setScrollPos();\r\n        })\r\n       \r\n\r\n\r\n    }\r\n    setScrollPos() {\r\n        let pos = this.currBtnItem.node.getPosition();\r\n        let w=this.vipBtnScrollview.getComponent(UITransform).contentSize.width;\r\n         this.vipBtnScrollview.scrollToOffset(new Vec2(pos.x-w+220 , 0), 0.1);\r\n        //  this.vipBtnScrollview.scrollTo(v2(pos.x-w-110,pos.y))\r\n    }\r\n    initCurrVipView() {\r\n        let currTable = this.currBtnItem.vipTable;\r\n        this.privilegetitleLab1.string = LangMgr.getCombineString(\"ui_vip_2\", [currTable.VipLv]);\r\n        this.privilegetitleLab2.string = LangMgr.getCombineString(\"ui_vip_3\", [currTable.VipLv]);\r\n        this.rewardNode.removeAllChildren();\r\n        for (let key in currTable.VipRewardIds) {\r\n            let itemInfo = new ItemInfo();\r\n            itemInfo.initItemData(currTable.VipRewardIds[key], currTable.VipRewardNum[key]);\r\n            ItemPoolMgr.ins.createRewadItem(itemInfo, this.rewardNode);\r\n        }\r\n        let item = tab.getData().ItemTableById.getValue(currTable.VipCostItemIds);\r\n        this.priceIcon1.setTexture(item.Icon);\r\n        this.priceIcon2.setTexture(item.Icon);\r\n        this.priceLab1.string = currTable.VipCostItemNum + \"\"\r\n        this.priceLab2.string = currTable.ShowCost + \"\"\r\n        // this.scheduleOnce(()=>{\r\n           \r\n        // })\r\n       \r\n        // this.priceLab2.isUnderline = true;\r\n        // this.priceLab2.underlineHeight = 0;\r\n        for (let key in this.privilegeItems) {\r\n            this.privilegeItems[key].node.active = false;\r\n        }\r\n\r\n        let lastBonus: Array<tab.VipBonusTable> = [];\r\n        if (currTable.VipLv > 0) {\r\n            lastBonus = this.vipBonusTabMap.get(currTable.VipLv - 1);\r\n        }\r\n        let currBonus = this.vipBonusTabMap.get(currTable.VipLv);\r\n\r\n        for (let key in currBonus) {\r\n            let item = this.creatorPrivilegeItem(Number(key));\r\n            item.node.active = true;\r\n            let bouns = currBonus[key];\r\n            let tips = \"\"\r\n            if (bouns.VipBonus == tab.VipBonus.VipBonus_OpenFunction) {\r\n                tips = LangMgr.getLab(tab.VipBonus[bouns.VipBonus] + \"_\" + bouns.AddValue);\r\n            } else if(bouns.VipBonus == tab.VipBonus.VipBonus_PatrolIdleTime){\r\n                let value = Math.floor(bouns.AddValue / 360)/10;\r\n                tips = LangMgr.getCombineString(tab.VipBonus[bouns.VipBonus], [value]);\r\n            }else if (bouns.VipBonus == tab.VipBonus.VipBonus_PatrolMoneyRatio || bouns.VipBonus == tab.VipBonus.VipBonus_PatrolFoodRatio) {\r\n                let value = Math.floor(bouns.AddValue / 100);\r\n                tips = LangMgr.getCombineString(tab.VipBonus[bouns.VipBonus], [value]);\r\n            } else {\r\n                tips = LangMgr.getCombineString(tab.VipBonus[bouns.VipBonus], [bouns.AddValue]);\r\n            }\r\n            item.richtex.string = tips;\r\n            if (currTable.VipLv == 0) {\r\n                item.upNode.active = false;\r\n                item.newNode.active = false;\r\n            } else {\r\n\r\n                let findTab = lastBonus.find(a => a.VipBonus == bouns.VipBonus);\r\n                if (findTab) {\r\n                    if (bouns.VipBonus == tab.VipBonus.VipBonus_OpenFunction) {\r\n                        if (findTab.AddValue != bouns.AddValue) {\r\n                            item.upNode.active = false;\r\n                            item.newNode.active = true;\r\n                        } else {\r\n                            item.upNode.active = false;\r\n                            item.newNode.active = false;\r\n                        }\r\n                    } else {\r\n                        if (findTab.AddValue < bouns.AddValue) {\r\n                            item.upNode.active = true;\r\n                            item.newNode.active = false;\r\n                        } else {\r\n                            item.upNode.active = false;\r\n                            item.newNode.active = false;\r\n                        }\r\n                    }\r\n\r\n                } else {\r\n                    item.upNode.active = false;\r\n                    item.newNode.active = true;\r\n                }\r\n\r\n\r\n            }\r\n        }\r\n        this.scheduleOnce(()=>{\r\n            this.deleteLine.width=this.priceLab2.getComponent(UITransform).width+5;\r\n            this.privilegeScrollView.scrollToTop();\r\n         \r\n        })\r\n        this.updateBuyState();\r\n\r\n\r\n    }\r\n    updateBuyState() {\r\n        let currTable = this.currBtnItem.vipTable;\r\n        this.isCanBuy = false;\r\n        if (currTable.VipLv > this.vipLevel) {\r\n            this.buyBtnNode.active = true;\r\n            this.buyBtnNode.getComponent(Sprite).grayscale = true;\r\n            this.purchasedBtnNode.active = false;\r\n            this.buyBtnNode.getChildByName(\"reddot\").active=false;\r\n        } else {\r\n            let isBuy = ActivityData.ins.vipMsg.boughtVipGifts.indexOf(currTable.VipLv) >= 0;\r\n            if (isBuy) {\r\n                this.purchasedBtnNode.active = true;\r\n                this.buyBtnNode.active = false;\r\n            } else {\r\n                this.isCanBuy = true;\r\n                this.buyBtnNode.active = true;\r\n                this.buyBtnNode.getComponent(Sprite).grayscale = false;\r\n                this.buyBtnNode.getChildByName(\"reddot\").active=true;\r\n                this.purchasedBtnNode.active = false;\r\n            }\r\n        }\r\n    }\r\n    initGiftView() {\r\n        this.giftLab.string = LangMgr.getCombineString(\"ui_vip_4\", [this.vipLevel])\r\n        this.giftSpr.grayscale=ActivityData.ins.vipMsg.isDailyGiftReceived;\r\n        this.lightNode.active=!ActivityData.ins.vipMsg.isDailyGiftReceived;\r\n        this.arrowNode.active=!ActivityData.ins.vipMsg.isDailyGiftReceived;\r\n    }\r\n    initProgress() {\r\n        let vipTable = tab.getData().VipTableByVipLv.getValue(this.vipLevel);\r\n        let lastVipTable=tab.getData().VipTableByVipLv.getValue(this.vipLevel-1);\r\n        let lastVipExp=lastVipTable?lastVipTable.VipExp:0;\r\n        let VipExp=vipTable.VipExp-lastVipExp;\r\n        if (this.vipLevel >= this.maxVipLevel) {\r\n            //this.tipsLab.string = \"已达到最大等级\";\r\n            this.tipsLab.string = LangMgr.getLab(\"ui_vip_7\");\r\n            \r\n            this.progressLabel.string =VipExp + \"/\" + VipExp;\r\n            this.progressLabel.node.active = false;\r\n            this.vipProgress.progress = 1;\r\n\r\n        } else {\r\n            this.progressLabel.node.active = true;\r\n            let currScore = ItemData.ins.getCount(tab.CurrencyType.CurrencyType_VipExp);\r\n            let score = vipTable.VipExp - currScore;\r\n            let score2 =  currScore-lastVipExp;\r\n            this.tipsLab.string = LangMgr.getCombineString(\"ui_vip_5\", [score, this.vipLevel + 1]);\r\n            this.progressLabel.string = score2 + \"/\" +VipExp;\r\n            this.vipProgress.progress = score2 / VipExp;\r\n        }\r\n\r\n    }\r\n\r\n    creatorPrivilegeItem(index: number) {\r\n        if (!this.privilegeItems) {\r\n            this.privilegeItems = [];\r\n        }\r\n        if (!this.privilegeItems[index]) {\r\n            let item = instantiate(this.privilegePrefab);\r\n            item.parent = this.privilegeScrollView.content;\r\n            let com = item.getComponent(VipPrivilegeItem);\r\n            this.privilegeItems.push(com);\r\n        }\r\n        return this.privilegeItems[index];\r\n    }\r\n\r\n    updateView() {\r\n        if (ActivityData.ins.vipMsg.vipLevel != this.vipLevel) {\r\n            this.initView();\r\n        } else {\r\n            this.initProgress();\r\n        }\r\n    }\r\n    // onClickHelpBtn(event:EventTouch) {\r\n    //     // log(\"---------------------\");\r\n    //     UIMgr.ins.show({ viewName: ViewName.CommonBlackTipsPop,data:{\"worldPos\":event.target.worldPosition,\"WordTableKey\":\"策划配置\" }});\r\n    // }\r\n    onClickItem = (item: VipLvBtnItem) => {\r\n        if (item != this.currBtnItem) {\r\n            this.currBtnItem.setSelectState(false);\r\n            item.setSelectState(true);\r\n            this.currBtnItem = item;\r\n            this.initCurrVipView();\r\n        }\r\n    }\r\n    onClickBuyBtn() {\r\n        if (this.isCanBuy) {\r\n            let currTable = this.currBtnItem.vipTable;\r\n            if (currTable) {\r\n                let id = ItemData.ins.isItemsEnoughByList([currTable.VipCostItemIds], [currTable.VipCostItemNum])\r\n                if (id <= 0) {\r\n                    ActivityControl.ins.requesBuyVipGift(currTable.VipLv);\r\n                } else {\r\n                    let itemtab = tab.getData().ItemTableById.getValue(id);\r\n                    //ShowTips(LangMgr.getLab(itemtab.Name) + \"不足\");\r\n                    ShowTips(LangMgr.getCombineString(\"Tips_itemshortage\", [LangMgr.getLab(itemtab.Name)]));\r\n                }\r\n            }\r\n\r\n        } else {\r\n            //ShowTips(\"未达到vip等级\");\r\n            ShowTips(LangMgr.getLab(\"Tips_vip_1\"));\r\n        }\r\n    }\r\n    onClickReceiveGift(){\r\n        if(!ActivityData.ins.vipMsg.isDailyGiftReceived){\r\n            ActivityControl.ins.requesReceiveVipDailyGift();\r\n        }\r\n    }\r\n    onClickGetVipExp(){\r\n        if(OpenFunctionMgr.ins.checkFunctionIsOpen(tab.OpenFunctionName.OpenFunctionName_DailyShop)){\r\n            // UIMgr.ins.show({viewName:ViewName.MallMainView,data:tab.MallTab.MallTab_Tab5});\r\n            UIMgr.ins.hideView(\"WelfareActivityMainView\");\r\n            UIMgr.ins.jumpLayer(tab.Module.Module_ActivityMainView);\r\n        }else{\r\n            // OpenFunctionMgr.ins.showFunctionTips(tab.OpenFunctionName.OpenFunctionName_DailyShop);\r\n            UIMgr.ins.show({ viewName: ViewName.DiamondBuyPop})\r\n        }\r\n       \r\n        // ShowTips(\"前往获取vip积分\")\r\n    }\r\n    // vip等级提升\r\n    on_s2c_VipLevelUpPush(msg: proto.Msg_VipLevelUpPush) {\r\n        this.initView();\r\n\r\n    }\r\n\r\n    // vip每日礼包领取返回\r\n    on_s2c_ReceiveVipDailyGiftRsp(msg: proto.Msg_ReceiveVipDailyGiftRsp) {\r\n        if (!msg.error || msg.error.code == proto.CommonErrorCode.Succeed) {\r\n            this.initGiftView();\r\n            UIMgr.ins.show({viewName: ViewName.CongratulationPop, data: msg.rewards })\r\n        }\r\n    }\r\n    // vip专属礼包购买返回\r\n    on_s2c_BuyVipGiftRsp(msg: proto.Msg_BuyVipGiftRsp) {\r\n        if (!msg.error || msg.error.code == proto.CommonErrorCode.Succeed) {\r\n            this.updateBuyState();\r\n            UIMgr.ins.show({viewName: ViewName.CongratulationPop, data: msg.rewards })\r\n        }\r\n    }\r\n     /**\r\n     * 刷新资源显示数量\r\n     */\r\n     updateResourceNum(itemIds: Array<number>) {\r\n\r\n        if (itemIds.indexOf(tab.CurrencyType.CurrencyType_VipExp) > -1) {\r\n            this.initProgress();\r\n            \r\n            // this.numLab.string = ItemData.ins.getCount(this.itemId) + \"\"\r\n            // let item = ItemData.ins.getByItemId(this.itemId);\r\n            // if (item) {\r\n            //     let num = item.num;\r\n            //     this.numLab.string = num + \"\";\r\n            // } else {\r\n            //     this.numLab.string = \"0\";\r\n            // }\r\n\r\n        }\r\n\r\n    }\r\n}"]}