{"version":3,"sources":["file:///C:/chickenStarClient/client/assets/scripts/logic/utils/MainSceneQueueUI.ts"],"names":["_decorator","EventMgr","LocalEvent","tab","Func","SignInGiftData","UIMgr","PatrolDataMgr","RoleData","ActivityData","OpenFunctionMgr","checkSameDay","RecruitType","ccclass","property","PopUI_id","MainSceneQueueUI","init","onLocal","LocalMsg_QueueUI_check","checkOpenAll","LocalMsg_QueueUI_deleteUI","deleteUI","queueUIs","length","splice","showUI","openView","key","value","openObj","id","isOpen","push","index","v","conf","getData","PopWindowMechanismByID","getValue","j","MutexID","dd","forBy","sort","a","b","aconf","bconf","PopPriority","console","warn","JSON","stringify","data","Sign100","isGiftOpen","ins","checkFunctionIsOpen","OpenFunctionName","OpenFunctionName_SignInGift","checkActivityEnd","jumpLayer","Module","Module_SignInGiftPop","SignNew","Module_NewPlayerSignInPop","SignDay","upBanner","GaChaUp","Module_BannerPop","Patrol","patrolOpen","OpenFunctionName_Patrol","Module_PatrolPop","checkItem10001","canReceive","checkItem10004","startPatrolData","InitialPatrolMaxTime","GetKeyValue_ConfigTable","getPrivilegeValue","VipBonus","VipBonus_PatrolIdleTime","curTime","getServerUtcTime","timeCount","Number","startPatrolTime","maxTime","checkItem10002","canGet","getNewPlayerSignAwards","isOpenDailyAcivity","DailyRewardType","DailyRewardType_NewServer","checkItem10003","checkItem10005","actInfos","getAllUpData"],"mappings":"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","sourcesContent":["/*\r\n * @Date: 2024-10-15 16:32:56\r\n * @LastEditors: wzq\r\n * @LastEditTime: 2024-11-06 09:57:55\r\n * @param:进入主场景弹出队列UI\r\n */\r\nimport { _decorator, Component, Node } from 'cc';\r\nimport { EventMgr } from '../mgr/EventMgr';\r\nimport { LocalEvent } from '../define/LocalEvent';\r\nimport { tab } from '../../Table/table_gen';\r\nimport { Func } from './Func';\r\nimport { SignInGiftData } from '../model/activity/signGift/SignInGiftData';\r\nimport { UIMgr } from '../mgr/UIMgr';\r\nimport { PatrolDataMgr } from '../model/home/Patrol/PatrolDataMgr';\r\nimport { RoleData } from '../model/role/RoleData';\r\nimport { ActivityData } from '../model/activity/ActivityData';\r\nimport { ViewName } from '../define/ViewDefine';\r\nimport { OpenFunctionMgr } from '../../Common/component/OpenFunctionMgr';\r\nimport { checkSameDay } from './GameUtil';\r\nimport { RecruitType } from '../../Common/script/EnumTypeMgr';\r\nconst { ccclass, property } = _decorator;\r\ninterface openData {\r\n    id: number,\r\n    isOpen: boolean,\r\n}\r\nenum PopUI_id {\r\n    Sign100 = 10001,\r\n    SignNew = 10002,\r\n    SignDay = 10003,\r\n    Patrol = 10004,\r\n    upBanner = 10005,\r\n}\r\n@ccclass('MainSceneQueueUI')\r\nexport default class MainSceneQueueUI {\r\n    static queueUIs: { id: number, isOpen: boolean }[] = []\r\n\r\n    static init() {\r\n        EventMgr.onLocal(LocalEvent.LocalMsg_QueueUI_check, this.checkOpenAll, this)\r\n        EventMgr.onLocal(LocalEvent.LocalMsg_QueueUI_deleteUI, this.deleteUI, this)\r\n    }\r\n    static deleteUI() {\r\n        if (this.queueUIs && this.queueUIs.length > 0) {\r\n            this.queueUIs.splice(0, 1)\r\n            this.showUI()\r\n        }\r\n    }\r\n    static checkOpenAll() {\r\n        let openView: openData[] = []\r\n        //检测打开条件\r\n        for (const key in PopUI_id) {\r\n            const value = PopUI_id[key]\r\n            if (typeof (value) == 'number') {\r\n                const openObj: openData = {\r\n                    id: value,\r\n                    isOpen: this[\"checkItem\" + value]()\r\n                }\r\n                openView.push(openObj)\r\n            }\r\n        }\r\n        //处理互斥\r\n        for (let index = 0; index < openView.length; index++) {\r\n            const v = openView[index];\r\n            if (v.isOpen) {\r\n                let conf = tab.getData().PopWindowMechanismByID.getValue(v.id)\r\n                for (let j = 0; j < conf.MutexID.length; j++) {\r\n                    let dd: openData = Func.forBy(openView, \"id\", conf.MutexID[j])\r\n                    if (dd) {\r\n                        dd.isOpen = false\r\n                    }\r\n                }\r\n            }\r\n        }\r\n        //删除因为互斥不显示的模块\r\n        for (let index = openView.length - 1; index >= 0; index--) {\r\n            let v = openView[index];\r\n            if (!v.isOpen) {\r\n                openView.splice(index, 1)\r\n            }\r\n        }\r\n\r\n        openView.sort((a, b) => {\r\n            let aconf = tab.getData().PopWindowMechanismByID.getValue(a.id)\r\n            let bconf = tab.getData().PopWindowMechanismByID.getValue(b.id)\r\n            return aconf.PopPriority - bconf.PopPriority\r\n        })\r\n        this.queueUIs = openView\r\n\r\n        console.warn(\"主场景打开队列\", JSON.stringify(this.queueUIs))\r\n\r\n        this.showUI()\r\n    }\r\n    static showUI() {\r\n        let data = this.queueUIs[0]\r\n        if (data) {\r\n            switch (data.id) {\r\n                case PopUI_id.Sign100:\r\n                    const isGiftOpen = OpenFunctionMgr.ins.checkFunctionIsOpen(tab.OpenFunctionName.OpenFunctionName_SignInGift);\r\n                    if (isGiftOpen&&!SignInGiftData.ins.checkActivityEnd()) {\r\n                        UIMgr.ins.jumpLayer(tab.Module.Module_SignInGiftPop);\r\n                    }\r\n                    break\r\n                case PopUI_id.SignNew:\r\n                    UIMgr.ins.jumpLayer(tab.Module.Module_NewPlayerSignInPop);\r\n                    break\r\n                case PopUI_id.SignDay:\r\n                    // UIMgr.ins.jumpLayer(tab.Module.Module_NewPlayerSignInPop);\r\n                    break\r\n                case PopUI_id.upBanner:\r\n                    if(!checkSameDay(RecruitType.GaChaUp)){\r\n                        UIMgr.ins.jumpLayer(tab.Module.Module_BannerPop);\r\n                    }\r\n                    break\r\n                case PopUI_id.Patrol:\r\n                    const patrolOpen = OpenFunctionMgr.ins.checkFunctionIsOpen(tab.OpenFunctionName.OpenFunctionName_Patrol);\r\n                    if (patrolOpen) {\r\n                        UIMgr.ins.jumpLayer(tab.Module.Module_PatrolPop);\r\n                    }\r\n                    break\r\n                default:\r\n                    break;\r\n            }\r\n        }\r\n    }\r\n    /* 签到 */\r\n    static checkItem10001() {\r\n        return SignInGiftData.ins.canReceive()\r\n    }\r\n    /* 巡逻奖励满 */\r\n    static checkItem10004() {\r\n        const startPatrolData = PatrolDataMgr.ins.startPatrolData;\r\n        const InitialPatrolMaxTime = tab.getData().GetKeyValue_ConfigTable().InitialPatrolMaxTime + RoleData.ins.getPrivilegeValue(tab.VipBonus.VipBonus_PatrolIdleTime)\r\n        const curTime = RoleData.ins.getServerUtcTime();\r\n        let timeCount = curTime - (Number(startPatrolData.startPatrolTime))\r\n        const maxTime = InitialPatrolMaxTime;\r\n        return timeCount > maxTime;\r\n    }\r\n    /* 萌新签到 */\r\n    static checkItem10002() {\r\n        // 还有未签到的\r\n        const canGet = ActivityData.ins.getNewPlayerSignAwards();\r\n        const isOpen = ActivityData.ins.isOpenDailyAcivity(tab.DailyRewardType.DailyRewardType_NewServer)\r\n        return isOpen && canGet;\r\n    }\r\n    static checkItem10003() {\r\n        return false\r\n    }\r\n    static checkItem10005() {\r\n        const actInfos = ActivityData.ins.getAllUpData();\r\n        return actInfos.length > 0;\r\n    }\r\n}\r\n\r\n\r\n"]}