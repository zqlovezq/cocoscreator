{"version":3,"sources":["file:///C:/chickenStarClient/client/assets/scripts/logic/model/home/Patrol/PatrolPop.ts"],"names":["_decorator","Button","Label","Node","sp","Sprite","ViewPop","proto","Net","EventMgr","ShowTips","UIMgr","ViewName","AdMgr","tab","ItemData","createAnimation","GameUtil","setTextTime_2","BattleMainDataControl","ItemInfo","ItemPoolMgr","LangMgr","CommonItem","HeroTeamControl","HeroData","PatrolDataMgr","RoleData","LocalEvent","ccclass","property","PatrolPop","startPatrolData","canClickGetBtn","commonItems","timesBeginTimes","InitialPatrolMaxTime","QuickPatrolDailyCount","StageId","register","onMsg","Ptl","ReceivePatrolRewardRsp","on_s2c_ReceivePatrolRewardRsp","ReceiveQuickPatrolRewardRsp","on_s2c_ReceiveQuickPatrolRewardRsp","unRegister","onShow","ins","getData","GetKeyValue_ConfigTable","getPrivilegeValue","VipBonus","VipBonus_PatrolIdleTime","VipBonus_QuickPatrolDailyCount","stageClearIds","getStageClearIds","length","StaticView","AsyncView","onDestroy","onDisable","i","putCommonItem","msg","error","code","CommonErrorCode","Succeed","startPatrolTime","getServerUtcTime","lastReceiveBaseRewardsTimeMap","lastReceiveExtraRewardsTimeMap","show","viewName","CongratulationPop","data","rewards","scheduleOnce","refreshQuickData","quickItem","QuickPatrolUseItem","quickItemId","quickItemNum","itemTab","ItemTableById","getValue","sp_power_icon","setTexture","Icon","lbl_power_count","string","patrolTab","PatrolTableByPveStageId","itemIds","BaseItemIds","concat","ExtraItemIds","itemNums","BaseItemNum","ExtraItemNum","ItemTab","exp_node","node_revenue","children","exp_sp","getChildByName","getComponent","exp_lbl","num","CurrencyType","CurrencyType_Gold","Math","round","VipBonus_PatrolMoneyRatio","CurrencyType_Feed","VipBonus_PatrolFoodRatio","maxCount","getCombineString","convertNumber","node_no_revenue","active","lbl_max_revenue","heros","getTeam","node_spine","item","spine","Skeleton","heroInfo","getById","heroId","node","heroTable","Born","node_reward_layout","destroyAllChildren","curAdTimes","getAdCountByType","AdType","AdType_QuickPatrol","maxAdTimes","getAdCountMaxByType","lbl_ad_times","btn_ad_quick_patrol","interactable","sp_ad_quick_patrol","grayscale","curQuickTimes","getCount","havaItemCount","btn_quick_patrol","sp_quick_patrol","lbl_quick_time","String","lbl_quick_time_max","Object","keys","forEach","key","push","updatePatrolTimes","unschedule","schedule","curTime","timeCount","Number","maxTime","lbl_patrol_time","console","log","itemCounts","times","BaseTimes","ExtraTimes","showNothing","base_timeCount","base_time","base_itemId","base_itemCount","floor","itemTs","curItemCount","getItemCount","setShowNum","base_info","itemId","createItem","clickQuickPatrol","event","type","getLab","sendMsg","Msg_ReceiveQuickPatrolRewardReq","Send","ReceiveQuickPatrolRewardReq","playVideoAd","clickGetPatrolAward","Msg_ReceivePatrolRewardReq","ReceivePatrolRewardReq","onClose","emitLocal","LocalMsg_QueueUI_deleteUI"],"mappings":"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","sourcesContent":["/*\r\n * @Date: 2024-06-18 16:00:02\r\n * @LastEditors: wzq\r\n * @File:快速巡逻\r\n * @LastEditTime: 2024-11-22 15:53:18\r\n */\r\n\r\nimport { _decorator, Button, Component, EventTouch, Label, log, Node, sp, Sprite } from 'cc';\r\nimport { ViewPop } from '../../../../framework/base/ViewPop';\r\nimport { proto } from 'client_protocol';\r\nimport { Net } from '../../../net/Net';\r\nimport { EventMgr } from '../../../mgr/EventMgr';\r\nimport { ShowTips, UIMgr } from '../../../mgr/UIMgr';\r\nimport { ViewName } from '../../../define/ViewDefine';\r\nimport { AdMgr } from '../../AdMgr';\r\nimport { tab } from '../../../../Table/table_gen';\r\nimport { ItemData } from '../../item/ItemData';\r\nimport { createAnimation, GameUtil, setTextTime, setTextTime_2 } from '../../../utils/GameUtil';\r\nimport { BattleMainDataControl } from '../battle/BattleMainDataControl';\r\nimport { ItemInfo } from '../../item/ItemInfo';\r\nimport { ItemPoolMgr } from '../../item/ItemPoolMgr';\r\nimport { LangMgr } from '../../../mgr/LangMgr';\r\nimport { CommonItem } from '../../item/CommonItem';\r\nimport { HeroTeamControl } from '../../hero/HeroTeamControl';\r\nimport { HeroData } from '../../hero/HeroData';\r\nimport { PatrolDataMgr } from './PatrolDataMgr';\r\nimport { RoleData } from '../../role/RoleData';\r\nimport { LocalEvent } from '../../../define/LocalEvent';\r\nconst { ccclass, property } = _decorator;\r\n\r\n@ccclass('PatrolPop')\r\nexport class PatrolPop extends ViewPop {\r\n    @property(Label)\r\n    lbl_ad_times: Label = null;\r\n    @property(Button)\r\n    btn_ad_quick_patrol: Button = null;\r\n    @property(Sprite)\r\n    sp_ad_quick_patrol: Sprite = null;\r\n    @property(Button)\r\n    btn_quick_patrol: Button = null;\r\n    @property(Sprite)\r\n    sp_quick_patrol: Sprite = null;\r\n\r\n    @property(Sprite)\r\n    sp_power_icon: Sprite = null;\r\n    @property(Label)\r\n    lbl_power_count: Label = null;\r\n    @property(Label)\r\n    lbl_patrol_time: Label = null;\r\n    @property(Label)\r\n    lbl_quick_time: Label = null;\r\n    @property(Label)\r\n    lbl_quick_time_max: Label = null;\r\n    @property(Node)\r\n    node_reward_layout: Node = null;\r\n\r\n    @property(Node)\r\n    node_revenue: Node = null;\r\n    @property(Label)\r\n    lbl_max_revenue: Label = null;\r\n    @property(Node)\r\n    node_no_revenue: Node = null;\r\n    @property(Node)\r\n    node_spine: Node = null;\r\n\r\n    private startPatrolData: proto.Msg_GetPatrolInfoRsp = null;//巡逻时间\r\n    private canClickGetBtn: boolean = false;//是否可以点击领取按钮\r\n    private commonItems: Node[] = [];\r\n    private timesBeginTimes = [];\r\n    private InitialPatrolMaxTime: number = 0;\r\n    private QuickPatrolDailyCount: number = 0;\r\n    private StageId: number = 0;\r\n    register(): void {\r\n        EventMgr.onMsg(proto.Ptl.ReceivePatrolRewardRsp, this.on_s2c_ReceivePatrolRewardRsp, this);\r\n        EventMgr.onMsg(proto.Ptl.ReceiveQuickPatrolRewardRsp, this.on_s2c_ReceiveQuickPatrolRewardRsp, this)\r\n    }\r\n    unRegister(): void {\r\n        super.unRegister();\r\n    }\r\n    onShow(): void {\r\n        // 获取巡逻信息\r\n        this.startPatrolData = PatrolDataMgr.ins.startPatrolData;\r\n        this.InitialPatrolMaxTime = tab.getData().GetKeyValue_ConfigTable().InitialPatrolMaxTime + RoleData.ins.getPrivilegeValue(tab.VipBonus.VipBonus_PatrolIdleTime)\r\n        this.QuickPatrolDailyCount = tab.getData().GetKeyValue_ConfigTable().QuickPatrolDailyCount + RoleData.ins.getPrivilegeValue(tab.VipBonus.VipBonus_QuickPatrolDailyCount);\r\n        const stageClearIds = BattleMainDataControl.ins.getStageClearIds();\r\n        if (stageClearIds.length > 0) {\r\n            this.StageId = stageClearIds[stageClearIds.length - 1];\r\n        }\r\n        this.StaticView();\r\n        this.AsyncView();\r\n    }\r\n    protected onDestroy(): void {\r\n        super.onDestroy();\r\n    }\r\n    protected onDisable(): void {\r\n        if (this.commonItems && this.commonItems.length > 0) {\r\n            for (let i = 0; i < this.commonItems.length; i++) {\r\n                ItemPoolMgr.ins.putCommonItem(this.commonItems[i]);\r\n            }\r\n        }\r\n    }\r\n    on_s2c_ReceivePatrolRewardRsp(msg: proto.Msg_ReceivePatrolRewardRsp) {\r\n        if (msg.error && msg.error.code != proto.CommonErrorCode.Succeed) return;\r\n        // 领取巡逻奖励\r\n        this.startPatrolData.startPatrolTime = RoleData.ins.getServerUtcTime();\r\n        this.startPatrolData.lastReceiveBaseRewardsTimeMap = msg.lastReceiveBaseRewardsTimeMap;\r\n        this.startPatrolData.lastReceiveExtraRewardsTimeMap = msg.lastReceiveExtraRewardsTimeMap;\r\n\r\n        UIMgr.ins.show({ viewName: ViewName.CongratulationPop, data: msg.rewards })\r\n        this.AsyncView();\r\n        this.canClickGetBtn = false;\r\n        this.scheduleOnce(() => {\r\n            this.canClickGetBtn = true;\r\n        }, 60)\r\n    }\r\n    on_s2c_ReceiveQuickPatrolRewardRsp(msg: proto.Msg_ReceiveQuickPatrolRewardRsp) {\r\n        if (msg.error && msg.error.code != proto.CommonErrorCode.Succeed) return;\r\n        // 显示快速巡逻奖励\r\n        UIMgr.ins.show({ viewName: ViewName.CongratulationPop, data: msg.rewards })\r\n        this.refreshQuickData();\r\n    }\r\n    StaticView() {\r\n        // 快速巡逻消耗道具\r\n        const quickItem = tab.getData().GetKeyValue_ConfigTable().QuickPatrolUseItem;\r\n        const quickItemId = quickItem[0];\r\n        const quickItemNum = quickItem[1];\r\n        const itemTab = tab.getData().ItemTableById.getValue(quickItemId);\r\n        this.sp_power_icon.setTexture(itemTab.Icon);\r\n        this.lbl_power_count.string = \"x\" + quickItemNum;\r\n        this.canClickGetBtn = true;\r\n        if (this.StageId) {\r\n            const patrolTab = tab.getData().PatrolTableByPveStageId.getValue(this.StageId);\r\n            const itemIds = patrolTab.BaseItemIds.concat(patrolTab.ExtraItemIds[0]);\r\n            const itemNums =patrolTab.BaseItemNum.concat(patrolTab.ExtraItemNum[0]);\r\n            for (let i = 0; i < itemIds.length; i++) {\r\n                const ItemTab = tab.getData().ItemTableById.getValue(itemIds[i])\r\n                const exp_node = this.node_revenue.children[i];\r\n                const exp_sp = exp_node.getChildByName(\"icon\").getComponent(Sprite);\r\n                exp_sp.setTexture(ItemTab.Icon);\r\n                const exp_lbl = exp_node.getChildByName(\"label\").getComponent(Label);\r\n                let num = 0;\r\n                if (itemIds[i] === tab.CurrencyType.CurrencyType_Gold) {\r\n                    num =  Math.round(itemNums[i] * (1 + RoleData.ins.getPrivilegeValue(tab.VipBonus.VipBonus_PatrolMoneyRatio) / 10000));\r\n                } else if (itemIds[i] === tab.CurrencyType.CurrencyType_Feed) {\r\n                    num = Math.round(itemNums[i] * (1 + RoleData.ins.getPrivilegeValue(tab.VipBonus.VipBonus_PatrolFoodRatio) / 10000));\r\n                }else{\r\n                    num = itemNums[i]\r\n                }\r\n                const maxCount = i===3?num:num * 6;\r\n                exp_lbl.string = LangMgr.getCombineString(\"ui_patrol_2\", [GameUtil.convertNumber(maxCount)]);\r\n            }\r\n        } else {\r\n            this.node_no_revenue.active = true;\r\n        }\r\n        this.lbl_max_revenue.string = LangMgr.getCombineString(\"ui_patrol_1\", [this.InitialPatrolMaxTime / 3600]);\r\n\r\n        // 生成几只小鸡move的动画\r\n        const heros = HeroTeamControl.ins.getTeam();\r\n        for (let i = 0; i < this.node_spine.children.length; i++) {\r\n            const item = this.node_spine.children[i];\r\n            const spine = item.getComponent(sp.Skeleton);\r\n            const heroInfo = HeroData.ins.getById(heros[i].heroId)\r\n            if (heroInfo) {\r\n                createAnimation(spine.node, heroInfo.heroTable.Born + 2);\r\n            }\r\n        }\r\n\r\n        if (this.commonItems && this.commonItems.length > 0) {\r\n            for (let i = 0; i < this.commonItems.length; i++) {\r\n                ItemPoolMgr.ins.putCommonItem(this.commonItems[i]);\r\n            }\r\n        }\r\n        this.node_reward_layout.destroyAllChildren();\r\n    }\r\n    // 刷新广告次数+巡逻次数\r\n    refreshQuickData() {\r\n        // 广告次数\r\n        const curAdTimes = AdMgr.ins.getAdCountByType(tab.AdType.AdType_QuickPatrol);\r\n        const maxAdTimes = AdMgr.ins.getAdCountMaxByType(tab.AdType.AdType_QuickPatrol)\r\n        this.lbl_ad_times.string = (maxAdTimes - curAdTimes) + \"/\" + maxAdTimes;\r\n        this.btn_ad_quick_patrol.interactable = maxAdTimes - curAdTimes > 0\r\n        this.sp_ad_quick_patrol.grayscale = maxAdTimes - curAdTimes <= 0;\r\n        // 快速巡逻剩余次数\r\n        // const curQuickMaxTimes = tab.getData().GetKeyValue_ConfigTable().QuickPatrolDailyCount;\r\n        const curQuickTimes = ItemData.ins.getCount(10);\r\n        const quickItem = tab.getData().GetKeyValue_ConfigTable().QuickPatrolUseItem;\r\n        const quickItemId = quickItem[0];\r\n        const quickItemNum = quickItem[1];\r\n        const havaItemCount = ItemData.ins.getCount(quickItemId);\r\n        this.btn_quick_patrol.interactable = havaItemCount >= quickItemNum && curQuickTimes > 0;\r\n        this.sp_quick_patrol.grayscale = havaItemCount < quickItemNum || curQuickTimes === 0;\r\n        // 算道具\r\n        //this.lbl_quick_time.string = String(curQuickMaxTimes - curQuickTimes);\r\n        this.lbl_quick_time.string = String(curQuickTimes);\r\n        this.lbl_quick_time_max.string = String(this.QuickPatrolDailyCount);\r\n    }\r\n    AsyncView() {\r\n        this.refreshQuickData();\r\n        this.timesBeginTimes = [];\r\n        Object.keys(this.startPatrolData.lastReceiveBaseRewardsTimeMap).forEach(key => {\r\n            this.timesBeginTimes.push(this.startPatrolData.lastReceiveBaseRewardsTimeMap[key])\r\n        })\r\n        Object.keys(this.startPatrolData.lastReceiveExtraRewardsTimeMap).forEach(key => {\r\n            this.timesBeginTimes.push(this.startPatrolData.lastReceiveExtraRewardsTimeMap[key])\r\n        })\r\n\r\n        this.updatePatrolTimes();\r\n        this.unschedule(this.updatePatrolTimes)\r\n        this.schedule(this.updatePatrolTimes, 1)\r\n    }\r\n    updatePatrolTimes() {\r\n        // 巡逻收益时间\r\n        const curTime = RoleData.ins.getServerUtcTime();\r\n        let timeCount = curTime - (Number(this.startPatrolData.startPatrolTime))\r\n        const maxTime = this.InitialPatrolMaxTime;\r\n        // 新手没有收益\r\n        if (this.startPatrolData.startPatrolTime === 0) {\r\n            this.lbl_patrol_time.string = \"00:00:00\";\r\n            this.unschedule(this.updatePatrolTimes);\r\n            return;\r\n        }\r\n        // 已经达到最大收益\r\n        if (timeCount > maxTime) {\r\n            console.log(`已经打到最大巡逻收益`)\r\n            timeCount = maxTime;\r\n            this.unschedule(this.updatePatrolTimes);\r\n        }\r\n\r\n        this.lbl_patrol_time.string = setTextTime_2(timeCount);\r\n\r\n        // 基础奖励\r\n        const patrolTab = tab.getData().PatrolTableByPveStageId.getValue(this.StageId);\r\n        if (patrolTab) {\r\n            const itemIds = patrolTab.BaseItemIds.concat(patrolTab.ExtraItemIds);\r\n            const itemCounts = patrolTab.BaseItemNum.concat(patrolTab.ExtraItemNum);\r\n            const times = patrolTab.BaseTimes.concat(patrolTab.ExtraTimes);\r\n            // 每个物品的单独计算的cd\r\n            const timesBeginTimes = this.timesBeginTimes;\r\n            let showNothing = true;\r\n            for (let i = 0; i < itemIds.length; i++) {\r\n                const base_timeCount = curTime - Number(timesBeginTimes[i]) > maxTime ? maxTime : curTime - Number(timesBeginTimes[i]);\r\n                const base_time = times[i];\r\n                const base_itemId = itemIds[i];\r\n                let  base_itemCount = itemCounts[i];\r\n                if(base_itemId=== tab.CurrencyType.CurrencyType_Gold){\r\n                    base_itemCount = Math.floor(base_itemCount*(1 + RoleData.ins.getPrivilegeValue(tab.VipBonus.VipBonus_PatrolMoneyRatio) / 10000))\r\n                }else if(patrolTab.BaseItemIds[i] === tab.CurrencyType.CurrencyType_Feed){\r\n                    base_itemCount = Math.floor(base_itemCount*(1 + RoleData.ins.getPrivilegeValue(tab.VipBonus.VipBonus_PatrolFoodRatio) / 10000))\r\n                }\r\n                if (this.node_reward_layout.children[i]) {\r\n                    const item = this.node_reward_layout.children[i];\r\n                    const itemTs = item.getComponent(CommonItem);\r\n                    const curItemCount = itemTs.getItemCount();\r\n                    if (base_time > base_timeCount) {\r\n                        this.node_reward_layout.children[i].active = false;\r\n                    } else {\r\n                        showNothing = false;\r\n                        this.node_reward_layout.children[i].active = true;\r\n                        if (Math.floor(base_timeCount / base_time) > (curItemCount / base_time)) {\r\n                            itemTs.setShowNum(Math.floor(base_timeCount / base_time) * base_itemCount);\r\n                        }\r\n                    }\r\n                } else {\r\n                    if (base_time < base_timeCount) {\r\n                        showNothing = false;\r\n                        const base_info = new ItemInfo();\r\n                        base_info.itemId = base_itemId;\r\n                        base_info.num = base_itemCount * Math.floor(base_timeCount / base_time);\r\n                        ItemPoolMgr.ins.createItem(base_info, this.node_reward_layout);\r\n                    }\r\n                }\r\n            }\r\n            this.node_no_revenue.active = showNothing;\r\n        }\r\n    }\r\n    // 点击快速巡逻\r\n    clickQuickPatrol(event: EventTouch, type: string) {\r\n        const stageClearIds = BattleMainDataControl.ins.getStageClearIds();\r\n        if (stageClearIds.length === 0) {\r\n            //ShowTips(\"至少通过一关\");\r\n            ShowTips(LangMgr.getLab(\"Tips_patrol_1\"));\r\n            return;\r\n        }\r\n        let sendMsg = function(){\r\n            let msg = new proto.Msg_ReceiveQuickPatrolRewardReq();\r\n            msg.type = Number(type);\r\n            Net.Send(proto.Ptl.ReceiveQuickPatrolRewardReq, msg)\r\n        }\r\n        if(type===\"1\"){\r\n            AdMgr.ins.playVideoAd(tab.AdType.AdType_QuickPatrol, () => {\r\n                sendMsg();\r\n            }, false)\r\n        }else{\r\n            sendMsg();\r\n        }\r\n\r\n    }\r\n    // 点击领取奖励\r\n    clickGetPatrolAward() {\r\n        if (this.canClickGetBtn && !this.node_no_revenue.active) {\r\n            let msg = new proto.Msg_ReceivePatrolRewardReq();\r\n            Net.Send(proto.Ptl.ReceivePatrolRewardReq, msg)\r\n        }\r\n    }\r\n    onClose(): void {\r\n        super.onClose();\r\n        EventMgr.emitLocal(LocalEvent.LocalMsg_QueueUI_deleteUI);\r\n    }\r\n}\r\n\r\n\r\n"]}