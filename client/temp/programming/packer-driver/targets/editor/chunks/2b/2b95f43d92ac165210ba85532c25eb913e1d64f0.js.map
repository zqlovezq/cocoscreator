{"version":3,"sources":["file:///C:/chickenStarClient/client/assets/scripts/logic/fight/power/powerTab/SkillTab.ts"],"names":["_decorator","tab","Random","PowerBase","FightData","FightMacro","ccclass","property","Math_RATIO","SkillTab","powerType","PowerType","PowerType_SkillTable","configTab","Id","SkillType","Priority","Trigger","ActionPriority","ActionID","Expend","SkillEnhanceIds","Effect","EffectUnit","SearchEnemy","SearchNum","AddBuff","AddBuffChance","CoolTime","SkillConflict","BulletTime","RunningShot","Bullet","RunningShotBullet","HandEnemy","RunningShotBulletType","isPower","bulletTab","runningShotBulletTab","triggerTabs","effectTabs","addBuffTabs","isActionSkill","cdTime","isFirstCd","setConfigId","id","skillPowers","createTypeAnyId","PowerType_BulletTable","index","length","push","PowerType_EffectTable","PowerType_BuffTable","PowerType_TriggerTable","isNormalAttack","SkillType_NormalAttack","isPassiveSkill","SkillType_PassiveSkill","isTimePush","SkillType_TimePush","isTrigger","type","element","isCanTrigger","isType","isRunningShotSuccess","addRate","rate","isSuccess","isHasBuff","isHasTrigger","initCd","time","v","clearTimeRefresh","use","isInCD","attrData","tmpCdTime","getAttr","AttrType","AttrType_AttackSpeed","PERCENT","isRunningShot"],"mappings":"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","sourcesContent":["import { _decorator, Component } from \"cc\";\nimport { tab } from \"../../../../Table/table_gen\";\nimport { Random } from \"../../util/Random\";\nimport { SkillTriggerTab } from \"./SkillTriggerTab\";\nimport { PowerBase } from \"./PowerBase\";\nimport { BulletTab } from \"./BulletTab\";\nimport { EffectTab } from \"./EffectTab\";\nimport { BuffTab } from \"./BuffTab\";\nimport { FightData } from \"../../data/FightData\";\nimport { FightAttrData } from \"../../data/FightAttrData\";\nimport { FightMacro } from \"../../define/FightDefine\";\n\nconst { ccclass, property } = _decorator;\nconst Math_RATIO = 10000;\n\n@ccclass('SkillTab')\nexport class SkillTab extends PowerBase {\n    powerType: tab.PowerType = tab.PowerType.PowerType_SkillTable\n    configTab: tab.SkillTable\n    //---------------------配置字段-------------------\n    Id: number // ID \n    SkillType: tab.SkillType // 技能类型 \n    Priority: number // 发动优先级 \n    Trigger: number[] // 触发器 \n    ActionPriority: number // 动作优先级 \n    ActionID: number // 动作ID \n    Expend: number // 出手消耗 \n    SkillEnhanceIds: number[] // 技能增强 \n    Effect: number[] // 效果 \n    EffectUnit: tab.EffectUnit // 作用目标 \n    SearchEnemy: tab.SearchEnemy // 作用规则 \n    SearchNum: number // 作用数量 \n    AddBuff: number[] // 加buff \n    AddBuffChance: number[] // buff触发概率 \n    CoolTime: number[] // 冷却时间 \n    SkillConflict: number[] // 技能互斥 \n    BulletTime: number // 子弹发射时间 \n    RunningShot: number[] // 连射 \n    Bullet: number // 子弹ID \n    RunningShotBullet: number // 连射子弹 \n    HandEnemy : boolean // 手动目标 \n    RunningShotBulletType : tab.RunningShotBulletType // 连射类型 \n\n    //---------------------自有字段-------------------\n    isPower: boolean = false//是否已处理增强\n\n    bulletTab: BulletTab\n    runningShotBulletTab: BulletTab\n    triggerTabs: SkillTriggerTab[] = []\n    effectTabs: EffectTab[] = []\n    addBuffTabs: BuffTab[] = []\n\n    isActionSkill: boolean = false //是否为招式技能\n\n    cdTime: number\n    isFirstCd: boolean = true //初始CD中\n\n    setConfigId(id: number) {\n        super.setConfigId(id)\n\n        //子弹配置\n        if (this.Bullet) {\n            this.bulletTab = this.skillPowers.createTypeAnyId(tab.PowerType.PowerType_BulletTable, this.Bullet) as BulletTab\n        }\n        //连射子弹\n        if (this.RunningShotBullet) {\n            this.runningShotBulletTab = this.skillPowers.createTypeAnyId(tab.PowerType.PowerType_BulletTable, this.RunningShotBullet) as BulletTab\n        }\n\n        //效果配置\n        for (let index = 0; index < this.Effect.length; index++) {\n            this.effectTabs.push(this.skillPowers.createTypeAnyId(tab.PowerType.PowerType_EffectTable, this.Effect[index]) as EffectTab)\n        }\n        //buff配置\n        for (let index = 0; index < this.AddBuff.length; index++) {\n            this.addBuffTabs.push(this.skillPowers.createTypeAnyId(tab.PowerType.PowerType_BuffTable, this.AddBuff[index]) as BuffTab)\n        }\n        //触发器配置\n        for (let index = 0; index < this.Trigger.length; index++) {\n            this.triggerTabs.push(this.skillPowers.createTypeAnyId(tab.PowerType.PowerType_TriggerTable, this.Trigger[index]) as SkillTriggerTab)\n        }\n    }\n\n    /** 是否为普通攻击 */\n    isNormalAttack() {\n        return this.SkillType == tab.SkillType.SkillType_NormalAttack\n    }\n\n    /** 被动技能  */\n    isPassiveSkill() {\n        return this.SkillType == tab.SkillType.SkillType_PassiveSkill\n    }\n     /** 时间释放技能  */\n    isTimePush(){\n        return this.SkillType == tab.SkillType.SkillType_TimePush\n    }\n\n    isTrigger(type: tab.Triggertype) {\n        if (this.triggerTabs.length) {\n            for (let index = 0; index < this.triggerTabs.length; index++) {\n                const element = this.triggerTabs[index];\n                if (element.isCanTrigger() && element.isType(type)) {\n                    return true\n                }\n            }\n        }\n        return false\n    }\n\n    /** 是否连射 */\n    isRunningShotSuccess(addRate: number) {\n        let rate = addRate + this.RunningShot[2]\n        return Random.isSuccess(rate)\n    }\n\n    isHasBuff() {\n        return this.addBuffTabs.length > 0\n    }\n    isHasTrigger() {\n        return this.triggerTabs.length > 0\n    }\n\n    initCd() {\n        this.isFirstCd = true\n        this.cdTime = FightData.time\n\n        for (let index = 0; index < this.triggerTabs.length; index++) {\n            const v = this.triggerTabs[index];\n            v.clearTimeRefresh()\n        }\n    }\n\n\n    use() {\n        this.isFirstCd = false\n        this.cdTime = FightData.time\n    }\n\n    /** 是否在CD中 */\n    isInCD(attrData: FightAttrData) {\n        if (this.CoolTime.length) {\n            let tmpCdTime = this.CoolTime[1]\n            if (this.isFirstCd) {\n                tmpCdTime = this.CoolTime[0]\n            }\n            if (attrData) {\n                tmpCdTime = tmpCdTime / (1 + attrData.getAttr(tab.AttrType.AttrType_AttackSpeed) / FightMacro.PERCENT)\n            }\n            return FightData.time - this.cdTime < tmpCdTime\n        }\n        return false\n    }\n\n    /** 是否为连射 */\n    isRunningShot() {\n        return this.RunningShot.length > 0 && this.RunningShot[1] > 0\n    }\n}"]}