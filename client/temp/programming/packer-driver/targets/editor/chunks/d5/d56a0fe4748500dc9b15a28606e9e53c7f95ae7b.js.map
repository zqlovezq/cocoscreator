{"version":3,"sources":["file:///C:/chickenStarClient/client/assets/scripts/logic/model/hero/herobag/HeroRecommendPop.ts"],"names":["_decorator","instantiate","Layout","Node","Prefab","ScrollView","ViewPop","tab","HeroRecommendPopItem","LocalEvent","EventMgr","HeroDataControl","proto","UIMgr","ViewName","RedMgr","RedDotType","ccclass","property","HeroRecommendPop","_recommendTableData","register","onLocal","Click_Recommend_Hero","onClose","onMsg","Ptl","ReceiveRecommendTeamRewardRsp","on_s2c_ReceiveRecommendTeamRewardRsp","msg","error","code","CommonErrorCode","Succeed","rewards","ins","show","viewName","CongratulationPop","data","map","getRecommendTeamIds","set","recommendTeamId","refreshEvent","HeroRecommend","setView","onShow","getListData","i","length","item","node_content","children","pfb_recommend_item","addChild","ts","getComponent","UpdateContent","tabData","scrollView","scroll_view","updateLayout","onDestroy","arr1","arr2","getData","RecommendTeamTable","_tab","get","Id","push","concat"],"mappings":"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","sourcesContent":["import { _decorator, Component, instantiate, Layout, Node, Prefab, ScrollView, Socket } from 'cc';\r\nimport { ViewPop } from '../../../../framework/base/ViewPop';\r\nimport { tab } from '../../../../Table/table_gen';\r\nimport { HeroRecommendPopItem } from './HeroRecommendPopItem';\r\nimport { LocalEvent } from '../../../define/LocalEvent';\r\nimport { EventMgr } from '../../../mgr/EventMgr';\r\nimport { HeroDataControl } from './HeroDataControl';\r\nimport { proto } from 'client_protocol';\r\nimport { UIMgr } from '../../../mgr/UIMgr';\r\nimport { ViewName } from '../../../define/ViewDefine';\r\nimport { RedMgr } from '../../../mgr/RedMgr';\r\nimport { RedDotType } from '../../../red/RedDotType';\r\nconst { ccclass, property } = _decorator;\r\n\r\n@ccclass('HeroRecommendPop')\r\nexport class HeroRecommendPop extends ViewPop {\r\n    // @property(InfiniteList)\r\n    // list_view: InfiniteList = null;\r\n    @property(Prefab)\r\n    pfb_recommend_item: Prefab = null;\r\n    @property(Node)\r\n    node_content:Node = null;\r\n    @property(ScrollView)\r\n    scroll_view:ScrollView = null;\r\n\r\n    private _recommendTableData: tab.RecommendTeamTable[] = [];\r\n    register(): void {\r\n        /* 当点击阵容推荐里面的英雄 */\r\n        EventMgr.onLocal(LocalEvent.Click_Recommend_Hero, this.onClose, this);\r\n        EventMgr.onMsg(proto.Ptl.ReceiveRecommendTeamRewardRsp, this.on_s2c_ReceiveRecommendTeamRewardRsp, this);\r\n    }\r\n   \r\n    on_s2c_ReceiveRecommendTeamRewardRsp(msg:proto.Msg_ReceiveRecommendTeamRewardRsp){\r\n        if (msg.error && msg.error.code != proto.CommonErrorCode.Succeed) return;\r\n        let rewards = msg.rewards;\r\n        // 展示奖励\r\n        UIMgr.ins.show({ viewName: ViewName.CongratulationPop, data: rewards });\r\n        let map = HeroDataControl.ins.getRecommendTeamIds();\r\n        map.set(msg.recommendTeamId,true);\r\n        RedMgr.refreshEvent(RedDotType.HeroRecommend);\r\n        this.setView();\r\n    }\r\n    onShow(): void {\r\n        this.setView();\r\n    }\r\n    /* 领取奖励之后刷新界面 */\r\n    setView(){\r\n        this._recommendTableData = this.getListData();\r\n        for(let i=0;i<this._recommendTableData.length;i++){\r\n            let data = this._recommendTableData[i];\r\n            let item = null;\r\n            if(this.node_content.children[i]){\r\n                item = this.node_content.children[i]\r\n            }else{\r\n                item = instantiate(this.pfb_recommend_item);\r\n                this.node_content.addChild(item);\r\n            }\r\n            let ts = item.getComponent(HeroRecommendPopItem);\r\n            ts.UpdateContent({tabData:data,scrollView:this.scroll_view});\r\n        }\r\n        this.node_content.getComponent(Layout).updateLayout();\r\n    }\r\n    onDestroy(): void {\r\n        super.onDestroy();\r\n    }\r\n    private getListData(){\r\n        let arr1=[];\r\n        let arr2=[];\r\n        let map = HeroDataControl.ins.getRecommendTeamIds();\r\n        for(let i=0;i<tab.getData().RecommendTeamTable.length;i++){\r\n            let _tab = tab.getData().RecommendTeamTable[i];\r\n            if(map.get(_tab.Id)){\r\n                arr2.push(_tab);\r\n            }else{\r\n                arr1.push(_tab);\r\n            }\r\n            _tab[\"extend\"] = 0;\r\n        }\r\n        return arr1.concat(arr2);\r\n    }\r\n}\r\n\r\n\r\n"]}