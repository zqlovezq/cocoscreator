{"version":3,"sources":["file:///C:/chickenStarClient/client/assets/scripts/logic/model/common/NewHeroPop.ts"],"names":["_decorator","instantiate","Node","Prefab","sp","Animation","Sprite","Label","AnimationComponent","Vec3","ViewPop","HeroInfo","tab","HeroSkillItem","createAnimation","LangMgr","GuideController","EventMgr","LocalEvent","ccclass","property","NewHeroPop","Skeleton","itemId","_heroInfo","mClosedCallBack","register","unRegister","onShow","openData","heroTab","getData","HeroTableById","getValue","heroInfo","id","star","DefaultStar","showBaseInfo","showSkillItem","setCloseCallBack","closeFunc","onClose","ins","isGuiding","canHideHeroPop","emitLocal","hideHeroPop","onDestroy","showNewOver","heroTable","node_skill_layout","destroyAllChildren","skillMap","getHeroSkillMap","i","iconUrl","skillData","get","skill_item","pfb_skill_item","ts","getComponent","initData","parent","anim","ske_hero","node","setPosition","Born","setCompleteListener","listener","animation","name","addAnimation","play","on","EventType","FINISHED","walkFinish","itemTab","ItemTableById","heroClassTab","HeroClassTableByHeroClass","Class","heroAptitudeTab","HeroAptitudeTableByHeroAptitude","Aptitude","sp_vocation","setTexture","Icon","sp_quality","lbl_hero_name","string","getLab","Name","lbl_speciality","Speciality","type","state","console","log","clearAnimation","setAnimation","HeroAptitude","HeroAptitude_SSR","HeroAptitude_SR","scheduleOnce","ShowPop"],"mappings":"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","sourcesContent":["import { _decorator, Component, instantiate, Node, Prefab, sp, Animation, Sprite, Label, AnimationComponent, animation, Vec3 } from 'cc';\r\nimport { ViewPop } from '../../../framework/base/ViewPop';\r\nimport { HeroInfo } from '../hero/HeroInfo';\r\nimport { tab } from '../../../Table/table_gen';\r\nimport { HeroSkillItem } from '../hero/herobag/HeroSkillItem';\r\nimport { createAnimation } from '../../utils/GameUtil';\r\nimport { LangMgr } from '../../mgr/LangMgr';\r\nimport { GuideController } from '../../guide/GuideController';\r\nimport { EventMgr } from '../../mgr/EventMgr';\r\nimport { LocalEvent } from '../../define/LocalEvent';\r\nconst { ccclass, property } = _decorator;\r\n\r\n@ccclass('NewHeroPop')\r\nexport class NewHeroPop extends ViewPop {\r\n    @property(Prefab)\r\n    pfb_skill_item: Prefab = null;\r\n    @property(Node)\r\n    node_skill_layout: Node = null;\r\n    @property(sp.Skeleton)\r\n    ske_hero: sp.Skeleton = null;\r\n    @property(Sprite)\r\n    sp_vocation: Sprite = null;//职业\r\n    @property(Sprite)\r\n    sp_quality: Sprite = null;//品质\r\n    @property(Label)\r\n    lbl_hero_name: Label = null;\r\n    @property(Label)\r\n    lbl_speciality: Label = null;\r\n    // @property(Node)\r\n    // node_new:Node = null\r\n    // @property(Node)\r\n    // node_rare:Node = null\r\n    private itemId: number = 0;\r\n    private _heroInfo: HeroInfo = null;\r\n    private mClosedCallBack: Function = null;\r\n    register(): void {\r\n\r\n    }\r\n    unRegister(): void {\r\n        super.unRegister()\r\n    }\r\n    onShow(): void {\r\n        this.itemId = this.openData.itemId;\r\n        const heroTab = tab.getData().HeroTableById.getValue(this.itemId);\r\n        let heroInfo = new HeroInfo();\r\n        heroInfo.itemId = this.itemId;\r\n        heroInfo.id = 0;\r\n        heroInfo.star = heroTab.DefaultStar;\r\n        this._heroInfo = heroInfo;\r\n        this.showBaseInfo();\r\n        this.showSkillItem();\r\n    }\r\n    setCloseCallBack(closeFunc: Function) {\r\n        this.mClosedCallBack = closeFunc;\r\n    }\r\n    onClose(): void {\r\n        if(GuideController.ins.isGuiding()){\r\n            if(GuideController.ins.canHideHeroPop){\r\n                super.onClose();\r\n                EventMgr.emitLocal(LocalEvent.hideHeroPop);\r\n            }\r\n        }else{\r\n            super.onClose();\r\n        }\r\n    }\r\n    onDestroy() {\r\n        super.onDestroy();\r\n        EventMgr.emitLocal(LocalEvent.showNewOver);\r\n        if (this.mClosedCallBack && typeof this.mClosedCallBack == 'function') {\r\n            this.mClosedCallBack();\r\n            this.mClosedCallBack = null;\r\n        }\r\n    }\r\n    // 创建技能\r\n    showSkillItem() {\r\n        let heroTab = this._heroInfo.heroTable;\r\n        this.node_skill_layout.destroyAllChildren();\r\n        let skillMap = this._heroInfo.getHeroSkillMap();\r\n        for (let i = 1; i <= 3; i++) {\r\n            let iconUrl = heroTab[\"SkillIcon\" + i];\r\n            if (iconUrl) {\r\n                let skillData: tab.HeroStarUpTable[] = skillMap.get(i);\r\n                if (skillData) {\r\n                    let skill_item = instantiate(this.pfb_skill_item);\r\n                    let ts = skill_item.getComponent(HeroSkillItem);\r\n                    ts.initData(i, this._heroInfo);\r\n                    skill_item.parent = this.node_skill_layout;\r\n                }\r\n            }\r\n        }\r\n    }\r\n    // 创建职业\r\n    // 基本信息\r\n    showBaseInfo() {\r\n        const anim: Animation = this.getComponent(Animation);\r\n        this.ske_hero.node.setPosition(new Vec3(-400, -180, 0))\r\n        createAnimation(this.ske_hero.node, this._heroInfo.heroTable.Born);\r\n        this.ske_hero.setCompleteListener((listener) => {\r\n            if (listener.animation.name === \"action_born\") {\r\n                this.ske_hero.addAnimation(0, \"action_move\", true)\r\n                anim.play(\"NewHeroWalk\");\r\n                anim.on(AnimationComponent.EventType.FINISHED, this.walkFinish, this);\r\n            }\r\n        })\r\n        let itemId = this.itemId;\r\n        let itemTab = tab.getData().ItemTableById.getValue(itemId);\r\n        let heroTab = tab.getData().HeroTableById.getValue(itemId);\r\n        let heroClassTab = tab.getData().HeroClassTableByHeroClass.getValue(heroTab.Class)\r\n        let heroAptitudeTab = tab.getData().HeroAptitudeTableByHeroAptitude.getValue(heroTab.Aptitude);\r\n\r\n        this.sp_vocation.setTexture(heroClassTab.Icon);\r\n        this.sp_quality.setTexture(heroAptitudeTab.Icon);\r\n        /* 英雄名称 */\r\n        this.lbl_hero_name.string = LangMgr.getLab(itemTab.Name);\r\n        /* 技能 */\r\n        this.lbl_speciality.string = LangMgr.getLab(heroTab.Speciality);\r\n    }\r\n    walkFinish(type, state) {\r\n        const anim: Animation = this.getComponent(Animation);\r\n        console.log(\"播放完成-----\");\r\n        let heroTab = tab.getData().HeroTableById.getValue(this.itemId);\r\n        if (state.name === \"NewHeroNew\" || state.name === \"NewHeroRare\") {\r\n            anim.play(\"NewHeroIdle\");\r\n        } else if (state.name === \"NewHeroWalk\") {\r\n            this.ske_hero.clearAnimation();\r\n            this.ske_hero.setAnimation(0, \"action_idle\", true);\r\n            if (heroTab.Aptitude === tab.HeroAptitude.HeroAptitude_SSR) {\r\n                anim.play(\"NewHeroRare\");\r\n            } else if (heroTab.Aptitude === tab.HeroAptitude.HeroAptitude_SR) {\r\n                anim.play(\"NewHeroNew\");\r\n            }\r\n        }\r\n        if (GuideController.ins.isGuiding()) {\r\n            this.scheduleOnce(() => {\r\n                EventMgr.emitLocal(LocalEvent.ShowPop);\r\n            }, 3.2)\r\n        }\r\n    }\r\n}\r\n\r\n\r\n"]}