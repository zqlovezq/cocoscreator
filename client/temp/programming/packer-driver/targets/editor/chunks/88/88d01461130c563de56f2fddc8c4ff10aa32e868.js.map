{"version":3,"sources":["file:///C:/chickenStarClient/client/assets/scripts/logic/model/item/ItemPoolMgr.ts"],"names":["_decorator","error","instantiate","NodePool","Prefab","v3","LoadResAsync","CommonItem","tab","HeroItem","HeroInfo","EquipmentItem","WeaponItem","ItemInfo","EquipInfo","ccclass","property","ItemPoolMgr","_itemCommonPool","_itemHeroPool","_equipmentItemPool","_bookItemPool","conmmonPrefab","equipmentPrefab","heroPrefab","bookPrefab","ins","_instance","initPool","loadItemPrefab","addRef","ass","createRewadItem","reward","parentNode","isTouch","itemTab","getData","ItemTableById","getValue","itemId","Type","node","ItemType","ItemType_Hero","info","createDefaultData","createHeroItem","ItemType_Book","createBookItem","ItemType_Currency","ItemType_Material","ItemType_HeroCommonCost","ItemType_LimitTimeItem","ItemType_Elixir","ItemType_Box","ItemType_ChoiceBox","Id","itemInfo","initItemData","Number","num","createItem","ItemType_Equip","euqipInfo","createEquipItem","data","isConsume","get","parent","com","getComponent","initData","setPosition","setScale","UpdateContent","setLevel","itemTs","putCommonItem","put","putEquipItem","putHeroItem","putBookItme","clear"],"mappings":"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","sourcesContent":["import { _decorator, Asset, Component, error, instantiate, Node, NodePool, Prefab, v3 } from 'cc';\r\nimport { LoadResAsync } from '../../mgr/ResMgr';\r\nimport { CommonItem } from './CommonItem';\r\nimport { tab } from '../../../Table/table_gen';\r\nimport { HeroItem } from './HeroItem';\r\nimport { HeroInfo } from '../hero/HeroInfo';\r\nimport { EquipmentItem } from './EquipmentItem';\r\nimport { WeaponItem } from '../common/WeaponItem';\r\n\r\nimport { proto } from 'client_protocol';\r\nimport { ItemInfo } from './ItemInfo';\r\nimport { EquipInfo } from '../equip/EquipInfo';\r\nimport { RareBookData } from '../rareBook/RareBookData';\r\n\r\nconst { ccclass, property } = _decorator;\r\n\r\n@ccclass('ItemPoolMgr')\r\nexport class ItemPoolMgr {\r\n    private static _instance: ItemPoolMgr;\r\n    private _itemCommonPool: NodePool;\r\n    private _itemHeroPool: NodePool;\r\n    private _equipmentItemPool: NodePool;\r\n    private _bookItemPool: NodePool;\r\n    private conmmonPrefab: Prefab;\r\n    private equipmentPrefab: Prefab;\r\n    private heroPrefab: Prefab;\r\n    private bookPrefab: Prefab;\r\n    public static get ins() {\r\n        if (null == this._instance) {\r\n            this._instance = new ItemPoolMgr();\r\n            this._instance.initPool();\r\n        }\r\n        return this._instance;\r\n    }\r\n    private initPool() {\r\n        this._itemCommonPool = new NodePool();\r\n        this._itemHeroPool = new NodePool();\r\n        this._equipmentItemPool = new NodePool();\r\n        this._bookItemPool = new NodePool();\r\n    }\r\n    async loadItemPrefab() {\r\n        this.heroPrefab = await LoadResAsync('prefab/common/HeroItem', Prefab);\r\n        this.conmmonPrefab = await LoadResAsync('prefab/common/CommonItem', Prefab);\r\n        this.equipmentPrefab = await LoadResAsync('prefab/common/EquipmentItem', Prefab);\r\n        this.bookPrefab = await LoadResAsync('prefab/common/WeaponItem', Prefab);\r\n        this.addRef(this.heroPrefab)\r\n        this.addRef(this.conmmonPrefab)\r\n        this.addRef(this.equipmentPrefab)\r\n        this.addRef(this.bookPrefab)\r\n    }\r\n    addRef(ass: Asset) {\r\n        if (ass) {\r\n            ass.addRef()\r\n        }\r\n    }\r\n\r\n    createRewadItem(reward: proto.Item, parentNode: Node, isTouch = true) {\r\n        let itemTab = tab.getData().ItemTableById.getValue(reward.itemId);\r\n        if (!itemTab) {\r\n            error(\"itemTabel 未配置---\", reward.itemId)\r\n            return;\r\n        }\r\n        let Type = itemTab.Type;\r\n        let node;\r\n        switch (Type) {\r\n            case tab.ItemType.ItemType_Hero:\r\n                let info = new HeroInfo();\r\n                info.createDefaultData(reward.itemId);\r\n                node = this.createHeroItem(info, parentNode);\r\n                break;\r\n            case tab.ItemType.ItemType_Book:\r\n                node = this.createBookItem(reward.itemId, parentNode);\r\n                break;\r\n            case tab.ItemType.ItemType_Currency:\r\n            case tab.ItemType.ItemType_Material:\r\n            case tab.ItemType.ItemType_HeroCommonCost:\r\n            case tab.ItemType.ItemType_LimitTimeItem:\r\n            case tab.ItemType.ItemType_Elixir:\r\n            case tab.ItemType.ItemType_Box:\r\n            case tab.ItemType.ItemType_ChoiceBox:\r\n                if (itemTab.Id > 6100 && itemTab.Id < 9000) {\r\n                    reward.itemId = itemTab.Id - 4000\r\n                    let info = new HeroInfo();\r\n                    info.createDefaultData(reward.itemId);\r\n                    node = this.createHeroItem(info, parentNode);\r\n                } else {\r\n                    let itemInfo = new ItemInfo();\r\n                    itemInfo.initItemData(reward.itemId, Number(reward.num));\r\n                    node = this.createItem(itemInfo, parentNode, isTouch);\r\n                }\r\n                break;\r\n            case tab.ItemType.ItemType_Equip:\r\n                let euqipInfo = new EquipInfo();\r\n                euqipInfo.createDefaultData(reward.itemId);\r\n                node = this.createEquipItem(euqipInfo, parentNode, isTouch);\r\n                // this.createEquipItem(data, parentNode)\r\n                break;\r\n            default:\r\n                let itemInfo = new ItemInfo();\r\n                itemInfo.initItemData(reward.itemId, Number(reward.num));\r\n                node = this.createItem(itemInfo, parentNode, isTouch);\r\n                break;\r\n        }\r\n        return node;\r\n\r\n    }\r\n    createItem(data: any, parentNode: Node, isTouch = true, isConsume: boolean = false): Node {\r\n        let node: Node = null;\r\n        node = this._itemCommonPool.get();\r\n        if (!node) {\r\n            node = instantiate(this.conmmonPrefab);\r\n        }\r\n        node.parent = parentNode;\r\n        let com = node.getComponent(CommonItem);\r\n        com.initData(data, isTouch, isConsume);\r\n        node.setPosition(v3(0, 0));\r\n        node.setScale(1, 1);\r\n        return node;\r\n\r\n    }\r\n    createEquipItem(data: any, parentNode: Node, isTouch = true): Node {\r\n        let node = null;\r\n        node = this._equipmentItemPool.get();\r\n        if (!node) {\r\n            node = instantiate(this.equipmentPrefab);\r\n        }\r\n        node.parent = parentNode;\r\n        let com = node.getComponent(EquipmentItem);\r\n        com.initData(data, isTouch);\r\n        node.setPosition(v3(0, 0));\r\n        return node;\r\n\r\n    }\r\n    createHeroItem(data: any, parent: Node) {\r\n        let node: Node = null;\r\n        node = this._itemHeroPool.get();\r\n        if (!node) {\r\n            node = instantiate(this.heroPrefab);\r\n        }\r\n        node.parent = parent;\r\n        node.setPosition(0, 0);\r\n        node.getComponent(HeroItem).UpdateContent(data);\r\n        node.getComponent(HeroItem).setLevel(0);\r\n        return node;\r\n    }\r\n    createBookItem(data: any, parent: Node) {\r\n        let node: Node = null;\r\n        node = this._bookItemPool.get();\r\n        if (!node) {\r\n            node = instantiate(this.bookPrefab);\r\n        }\r\n        node.parent = parent;\r\n        node.setPosition(0, 0);\r\n        const itemTs = node.getComponent(WeaponItem)\r\n        itemTs.initData(data,false,false);\r\n        return node;\r\n    }\r\n    putCommonItem(node: Node) {\r\n        this._itemCommonPool.put(node);\r\n    }\r\n    putEquipItem(node: Node) {\r\n        this._equipmentItemPool.put(node);\r\n    }\r\n    putHeroItem(node: Node) {\r\n        this._itemHeroPool.put(node);\r\n    }\r\n    putBookItme(node: Node) {\r\n        this._bookItemPool.put(node);\r\n    }\r\n    clear() {\r\n        this._itemCommonPool.clear();\r\n        this._itemHeroPool.clear();\r\n        this._equipmentItemPool.clear()\r\n        this._bookItemPool.clear()\r\n    }\r\n\r\n\r\n\r\n\r\n}\r\n\r\n\r\n"]}