{"version":3,"sources":["file:///C:/chickenStarClient/client/assets/scripts/logic/model/activity/combine/CombineAccumulatedRechargeCellItem.ts"],"names":["_decorator","Component","Label","Node","ProgressBar","tab","ItemInfo","ItemPoolMgr","LangMgr","ActivityData","AWARD_STATE","UIMgr","ActivityControl","ButtonLock","ccclass","property","CombineAccumulatedRechargeCellItem","_state","NONE","_type","_awardId","initData","type","IndexId","maxValue","lbl_target_amount","string","getCombineString","serverData","ins","getRechargeServerData","ActivityId","lbl_progress_num","payAmount","bar_progress","progress","node_reawrd","destroyAllChildren","i","RewardItemIds","length","id","count","RewardItemNum","awardInfo","itemId","num","createRewadItem","state","getRewardState","node_go","active","GO","node_receive","RECEIVE","node_got","GOT","node_lock","LOCK","tabData","curTabGo","getData","ActivityCumulativeRechargeTable","_tab","activityId","receivedRewardIds","indexOf","onClickGoBtn","hideView","jumpLayer","Module","Module_ActivityMainView","onClickReceive","requestReceiveCumulativeRechargeReward"],"mappings":"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","sourcesContent":["import { _decorator, Component, Label, Node, ProgressBar } from 'cc';\r\nimport { tab } from '../../../../Table/table_gen';\r\nimport { ItemInfo } from '../../item/ItemInfo';\r\nimport { ItemPoolMgr } from '../../item/ItemPoolMgr';\r\nimport { LangMgr } from '../../../mgr/LangMgr';\r\nimport { ActivityData } from '../ActivityData';\r\nimport { AWARD_STATE } from '../../../../Common/script/EnumTypeMgr';\r\nimport { proto } from 'client_protocol';\r\nimport { UIMgr } from '../../../mgr/UIMgr';\r\nimport { ActivityControl } from '../ActivityControl';\r\nimport { ButtonLock } from '../../../utils/GameUtil';\r\nconst { ccclass, property } = _decorator;\r\n\r\n@ccclass('CombineAccumulatedRechargeCellItem')\r\nexport class CombineAccumulatedRechargeCellItem extends Component {\r\n    @property(Node)\r\n    node_reawrd: Node = null;\r\n    @property(Label)\r\n    lbl_target_amount: Label = null;\r\n    @property(Label)\r\n    lbl_progress_num: Label = null;\r\n    @property(ProgressBar)\r\n    bar_progress: ProgressBar = null;\r\n    @property(Node)\r\n    node_go: Node = null;\r\n    @property(Node)\r\n    node_receive: Node = null;\r\n    @property(Node)\r\n    node_got: Node = null;\r\n    @property(Node)\r\n    node_lock: Node = null;\r\n    private _state: AWARD_STATE = AWARD_STATE.NONE;\r\n    private _type: string = \"\";\r\n    private _awardId: number = 0;\r\n    initData(tab: tab.ActivityCumulativeRechargeTable, type: string) {\r\n        // 显示奖励\r\n        this._type = type;\r\n        this._awardId = tab.IndexId;\r\n        let maxValue = 0;\r\n        if (type === \"PriceDollar\") {\r\n            maxValue = tab[type] / 100\r\n        } else {\r\n            maxValue = tab[type]\r\n        }\r\n        this.lbl_target_amount.string = LangMgr.getCombineString(\"ui_accumulatedrecharge_1\", [maxValue]);\r\n        const serverData = ActivityData.ins.getRechargeServerData(tab.ActivityId);\r\n        this.lbl_progress_num.string = serverData.payAmount + \"/\" + maxValue;\r\n        this.bar_progress.progress = serverData.payAmount / maxValue > 1 ? 1 : serverData.payAmount / maxValue\r\n        this.node_reawrd.destroyAllChildren();\r\n        for (let i = 0; i < tab.RewardItemIds.length; i++) {\r\n            const id = tab.RewardItemIds[i];\r\n            const count = tab.RewardItemNum[i];\r\n            const awardInfo = new ItemInfo();\r\n            awardInfo.itemId = id;\r\n            awardInfo.num = count;\r\n            ItemPoolMgr.ins.createRewadItem(awardInfo, this.node_reawrd);\r\n        }\r\n        const state = this.getRewardState(serverData, tab);\r\n        this.node_go.active = state === AWARD_STATE.GO;\r\n        this.node_receive.active = state === AWARD_STATE.RECEIVE;\r\n        this.node_got.active = state === AWARD_STATE.GOT;\r\n        this.node_lock.active = state === AWARD_STATE.LOCK;\r\n    }\r\n    getRewardState(serverData: proto.CumulativeRecharge, tabData: tab.ActivityCumulativeRechargeTable): AWARD_STATE {\r\n        // 根据当前的充值金额获取当前的档位\r\n        let curTabGo = null;\r\n        for (let i = 0; i < tab.getData().ActivityCumulativeRechargeTable.length; i++) {\r\n            const _tab = tab.getData().ActivityCumulativeRechargeTable[i];\r\n            if (_tab.ActivityId === serverData.activityId) {\r\n                if (_tab[this._type] > serverData.payAmount) {\r\n                    curTabGo = _tab;\r\n                    break;\r\n                } else {\r\n                    if (i === tab.getData().ActivityCumulativeRechargeTable.length - 1) {\r\n                        if (_tab[this._type] < serverData.payAmount) {\r\n                            curTabGo = _tab;\r\n                        }\r\n                    }\r\n                }\r\n            }\r\n        }\r\n\r\n        if (serverData.payAmount >= tabData[this._type]) {\r\n            // 已经领取\r\n            if (serverData.receivedRewardIds.indexOf(tabData.IndexId) > -1) {\r\n                return AWARD_STATE.GOT\r\n            } else {\r\n                return AWARD_STATE.RECEIVE\r\n            }\r\n        } else {\r\n            if (tabData.IndexId === curTabGo.IndexId) {\r\n                return AWARD_STATE.GO\r\n            } else {\r\n                return AWARD_STATE.LOCK\r\n            }\r\n        }\r\n    }\r\n    // 点击前往\r\n    onClickGoBtn() {\r\n        UIMgr.ins.hideView(\"CombineActivityMainView\");\r\n        UIMgr.ins.jumpLayer(tab.Module.Module_ActivityMainView);\r\n    }\r\n    // 领取奖励\r\n    @ButtonLock(1, () => { })\r\n    onClickReceive() {\r\n        ActivityControl.ins.requestReceiveCumulativeRechargeReward(this._awardId)\r\n    }\r\n}\r\n\r\n\r\n"]}