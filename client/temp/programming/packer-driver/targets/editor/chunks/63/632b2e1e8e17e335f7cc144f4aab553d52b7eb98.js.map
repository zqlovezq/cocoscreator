{"version":3,"sources":["file:///C:/chickenStarClient/client/assets/scripts/logic/model/common/PlayerHeadItem.ts"],"names":["_decorator","Component","Label","Node","sp","Sprite","UIMgr","ViewName","RoleData","tab","EventMgr","proto","ccclass","property","PlayerHeadItem","Skeleton","headInfo","fromUrl","mTouchCallBack","onLoad","node","on","EventType","TOUCH_END","clickHead","onMsg","Ptl","SetHeadIconRsp","on_s2c_SetHeadIconRsp","SetHeadFrameRsp","on_s2c_SetHeadFrameRsp","updateHeadInfo","ins","avatarInfo","headIcon","headFrame","msg","error","code","CommonErrorCode","Succeed","initHeadInfo","info","from","roleInfo","level","levelLab","string","setCloseCallBack","closeFunc","roleInfoView","CheckRoleInfoView","id","getView","show","viewName","RoleInfoPop","CheckRoleInfoPop","data","roleId","headId","headFrameId","itemHeadTab","getData","ItemTableById","getValue","headImg","setTexture","Icon","itemheadFrameTab","headFrameImg"],"mappings":"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","sourcesContent":["import { _decorator, Component, Label, Node, sp, Sprite } from 'cc';\r\nimport { UIMgr } from '../../mgr/UIMgr';\r\nimport { ViewName } from '../../define/ViewDefine';\r\nimport { SimpleRoleInfo } from '../friends/SimpleRoleInfo';\r\nimport { Role } from '../../fight/base/obj/role/role/Role';\r\nimport { RoleData } from '../role/RoleData';\r\nimport { tab } from '../../../Table/table_gen';\r\nimport { EventMgr } from '../../mgr/EventMgr';\r\nimport { proto } from 'client_protocol';\r\nconst { ccclass, property } = _decorator;\r\n\r\n@ccclass('PlayerHeadItem')\r\nexport class PlayerHeadItem extends Component {\r\n    @property(Sprite)\r\n    headFrameImg:Sprite=null;\r\n    @property(Sprite)\r\n    headImg:Sprite=null;\r\n    @property(Label)\r\n    levelLab:Label=null;\r\n    @property(Node)\r\n    redPoint:Node=null;\r\n    @property(sp.Skeleton)\r\n    spine:sp.Skeleton=null;\r\n    private headInfo:HeadInfo=null;\r\n    private fromUrl:string = \"\"\r\n    private mTouchCallBack: Function = null;\r\n    protected onLoad(): void {\r\n        this.node.on(Node.EventType.TOUCH_END,this.clickHead,this);\r\n        EventMgr.onMsg(proto.Ptl.SetHeadIconRsp, this.on_s2c_SetHeadIconRsp, this)\r\n        EventMgr.onMsg(proto.Ptl.SetHeadFrameRsp, this.on_s2c_SetHeadFrameRsp, this)\r\n        this.updateHeadInfo(RoleData.ins.avatarInfo.headIcon,RoleData.ins.avatarInfo.headFrame)\r\n    }\r\n    on_s2c_SetHeadIconRsp(msg: proto.Msg_SetHeadIconRsp){\r\n        if (!msg.error || msg.error.code == proto.CommonErrorCode.Succeed) {\r\n            this.updateHeadInfo(msg.headIcon,-1)\r\n        }\r\n    }\r\n    on_s2c_SetHeadFrameRsp(msg: proto.Msg_SetHeadFrameRsp){\r\n        if (!msg.error || msg.error.code == proto.CommonErrorCode.Succeed) {\r\n            this.updateHeadInfo(-1,msg.headFrame)\r\n        }\r\n    }\r\n    initHeadInfo(info:HeadInfo,from?:string){\r\n        this.headInfo=info;\r\n        if(from){\r\n            this.fromUrl = from;\r\n        }\r\n        if(info.roleInfo){\r\n            if(!info.headFrame){\r\n                info.headFrame=info.roleInfo.headFrame;\r\n            }\r\n            if(!info.headIcon){\r\n                info.headIcon=info.roleInfo.headIcon;\r\n            }\r\n            if(!info.level){\r\n                info.level=info.roleInfo.level;\r\n            }\r\n            // this.levelLab.string=info.level+\"\";\r\n        }\r\n        if(info.level){\r\n            this.levelLab.string=info.level+\"\";\r\n        }\r\n        this.updateHeadInfo(info.headIcon,info.headFrame);\r\n\r\n    }\r\n    setCloseCallBack(closeFunc: Function) {\r\n        this.mTouchCallBack = closeFunc;\r\n    }\r\n    clickHead(){\r\n        if (this.mTouchCallBack && typeof this.mTouchCallBack == 'function') {\r\n            this.mTouchCallBack();\r\n            return;\r\n        }\r\n        let roleInfoView = null;\r\n        let CheckRoleInfoView = null;\r\n        if(this.headInfo){\r\n            if(this.headInfo.roleInfo){\r\n                if(RoleData.ins.id==this.headInfo.roleInfo.id&&!this.fromUrl){\r\n                    roleInfoView = UIMgr.ins.getView(\"RoleInfoPop\")\r\n                    if(!roleInfoView){\r\n                        UIMgr.ins.show({viewName: ViewName.RoleInfoPop})\r\n                    }\r\n                }else{\r\n                    CheckRoleInfoView = UIMgr.ins.getView(\"CheckRoleInfoPop\")\r\n                    if(!CheckRoleInfoView){\r\n                        UIMgr.ins.show({viewName: ViewName.CheckRoleInfoPop,data:{\"info\":this.headInfo.roleInfo}})\r\n                    }\r\n                }\r\n            }else if(this.headInfo.roleId){\r\n                if(RoleData.ins.id==this.headInfo.roleId&&!this.fromUrl){\r\n                    roleInfoView = UIMgr.ins.getView(\"RoleInfoPop\")\r\n                    if(!roleInfoView){\r\n                        UIMgr.ins.show({viewName: ViewName.RoleInfoPop})\r\n                    }\r\n                }else{\r\n                    CheckRoleInfoView = UIMgr.ins.getView(\"CheckRoleInfoPop\")\r\n                    if(!CheckRoleInfoView){\r\n                        UIMgr.ins.show({viewName: ViewName.CheckRoleInfoPop,data:{\"roleId\":this.headInfo.roleId}})\r\n                    }\r\n                }\r\n            }\r\n          \r\n        }\r\n        else{\r\n            roleInfoView = UIMgr.ins.getView(\"RoleInfoPop\")\r\n            if(!roleInfoView){\r\n                UIMgr.ins.show({viewName: ViewName.RoleInfoPop})\r\n            }\r\n        }\r\n       \r\n    }\r\n     /**\r\n     * 刷新头像信息\r\n     */\r\n     updateHeadInfo(headId:number,headFrameId:number){\r\n        if(headId>=0){\r\n            let itemHeadTab = tab.getData().ItemTableById.getValue(headId);\r\n            if(!itemHeadTab){\r\n                itemHeadTab = tab.getData().ItemTableById.getValue(31201);\r\n            }\r\n            this.headImg.setTexture(itemHeadTab.Icon);\r\n        }\r\n       \r\n        if(headFrameId>=0){\r\n            let itemheadFrameTab = tab.getData().ItemTableById.getValue(headFrameId);\r\n            if(!itemheadFrameTab){\r\n                //默认头像框\r\n                itemheadFrameTab=tab.getData().ItemTableById.getValue(32000);\r\n            }\r\n        \r\n            this.headFrameImg.setTexture(itemheadFrameTab.Icon);\r\n        }\r\n        \r\n       \r\n      \r\n     }\r\n  \r\n}\r\nexport interface HeadInfo {\r\n\t  /** SimpleRole name */\r\n      name?: (string|null);\r\n\r\n      /** SimpleRole headIcon */\r\n      headIcon?: (number|null);\r\n\r\n      /** SimpleRole headFrame */\r\n      headFrame?: (number|null);\r\n\r\n      /** SimpleRole level */\r\n      level?: (number|null);\r\n      roleId?:string;\r\n      roleInfo?:SimpleRoleInfo;\r\n      isTouch?:boolean;\r\n\r\n}\r\n\r\n\r\n\r\n"]}