{"version":3,"sources":["file:///C:/chickenStarClient/client/assets/scripts/logic/model/shop/MallCommodityItem.ts"],"names":["_decorator","Component","Label","Node","Sprite","tab","HeroItem","CommonItem","ItemInfo","proto","HeroInfo","WeaponItem","EquipInfo","EquipmentItem","dailyBuyShop","GameUtil","Net","MallDataMgr","LangMgr","MALLNAME","AdMgr","ccclass","property","MallCommodityItem","mallItemTab","_view_type","MallTab","MallTab_None","_view_name","NONE","_dailyShopIndex","_dailyShopId","_dailyShopData","_CostItemId","_CostItemNum","_GetItemId","_GetItemNum","boughtCount","initData","viewData","view","viewName","createItemByType","setStaticView","node","on","EventType","TOUCH_END","buyItem","isBought","commodityId","ins","playVideoAd","AdType","AdType_BuyDailyShop","msg","Msg_BuyDailyShopCommodityReq","index","Send","Ptl","BuyDailyShopCommodityReq","MallTab_Tab1","LimitCount","console","log","Msg_BuyFixedShopCommodityReq","Id","num","BuyFixedShopCommodityReq","hero_item","parent","active","common_item","equip_item","node_buy","node_ad","node_ordinary","sp_off","node_lock","data","MallTab_Tab2","MallTab_Tab3","MallTab_Tab4","getFixedShopData","get","GetItemIds","GetItemNum","CostItemIds","CostItemNum","setAsyncView","getData","DailyShopItemTableById","getValue","CostItemId","GetItemId","lbl_quota","getChildByName","Advert","DiscountIcon","setTexture","Item","itemId","itemTab","ItemTableById","lbl_item_name","string","getLab","Name","Type","ItemType","ItemType_Hero","createHeroItem","ItemType_Book","createBookItem","ItemType_Currency","ItemType_Material","ItemType_HeroCommonCost","ItemType_LimitTimeItem","ItemType_Elixir","ItemType_Box","ItemType_Piece","ItemType_IdleReward","ItemType_ChoiceBox","createCommonItem","ItemType_Equip","createEquipItem","info","isPiece","HeroTableById","id","star","DefaultStar","UpdateContent","numLab","setPiece","Number","weapon_item","initBookItemId","sp_need_item","Icon","lbl_need_item","convertNumber","RefreshType","str","RefreshType_Daily","RefreshType_Weekly","RefreshType_Monthly","getCombineString","onClickAd"],"mappings":"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","sourcesContent":["import { _decorator, Component, Label, Node, Sprite } from 'cc';\r\nimport { tab } from '../../../Table/table_gen';\r\nimport { HeroItem } from '../item/HeroItem';\r\nimport { CommonItem } from '../item/CommonItem';\r\nimport { ItemInfo } from '../item/ItemInfo';\r\nimport { proto } from 'client_protocol';\r\nimport { ItemPoolMgr } from '../item/ItemPoolMgr';\r\nimport { HeroInfo } from '../hero/HeroInfo';\r\nimport { WeaponItem } from '../common/WeaponItem';\r\nimport { EquipInfo } from '../equip/EquipInfo';\r\nimport { EquipmentItem } from '../item/EquipmentItem';\r\nimport { dailyBuyShop, GameUtil } from '../../utils/GameUtil';\r\nimport { Net } from '../../net/Net';\r\nimport { MallDataMgr } from './MallDataMgr';\r\nimport { LangMgr } from '../../mgr/LangMgr';\r\nimport { MALLNAME } from '../../../Common/script/EnumTypeMgr';\r\nimport { AdMgr } from '../AdMgr';\r\nconst { ccclass, property } = _decorator;\r\n\r\n@ccclass('MallCommodityItem')\r\nexport class MallCommodityItem extends Component {\r\n    @property(HeroItem)\r\n    hero_item: HeroItem = null;\r\n\r\n    @property(CommonItem)\r\n    common_item: CommonItem = null;\r\n\r\n    @property(WeaponItem)\r\n    weapon_item: WeaponItem = null;\r\n\r\n    @property(EquipmentItem)\r\n    equip_item: EquipmentItem = null;\r\n\r\n    @property(Label)\r\n    lbl_quota: Label = null;\r\n    @property(Sprite)\r\n    sp_need_item: Sprite = null;\r\n    @property(Label)\r\n    lbl_need_item: Label = null;\r\n    @property(Node)\r\n    node_buy: Node = null;\r\n    @property(Node)\r\n    node_ordinary:Node = null;\r\n    @property(Node)\r\n    node_ad:Node = null;\r\n    @property(Label)\r\n    lbl_item_name:Label = null;\r\n    @property(Sprite)\r\n    sp_off:Sprite = null;\r\n    @property(Node)\r\n    node_lock:Node = null;\r\n\r\n    private mallItemTab: any = null;\r\n    private _view_type: tab.MallTab = tab.MallTab.MallTab_None;\r\n    private _view_name: MALLNAME = MALLNAME.NONE;\r\n    private _dailyShopIndex: number = 0;\r\n    private _dailyShopId: number = 0;\r\n    private _dailyShopData: tab.DailyShopItemTable = null;\r\n    private _CostItemId: number = 0;\r\n    private _CostItemNum: number = 0;\r\n    private _GetItemId: number = 0;\r\n    private _GetItemNum: number = 0;\r\n    private boughtCount: number = 0;\r\n    initData(viewData, view: tab.MallTab, viewName: MALLNAME) {\r\n        //   根据商品id设置item\r\n        this._view_name = viewName;\r\n        this.mallItemTab = viewData;\r\n        this._view_type = view;\r\n        this.createItemByType();\r\n        this.setStaticView();\r\n        this.node.on(Node.EventType.TOUCH_END, this.buyItem, this);\r\n    }\r\n    buyItem() {\r\n        // 购买道具\r\n        if(this.mallItemTab.isBought){\r\n            return;\r\n        }\r\n        if(this.mallItemTab.commodityId&&this.mallItemTab.commodityId===1000){\r\n            // 广告看\r\n\r\n            AdMgr.ins.playVideoAd(tab.AdType.AdType_BuyDailyShop, () => {\r\n                let msg = new proto.Msg_BuyDailyShopCommodityReq();\r\n                msg.index = this._dailyShopIndex;\r\n                Net.Send(proto.Ptl.BuyDailyShopCommodityReq, msg);\r\n            }, false)\r\n        }else{\r\n            dailyBuyShop(this._CostItemId, this._CostItemNum, this._GetItemId, \"Tips_common_buy\", () => {\r\n                // 发送购买信息\r\n                if (this._view_type === tab.MallTab.MallTab_Tab1) {\r\n                    // 如果是每日商店\r\n                    let msg = new proto.Msg_BuyDailyShopCommodityReq();\r\n                    msg.index = this._dailyShopIndex;\r\n                    Net.Send(proto.Ptl.BuyDailyShopCommodityReq, msg);\r\n                } else {\r\n                    // 发送购买固定商品\r\n                    if (this.boughtCount >= this.mallItemTab.LimitCount) {\r\n                        console.log(\"没有次数了\")\r\n                    } else {\r\n                        let msg = new proto.Msg_BuyFixedShopCommodityReq();\r\n                        msg.commodityId = this.mallItemTab.Id;\r\n                        msg.num = 1;\r\n                        Net.Send(proto.Ptl.BuyFixedShopCommodityReq, msg);\r\n                    }\r\n                }\r\n            })\r\n        }\r\n    }\r\n    // 根据类型创建不同的item\r\n    createItemByType() {\r\n        this.hero_item.node.parent.active = false;\r\n        this.common_item.node.parent.active = false;\r\n        this.equip_item.node.parent.active = false;\r\n        this.node_buy.active = false;\r\n        this.node_ad.active = false;\r\n        this.node_ordinary.active = true;\r\n        this.sp_off.node.parent.active = false;\r\n        this.node_lock.active = false;\r\n        // 判断当前是商品还是道具\r\n        let data = null;\r\n        if (this._view_type === tab.MallTab.MallTab_Tab2 || this._view_type === tab.MallTab.MallTab_Tab3 || this._view_type === tab.MallTab.MallTab_Tab4) {\r\n            this.boughtCount = MallDataMgr.ins.getFixedShopData(this._view_name).get(this.mallItemTab.Id);\r\n            this._GetItemId = this.mallItemTab.GetItemIds[0];\r\n            this._GetItemNum = this.mallItemTab.GetItemNum[0];\r\n            this._CostItemId = this.mallItemTab.CostItemIds[0];\r\n            this._CostItemNum = this.mallItemTab.CostItemNum[0];\r\n            this.node_buy.active = this.mallItemTab.LimitCount==this.boughtCount;\r\n            this.node_ordinary.active = !this.node_buy.active;\r\n            this.setAsyncView();\r\n        } else if (this._view_type === tab.MallTab.MallTab_Tab1) {\r\n            this._dailyShopIndex = this.mallItemTab.index;\r\n            this._dailyShopId = this.mallItemTab.commodityId;\r\n            this._dailyShopData = tab.getData().DailyShopItemTableById.getValue(this._dailyShopId);\r\n            this._CostItemId = this._dailyShopData.CostItemId;\r\n            this._CostItemNum = this._dailyShopData.CostItemNum;\r\n            this._GetItemId = this._dailyShopData.GetItemId;\r\n            this._GetItemNum = this._dailyShopData.GetItemNum;\r\n            this.lbl_quota.node.active = false;\r\n            this.node_buy.active = this.mallItemTab.isBought;\r\n            this.node_ordinary.active = !this.mallItemTab.isBought;\r\n            this.node.getChildByName(\"ordinary_node\").active = !(this._dailyShopData.Advert==tab.AdType.AdType_BuyDailyShop);\r\n            if(this._dailyShopData.Advert==tab.AdType.AdType_BuyDailyShop&&!this.mallItemTab.isBought){\r\n                // 每日商店广告\r\n                this.node_ad.active = true;\r\n                this.node_ordinary.active = false;\r\n            }\r\n            // 是否有折扣图标 有的话显示折扣信息\r\n            if(this._dailyShopData.DiscountIcon){\r\n                this.sp_off.node.parent.active = true;\r\n                this.sp_off.setTexture(this._dailyShopData.DiscountIcon);\r\n            }\r\n        }\r\n        data = new proto.Item();\r\n        data.itemId = this._GetItemId;\r\n        data.num = this._GetItemNum;\r\n\r\n        const itemTab = tab.getData().ItemTableById.getValue(data.itemId);\r\n        this.lbl_item_name.string = LangMgr.getLab(itemTab.Name);\r\n        const Type = itemTab.Type;\r\n        switch (Type) {\r\n            case tab.ItemType.ItemType_Hero:\r\n                this.createHeroItem(data)\r\n                break;\r\n            case tab.ItemType.ItemType_Book:\r\n                this.createBookItem(data)\r\n                break;\r\n            case tab.ItemType.ItemType_Currency:\r\n            case tab.ItemType.ItemType_Material:\r\n            case tab.ItemType.ItemType_HeroCommonCost:\r\n            case tab.ItemType.ItemType_LimitTimeItem:\r\n            case tab.ItemType.ItemType_Elixir:\r\n            case tab.ItemType.ItemType_Box:\r\n            case tab.ItemType.ItemType_Piece:\r\n            case tab.ItemType.ItemType_IdleReward:\r\n            case tab.ItemType.ItemType_ChoiceBox:\r\n                if (itemTab.Id > 6100 && itemTab.Id < 9000) {\r\n                    data.itemId = itemTab.Id - 4000\r\n                    this.createHeroItem(data, true);\r\n                } else {\r\n                    this.createCommonItem(data);\r\n                }\r\n                break;\r\n            case tab.ItemType.ItemType_Equip:\r\n                this.createEquipItem(data)\r\n                break;\r\n            default:\r\n                break;\r\n        }\r\n    }\r\n    // 创建普通item\r\n    createCommonItem(data: proto.Item) {\r\n        this.common_item.node.parent.active = true;\r\n        const info = new ItemInfo();\r\n        info.itemId = data.itemId;\r\n        info.num = data.num;\r\n        this.common_item.initData(info)\r\n    }\r\n    // 创建英雄item\r\n    createHeroItem(data: proto.Item, isPiece: boolean = false) {\r\n        this.hero_item.node.parent.active = true;\r\n        const info = new HeroInfo();\r\n        info.itemId = data.itemId;\r\n        const itemTab = tab.getData().HeroTableById.getValue(data.itemId)\r\n        info.id = 0;\r\n        info.star = itemTab.DefaultStar;\r\n        this.hero_item.UpdateContent(info);\r\n        this.hero_item.numLab.node.active = false;\r\n        if (isPiece) {\r\n            this.hero_item.setPiece(Number(data.num));\r\n        }\r\n    }\r\n    // 创建秘籍\r\n    createBookItem(data: proto.Item) {\r\n        this.weapon_item.initBookItemId(data.itemId)\r\n    }\r\n    // 创建装备\r\n    createEquipItem(data: proto.Item) {\r\n        this.equip_item.node.parent.active = true;;\r\n        const info = new EquipInfo();\r\n        info.itemId = data.itemId;\r\n        this.equip_item.initData(info);\r\n        // this.equip_item.setTouchCallBack(() => {\r\n\r\n        // })\r\n    }\r\n    // 设置不会变化的节点\r\n    setStaticView() {\r\n        if(this._CostItemId){\r\n            const itemTab = tab.getData().ItemTableById.getValue(this._CostItemId);\r\n            this.sp_need_item.setTexture(itemTab.Icon);\r\n            this.lbl_need_item.string =GameUtil.convertNumber(this._CostItemNum,true);\r\n        }\r\n    }\r\n    // 设置可以变化的节点\r\n    setAsyncView() {\r\n        // 限购次数\r\n        this.lbl_quota.node.active = true;\r\n        const RefreshType = this.mallItemTab.RefreshType;\r\n        let str = \"\"\r\n        if (RefreshType === tab.RefreshType.RefreshType_Daily) {\r\n            //str = \"每日\"\r\n            str = LangMgr.getLab(\"ui_mall_9\")\r\n        } else if (RefreshType === tab.RefreshType.RefreshType_Weekly) {\r\n            //str = \"每周\"\r\n            str = LangMgr.getLab(\"ui_mall_10\")\r\n        } else if (RefreshType === tab.RefreshType.RefreshType_Monthly) {\r\n            //str = \"每月\"\r\n            str = LangMgr.getLab(\"ui_mall_11\")\r\n        }\r\n        //this.lbl_quota.string = str + \"限購：\" + (this.mallItemTab.LimitCount - this.boughtCount) + \"/\" + this.mallItemTab.LimitCount;\r\n        this.lbl_quota.string = LangMgr.getCombineString(\"ui_commondesc_108\", [str]) + (this.mallItemTab.LimitCount - this.boughtCount) + \"/\" + this.mallItemTab.LimitCount;\r\n    }\r\n    // 点击看广告\r\n    onClickAd(){\r\n        console.log(`cocos 点击观看广告`);\r\n    }\r\n}\r\n\r\n\r\n"]}