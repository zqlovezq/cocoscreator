{"version":3,"sources":["file:///C:/chickenStarClient/client/assets/scripts/logic/fight/FightRootView.ts"],"names":["_decorator","Game","game","Layers","Node","Sprite","UITransform","Vec3","ViewScreen","PlayerControl","FightEvent","EventMgr","tab","DropItem","EffectUI","MathAngle","DeadEffectUI","HoldTimeEffectUI","RoguePop","DropControl","FightRenderSort","FightData","LocalEvent","BattleMainDataControl","FightRootControl","ccclass","property","tempPos","FightRootView","touchID","clickCount","clickTime","onLoad","ins","isPvp","mapSpr","node","scale","ONE","setTexture","stageTab","Background","getLastStageId","getData","GetKeyValue_ConfigTable","TapTipsTimes","schedule","resetClickCount","register","console","log","registerTouch","onFight","Fight_Drop_Item","onFight_Drop_Item","Fight_Drop_Item_Anim","onFight_Drop_Item_Anim","Fight_Drop_Remove_First","onFight_Drop_Remove_First","Hit_Effect_Add","onHit_Effect_Add","buff_link","onBuff_link","Sort_AbsRole","onSort_AbsRole","add_DeadEffect","onadd_DeadEffect","remove_DeadEffect","onremove_DeadEffect","Create_HoldTime_Effect","onCreate_HoldTime_Effect","Effect_Add_To_Layer","onEffect_Add_To_Layer","addNode","nn","objects","addChild","getBullet","isBelow","roleDown","bullets","touchNode","on","EventType","TOUCH_START","touchStart","TOUCH_MOVE","touchMove","TOUCH_END","touchEnd","TOUCH_CANCEL","touchCancel","EVENT_HIDE","cancelTouch","EVENT_SHOW","dt","timeScale","getUIView","showTapTipsTimes","event","getID","innerPosition","getUILocation","isClicking","uiPos","setClickWorldPos","x","y","getRolePosByIndex","index","rolePosNode","children","position","dropItemId","dropItem","create","dropNode","setDropItemId","setPos","stageId","emitLocal","JadeDrop","JadeDropFinger","audoDropCollect","length","scheduleOnce","animId","parent","dropAnimNode","set","ZERO","run","getComponent","remove","hitEffect","startPos","targetPos","hitType","hitAnimId","bulletHitEffect","angle","posToAngle","lengthSqr","distance","avatar","fpsAvatar","spr","sizeMode","SizeMode","CUSTOM","width","abs","getHitPos","setAbs","setAnimIds","Deatheffect","list","getComponentsInChildren","i","setAbsPvp","roles","linkNode","destroyAllChildren","now","next","uitrans","addComponent","layer","Enum","DEFAULT","anchorX","type","Type","TILED","height","sort","getRendderCout","total","rootNode","v","layerType"],"mappings":"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","sourcesContent":["import { _decorator, Component, EventTouch, Game, game, input, Input, Layers, math, Node, Size, Sprite, SpriteFrame, Toggle, Tween, tween, UITransform, v2, v3, Vec2, Vec3, view } from 'cc';\nimport { ViewScreen } from '../../framework/base/ViewScreen';\nimport { PlayerControl } from './base/obj/role/role/PlayerControl';\nimport { FightEvent } from './define/FightEvent';\nimport { EventMgr } from '../mgr/EventMgr';\nimport { tab } from '../../Table/table_gen';\nimport { DropItem } from './drop/DropItem';\nimport { EffectUI } from './base/effect/EffectUI';\nimport { AbsRole } from './base/obj/role/AbsRole';\nimport { MathAngle, Vector2 } from '../../framework/collision/Maths';\nimport { Func } from '../utils/Func';\nimport { DeadEffectUI } from './base/effect/DeadEffectUI';\nimport { HoldTimeEffectUI } from './base/effect/HoldTimeEffectUI';\nimport { Role } from './base/obj/role/role/Role';\nimport { RoguePop } from './view/rogue/RoguePop';\nimport { DropControl } from './drop/DropControl';\nimport { FrameControl } from './base/frame/FrameControl';\nimport { AbsObjType } from './base/obj/AbsObj';\nimport { FightRenderSort } from './define/FightRenderSort';\nimport { FightData } from './data/FightData';\nimport { GuideController } from '../guide/GuideController';\nimport { LocalEvent } from '../define/LocalEvent';\nimport { BattleMainDataControl } from '../model/home/battle/BattleMainDataControl';\nimport { FightRootControl } from './FightRootControl';\nimport { FightMacro } from './define/FightDefine';\nimport { PvpRole } from './pvp/obj/PvpRole';\nconst { ccclass, property } = _decorator;\nconst tempPos = new Vec3()\n@ccclass('FightRootView')\nexport class FightRootView extends ViewScreen {\n    @property(Node)\n    camera: Node = null; //跟随相机\n\n    @property(Node)\n    rootNode: Node = null\n\n    @property(Sprite)\n    mapSpr: Sprite = null\n\n    @property(Node)\n    linkNode: Node = null\n\n    @property(Node)\n    dropNode: Node = null; //掉落\n\n    @property(Node)\n    rolePosNode: Node = null\n\n    @property(Node)\n    objects: Node = null; //enemy 显示挂载点\n\n    @property(Node)\n    bulletHitEffect: Node = null; //子弹击中特效\n\n\n    @property(Node)\n    bullets: Node = null; //bullet 显示挂载点\n\n    @property(Node) //英雄下层\n    roleDown: Node = null\n\n    @property(Node)//英雄上层\n    roleUp: Node = null\n\n    @property(Node)\n    damages: Node = null; //伤害\n\n    @property(Node)\n    touchNode: Node = null; //伤害\n    @property(Node)\n    dropAnimNode: Node = null; //掉落动画\n    @property(Node)\n    drawLine: Node = null; //伤害\n\n\n    public touchID: number = -1;\n    private clickCount: number = 0;\n    private clickTime: number = 0;\n\n    protected onLoad(): void {\n        super.onLoad()\n        if (FightData.ins.isPvp) {\n            this.mapSpr.node.scale = Vec3.ONE\n        }\n        this.mapSpr.setTexture(FightData.ins.stageTab.Background)\n\n        if (FightData.ins.isPvp) {\n            return\n        }\n        this.clickCount = 0;\n        if (BattleMainDataControl.ins.getLastStageId() <= tab.getData().GetKeyValue_ConfigTable().TapTipsTimes[0]) {\n            this.schedule(this.resetClickCount);\n        }\n    }\n\n    register(): void {\n        console.log(\"注册消息------\")\n        this.registerTouch()\n        EventMgr.onFight(FightEvent.Fight_Drop_Item, this.onFight_Drop_Item, this)\n        EventMgr.onFight(FightEvent.Fight_Drop_Item_Anim, this.onFight_Drop_Item_Anim, this)\n\n        EventMgr.onFight(FightEvent.Fight_Drop_Remove_First, this.onFight_Drop_Remove_First, this)\n        EventMgr.onFight(FightEvent.Hit_Effect_Add, this.onHit_Effect_Add, this)\n        EventMgr.onFight(FightEvent.buff_link, this.onBuff_link, this)\n        EventMgr.onFight(FightEvent.Sort_AbsRole, this.onSort_AbsRole, this)\n        EventMgr.onFight(FightEvent.add_DeadEffect, this.onadd_DeadEffect, this)\n        EventMgr.onFight(FightEvent.remove_DeadEffect, this.onremove_DeadEffect, this)\n        EventMgr.onFight(FightEvent.Create_HoldTime_Effect, this.onCreate_HoldTime_Effect, this)\n        EventMgr.onFight(FightEvent.Effect_Add_To_Layer, this.onEffect_Add_To_Layer, this)\n\n\n    }\n\n    addNode(nn: Node) {\n        this.objects.addChild(nn);\n    }\n\n    getBullet(isBelow: boolean) {\n        if (isBelow) {\n            return this.roleDown\n        }\n        return this.bullets\n    }\n\n\n    registerTouch() {\n        // input.on(Input.EventType.TOUCH_START, this.touchStart, this);\n        // input.on(Input.EventType.TOUCH_MOVE, this.touchMove, this);\n        // input.on(Input.EventType.TOUCH_END, this.touchEnd, this);\n        // input.on(Input.EventType.TOUCH_CANCEL, this.touchEnd, this);\n\n        this.touchNode.on(Node.EventType.TOUCH_START, this.touchStart, this);\n        this.touchNode.on(Node.EventType.TOUCH_MOVE, this.touchMove, this);\n        this.touchNode.on(Node.EventType.TOUCH_END, this.touchEnd, this);\n        this.touchNode.on(Node.EventType.TOUCH_CANCEL, this.touchCancel, this);\n\n        game.on(Game.EVENT_HIDE, () => {\n            console.log(\"进入后台\")\n            this.cancelTouch()\n        })\n\n        game.on(Game.EVENT_SHOW, () => {\n            console.log(\"进入前台\")\n            this.cancelTouch()\n        })\n\n    }\n    resetClickCount(dt: number) {\n        this.clickTime += (dt / FightData.ins.timeScale);\n        if (this.clickTime >= 1) {\n            if (this.clickCount >= tab.getData().GetKeyValue_ConfigTable().TapTipsTimes[1]) {\n                // 显示提示tips\n                FightRootControl.ins.getUIView().showTapTipsTimes();\n            }\n            this.clickCount = 0;\n            this.clickTime = 0;\n        }\n    }\n    touchStart(event: EventTouch) {\n        if (this.touchID == -1) {\n            this.touchID = event.getID();\n        }\n\n        if (this.touchID != event.getID()) return false;\n        this.clickCount++;\n        this.innerPosition(event.getUILocation())\n\n        return true;\n    }\n\n    touchMove(event: EventTouch) {\n        if (this.touchID != event.getID()) return false;\n\n        this.innerPosition(event.getUILocation())\n\n        return true;\n    }\n\n    touchEnd(event: EventTouch) {\n        if (this.touchID != event.getID()) return false;\n        // this.innerPosition(event.getUILocation())\n        this.cancelTouch()\n        return true;\n    }\n\n    touchCancel(event: EventTouch) {\n        if (this.touchID != event.getID()) return false;\n        // this.innerPosition(event.getUILocation())\n        this.cancelTouch()\n        return true;\n    }\n\n    cancelTouch() {\n        this.touchID = -1;\n        PlayerControl.ins.isClicking(false)\n    }\n\n    innerPosition(uiPos: Vec2) {\n        // let clickPos = v3(uiPos.x, uiPos.y, 0)\n        PlayerControl.ins.setClickWorldPos(uiPos.x, uiPos.y)\n    }\n\n    getRolePosByIndex(index: number) {\n        return this.rolePosNode.children[index - 1].position;\n    }\n\n    //----------------回调---------------\n\n    /** 普通掉落 */\n    onFight_Drop_Item(dropItemId: number, position: Vec3) {\n\n        let dropItem = DropItem.create()\n        this.dropNode.addChild(dropItem.node)\n        dropItem.setDropItemId(dropItemId)\n\n        dropItem.setPos(position)\n        if (FightData.ins.stageId === 1) {\n            EventMgr.emitLocal(LocalEvent.JadeDrop);\n            EventMgr.emitLocal(LocalEvent.JadeDropFinger)\n        }\n        if (DropControl.ins.audoDropCollect && this.dropNode.children.length == 1) {\n            this.scheduleOnce(() => {\n                RoguePop.create()\n            }, 0.8)\n        }\n    }\n\n    /** 普通掉落动画 */\n    onFight_Drop_Item_Anim(animId: number, position: Vec3) {\n        let nn = EffectUI.create()\n        nn.node.parent = this.dropAnimNode\n        nn.node.position = position || tempPos.set(Vec3.ZERO)\n        nn.run(animId)\n    }\n\n    onFight_Drop_Remove_First() {\n        if (this.dropNode.children.length) {\n            (this.dropNode.children[0].getComponent(DropItem)).remove()\n        }\n    }\n\n    onHit_Effect_Add(hitEffect: number[], startPos: Vec3, targetPos: Vec3) {\n        for (let index = 0; index < hitEffect.length; index++) {\n            let hitType = hitEffect[index];\n            let hitAnimId = hitEffect[index + 1];\n            let nn = EffectUI.create()\n            nn.node.parent = this.bulletHitEffect\n            if (hitType == 1) {\n                nn.node.position = targetPos || tempPos.set(Vec3.ZERO)\n                nn.run(hitAnimId)\n            } else if (hitType == 2) {\n                tempPos.x = (startPos.x + targetPos.x) / 2;\n                tempPos.y = (startPos.y + targetPos.y) / 2;\n                nn.node.position = tempPos\n                nn.node.angle = MathAngle.posToAngle(startPos, targetPos)\n\n                let lengthSqr = Vec3.distance(startPos, targetPos)\n                nn.run(hitAnimId)\n                if (nn.avatar && nn.avatar.fpsAvatar) {\n                    nn.avatar.fpsAvatar.spr.sizeMode = Sprite.SizeMode.CUSTOM\n                    nn.avatar.fpsAvatar.spr.getComponent(UITransform).width = lengthSqr\n                }\n            }\n            index++\n        }\n\n    }\n\n    onadd_DeadEffect(abs: AbsRole) {\n        let nn = DeadEffectUI.create()\n        nn.node.parent = this.bulletHitEffect\n        nn.node.position = abs ? abs.getHitPos() : tempPos.set(Vec3.ZERO)\n        nn.setAbs(abs)\n        nn.setAnimIds(tab.getData().GetKeyValue_ConfigTable().Deatheffect)\n    }\n\n    onremove_DeadEffect(abs: AbsRole) {\n        let list = this.bulletHitEffect.getComponentsInChildren(DeadEffectUI)\n        for (let i = 0; i < list.length; i++) {\n            let nn = list[i]\n            if (nn.abs == abs) {\n                nn.remove()\n            }\n        }\n    }\n    onCreate_HoldTime_Effect(abs: Role | PvpRole) {\n        let nn = HoldTimeEffectUI.create()\n        nn.node.parent = this.bulletHitEffect\n        if (FightData.ins.isPvp) {\n            nn.setAbsPvp(abs as PvpRole)\n            return\n        }\n        this.scheduleOnce(() => {\n            nn.setAbs(abs as Role)\n        }, 0.1)\n    }\n\n    //buff伤害链接\n    onBuff_link(roles: AbsRole[]) {\n        this.linkNode.destroyAllChildren()\n\n        for (let i = 0; i < roles.length; i++) {\n            let now = roles[i]\n            let next = roles[i + 1]\n            if (next) {\n                let nn = new Node(\"link\")\n                let uitrans = nn.addComponent(UITransform)\n                nn.layer = Layers.Enum.DEFAULT\n                nn.parent = this.linkNode\n                uitrans.anchorX = 0\n\n                let spr = nn.addComponent(Sprite)\n                spr.setTexture(\"spine/bullet/boss_chain_1\")\n                spr.sizeMode = Sprite.SizeMode.CUSTOM\n                spr.type = Sprite.Type.TILED\n\n                nn.position = now.getHitPos()\n\n                nn.angle = MathAngle.posToAngle(nn.position, next.getHitPos())\n\n                uitrans.width = Vec3.distance(nn.position, next.getHitPos())\n                uitrans.height = 32\n            }\n        }\n    }\n\n    onSort_AbsRole() {\n        FightRenderSort.sort(this.objects, this.bullets)\n    }\n\n    getRendderCout() {\n        let total = 0\n        for (let index = 0; index < this.rootNode.children.length; index++) {\n            const v = this.rootNode.children[index];\n            total += v.children.length\n        }\n        return total - 5\n    }\n\n    onEffect_Add_To_Layer(layerType: string, nn: Node) {\n        switch (layerType) {\n            case \"shadow\":\n                this.roleDown.addChild(nn)\n                break;\n            default:\n                break;\n        }\n    }\n}\n\n"]}