{"version":3,"sources":["file:///C:/chickenStarClient/client/assets/scripts/logic/model/hero/herobag/HeroResonancePop.ts"],"names":["_decorator","instantiate","Label","Node","Prefab","ViewPop","ItemPoolMgr","HeroItem","HeroTeamControl","HeroData","HeroStar","HeroAttrItem","tab","proto","Net","RedMgr","RedDotType","EventMgr","LangMgr","ccclass","property","VIEW_TYPE","HeroResonancePop","_view_type","LEVEL","register","onMsg","Ptl","UpLevelResonanceRsp","on_s2c_UpLevelResonanceRsp","UpStarResonanceRsp","on_s2c_UpStarResonanceRsp","msg","error","code","CommonErrorCode","Succeed","ins","setTeamResonanceLevel","levelResonance","refreshEvent","HeroResonanceLevel","switchView","String","setTeamResonanceStar","starResonance","HeroresonanceStar","onShow","e","type","view_type","Number","node_level","active","node_star","STAR","parentNode","node_heros","i","node","children","heroClass","name","teamSlot","getClassTeamData","heroInfo","getById","heroId","createItem","HeroStar_cur_resonance_star","showStar","getMinTeamStar","startab","getResonanceStarTab","NeedStar","HeroStar_next_resonance_star","node_red_level","isRed","node_red_star","showLevelView","node_red_btn","showStarView","node_lv_up_btn","Leveltab","getResonanceLevelTab","NeedLv","lbl_resonance_value_next","node_no_attr","Id","node_attr_layout","AttrTypes","length","value","AttrValue","pfb_attr_item","parent","ts","getComponent","initView","lbl_resonance_level","string","getCombineString","getMinTeamLevel","lbl_resonance_value","nextLeveltab","getData","HeroLevelResonanceTable","node_star_resonace_layout","isLevel","item","createHeroItem","UpdateContent","setHeroActive","clickUp","Msg_UpLevelResonanceReq","Send","UpLevelResonanceReq","Msg_UpStarResonanceReq","UpStarResonanceReq","onDisable"],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAOSA,MAAAA,U,OAAAA,U;AAAmCC,MAAAA,W,OAAAA,W;AAAaC,MAAAA,K,OAAAA,K;AAAOC,MAAAA,I,OAAAA,I;AAAMC,MAAAA,M,OAAAA,M;;AAC7DC,MAAAA,O,iBAAAA,O;;AAEAC,MAAAA,W,iBAAAA,W;;AACAC,MAAAA,Q,iBAAAA,Q;;AACAC,MAAAA,e,iBAAAA,e;;AACAC,MAAAA,Q,iBAAAA,Q;;AACAC,MAAAA,Q,iBAAAA,Q;;AACAC,MAAAA,Y,iBAAAA,Y;;AACAC,MAAAA,G,iBAAAA,G;;AACAC,MAAAA,K,oBAAAA,K;;AACAC,MAAAA,G,kBAAAA,G;;AACAC,MAAAA,M,kBAAAA,M;;AACAC,MAAAA,U,kBAAAA,U;;AACAC,MAAAA,Q,kBAAAA,Q;;AACAC,MAAAA,O,kBAAAA,O;;;;;;AAtBT;AACA;AACA;AACA;AACA;AACA;;;;;OAkBM;AAAEC,QAAAA,OAAF;AAAWC,QAAAA;AAAX,O,GAAwBpB,U;;AACzBqB,MAAAA,S,0BAAAA,S;AAAAA,QAAAA,S,CAAAA,S;AAAAA,QAAAA,S,CAAAA,S;eAAAA,S;QAAAA,S;;kCAKQC,gB,WADZH,OAAO,CAAC,kBAAD,C,UAEHC,QAAQ,CAACjB,IAAD,C,UAERiB,QAAQ,CAACjB,IAAD,C,UAERiB,QAAQ,CAACjB,IAAD,C,UAERiB,QAAQ,CAACjB,IAAD,C,UAERiB,QAAQ,CAACjB,IAAD,C,UAERiB,QAAQ,CAACjB,IAAD,C,UAERiB,QAAQ,CAACjB,IAAD,C,UAERiB,QAAQ,CAACjB,IAAD,C,WAGRiB,QAAQ,CAAClB,KAAD,C,WAGRkB,QAAQ,CAAClB,KAAD,C,WAERkB,QAAQ,CAAClB,KAAD,C,WAGRkB,QAAQ,CAAChB,MAAD,C,WAERgB,QAAQ,CAACjB,IAAD,C,WAERiB,QAAQ,CAACjB,IAAD,C,WAGRiB,QAAQ;AAAA;AAAA,+B,WAERA,QAAQ;AAAA;AAAA,+B,2BApCb,MACaE,gBADb;AAAA;AAAA,8BAC8C;AAAA;AAAA;;AAAA;;AAAA;;AAAA;;AAAA;;AAAA;;AAAA;;AAAA;;AAAA;;AAAA;;AAAA;;AAsBR;AAtBQ;;AAwBH;AAxBG;;AAAA;;AAAA;;AAAA;;AAAA;;AAAA,eAsClCC,UAtCkC,GAsCVF,SAAS,CAACG,KAtCA;AAAA;;AAuC1CC,QAAAA,QAAQ,GAAS;AACb;AAAA;AAAA,oCAASC,KAAT,CAAe;AAAA;AAAA,8BAAMC,GAAN,CAAUC,mBAAzB,EAA8C,KAAKC,0BAAnD,EAA+E,IAA/E;AACA;AAAA;AAAA,oCAASH,KAAT,CAAe;AAAA;AAAA,8BAAMC,GAAN,CAAUG,kBAAzB,EAA6C,KAAKC,yBAAlD,EAA6E,IAA7E;AACH;AAED;;;AACAF,QAAAA,0BAA0B,CAACG,GAAD,EAAqC;AAC3D,cAAIA,GAAG,CAACC,KAAJ,IAAaD,GAAG,CAACC,KAAJ,CAAUC,IAAV,IAAkB;AAAA;AAAA,8BAAMC,eAAN,CAAsBC,OAAzD,EAAkE;AAClE;AAAA;AAAA,kDAAgBC,GAAhB,CAAoBC,qBAApB,CAA0CN,GAAG,CAACO,cAA9C;AACA;;AACA;AAAA;AAAA,gCAAOC,YAAP,CAAoB;AAAA;AAAA,wCAAWC,kBAA/B;AACA,eAAKC,UAAL,CAAgB,IAAhB,EAAsBC,MAAM,CAAC,KAAKpB,UAAN,CAA5B;AACH;AACD;;;AACAQ,QAAAA,yBAAyB,CAACC,GAAD,EAAoC;AACzD,cAAIA,GAAG,CAACC,KAAJ,IAAaD,GAAG,CAACC,KAAJ,CAAUC,IAAV,IAAkB;AAAA;AAAA,8BAAMC,eAAN,CAAsBC,OAAzD,EAAkE;AAClE;AAAA;AAAA,kDAAgBC,GAAhB,CAAoBO,oBAApB,CAAyCZ,GAAG,CAACa,aAA7C;AACA;;AACA;AAAA;AAAA,gCAAOL,YAAP,CAAoB;AAAA;AAAA,wCAAWM,iBAA/B;AACA,eAAKJ,UAAL,CAAgB,IAAhB,EAAsBC,MAAM,CAAC,KAAKpB,UAAN,CAA5B;AACH;;AACDwB,QAAAA,MAAM,GAAS;AACX,eAAKxB,UAAL,GAAkBF,SAAS,CAACG,KAA5B;AACA;;AACA,eAAKkB,UAAL,CAAgB,IAAhB,EAAsBC,MAAM,CAAC,KAAKpB,UAAN,CAA5B;AACH;;AACDmB,QAAAA,UAAU,CAACM,CAAD,EAAgBC,IAAhB,EAA8B;AACpC,cAAIC,SAAS,GAAGC,MAAM,CAACF,IAAD,CAAtB;AACA,eAAK1B,UAAL,GAAkB2B,SAAlB;AACA,eAAKE,UAAL,CAAgBC,MAAhB,GAAyBH,SAAS,KAAK7B,SAAS,CAACG,KAAjD;AACA,eAAK8B,SAAL,CAAeD,MAAf,GAAwBH,SAAS,KAAK7B,SAAS,CAACkC,IAAhD;AACA,cAAIC,UAAU,GAAG,KAAKC,UAAtB;;AACA,eAAK,IAAIC,CAAC,GAAG,CAAb,EAAgBA,CAAC,GAAG,CAApB,EAAuBA,CAAC,EAAxB,EAA4B;AACxB,gBAAIC,IAAI,GAAGH,UAAU,CAACI,QAAX,CAAoBF,CAApB,CAAX;AACA,gBAAIG,SAAS,GAAGV,MAAM,CAACQ,IAAI,CAACG,IAAN,CAAtB;AACA,gBAAIC,QAAyB,GAAG;AAAA;AAAA,oDAAgB1B,GAAhB,CAAoB2B,gBAApB,CAAqCH,SAArC,CAAhC;AACA,gBAAII,QAAQ,GAAG;AAAA;AAAA,sCAAS5B,GAAT,CAAa6B,OAAb,CAAqBH,QAAQ,CAACI,MAA9B,CAAf;AACA,iBAAKC,UAAL,CAAgBH,QAAhB,EAA0BT,UAAU,CAACI,QAAX,CAAoBF,CAApB,CAA1B,EAAkDR,SAAS,IAAI7B,SAAS,CAACG,KAAzE;AACH;;AACD,eAAK6C,2BAAL,CAAiCC,QAAjC,CAA0C;AAAA;AAAA,kDAAgBjC,GAAhB,CAAoBkC,cAApB,EAA1C;AACA,cAAIC,OAAO,GAAG;AAAA;AAAA,kDAAgBnC,GAAhB,CAAoBoC,mBAApB,EAAd;;AACA,cAAGD,OAAO,CAACE,QAAX,EAAoB;AAChB,iBAAKC,4BAAL,CAAkCL,QAAlC,CAA2CE,OAAO,CAACE,QAAnD;AACH;;AACD,eAAKE,cAAL,CAAoBvB,MAApB,GAA6B;AAAA;AAAA,gCAAOhB,GAAP,CAAWwC,KAAX,CAAiB;AAAA;AAAA,wCAAWpC,kBAA5B,CAA7B;AACA,eAAKqC,aAAL,CAAmBzB,MAAnB,GAA4B;AAAA;AAAA,gCAAOhB,GAAP,CAAWwC,KAAX,CAAiB;AAAA;AAAA,wCAAW/B,iBAA5B,CAA5B;;AACA,cAAII,SAAS,IAAI7B,SAAS,CAACG,KAA3B,EAAkC;AAC9B,iBAAKuD,aAAL;AACA,iBAAKC,YAAL,CAAkB3B,MAAlB,GAA2B;AAAA;AAAA,kCAAOhB,GAAP,CAAWwC,KAAX,CAAiB;AAAA;AAAA,0CAAWpC,kBAA5B,CAA3B;AACH,WAHD,MAGO;AACH,iBAAKwC,YAAL;AACA,iBAAKD,YAAL,CAAkB3B,MAAlB,GAA2B;AAAA;AAAA,kCAAOhB,GAAP,CAAWwC,KAAX,CAAiB;AAAA;AAAA,0CAAW/B,iBAA5B,CAA3B;AACH;AACJ;;AACDiC,QAAAA,aAAa,GAAG;AACZ;AACA,eAAKG,cAAL,CAAoB7B,MAApB,GAA6B,IAA7B;AACA,cAAI8B,QAAQ,GAAG;AAAA;AAAA,kDAAgB9C,GAAhB,CAAoB+C,oBAApB,EAAf;;AACA,cAAGD,QAAQ,CAACE,MAAT,KAAkB,CAArB,EAAuB;AACnB,iBAAKH,cAAL,CAAoB7B,MAApB,GAA6B,KAA7B;AACA,iBAAKiC,wBAAL,CAA8B3B,IAA9B,CAAmCN,MAAnC,GAA4C,KAA5C;AACH;;AACD,eAAKkC,YAAL,CAAkBlC,MAAlB,GAA2B8B,QAAQ,CAACK,EAAT,KAAgB,CAA3C;AACA,eAAKC,gBAAL,CAAsBpC,MAAtB,GAA+B8B,QAAQ,CAACK,EAAT,GAAc,CAA7C;;AACA,eAAK,IAAI9B,CAAC,GAAG,CAAb,EAAgBA,CAAC,GAAGyB,QAAQ,CAACO,SAAT,CAAmBC,MAAvC,EAA+CjC,CAAC,EAAhD,EAAoD;AAChD,gBAAIT,IAAI,GAAGkC,QAAQ,CAACO,SAAT,CAAmBhC,CAAnB,CAAX;AACA,gBAAIkC,KAAK,GAAGT,QAAQ,CAACU,SAAT,CAAmBnC,CAAnB,CAAZ;;AACA,gBAAIkC,KAAK,KAAK,CAAd,EAAiB;AACb;AACH;;AACD,gBAAIjC,IAAI,GAAG,KAAK8B,gBAAL,CAAsB7B,QAAtB,CAA+BF,CAA/B,CAAX;;AACA,gBAAI,CAACC,IAAL,EAAW;AACPA,cAAAA,IAAI,GAAG1D,WAAW,CAAC,KAAK6F,aAAN,CAAlB;AACAnC,cAAAA,IAAI,CAACoC,MAAL,GAAc,KAAKN,gBAAnB;AACH;;AACD,gBAAIO,EAAgB,GAAGrC,IAAI,CAACsC,YAAL;AAAA;AAAA,6CAAvB;AACAD,YAAAA,EAAE,CAACE,QAAH,CAAYjD,IAAZ,EAAkB2C,KAAlB;AACH;;AACD,eAAKO,mBAAL,CAAyBC,MAAzB,GAAkC;AAAA;AAAA,kCAAQC,gBAAR,CAAyB,uBAAzB,EAAkD,CAAC;AAAA;AAAA,kDAAgBhE,GAAhB,CAAoBiE,eAApB,EAAD,CAAlD,CAAlC;AACA,eAAKC,mBAAL,CAAyBH,MAAzB,GAAkC;AAAA;AAAA,kCAAQC,gBAAR,CAAyB,uBAAzB,EAAkD,CAAClB,QAAQ,CAACK,EAAV,CAAlD,CAAlC;;AACA,cAAIL,QAAQ,CAACE,MAAb,EAAqB;AACjB,gBAAImB,YAAY,GAAG;AAAA;AAAA,4BAAIC,OAAJ,GAAcC,uBAAd,CAAsCvB,QAAQ,CAACK,EAAT,GAAc,CAApD,CAAnB;AACA,iBAAKF,wBAAL,CAA8Bc,MAA9B,GAAuC;AAAA;AAAA,oCAAQC,gBAAR,CAAyB,uBAAzB,EAAkD,CAAClB,QAAQ,CAACE,MAAV,EAAkBmB,YAAY,CAAChB,EAA/B,CAAlD,CAAvC;AACH;AACJ;;AACDP,QAAAA,YAAY,GAAG;AACX,eAAKC,cAAL,CAAoB7B,MAApB,GAA6B,IAA7B;AACA,cAAImB,OAAO,GAAG;AAAA;AAAA,kDAAgBnC,GAAhB,CAAoBoC,mBAApB,EAAd;;AACA,cAAGD,OAAO,CAACE,QAAR,KAAmB,CAAtB,EAAwB;AACpB,iBAAKQ,cAAL,CAAoB7B,MAApB,GAA6B,KAA7B;AACA,iBAAKsD,yBAAL,CAA+BtD,MAA/B,GAAwC,KAAxC;AACH;;AACD,eAAKkC,YAAL,CAAkBlC,MAAlB,GAA2BmB,OAAO,CAACgB,EAAR,KAAe,CAA1C;AACA,eAAKC,gBAAL,CAAsBpC,MAAtB,GAA+BmB,OAAO,CAACgB,EAAR,GAAa,CAA5C;;AACA,eAAK,IAAI9B,CAAC,GAAG,CAAb,EAAgBA,CAAC,GAAGc,OAAO,CAACkB,SAAR,CAAkBC,MAAtC,EAA8CjC,CAAC,EAA/C,EAAmD;AAC/C,gBAAIT,IAAI,GAAGuB,OAAO,CAACkB,SAAR,CAAkBhC,CAAlB,CAAX;AACA,gBAAIkC,KAAK,GAAGpB,OAAO,CAACqB,SAAR,CAAkBnC,CAAlB,CAAZ;;AACA,gBAAIkC,KAAK,KAAK,CAAd,EAAiB;AACb;AACH;;AACD,gBAAIjC,IAAI,GAAG,KAAK8B,gBAAL,CAAsB7B,QAAtB,CAA+BF,CAA/B,CAAX;;AACA,gBAAI,CAACC,IAAL,EAAW;AACPA,cAAAA,IAAI,GAAG1D,WAAW,CAAC,KAAK6F,aAAN,CAAlB;AACAnC,cAAAA,IAAI,CAACoC,MAAL,GAAc,KAAKN,gBAAnB;AACH;;AACD,gBAAIO,EAAgB,GAAGrC,IAAI,CAACsC,YAAL;AAAA;AAAA,6CAAvB;AACAD,YAAAA,EAAE,CAACE,QAAH,CAAYjD,IAAZ,EAAkB2C,KAAlB;AACH;;AACD,eAAKW,mBAAL,CAAyBH,MAAzB,GAAkC;AAAA;AAAA,kCAAQC,gBAAR,CAAyB,uBAAzB,EAAkD,CAAC7B,OAAO,CAACgB,EAAT,CAAlD,CAAlC;AACH;;AAEDpB,QAAAA,UAAU,CAACH,QAAD,EAAqBN,IAArB,EAAiCiD,OAAjC,EAAmD;AACzD,cAAIC,IAAI,GAAG,IAAX;;AACA,cAAIlD,IAAI,CAACC,QAAL,CAAc,CAAd,CAAJ,EAAsB;AAClBiD,YAAAA,IAAI,GAAGlD,IAAI,CAACC,QAAL,CAAc,CAAd,CAAP;AACH,WAFD,MAEO;AACHiD,YAAAA,IAAI,GAAG;AAAA;AAAA,4CAAYxE,GAAZ,CAAgByE,cAAhB,CAA+B7C,QAA/B,EAAwCN,IAAxC,CAAP,CADG,CAEH;AACH;;AACD,cAAIqC,EAAY,GAAGa,IAAI,CAACZ,YAAL;AAAA;AAAA,mCAAnB;AACAD,UAAAA,EAAE,CAACe,aAAH,CAAiB9C,QAAjB,EATyD,CAUzD;;AACA+B,UAAAA,EAAE,CAACgB,aAAH,CAAiB,KAAjB;AACH;AACD;;;AACAC,QAAAA,OAAO,GAAG;AACN,cAAI,KAAK1F,UAAL,IAAmBF,SAAS,CAACG,KAAjC,EAAwC;AACpC,gBAAI;AAAA;AAAA,oDAAgBa,GAAhB,CAAoBiE,eAApB,MAAyC;AAAA;AAAA,oDAAgBjE,GAAhB,CAAoB+C,oBAApB,GAA2CC,MAAxF,EAAgG;AAC5F,kBAAIrD,GAAG,GAAG,IAAI;AAAA;AAAA,kCAAMkF,uBAAV,EAAV;AACA;AAAA;AAAA,8BAAIC,IAAJ,CAAS;AAAA;AAAA,kCAAMxF,GAAN,CAAUyF,mBAAnB,EAAwCpF,GAAxC;AACH;AACJ,WALD,MAKO;AACH,gBAAI;AAAA;AAAA,oDAAgBK,GAAhB,CAAoBkC,cAApB,MAAwC;AAAA;AAAA,oDAAgBlC,GAAhB,CAAoBoC,mBAApB,GAA0CC,QAAtF,EAAgG;AAC5F,kBAAI1C,GAAG,GAAG,IAAI;AAAA;AAAA,kCAAMqF,sBAAV,EAAV;AACA;AAAA;AAAA,8BAAIF,IAAJ,CAAS;AAAA;AAAA,kCAAMxF,GAAN,CAAU2F,kBAAnB,EAAuCtF,GAAvC;AACH;AACJ;AACJ;;AACSuF,QAAAA,SAAS,GAAS;AACxB,eAAK5C,4BAAL,CAAkC4C,SAAlC;AACA,eAAKlD,2BAAL,CAAiCkD,SAAjC;AACH;;AApLyC,O;;;;;iBAEvB,I;;;;;;;iBAED,I;;;;;;;iBAEC,I;;;;;;;iBAEM,I;;;;;;;iBAEF,I;;;;;;;iBAED,I;;;;;;;iBAED,I;;;;;;;iBAEA,I;;;;;;;iBAGQ,I;;;;;;;iBAGA,I;;;;;;;iBAEK,I;;;;;;;iBAGV,I;;;;;;;iBAEF,I;;;;;;;iBAEW,I;;;;;;;iBAGO,I;;;;;;;iBAEC,I","sourcesContent":["/*\r\n * @Date: 2024-05-14 17:48:33\r\n * @LastEditors: wzq\r\n * @等级|星级共鸣\r\n * @LastEditTime: 2024-08-12 10:08:35\r\n */\r\n\r\nimport { _decorator, Component, EventTouch, instantiate, Label, Node, Prefab } from 'cc';\r\nimport { ViewPop } from '../../../../framework/base/ViewPop';\r\nimport { HeroInfo } from '../HeroInfo';\r\nimport { ItemPoolMgr } from '../../item/ItemPoolMgr';\r\nimport { HeroItem } from '../../item/HeroItem';\r\nimport { HeroTeamControl } from '../HeroTeamControl';\r\nimport { HeroData } from '../HeroData';\r\nimport { HeroStar } from '../HeroStar';\r\nimport { HeroAttrItem } from './HeroAttrItem';\r\nimport { tab } from '../../../../Table/table_gen';\r\nimport { proto } from 'client_protocol';\r\nimport { Net } from '../../../net/Net';\r\nimport { RedMgr } from '../../../mgr/RedMgr';\r\nimport { RedDotType } from '../../../red/RedDotType';\r\nimport { EventMgr } from '../../../mgr/EventMgr';\r\nimport { LangMgr } from '../../../mgr/LangMgr';\r\nconst { ccclass, property } = _decorator;\r\nenum VIEW_TYPE {\r\n    LEVEL = 1,\r\n    STAR\r\n}\r\n@ccclass('HeroResonancePop')\r\nexport class HeroResonancePop extends ViewPop {\r\n    @property(Node)\r\n    node_level: Node = null;\r\n    @property(Node)\r\n    node_star: Node = null;\r\n    @property(Node)\r\n    node_heros: Node = null;\r\n    @property(Node)\r\n    node_attr_layout: Node = null;\r\n    @property(Node)\r\n    node_red_level: Node = null;\r\n    @property(Node)\r\n    node_red_star: Node = null;\r\n    @property(Node)\r\n    node_red_btn: Node = null;\r\n    @property(Node)\r\n    node_no_attr: Node = null;\r\n\r\n    @property(Label)\r\n    lbl_resonance_level: Label = null;\r\n\r\n    @property(Label)\r\n    lbl_resonance_value: Label = null;//共鸣之力12级\r\n    @property(Label)\r\n    lbl_resonance_value_next: Label = null;//共鸣等级达到12级激活共鸣之力5级\r\n\r\n    @property(Prefab)\r\n    pfb_attr_item: Prefab = null;\r\n    @property(Node)\r\n    node_lv_up_btn:Node = null;\r\n    @property(Node)\r\n    node_star_resonace_layout:Node = null;\r\n\r\n    @property(HeroStar)\r\n    HeroStar_cur_resonance_star: HeroStar = null;\r\n    @property(HeroStar)\r\n    HeroStar_next_resonance_star: HeroStar = null;\r\n\r\n    private _view_type: VIEW_TYPE = VIEW_TYPE.LEVEL;\r\n    register(): void {\r\n        EventMgr.onMsg(proto.Ptl.UpLevelResonanceRsp, this.on_s2c_UpLevelResonanceRsp, this);\r\n        EventMgr.onMsg(proto.Ptl.UpStarResonanceRsp, this.on_s2c_UpStarResonanceRsp, this);\r\n    }\r\n   \r\n    /* 等级共鸣 */\r\n    on_s2c_UpLevelResonanceRsp(msg: proto.Msg_UpLevelResonanceRsp) {\r\n        if (msg.error && msg.error.code != proto.CommonErrorCode.Succeed) return;\r\n        HeroTeamControl.ins.setTeamResonanceLevel(msg.levelResonance);\r\n        /* 更新等级共鸣红点 */\r\n        RedMgr.refreshEvent(RedDotType.HeroResonanceLevel);\r\n        this.switchView(null, String(this._view_type));\r\n    }\r\n    /* 星级共鸣 */\r\n    on_s2c_UpStarResonanceRsp(msg: proto.Msg_UpStarResonanceRsp) {\r\n        if (msg.error && msg.error.code != proto.CommonErrorCode.Succeed) return;\r\n        HeroTeamControl.ins.setTeamResonanceStar(msg.starResonance);\r\n        /* 更新等级共鸣红点 */\r\n        RedMgr.refreshEvent(RedDotType.HeroresonanceStar);\r\n        this.switchView(null, String(this._view_type));\r\n    }\r\n    onShow(): void {\r\n        this._view_type = VIEW_TYPE.LEVEL;\r\n        /* 开始默认是等级 */\r\n        this.switchView(null, String(this._view_type));\r\n    }\r\n    switchView(e: EventTouch, type: String) {\r\n        let view_type = Number(type);\r\n        this._view_type = view_type;\r\n        this.node_level.active = view_type === VIEW_TYPE.LEVEL;\r\n        this.node_star.active = view_type === VIEW_TYPE.STAR;\r\n        let parentNode = this.node_heros;\r\n        for (let i = 0; i < 5; i++) {\r\n            let node = parentNode.children[i];\r\n            let heroClass = Number(node.name);\r\n            let teamSlot: proto.ITeamSlot = HeroTeamControl.ins.getClassTeamData(heroClass);\r\n            let heroInfo = HeroData.ins.getById(teamSlot.heroId);\r\n            this.createItem(heroInfo, parentNode.children[i], view_type == VIEW_TYPE.LEVEL);\r\n        }\r\n        this.HeroStar_cur_resonance_star.showStar(HeroTeamControl.ins.getMinTeamStar());\r\n        let startab = HeroTeamControl.ins.getResonanceStarTab();\r\n        if(startab.NeedStar){\r\n            this.HeroStar_next_resonance_star.showStar(startab.NeedStar);\r\n        }\r\n        this.node_red_level.active = RedMgr.ins.isRed(RedDotType.HeroResonanceLevel);\r\n        this.node_red_star.active = RedMgr.ins.isRed(RedDotType.HeroresonanceStar);\r\n        if (view_type == VIEW_TYPE.LEVEL) {\r\n            this.showLevelView();\r\n            this.node_red_btn.active = RedMgr.ins.isRed(RedDotType.HeroResonanceLevel);\r\n        } else {\r\n            this.showStarView();\r\n            this.node_red_btn.active = RedMgr.ins.isRed(RedDotType.HeroresonanceStar);\r\n        }\r\n    }\r\n    showLevelView() {\r\n        // this.node_attr_layout.destroyAllChildren();\r\n        this.node_lv_up_btn.active = true;\r\n        let Leveltab = HeroTeamControl.ins.getResonanceLevelTab();\r\n        if(Leveltab.NeedLv===0){\r\n            this.node_lv_up_btn.active = false;\r\n            this.lbl_resonance_value_next.node.active = false;\r\n        }\r\n        this.node_no_attr.active = Leveltab.Id === 0;\r\n        this.node_attr_layout.active = Leveltab.Id > 0;\r\n        for (let i = 0; i < Leveltab.AttrTypes.length; i++) {\r\n            let type = Leveltab.AttrTypes[i];\r\n            let value = Leveltab.AttrValue[i];\r\n            if (value === 0) {\r\n                continue;\r\n            }\r\n            let node = this.node_attr_layout.children[i];\r\n            if (!node) {\r\n                node = instantiate(this.pfb_attr_item);\r\n                node.parent = this.node_attr_layout;\r\n            }\r\n            let ts: HeroAttrItem = node.getComponent(HeroAttrItem);\r\n            ts.initView(type, value);\r\n        }\r\n        this.lbl_resonance_level.string = LangMgr.getCombineString(\"ui_heroresonancepop_3\", [HeroTeamControl.ins.getMinTeamLevel()]);\r\n        this.lbl_resonance_value.string = LangMgr.getCombineString(\"ui_heroresonancepop_1\", [Leveltab.Id]);\r\n        if (Leveltab.NeedLv) {\r\n            let nextLeveltab = tab.getData().HeroLevelResonanceTable[Leveltab.Id + 1];\r\n            this.lbl_resonance_value_next.string = LangMgr.getCombineString(\"ui_heroresonancepop_2\", [Leveltab.NeedLv, nextLeveltab.Id]);\r\n        }\r\n    }\r\n    showStarView() {\r\n        this.node_lv_up_btn.active = true;\r\n        let startab = HeroTeamControl.ins.getResonanceStarTab();\r\n        if(startab.NeedStar===0){\r\n            this.node_lv_up_btn.active = false;\r\n            this.node_star_resonace_layout.active = false;\r\n        }\r\n        this.node_no_attr.active = startab.Id === 0;\r\n        this.node_attr_layout.active = startab.Id > 0;\r\n        for (let i = 0; i < startab.AttrTypes.length; i++) {\r\n            let type = startab.AttrTypes[i];\r\n            let value = startab.AttrValue[i];\r\n            if (value === 0) {\r\n                continue;\r\n            }\r\n            let node = this.node_attr_layout.children[i];\r\n            if (!node) {\r\n                node = instantiate(this.pfb_attr_item);\r\n                node.parent = this.node_attr_layout;\r\n            }\r\n            let ts: HeroAttrItem = node.getComponent(HeroAttrItem);\r\n            ts.initView(type, value);\r\n        }\r\n        this.lbl_resonance_value.string = LangMgr.getCombineString(\"ui_heroresonancepop_1\", [startab.Id]);\r\n    }\r\n   \r\n    createItem(heroInfo: HeroInfo, node: Node, isLevel: boolean) {\r\n        let item = null;\r\n        if (node.children[0]) {\r\n            item = node.children[0];\r\n        } else {\r\n            item = ItemPoolMgr.ins.createHeroItem(heroInfo,node);\r\n            // item.parent = node;\r\n        }\r\n        let ts: HeroItem = item.getComponent(HeroItem)\r\n        ts.UpdateContent(heroInfo);\r\n        // ts.setHeroActive(false, !isLevel);\r\n        ts.setHeroActive(false);\r\n    }\r\n    /* 点击共鸣升级 */\r\n    clickUp() {\r\n        if (this._view_type == VIEW_TYPE.LEVEL) {\r\n            if (HeroTeamControl.ins.getMinTeamLevel() >= HeroTeamControl.ins.getResonanceLevelTab().NeedLv) {\r\n                let msg = new proto.Msg_UpLevelResonanceReq()\r\n                Net.Send(proto.Ptl.UpLevelResonanceReq, msg)\r\n            }\r\n        } else {\r\n            if (HeroTeamControl.ins.getMinTeamStar() >= HeroTeamControl.ins.getResonanceStarTab().NeedStar) {\r\n                let msg = new proto.Msg_UpStarResonanceReq()\r\n                Net.Send(proto.Ptl.UpStarResonanceReq, msg)\r\n            }\r\n        }\r\n    }\r\n    protected onDisable(): void {\r\n        this.HeroStar_next_resonance_star.onDisable();\r\n        this.HeroStar_cur_resonance_star.onDisable();\r\n    }\r\n}\r\n\r\n\r\n"]}