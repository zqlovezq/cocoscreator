{"version":3,"sources":["file:///C:/chickenStarClient/client/assets/scripts/logic/model/shop/MallDataMgr.ts"],"names":["_decorator","AbsControl","RoleData","ccclass","property","MallDataMgr","_daily_shop_data","_fixed_shop_map","Map","_shopMap","ins","_instance","initDailyShop","msg","slots","sort","slot1","slot2","index","initFixedShop","shopInfoMap","shopMap","Object","keys","forEach","key","name","commodityMap","map","set","id","boughtCount","getDailyShopData","getFixedShopData","get","getFixedShopExpireTime","info","clientTime","getServerUtcTime","expireTime"],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;AAASA,MAAAA,U,OAAAA,U;;AACAC,MAAAA,U,iBAAAA,U;;AAIAC,MAAAA,Q,iBAAAA,Q;;;;;;;;;OACH;AAAEC,QAAAA,OAAF;AAAWC,QAAAA;AAAX,O,GAAwBJ,U;;6BAGjBK,W,WADZF,OAAO,CAAC,aAAD,C,2BAAR,MACaE,WADb;AAAA;AAAA,oCAC4C;AAAA;AAAA;AAAA,eAChCC,gBADgC,GACkB,IADlB;AACuB;AADvB,eAEhCC,eAFgC,GAEiB,IAAIC,GAAJ,EAFjB;AAAA,eAGhCC,QAHgC,GAGrB,IAHqB;AAAA;;AAKnB,mBAAHC,GAAG,GAAG;AACpB,cAAI,QAAQ,KAAKC,SAAjB,EAA4B;AACxB,iBAAKA,SAAL,GAAiB,IAAIN,WAAJ,EAAjB;AACH;;AACD,iBAAO,KAAKM,SAAZ;AACH,SAVuC,CAWxC;;;AACAC,QAAAA,aAAa,CAACC,GAAD,EAAoC;AAC7C,eAAKP,gBAAL,GAAwBO,GAAxB;;AACA,eAAKP,gBAAL,CAAsBQ,KAAtB,CAA4BC,IAA5B,CAAiC,CAACC,KAAD,EAAOC,KAAP,KAAe;AAC5C,mBAAOD,KAAK,CAACE,KAAN,GAAYD,KAAK,CAACC,KAAzB;AACH,WAFD;AAGH;;AACDC,QAAAA,aAAa,CAACN,GAAD,EAAsC;AAC/C,eAAKJ,QAAL,GAAgBI,GAAG,CAACO,WAApB;AACA,gBAAMC,OAAO,GAAGR,GAAG,CAACO,WAApB;AACAE,UAAAA,MAAM,CAACC,IAAP,CAAYF,OAAZ,EAAqBG,OAArB,CAA6BC,GAAG,IAAE;AAC9B,kBAAMC,IAAI,GAAGL,OAAO,CAACI,GAAD,CAAP,CAAaC,IAA1B;AACA,kBAAMC,YAAY,GAAGN,OAAO,CAACI,GAAD,CAAP,CAAaE,YAAlC;AACA,gBAAIC,GAAsB,GAAG,IAAIpB,GAAJ,EAA7B;AACAc,YAAAA,MAAM,CAACC,IAAP,CAAYI,YAAZ,EAA0BH,OAA1B,CAAkCC,GAAG,IAAE;AACnCG,cAAAA,GAAG,CAACC,GAAJ,CAAQF,YAAY,CAACF,GAAD,CAAZ,CAAkBK,EAA1B,EAA6BH,YAAY,CAACF,GAAD,CAAZ,CAAkBM,WAA/C;AACH,aAFD;;AAGA,iBAAKxB,eAAL,CAAqBsB,GAArB,CAAyBH,IAAzB,EAA8BE,GAA9B;AACH,WARD;AASH,SA9BuC,CA+BxC;;;AACAI,QAAAA,gBAAgB,GAAE;AACd,iBAAO,KAAK1B,gBAAZ;AACH,SAlCuC,CAmCxC;;;AACA2B,QAAAA,gBAAgB,CAACP,IAAD,EAAe;AAC3B,iBAAO,KAAKnB,eAAL,CAAqB2B,GAArB,CAAyBR,IAAzB,CAAP;AACH,SAtCuC,CAuCxC;;;AACAS,QAAAA,sBAAsB,CAACT,IAAD,EAAe;AACjC,gBAAMU,IAAyB,GAAG,KAAK3B,QAAL,CAAciB,IAAd,CAAlC;AACA,gBAAMW,UAAU,GAAG;AAAA;AAAA,oCAAS3B,GAAT,CAAa4B,gBAAb,EAAnB;;AACA,cAAGF,IAAI,IAAEC,UAAU,GAACD,IAAI,CAACG,UAAzB,EAAoC;AAChC,mBAAOH,IAAI,CAACG,UAAL,GAAgBF,UAAvB;AACH;;AACD,iBAAO,CAAC,CAAR;AACH;;AA/CuC,O,UAIzB1B,S","sourcesContent":["import { _decorator, Component, log, Node } from 'cc';\r\nimport { AbsControl } from '../../../framework/base/IAbs';\r\nimport { proto } from 'client_protocol';\r\nimport { tab } from '../../../Table/table_gen';\r\nimport { MALLNAME } from '../../../Common/script/EnumTypeMgr';\r\nimport { RoleData } from '../role/RoleData';\r\nconst { ccclass, property } = _decorator;\r\n\r\n@ccclass('MallDataMgr')\r\nexport class MallDataMgr extends AbsControl {\r\n    private _daily_shop_data: proto.Msg_GetDailyShopInfoRsp = null;//每日商店数据\r\n    private _fixed_shop_map:Map<number,Map<number,number>> = new Map();\r\n    private _shopMap = null;\r\n    private static _instance: MallDataMgr;\r\n    public static get ins() {\r\n        if (null == this._instance) {\r\n            this._instance = new MallDataMgr();\r\n        }\r\n        return this._instance;\r\n    }\r\n    // 设置每日商店信息\r\n    initDailyShop(msg: proto.Msg_GetDailyShopInfoRsp){\r\n        this._daily_shop_data = msg;\r\n        this._daily_shop_data.slots.sort((slot1,slot2)=>{\r\n            return slot1.index-slot2.index;\r\n        })\r\n    }\r\n    initFixedShop(msg:proto.Msg_GetFixedShopInfoMapRsp){\r\n        this._shopMap = msg.shopInfoMap;\r\n        const shopMap = msg.shopInfoMap;\r\n        Object.keys(shopMap).forEach(key=>{\r\n            const name = shopMap[key].name;\r\n            const commodityMap = shopMap[key].commodityMap;\r\n            let map:Map<number,number> = new Map()\r\n            Object.keys(commodityMap).forEach(key=>{\r\n                map.set(commodityMap[key].id,commodityMap[key].boughtCount)\r\n            })\r\n            this._fixed_shop_map.set(name,map);\r\n        })\r\n    }\r\n    // 根据\r\n    getDailyShopData(){\r\n        return this._daily_shop_data;\r\n    }\r\n    // 设置固定商店信息\r\n    getFixedShopData(name:MALLNAME){\r\n        return this._fixed_shop_map.get(name);\r\n    }\r\n    // 固定商店是否过期\r\n    getFixedShopExpireTime(name:MALLNAME){\r\n        const info:proto.IFixedShopInfo = this._shopMap[name]\r\n        const clientTime = RoleData.ins.getServerUtcTime()\r\n        if(info&&clientTime<info.expireTime){\r\n            return info.expireTime-clientTime\r\n        }\r\n        return -1;\r\n    }\r\n}\r\n\r\n\r\n"]}