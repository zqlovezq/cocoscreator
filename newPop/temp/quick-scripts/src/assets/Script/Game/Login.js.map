{"version":3,"sources":["assets/Script/Game/Login.ts"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;AAAA,oDAA+C;AAC/C,+CAA0C;AAC1C,2CAAkC;AAClC;IAAmC,yBAAY;IAA/C;;IA+JA,CAAC;IA7Ja,sBAAM,GAAhB;QACI,IAAI,KAAK,CAAC,QAAQ,KAAK,IAAI,EAAE;YACzB,KAAK,CAAC,QAAQ,GAAG,IAAI,CAAC;SACzB;aAAM;YACH,IAAI,CAAC,OAAO,EAAE,CAAC;YACf,OAAO;SACV;IACL,CAAC;IACD,yBAAS,GAAT;QACI,EAAE,CAAC,KAAK,CAAC,aAAa,EAAE,CAAC;QACzB,EAAE,CAAC,KAAK,CAAC,KAAK,GAAG,IAAI,EAAE,CAAC,WAAW,EAAE,CAAC;QACtC,uDAAuD;QACvD,qEAAqE;QACrE,oDAAoD;QACpD,qEAAqE;QACrE,uEAAuE;QACvE,IAAI,EAAE,CAAC,GAAG,CAAC,QAAQ,EAAE;YACjB,IAAI,OAAO,GAAG,EAAE,CAAC,GAAG,CAAC,YAAY,CAAC,OAAO,CAAC,OAAO,CAAC,CAAC;YACnD,IAAI,CAAC,OAAO,EAAE;gBACV,IAAI,CAAC,aAAa,EAAE,CAAC;aACxB;iBAAM;gBACH,qBAAW,CAAC,YAAY,CAAC,sBAAsB,EAAE,EAAE,GAAG,EAAE,OAAO,EAAE,OAAO,EAAE,CAAC,CAAA;gBAC3E,IAAI,CAAC,UAAU,EAAE,CAAC;aACrB;SACJ;aAAM;YACH,EAAE,CAAC,GAAG,CAAC,YAAY,CAAC,OAAO,CAAC,OAAO,EAAE,irBAAirB,CAAC,CAAC;YACxtB,IAAI,CAAC,UAAU,EAAE,CAAC;SACrB;IACL,CAAC;IACD,6BAAa,GAAb;QACI,4DAA4D;QAC5D,8BAA8B;QAC9B,6DAA6D;QAC7D,kEAAkE;QAClE,2EAA2E;QAC3E,6EAA6E;QAC7E,oGAAoG;QACpG,wGAAwG;QACxG,kEAAkE;QAClE,2EAA2E;QAE3E,uEAAuE;QACvE,8EAA8E;QAE9E,oEAAoE;QACpE,6EAA6E;QAE7E,0EAA0E;QAC1E,gFAAgF;IACpF,CAAC;IACD,iCAAiB,GAAjB,UAAkB,CAAC;QACf,+BAA+B;QAC/B,4BAA4B;IAChC,CAAC;IACD,6BAAa,GAAb,UAAc,CAAC;QACX,yBAAyB;QACzB,gDAAgD;QAChD,uBAAuB;QACvB,6BAA6B;QAC7B,6BAA6B;QAC7B,WAAW;QACX,4BAA4B;QAC5B,4BAA4B;QAC5B,IAAI;IACR,CAAC;IACD,8BAA8B;IAC9B,uCAAuC;IACvC,IAAI;IACJ,6BAA6B;IAC7B,sCAAsC;IACtC,IAAI;IACJ,+BAA+B;IAC/B,wCAAwC;IACxC,IAAI;IACJ,8BAA8B;IAC9B,uCAAuC;IACvC,IAAI;IACJ,2BAAW,GAAX;QACI,qGAAqG;QACrG,wGAAwG;QACxG,kEAAkE;QAClE,4EAA4E;QAE5E,uEAAuE;QACvE,+EAA+E;QAE/E,oEAAoE;QACpE,8EAA8E;QAE9E,0EAA0E;QAC1E,iFAAiF;QAEjF,6DAA6D;QAC7D,kEAAkE;QAClE,4EAA4E;QAC5E,8EAA8E;IAClF,CAAC;IACD,qBAAqB;IACrB,6BAA6B;IAC7B,+BAA+B;IAC/B,+DAA+D;IAC/D,mBAAmB;IACnB,yFAAyF;IACzF,YAAY;IACZ,QAAQ;IACR,IAAI;IACJ,0BAAU,GAAV;QAAA,iBA6BC;QA5BG,IAAI,QAAQ,GAAG,EAAE,CAAC;QAClB,EAAE,CAAC,KAAK,CAAC,WAAW,CAAC,UAAU,EAAE,KAAK,EAAE,QAAQ,CAAC,CAAC,IAAI,CAAC,UAAC,GAAG;YACvD,EAAE,CAAC,KAAK,CAAC,EAAE,CAAC,SAAS,GAAG,GAAG,CAAC,IAAI,CAAC,WAAW,CAAC;YAC7C,EAAE,CAAC,KAAK,CAAC,EAAE,CAAC,OAAO,GAAG,GAAG,CAAC,IAAI,CAAC,SAAS,CAAC;YACzC,EAAE,CAAC,KAAK,CAAC,EAAE,CAAC,KAAK,GAAG,GAAG,CAAC,IAAI,CAAC,aAAa,CAAC;YAC3C,EAAE,CAAC,KAAK,CAAC,EAAE,CAAC,cAAc,GAAG,GAAG,CAAC,IAAI,CAAC,cAAc,CAAC;YACrD,EAAE,CAAC,KAAK,CAAC,QAAQ,GAAG,GAAG,CAAC,IAAI,CAAC,QAAQ,CAAC;YACtC,EAAE;YACF,0DAA0D;YAC1D,8DAA8D;YAC9D,wBAAwB;YACxB,yBAAyB;YACzB,IAAI,QAAQ,GAAmB,KAAI,CAAC,IAAI,CAAC,cAAc,CAAC,UAAU,CAAC,CAAC,YAAY,CAAC,EAAE,CAAC,WAAW,CAAC,CAAC;YACjG,yBAAyB;YACzB,sDAAsD;YACtD,yDAAyD;YACzD,gCAAgC;YAChC,qCAAqC;YACrC,cAAc;YACd,wCAAwC;YACxC,sBAAY,CAAC,QAAQ,CAAC,aAAa,CAAC,oBAAM,EAAC,UAAC,GAAU,EAAE,KAAY;gBAChE,QAAQ,CAAC,QAAQ,GAAG,GAAG,GAAC,KAAK,CAAC;gBAC9B,IAAI,EAAE,GAAG,QAAQ,CAAC,IAAI,CAAC,cAAc,CAAC,IAAI,CAAC,CAAC;gBAC5C,EAAE,CAAC,CAAC,GAAG,GAAG,GAAC,QAAQ,CAAC,QAAQ,GAAC,EAAE,CAAC,KAAK,GAAC,CAAC,GAAC,EAAE,CAAC;YAC/C,CAAC,EAAC;gBACE,sBAAY,CAAC,QAAQ,CAAC,SAAS,CAAC,MAAM,EAAC,MAAM,CAAC,CAAC;YACnD,CAAC,CAAC,CAAC;QACP,CAAC,CAAC,CAAA;IACN,CAAC;IACD,uBAAO,GAAP,UAAQ,IAAY;QAApB,iBAoBC;QAnBG,oLAAoL;QACpL,IAAI,IAAI,GAAG;YACP,SAAS,EAAE,EAAE,CAAC,KAAK,CAAC,UAAU,CAAC,OAAO,CAAC,CAAC,CAAC,EAAE,CAAC,KAAK,CAAC,UAAU,CAAC,OAAO,CAAC,CAAC,CAAC,EAAE;YACzE,MAAM,EAAE,EAAE,CAAC,KAAK,CAAC,UAAU,CAAC,IAAI,CAAC,CAAC,CAAC,EAAE,CAAC,KAAK,CAAC,UAAU,CAAC,IAAI,CAAC,CAAC,CAAC,EAAE;YAChE,KAAK,EAAE,EAAE,CAAC,KAAK,CAAC,UAAU,CAAC,GAAG,CAAC,CAAC,CAAC,EAAE,CAAC,KAAK,CAAC,UAAU,CAAC,GAAG,CAAC,CAAC,CAAC,EAAE;YAC7D,aAAa,EAAE,EAAE,CAAC,KAAK,CAAC,UAAU,CAAC,GAAG,CAAC,CAAC,CAAC,EAAE,CAAC,KAAK,CAAC,UAAU,CAAC,GAAG,CAAC,CAAC,CAAC,EAAE;YACrE,MAAM,EAAE,EAAE,CAAC,KAAK,CAAC,UAAU,CAAC,IAAI,CAAC,CAAC,CAAC,EAAE,CAAC,KAAK,CAAC,UAAU,CAAC,IAAI,CAAC,CAAC,CAAC,EAAE;YAChE,YAAY,EAAE,EAAE,CAAC,KAAK,CAAC,UAAU,CAAC,UAAU,CAAC,CAAC,CAAC,EAAE,CAAC,KAAK,CAAC,UAAU,CAAC,UAAU,CAAC,CAAC,CAAC,EAAE;YAClF,cAAc,EAAE,EAAE,CAAC,KAAK,CAAC,UAAU,CAAC,YAAY,CAAC,CAAC,CAAC,EAAE,CAAC,KAAK,CAAC,UAAU,CAAC,YAAY,CAAC,CAAC,CAAC,EAAE;YACxF,MAAM,EAAE,IAAI;SACf,CAAA;QACD,EAAE,CAAC,GAAG,CAAC,YAAY,CAAC,OAAO,CAAC,SAAS,EAAE,EAAE,CAAC,KAAK,CAAC,UAAU,CAAC,OAAO,CAAC,CAAC,CAAC,EAAE,CAAC,KAAK,CAAC,UAAU,CAAC,OAAO,CAAC,CAAC,CAAC,EAAE,CAAC,CAAC;QACvG,EAAE,CAAC,GAAG,CAAC,YAAY,CAAC,OAAO,CAAC,cAAc,EAAE,EAAE,CAAC,KAAK,CAAC,UAAU,CAAC,YAAY,CAAC,CAAC,CAAC,EAAE,CAAC,KAAK,CAAC,UAAU,CAAC,YAAY,CAAC,CAAC,CAAC,EAAE,CAAC,CAAC;QACtH,EAAE,CAAC,KAAK,CAAC,WAAW,CAAC,UAAU,EAAE,MAAM,EAAE,IAAI,CAAC,CAAC,IAAI,CAAC,UAAC,GAAG;YACpD,EAAE,CAAC,GAAG,CAAC,YAAY,CAAC,OAAO,CAAC,OAAO,EAAE,GAAG,CAAC,IAAI,CAAC,KAAK,CAAC,CAAC;YACrD,qBAAW,CAAC,YAAY,CAAC,sBAAsB,EAAE,EAAE,GAAG,EAAE,OAAO,EAAE,GAAG,CAAC,IAAI,CAAC,KAAK,EAAE,CAAC,CAAA;YAClF,KAAI,CAAC,WAAW,EAAE,CAAC;YACnB,KAAI,CAAC,UAAU,EAAE,CAAC;QACtB,CAAC,CAAC,CAAA;IACN,CAAC;IA7Ja,cAAQ,GAAU,IAAI,CAAC;IA8JzC,YAAC;CA/JD,AA+JC,CA/JkC,EAAE,CAAC,SAAS,GA+J9C;kBA/JoB,KAAK","file":"","sourceRoot":"/","sourcesContent":["import CocosBridge from \"../Tools/CocosBridge\";\nimport AssetsBundle from \"./AssetsBundle\";\nimport resPkg from \"./GameResPkg\";\nexport default class Login extends cc.Component {\n    public static Instance: Login = null;\n    protected onLoad(): void {\n        if (Login.Instance === null) {\n            Login.Instance = this;\n        } else {\n            this.destroy();\n            return;\n        }\n    }\n    LoginGame(): void {\n        cc.Tools.screenAdapter();\n        cc.Tools.Event = new cc.EventTarget();\n        // this.loginLayer = this.node.getChildByName(\"login\");\n        // cc.Tools.breatheAnim(this.loginLayer.getChildByName(\"login_btn\"));\n        // cc.Tools.Event.on('getCode', this.getCode, this);\n        // this.userPrivacy = this.loginLayer.getChildByName(\"user_privacy\");\n        // this.userProtocol = this.loginLayer.getChildByName(\"user_protocol\");\n        if (cc.sys.isNative) {\n            let wxToken = cc.sys.localStorage.getItem(\"token\");\n            if (!wxToken) {\n                this.registerEvent();\n            } else {\n                CocosBridge.JSCallNative(\"preLoadRewardVideoAd\", \"\" + { \"token\": wxToken })\n                this.getAdTimes();\n            }\n        } else {\n            cc.sys.localStorage.setItem(\"token\", \"eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJWZXJzaW9uIjowLCJ1c2VyX2lkIjo3OTU5Miwib3Blbl9pZCI6Im9qbGR1NmIyMFMzbWtJM1pWNmgxOS1oU1YwQlUiLCJuaWNrX25hbWUiOiJZLvCfjLUiLCJnZW5kZXIiOjAsImF2YXRhciI6Imh0dHBzOi8vdGhpcmR3eC5xbG9nby5jbi9tbW9wZW4vdmlfMzIvNE9SaGdyendTeEVJUXk1anJmNXR3VE0wdmQ1ZjBHRDVGVWZiejRiV01ybktNVVJKVVJzQzhFMHZ2OTdLUVFFdERUR1RrbncxYWVka0FtZFEyeDZpYkRnLzEzMiIsImNyZWF0ZV90aW1lIjoxNjQ1NDI1NjYzLCJjaGFubmVsIjoibWVpenUyIiwiZGlzdGluY3RfaWQiOiI4ZDZjMGRmZC0yMzAzLTQwMTUtOTNjNS1lMjY1NGU1ZTI4ZmQiLCJpbWVpIjoiIiwibWFjIjoiMDI6MDA6MDA6MDA6MDA6MDAiLCJhbmRyb2lkX2lkIjoiNzZjZWYzMWRlNGE1NDY3NCIsIm9haWQiOiJmZWVmNWZiYi1jZjZiLTY3MzItYmM3Zi01YmZmNzdkZGRiNzkifQ.BmVpohnKod-1_L2paFDLMSDO1YgQR6CjUNTj1IXYMkc\");\n            this.getAdTimes();\n        }\n    }\n    registerEvent(): void {\n        // this.protect = this.loginLayer.getChildByName(\"protect\");\n        // this.protect.active = true;\n        // let acceptBtn = this.protect.getChildByName(\"accept_btn\");\n        // let noAcceptBtn = this.protect.getChildByName(\"no_accept_btn\");\n        // acceptBtn.on(cc.Node.EventType.TOUCH_END, this.closeProtectLayer, this);\n        // noAcceptBtn.on(cc.Node.EventType.TOUCH_END, this.closeProtectLayer, this);\n        // this.loginLayer.getChildByName(\"login_btn\").on(cc.Node.EventType.TOUCH_END, this.loginBtn, this);\n        // this.loginLayer.getChildByName(\"surn_btn\").on(cc.Node.EventType.TOUCH_END, this.clickProtocol, this);\n        // let privacyBtn = this.loginLayer.getChildByName(\"privacy_btn\");\n        // privacyBtn.on(cc.Node.EventType.TOUCH_END, this.showPrivacyLayer, this);\n\n        // let closePrivacy = this.userPrivacy.getChildByName(\"close_privacy\");\n        // closePrivacy.on(cc.Node.EventType.TOUCH_END, this.closePrivacyLayer, this);\n\n        // let protocolBtn = this.loginLayer.getChildByName(\"protocol_btn\");\n        // protocolBtn.on(cc.Node.EventType.TOUCH_END, this.showProtocolLayer, this);\n\n        // let closeProtocol = this.userProtocol.getChildByName(\"close_protocol\");\n        // closeProtocol.on(cc.Node.EventType.TOUCH_END, this.closeProtocolLayer, this);\n    }\n    closeProtectLayer(e): void {\n        // this.protect.active = false;\n        // cc.Tools.getPermission();\n    }\n    clickProtocol(e): void {\n        // let target = e.target;\n        // let select = target.getChildByName(\"select\");\n        // if (this.protocol) {\n        //     select.active = false;\n        //     this.protocol = false;\n        // } else {\n        //     select.active = true;\n        //     this.protocol = true;\n        // }\n    }\n    // closePrivacyLayer(): void {\n    //     this.userPrivacy.active = false;\n    // }\n    // showPrivacyLayer(): void {\n    //     this.userPrivacy.active = true;\n    // }\n    // closeProtocolLayer(): void {\n    //     this.userProtocol.active = false;\n    // }\n    // showProtocolLayer(): void {\n    //     this.userProtocol.active = true;\n    // }\n    removeEvent(): void {\n        // this.loginLayer.getChildByName(\"login_btn\").off(cc.Node.EventType.TOUCH_END, this.loginBtn, this);\n        // this.loginLayer.getChildByName(\"surn_btn\").off(cc.Node.EventType.TOUCH_END, this.clickProtocol, this)\n        // let privacyBtn = this.loginLayer.getChildByName(\"privacy_btn\");\n        // privacyBtn.off(cc.Node.EventType.TOUCH_END, this.showPrivacyLayer, this);\n\n        // let closePrivacy = this.userPrivacy.getChildByName(\"close_privacy\");\n        // closePrivacy.off(cc.Node.EventType.TOUCH_END, this.closePrivacyLayer, this);\n\n        // let protocolBtn = this.loginLayer.getChildByName(\"protocol_btn\");\n        // protocolBtn.off(cc.Node.EventType.TOUCH_END, this.showProtocolLayer, this);\n\n        // let closeProtocol = this.userProtocol.getChildByName(\"close_protocol\");\n        // closeProtocol.off(cc.Node.EventType.TOUCH_END, this.closeProtocolLayer, this);\n\n        // let acceptBtn = this.protect.getChildByName(\"accept_btn\");\n        // let noAcceptBtn = this.protect.getChildByName(\"no_accept_btn\");\n        // acceptBtn.off(cc.Node.EventType.TOUCH_END, this.closeProtectLayer, this);\n        // noAcceptBtn.off(cc.Node.EventType.TOUCH_END, this.closeProtectLayer, this);\n    }\n    // loginBtn(): void {\n    //     if (cc.sys.isNative) {\n    //         if (this.protocol) {\n    //             CocosBridge.JSCallNative(\"wxLogin\", \"wx_login\");\n    //         } else {\n    //             cc.Tools.showTips(this.loginLayer, \"<color=#000000>请先同意隐私政策和用户协议</color>\")\n    //         }\n    //     }\n    // }\n    getAdTimes(): void {\n        let sendData = {};\n        cc.Tools.sendRequest(\"UserStat\", \"GET\", sendData).then((res) => {\n            cc.Tools.ad.adShowNum = res.data.ad_show_num;\n            cc.Tools.ad.adPosId = res.data.ad_pos_id;\n            cc.Tools.ad.adDif = res.data.is_need_watch;\n            cc.Tools.ad.steal_left_num = res.data.steal_left_num;\n            cc.Tools.treasure = res.data.treasure;\n            //\n            // let login: cc.Node = this.node.getChildByName(\"login\");\n            // let loading: cc.Node = this.node.getChildByName(\"loading\");\n            // login.active = false;\n            // loading.active = true;\n            let progress: cc.ProgressBar = this.node.getChildByName(\"progress\").getComponent(cc.ProgressBar);\n            // progress.progress = 0;\n            // let icon: cc.Node = loading.getChildByName(\"icon\");\n            // cc.tween(progress).to(2, { progress: 1 }).call(() => {\n            //     this.startUpdate = false;\n            //     cc.director.loadScene('Main');\n            // }).start();\n            // icon.runAction(cc.moveBy(2, 500, 0));\n            AssetsBundle.Instance.preloadResPkg(resPkg,(now:number, total:number)=>{\n                progress.progress = now/total;\n                let sp = progress.node.getChildByName(\"sp\");\n                sp.x = 608*progress.progress+sp.width/2-20;\n            },()=>{\n                AssetsBundle.Instance.loadScene(\"Game\",\"Main\");\n            });\n        })\n    }\n    getCode(code: string): void {\n        // {\"channel\":\"walk\",\"imei\":\"\",\"android_id\":\"8bacfc24ece79979\",\"mac\":\"02:00:00:00:00:00\",\"uid\":\"3b0fe5ec-050d-46bf-aac6-0dc5aa5889c4\",\"oaid\":\"fbf75dfb-fffd-7f02-6ef6-f7ffbfad8da6\"}\n        let data = {\n            \"channel\": cc.Tools.DeviceInfo.channel ? cc.Tools.DeviceInfo.channel : \"\",\n            \"imei\": cc.Tools.DeviceInfo.imei ? cc.Tools.DeviceInfo.imei : \"\",\n            \"mac\": cc.Tools.DeviceInfo.mac ? cc.Tools.DeviceInfo.mac : \"\",\n            \"distinct_id\": cc.Tools.DeviceInfo.uid ? cc.Tools.DeviceInfo.uid : \"\",\n            \"oaid\": cc.Tools.DeviceInfo.oaid ? cc.Tools.DeviceInfo.oaid : \"\",\n            \"android_id\": cc.Tools.DeviceInfo.android_id ? cc.Tools.DeviceInfo.android_id : \"\",\n            \"sm_device_id\": cc.Tools.DeviceInfo.sm_device_id ? cc.Tools.DeviceInfo.sm_device_id : \"\",\n            \"code\": code\n        }\n        cc.sys.localStorage.setItem(\"channel\", cc.Tools.DeviceInfo.channel ? cc.Tools.DeviceInfo.channel : \"\");\n        cc.sys.localStorage.setItem(\"sm_device_id\", cc.Tools.DeviceInfo.sm_device_id ? cc.Tools.DeviceInfo.sm_device_id : \"\");\n        cc.Tools.sendRequest(\"register\", \"POST\", data).then((res) => {\n            cc.sys.localStorage.setItem(\"token\", res.data.token);\n            CocosBridge.JSCallNative(\"preLoadRewardVideoAd\", \"\" + { \"token\": res.data.token })\n            this.removeEvent();\n            this.getAdTimes();\n        })\n    }\n}\n"]}